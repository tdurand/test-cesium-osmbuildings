var Ow=Object.defineProperty;var xw=(t,e,n)=>e in t?Ow(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var d=(t,e,n)=>(xw(t,typeof e!="symbol"?e+"":e,n),n);function Nw(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var G5=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function M0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var B0={exports:{}},J={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ca=Symbol.for("react.element"),Fw=Symbol.for("react.portal"),Dw=Symbol.for("react.fragment"),Uw=Symbol.for("react.strict_mode"),kw=Symbol.for("react.profiler"),Lw=Symbol.for("react.provider"),Vw=Symbol.for("react.context"),Hw=Symbol.for("react.forward_ref"),zw=Symbol.for("react.suspense"),jw=Symbol.for("react.memo"),Ww=Symbol.for("react.lazy"),$_=Symbol.iterator;function Xw(t){return t===null||typeof t!="object"?null:(t=$_&&t[$_]||t["@@iterator"],typeof t=="function"?t:null)}var P0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},O0=Object.assign,x0={};function Hi(t,e,n){this.props=t,this.context=e,this.refs=x0,this.updater=n||P0}Hi.prototype.isReactComponent={};Hi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Hi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function N0(){}N0.prototype=Hi.prototype;function bp(t,e,n){this.props=t,this.context=e,this.refs=x0,this.updater=n||P0}var Ip=bp.prototype=new N0;Ip.constructor=bp;O0(Ip,Hi.prototype);Ip.isPureReactComponent=!0;var K_=Array.isArray,F0=Object.prototype.hasOwnProperty,Mp={current:null},D0={key:!0,ref:!0,__self:!0,__source:!0};function U0(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)F0.call(e,r)&&!D0.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];s.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Ca,type:t,key:i,ref:o,props:s,_owner:Mp.current}}function Gw(t,e){return{$$typeof:Ca,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Bp(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ca}function $w(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Y_=/\/+/g;function oh(t,e){return typeof t=="object"&&t!==null&&t.key!=null?$w(""+t.key):e.toString(36)}function Hc(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Ca:case Fw:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+oh(o,0):r,K_(s)?(n="",t!=null&&(n=t.replace(Y_,"$&/")+"/"),Hc(s,e,n,"",function(l){return l})):s!=null&&(Bp(s)&&(s=Gw(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Y_,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",K_(t))for(var a=0;a<t.length;a++){i=t[a];var c=r+oh(i,a);o+=Hc(i,e,n,c,s)}else if(c=Xw(t),typeof c=="function")for(t=c.call(t),a=0;!(i=t.next()).done;)i=i.value,c=r+oh(i,a++),o+=Hc(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Ya(t,e,n){if(t==null)return t;var r=[],s=0;return Hc(t,r,"","",function(i){return e.call(n,i,s++)}),r}function Kw(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ot={current:null},zc={transition:null},Yw={ReactCurrentDispatcher:ot,ReactCurrentBatchConfig:zc,ReactCurrentOwner:Mp};function k0(){throw Error("act(...) is not supported in production builds of React.")}J.Children={map:Ya,forEach:function(t,e,n){Ya(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Ya(t,function(){e++}),e},toArray:function(t){return Ya(t,function(e){return e})||[]},only:function(t){if(!Bp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};J.Component=Hi;J.Fragment=Dw;J.Profiler=kw;J.PureComponent=bp;J.StrictMode=Uw;J.Suspense=zw;J.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Yw;J.act=k0;J.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=O0({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Mp.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)F0.call(e,c)&&!D0.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:Ca,type:t.type,key:s,ref:i,props:r,_owner:o}};J.createContext=function(t){return t={$$typeof:Vw,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Lw,_context:t},t.Consumer=t};J.createElement=U0;J.createFactory=function(t){var e=U0.bind(null,t);return e.type=t,e};J.createRef=function(){return{current:null}};J.forwardRef=function(t){return{$$typeof:Hw,render:t}};J.isValidElement=Bp;J.lazy=function(t){return{$$typeof:Ww,_payload:{_status:-1,_result:t},_init:Kw}};J.memo=function(t,e){return{$$typeof:jw,type:t,compare:e===void 0?null:e}};J.startTransition=function(t){var e=zc.transition;zc.transition={};try{t()}finally{zc.transition=e}};J.unstable_act=k0;J.useCallback=function(t,e){return ot.current.useCallback(t,e)};J.useContext=function(t){return ot.current.useContext(t)};J.useDebugValue=function(){};J.useDeferredValue=function(t){return ot.current.useDeferredValue(t)};J.useEffect=function(t,e){return ot.current.useEffect(t,e)};J.useId=function(){return ot.current.useId()};J.useImperativeHandle=function(t,e,n){return ot.current.useImperativeHandle(t,e,n)};J.useInsertionEffect=function(t,e){return ot.current.useInsertionEffect(t,e)};J.useLayoutEffect=function(t,e){return ot.current.useLayoutEffect(t,e)};J.useMemo=function(t,e){return ot.current.useMemo(t,e)};J.useReducer=function(t,e,n){return ot.current.useReducer(t,e,n)};J.useRef=function(t){return ot.current.useRef(t)};J.useState=function(t){return ot.current.useState(t)};J.useSyncExternalStore=function(t,e,n){return ot.current.useSyncExternalStore(t,e,n)};J.useTransition=function(){return ot.current.useTransition()};J.version="18.3.1";B0.exports=J;var H=B0.exports;const Ff=M0(H);var L0={exports:{}},It={},V0={exports:{}},H0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(z,G){var $=z.length;z.push(G);e:for(;0<$;){var pe=$-1>>>1,ce=z[pe];if(0<s(ce,G))z[pe]=G,z[$]=ce,$=pe;else break e}}function n(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var G=z[0],$=z.pop();if($!==G){z[0]=$;e:for(var pe=0,ce=z.length,ir=ce>>>1;pe<ir;){var Bt=2*(pe+1)-1,Gr=z[Bt],xn=Bt+1,Me=z[xn];if(0>s(Gr,$))xn<ce&&0>s(Me,Gr)?(z[pe]=Me,z[xn]=$,pe=xn):(z[pe]=Gr,z[Bt]=$,pe=Bt);else if(xn<ce&&0>s(Me,$))z[pe]=Me,z[xn]=$,pe=xn;else break e}}return G}function s(z,G){var $=z.sortIndex-G.sortIndex;return $!==0?$:z.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,h=null,f=3,p=!1,m=!1,y=!1,w=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(z){for(var G=n(l);G!==null;){if(G.callback===null)r(l);else if(G.startTime<=z)r(l),G.sortIndex=G.expirationTime,e(c,G);else break;G=n(l)}}function C(z){if(y=!1,T(z),!m)if(n(c)!==null)m=!0,sr(I);else{var G=n(l);G!==null&&On(C,G.startTime-z)}}function I(z,G){m=!1,y&&(y=!1,_(N),N=-1),p=!0;var $=f;try{for(T(G),h=n(c);h!==null&&(!(h.expirationTime>G)||z&&!X());){var pe=h.callback;if(typeof pe=="function"){h.callback=null,f=h.priorityLevel;var ce=pe(h.expirationTime<=G);G=t.unstable_now(),typeof ce=="function"?h.callback=ce:h===n(c)&&r(c),T(G)}else r(c);h=n(c)}if(h!==null)var ir=!0;else{var Bt=n(l);Bt!==null&&On(C,Bt.startTime-G),ir=!1}return ir}finally{h=null,f=$,p=!1}}var P=!1,x=null,N=-1,D=5,F=-1;function X(){return!(t.unstable_now()-F<D)}function q(){if(x!==null){var z=t.unstable_now();F=z;var G=!0;try{G=x(!0,z)}finally{G?ee():(P=!1,x=null)}}else P=!1}var ee;if(typeof g=="function")ee=function(){g(q)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,He=K.port2;K.port1.onmessage=q,ee=function(){He.postMessage(null)}}else ee=function(){w(q,0)};function sr(z){x=z,P||(P=!0,ee())}function On(z,G){N=w(function(){z(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(z){z.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,sr(I))},t.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<z?Math.floor(1e3/z):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(z){switch(f){case 1:case 2:case 3:var G=3;break;default:G=f}var $=f;f=G;try{return z()}finally{f=$}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(z,G){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var $=f;f=z;try{return G()}finally{f=$}},t.unstable_scheduleCallback=function(z,G,$){var pe=t.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?pe+$:pe):$=pe,z){case 1:var ce=-1;break;case 2:ce=250;break;case 5:ce=1073741823;break;case 4:ce=1e4;break;default:ce=5e3}return ce=$+ce,z={id:u++,callback:G,priorityLevel:z,startTime:$,expirationTime:ce,sortIndex:-1},$>pe?(z.sortIndex=$,e(l,z),n(c)===null&&z===n(l)&&(y?(_(N),N=-1):y=!0,On(C,$-pe))):(z.sortIndex=ce,e(c,z),m||p||(m=!0,sr(I))),z},t.unstable_shouldYield=X,t.unstable_wrapCallback=function(z){var G=f;return function(){var $=f;f=G;try{return z.apply(this,arguments)}finally{f=$}}}})(H0);V0.exports=H0;var Jw=V0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qw=H,bt=Jw;function L(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var z0=new Set,Jo={};function vs(t,e){vi(t,e),vi(t+"Capture",e)}function vi(t,e){for(Jo[t]=e,t=0;t<e.length;t++)z0.add(e[t])}var Jn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Df=Object.prototype.hasOwnProperty,Qw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,J_={},q_={};function Zw(t){return Df.call(q_,t)?!0:Df.call(J_,t)?!1:Qw.test(t)?q_[t]=!0:(J_[t]=!0,!1)}function eR(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function tR(t,e,n,r){if(e===null||typeof e>"u"||eR(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function at(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Ge={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ge[t]=new at(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ge[e]=new at(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ge[t]=new at(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ge[t]=new at(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ge[t]=new at(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ge[t]=new at(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ge[t]=new at(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ge[t]=new at(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ge[t]=new at(t,5,!1,t.toLowerCase(),null,!1,!1)});var Pp=/[\-:]([a-z])/g;function Op(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Pp,Op);Ge[e]=new at(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Pp,Op);Ge[e]=new at(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Pp,Op);Ge[e]=new at(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ge[t]=new at(t,1,!1,t.toLowerCase(),null,!1,!1)});Ge.xlinkHref=new at("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ge[t]=new at(t,1,!1,t.toLowerCase(),null,!0,!0)});function xp(t,e,n,r){var s=Ge.hasOwnProperty(e)?Ge[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(tR(e,n,s,r)&&(n=null),r||s===null?Zw(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var nr=qw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ja=Symbol.for("react.element"),Xs=Symbol.for("react.portal"),Gs=Symbol.for("react.fragment"),Np=Symbol.for("react.strict_mode"),Uf=Symbol.for("react.profiler"),j0=Symbol.for("react.provider"),W0=Symbol.for("react.context"),Fp=Symbol.for("react.forward_ref"),kf=Symbol.for("react.suspense"),Lf=Symbol.for("react.suspense_list"),Dp=Symbol.for("react.memo"),pr=Symbol.for("react.lazy"),X0=Symbol.for("react.offscreen"),Q_=Symbol.iterator;function eo(t){return t===null||typeof t!="object"?null:(t=Q_&&t[Q_]||t["@@iterator"],typeof t=="function"?t:null)}var ve=Object.assign,ah;function To(t){if(ah===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);ah=e&&e[1]||""}return`
`+ah+t}var ch=!1;function lh(t,e){if(!t||ch)return"";ch=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){r=l}t.call(e.prototype)}else{try{throw Error()}catch(l){r=l}t()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var s=l.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{ch=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?To(t):""}function nR(t){switch(t.tag){case 5:return To(t.type);case 16:return To("Lazy");case 13:return To("Suspense");case 19:return To("SuspenseList");case 0:case 2:case 15:return t=lh(t.type,!1),t;case 11:return t=lh(t.type.render,!1),t;case 1:return t=lh(t.type,!0),t;default:return""}}function Vf(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Gs:return"Fragment";case Xs:return"Portal";case Uf:return"Profiler";case Np:return"StrictMode";case kf:return"Suspense";case Lf:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case W0:return(t.displayName||"Context")+".Consumer";case j0:return(t._context.displayName||"Context")+".Provider";case Fp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Dp:return e=t.displayName||null,e!==null?e:Vf(t.type)||"Memo";case pr:e=t._payload,t=t._init;try{return Vf(t(e))}catch{}}return null}function rR(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Vf(e);case 8:return e===Np?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Nr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function G0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function sR(t){var e=G0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function qa(t){t._valueTracker||(t._valueTracker=sR(t))}function $0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=G0(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function ol(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Hf(t,e){var n=e.checked;return ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Z_(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Nr(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function K0(t,e){e=e.checked,e!=null&&xp(t,"checked",e,!1)}function zf(t,e){K0(t,e);var n=Nr(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?jf(t,e.type,n):e.hasOwnProperty("defaultValue")&&jf(t,e.type,Nr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function em(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function jf(t,e,n){(e!=="number"||ol(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Eo=Array.isArray;function fi(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Nr(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Wf(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(L(91));return ve({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function tm(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(L(92));if(Eo(n)){if(1<n.length)throw Error(L(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Nr(n)}}function Y0(t,e){var n=Nr(e.value),r=Nr(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function nm(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function J0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Xf(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?J0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Qa,q0=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Qa=Qa||document.createElement("div"),Qa.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Qa.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function qo(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Bo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},iR=["Webkit","ms","Moz","O"];Object.keys(Bo).forEach(function(t){iR.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Bo[e]=Bo[t]})});function Q0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Bo.hasOwnProperty(t)&&Bo[t]?(""+e).trim():e+"px"}function Z0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Q0(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var oR=ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Gf(t,e){if(e){if(oR[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(L(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(L(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(L(61))}if(e.style!=null&&typeof e.style!="object")throw Error(L(62))}}function $f(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kf=null;function Up(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Yf=null,di=null,pi=null;function rm(t){if(t=Ra(t)){if(typeof Yf!="function")throw Error(L(280));var e=t.stateNode;e&&(e=Su(e),Yf(t.stateNode,t.type,e))}}function eE(t){di?pi?pi.push(t):pi=[t]:di=t}function tE(){if(di){var t=di,e=pi;if(pi=di=null,rm(t),e)for(t=0;t<e.length;t++)rm(e[t])}}function nE(t,e){return t(e)}function rE(){}var uh=!1;function sE(t,e,n){if(uh)return t(e,n);uh=!0;try{return nE(t,e,n)}finally{uh=!1,(di!==null||pi!==null)&&(rE(),tE())}}function Qo(t,e){var n=t.stateNode;if(n===null)return null;var r=Su(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(L(231,e,typeof n));return n}var Jf=!1;if(Jn)try{var to={};Object.defineProperty(to,"passive",{get:function(){Jf=!0}}),window.addEventListener("test",to,to),window.removeEventListener("test",to,to)}catch{Jf=!1}function aR(t,e,n,r,s,i,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var Po=!1,al=null,cl=!1,qf=null,cR={onError:function(t){Po=!0,al=t}};function lR(t,e,n,r,s,i,o,a,c){Po=!1,al=null,aR.apply(cR,arguments)}function uR(t,e,n,r,s,i,o,a,c){if(lR.apply(this,arguments),Po){if(Po){var l=al;Po=!1,al=null}else throw Error(L(198));cl||(cl=!0,qf=l)}}function ws(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function iE(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function sm(t){if(ws(t)!==t)throw Error(L(188))}function hR(t){var e=t.alternate;if(!e){if(e=ws(t),e===null)throw Error(L(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return sm(s),t;if(i===r)return sm(s),e;i=i.sibling}throw Error(L(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o)throw Error(L(189))}}if(n.alternate!==r)throw Error(L(190))}if(n.tag!==3)throw Error(L(188));return n.stateNode.current===n?t:e}function oE(t){return t=hR(t),t!==null?aE(t):null}function aE(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=aE(t);if(e!==null)return e;t=t.sibling}return null}var cE=bt.unstable_scheduleCallback,im=bt.unstable_cancelCallback,fR=bt.unstable_shouldYield,dR=bt.unstable_requestPaint,Ie=bt.unstable_now,pR=bt.unstable_getCurrentPriorityLevel,kp=bt.unstable_ImmediatePriority,lE=bt.unstable_UserBlockingPriority,ll=bt.unstable_NormalPriority,gR=bt.unstable_LowPriority,uE=bt.unstable_IdlePriority,Au=null,Bn=null;function _R(t){if(Bn&&typeof Bn.onCommitFiberRoot=="function")try{Bn.onCommitFiberRoot(Au,t,void 0,(t.current.flags&128)===128)}catch{}}var rn=Math.clz32?Math.clz32:yR,mR=Math.log,AR=Math.LN2;function yR(t){return t>>>=0,t===0?32:31-(mR(t)/AR|0)|0}var Za=64,ec=4194304;function So(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function ul(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~s;a!==0?r=So(a):(i&=o,i!==0&&(r=So(i)))}else o=n&~s,o!==0?r=So(o):i!==0&&(r=So(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-rn(e),s=1<<n,r|=t[n],e&=~s;return r}function TR(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ER(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-rn(i),a=1<<o,c=s[o];c===-1?(!(a&n)||a&r)&&(s[o]=TR(a,e)):c<=e&&(t.expiredLanes|=a),i&=~a}}function Qf(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function hE(){var t=Za;return Za<<=1,!(Za&4194240)&&(Za=64),t}function hh(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function va(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-rn(e),t[e]=n}function SR(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-rn(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Lp(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-rn(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var le=0;function fE(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var dE,Vp,pE,gE,_E,Zf=!1,tc=[],vr=null,wr=null,Rr=null,Zo=new Map,ea=new Map,Ar=[],CR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function om(t,e){switch(t){case"focusin":case"focusout":vr=null;break;case"dragenter":case"dragleave":wr=null;break;case"mouseover":case"mouseout":Rr=null;break;case"pointerover":case"pointerout":Zo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ea.delete(e.pointerId)}}function no(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Ra(e),e!==null&&Vp(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function vR(t,e,n,r,s){switch(e){case"focusin":return vr=no(vr,t,e,n,r,s),!0;case"dragenter":return wr=no(wr,t,e,n,r,s),!0;case"mouseover":return Rr=no(Rr,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Zo.set(i,no(Zo.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,ea.set(i,no(ea.get(i)||null,t,e,n,r,s)),!0}return!1}function mE(t){var e=is(t.target);if(e!==null){var n=ws(e);if(n!==null){if(e=n.tag,e===13){if(e=iE(n),e!==null){t.blockedOn=e,_E(t.priority,function(){pE(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function jc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=ed(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Kf=r,n.target.dispatchEvent(r),Kf=null}else return e=Ra(n),e!==null&&Vp(e),t.blockedOn=n,!1;e.shift()}return!0}function am(t,e,n){jc(t)&&n.delete(e)}function wR(){Zf=!1,vr!==null&&jc(vr)&&(vr=null),wr!==null&&jc(wr)&&(wr=null),Rr!==null&&jc(Rr)&&(Rr=null),Zo.forEach(am),ea.forEach(am)}function ro(t,e){t.blockedOn===e&&(t.blockedOn=null,Zf||(Zf=!0,bt.unstable_scheduleCallback(bt.unstable_NormalPriority,wR)))}function ta(t){function e(s){return ro(s,t)}if(0<tc.length){ro(tc[0],t);for(var n=1;n<tc.length;n++){var r=tc[n];r.blockedOn===t&&(r.blockedOn=null)}}for(vr!==null&&ro(vr,t),wr!==null&&ro(wr,t),Rr!==null&&ro(Rr,t),Zo.forEach(e),ea.forEach(e),n=0;n<Ar.length;n++)r=Ar[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ar.length&&(n=Ar[0],n.blockedOn===null);)mE(n),n.blockedOn===null&&Ar.shift()}var gi=nr.ReactCurrentBatchConfig,hl=!0;function RR(t,e,n,r){var s=le,i=gi.transition;gi.transition=null;try{le=1,Hp(t,e,n,r)}finally{le=s,gi.transition=i}}function bR(t,e,n,r){var s=le,i=gi.transition;gi.transition=null;try{le=4,Hp(t,e,n,r)}finally{le=s,gi.transition=i}}function Hp(t,e,n,r){if(hl){var s=ed(t,e,n,r);if(s===null)Eh(t,e,r,fl,n),om(t,r);else if(vR(s,t,e,n,r))r.stopPropagation();else if(om(t,r),e&4&&-1<CR.indexOf(t)){for(;s!==null;){var i=Ra(s);if(i!==null&&dE(i),i=ed(t,e,n,r),i===null&&Eh(t,e,r,fl,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else Eh(t,e,r,null,n)}}var fl=null;function ed(t,e,n,r){if(fl=null,t=Up(r),t=is(t),t!==null)if(e=ws(t),e===null)t=null;else if(n=e.tag,n===13){if(t=iE(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return fl=t,null}function AE(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(pR()){case kp:return 1;case lE:return 4;case ll:case gR:return 16;case uE:return 536870912;default:return 16}default:return 16}}var Tr=null,zp=null,Wc=null;function yE(){if(Wc)return Wc;var t,e=zp,n=e.length,r,s="value"in Tr?Tr.value:Tr.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return Wc=s.slice(t,1<r?1-r:void 0)}function Xc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function nc(){return!0}function cm(){return!1}function Mt(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?nc:cm,this.isPropagationStopped=cm,this}return ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=nc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=nc)},persist:function(){},isPersistent:nc}),e}var zi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jp=Mt(zi),wa=ve({},zi,{view:0,detail:0}),IR=Mt(wa),fh,dh,so,yu=ve({},wa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wp,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==so&&(so&&t.type==="mousemove"?(fh=t.screenX-so.screenX,dh=t.screenY-so.screenY):dh=fh=0,so=t),fh)},movementY:function(t){return"movementY"in t?t.movementY:dh}}),lm=Mt(yu),MR=ve({},yu,{dataTransfer:0}),BR=Mt(MR),PR=ve({},wa,{relatedTarget:0}),ph=Mt(PR),OR=ve({},zi,{animationName:0,elapsedTime:0,pseudoElement:0}),xR=Mt(OR),NR=ve({},zi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),FR=Mt(NR),DR=ve({},zi,{data:0}),um=Mt(DR),UR={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kR={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},LR={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function VR(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=LR[t])?!!e[t]:!1}function Wp(){return VR}var HR=ve({},wa,{key:function(t){if(t.key){var e=UR[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Xc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?kR[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wp,charCode:function(t){return t.type==="keypress"?Xc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Xc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),zR=Mt(HR),jR=ve({},yu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hm=Mt(jR),WR=ve({},wa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wp}),XR=Mt(WR),GR=ve({},zi,{propertyName:0,elapsedTime:0,pseudoElement:0}),$R=Mt(GR),KR=ve({},yu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),YR=Mt(KR),JR=[9,13,27,32],Xp=Jn&&"CompositionEvent"in window,Oo=null;Jn&&"documentMode"in document&&(Oo=document.documentMode);var qR=Jn&&"TextEvent"in window&&!Oo,TE=Jn&&(!Xp||Oo&&8<Oo&&11>=Oo),fm=String.fromCharCode(32),dm=!1;function EE(t,e){switch(t){case"keyup":return JR.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function SE(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var $s=!1;function QR(t,e){switch(t){case"compositionend":return SE(e);case"keypress":return e.which!==32?null:(dm=!0,fm);case"textInput":return t=e.data,t===fm&&dm?null:t;default:return null}}function ZR(t,e){if($s)return t==="compositionend"||!Xp&&EE(t,e)?(t=yE(),Wc=zp=Tr=null,$s=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return TE&&e.locale!=="ko"?null:e.data;default:return null}}var eb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!eb[t.type]:e==="textarea"}function CE(t,e,n,r){eE(r),e=dl(e,"onChange"),0<e.length&&(n=new jp("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var xo=null,na=null;function tb(t){NE(t,0)}function Tu(t){var e=Js(t);if($0(e))return t}function nb(t,e){if(t==="change")return e}var vE=!1;if(Jn){var gh;if(Jn){var _h="oninput"in document;if(!_h){var gm=document.createElement("div");gm.setAttribute("oninput","return;"),_h=typeof gm.oninput=="function"}gh=_h}else gh=!1;vE=gh&&(!document.documentMode||9<document.documentMode)}function _m(){xo&&(xo.detachEvent("onpropertychange",wE),na=xo=null)}function wE(t){if(t.propertyName==="value"&&Tu(na)){var e=[];CE(e,na,t,Up(t)),sE(tb,e)}}function rb(t,e,n){t==="focusin"?(_m(),xo=e,na=n,xo.attachEvent("onpropertychange",wE)):t==="focusout"&&_m()}function sb(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Tu(na)}function ib(t,e){if(t==="click")return Tu(e)}function ob(t,e){if(t==="input"||t==="change")return Tu(e)}function ab(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var cn=typeof Object.is=="function"?Object.is:ab;function ra(t,e){if(cn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Df.call(e,s)||!cn(t[s],e[s]))return!1}return!0}function mm(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Am(t,e){var n=mm(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=mm(n)}}function RE(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?RE(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function bE(){for(var t=window,e=ol();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=ol(t.document)}return e}function Gp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function cb(t){var e=bE(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&RE(n.ownerDocument.documentElement,n)){if(r!==null&&Gp(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Am(n,i);var o=Am(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var lb=Jn&&"documentMode"in document&&11>=document.documentMode,Ks=null,td=null,No=null,nd=!1;function ym(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;nd||Ks==null||Ks!==ol(r)||(r=Ks,"selectionStart"in r&&Gp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),No&&ra(No,r)||(No=r,r=dl(td,"onSelect"),0<r.length&&(e=new jp("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Ks)))}function rc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ys={animationend:rc("Animation","AnimationEnd"),animationiteration:rc("Animation","AnimationIteration"),animationstart:rc("Animation","AnimationStart"),transitionend:rc("Transition","TransitionEnd")},mh={},IE={};Jn&&(IE=document.createElement("div").style,"AnimationEvent"in window||(delete Ys.animationend.animation,delete Ys.animationiteration.animation,delete Ys.animationstart.animation),"TransitionEvent"in window||delete Ys.transitionend.transition);function Eu(t){if(mh[t])return mh[t];if(!Ys[t])return t;var e=Ys[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in IE)return mh[t]=e[n];return t}var ME=Eu("animationend"),BE=Eu("animationiteration"),PE=Eu("animationstart"),OE=Eu("transitionend"),xE=new Map,Tm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Hr(t,e){xE.set(t,e),vs(e,[t])}for(var Ah=0;Ah<Tm.length;Ah++){var yh=Tm[Ah],ub=yh.toLowerCase(),hb=yh[0].toUpperCase()+yh.slice(1);Hr(ub,"on"+hb)}Hr(ME,"onAnimationEnd");Hr(BE,"onAnimationIteration");Hr(PE,"onAnimationStart");Hr("dblclick","onDoubleClick");Hr("focusin","onFocus");Hr("focusout","onBlur");Hr(OE,"onTransitionEnd");vi("onMouseEnter",["mouseout","mouseover"]);vi("onMouseLeave",["mouseout","mouseover"]);vi("onPointerEnter",["pointerout","pointerover"]);vi("onPointerLeave",["pointerout","pointerover"]);vs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));vs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));vs("onBeforeInput",["compositionend","keypress","textInput","paste"]);vs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));vs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));vs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Co="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fb=new Set("cancel close invalid load scroll toggle".split(" ").concat(Co));function Em(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,uR(r,e,void 0,t),t.currentTarget=null}function NE(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==i&&s.isPropagationStopped())break e;Em(s,a,l),i=c}else for(o=0;o<r.length;o++){if(a=r[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==i&&s.isPropagationStopped())break e;Em(s,a,l),i=c}}}if(cl)throw t=qf,cl=!1,qf=null,t}function me(t,e){var n=e[ad];n===void 0&&(n=e[ad]=new Set);var r=t+"__bubble";n.has(r)||(FE(e,t,2,!1),n.add(r))}function Th(t,e,n){var r=0;e&&(r|=4),FE(n,t,r,e)}var sc="_reactListening"+Math.random().toString(36).slice(2);function sa(t){if(!t[sc]){t[sc]=!0,z0.forEach(function(n){n!=="selectionchange"&&(fb.has(n)||Th(n,!1,t),Th(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[sc]||(e[sc]=!0,Th("selectionchange",!1,e))}}function FE(t,e,n,r){switch(AE(e)){case 1:var s=RR;break;case 4:s=bR;break;default:s=Hp}n=s.bind(null,e,n,t),s=void 0,!Jf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Eh(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;a!==null;){if(o=is(a),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}a=a.parentNode}}r=r.return}sE(function(){var l=i,u=Up(n),h=[];e:{var f=xE.get(t);if(f!==void 0){var p=jp,m=t;switch(t){case"keypress":if(Xc(n)===0)break e;case"keydown":case"keyup":p=zR;break;case"focusin":m="focus",p=ph;break;case"focusout":m="blur",p=ph;break;case"beforeblur":case"afterblur":p=ph;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=lm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=BR;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=XR;break;case ME:case BE:case PE:p=xR;break;case OE:p=$R;break;case"scroll":p=IR;break;case"wheel":p=YR;break;case"copy":case"cut":case"paste":p=FR;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=hm}var y=(e&4)!==0,w=!y&&t==="scroll",_=y?f!==null?f+"Capture":null:f;y=[];for(var g=l,T;g!==null;){T=g;var C=T.stateNode;if(T.tag===5&&C!==null&&(T=C,_!==null&&(C=Qo(g,_),C!=null&&y.push(ia(g,C,T)))),w)break;g=g.return}0<y.length&&(f=new p(f,m,null,n,u),h.push({event:f,listeners:y}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",f&&n!==Kf&&(m=n.relatedTarget||n.fromElement)&&(is(m)||m[qn]))break e;if((p||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=l,m=m?is(m):null,m!==null&&(w=ws(m),m!==w||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=l),p!==m)){if(y=lm,C="onMouseLeave",_="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(y=hm,C="onPointerLeave",_="onPointerEnter",g="pointer"),w=p==null?f:Js(p),T=m==null?f:Js(m),f=new y(C,g+"leave",p,n,u),f.target=w,f.relatedTarget=T,C=null,is(u)===l&&(y=new y(_,g+"enter",m,n,u),y.target=T,y.relatedTarget=w,C=y),w=C,p&&m)t:{for(y=p,_=m,g=0,T=y;T;T=Os(T))g++;for(T=0,C=_;C;C=Os(C))T++;for(;0<g-T;)y=Os(y),g--;for(;0<T-g;)_=Os(_),T--;for(;g--;){if(y===_||_!==null&&y===_.alternate)break t;y=Os(y),_=Os(_)}y=null}else y=null;p!==null&&Sm(h,f,p,y,!1),m!==null&&w!==null&&Sm(h,w,m,y,!0)}}e:{if(f=l?Js(l):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var I=nb;else if(pm(f))if(vE)I=ob;else{I=sb;var P=rb}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(I=ib);if(I&&(I=I(t,l))){CE(h,I,n,u);break e}P&&P(t,f,l),t==="focusout"&&(P=f._wrapperState)&&P.controlled&&f.type==="number"&&jf(f,"number",f.value)}switch(P=l?Js(l):window,t){case"focusin":(pm(P)||P.contentEditable==="true")&&(Ks=P,td=l,No=null);break;case"focusout":No=td=Ks=null;break;case"mousedown":nd=!0;break;case"contextmenu":case"mouseup":case"dragend":nd=!1,ym(h,n,u);break;case"selectionchange":if(lb)break;case"keydown":case"keyup":ym(h,n,u)}var x;if(Xp)e:{switch(t){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else $s?EE(t,n)&&(N="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(N="onCompositionStart");N&&(TE&&n.locale!=="ko"&&($s||N!=="onCompositionStart"?N==="onCompositionEnd"&&$s&&(x=yE()):(Tr=u,zp="value"in Tr?Tr.value:Tr.textContent,$s=!0)),P=dl(l,N),0<P.length&&(N=new um(N,t,null,n,u),h.push({event:N,listeners:P}),x?N.data=x:(x=SE(n),x!==null&&(N.data=x)))),(x=qR?QR(t,n):ZR(t,n))&&(l=dl(l,"onBeforeInput"),0<l.length&&(u=new um("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:l}),u.data=x))}NE(h,e)})}function ia(t,e,n){return{instance:t,listener:e,currentTarget:n}}function dl(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Qo(t,n),i!=null&&r.unshift(ia(t,i,s)),i=Qo(t,e),i!=null&&r.push(ia(t,i,s))),t=t.return}return r}function Os(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Sm(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&l!==null&&(a=l,s?(c=Qo(n,i),c!=null&&o.unshift(ia(n,c,a))):s||(c=Qo(n,i),c!=null&&o.push(ia(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var db=/\r\n?/g,pb=/\u0000|\uFFFD/g;function Cm(t){return(typeof t=="string"?t:""+t).replace(db,`
`).replace(pb,"")}function ic(t,e,n){if(e=Cm(e),Cm(t)!==e&&n)throw Error(L(425))}function pl(){}var rd=null,sd=null;function id(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var od=typeof setTimeout=="function"?setTimeout:void 0,gb=typeof clearTimeout=="function"?clearTimeout:void 0,vm=typeof Promise=="function"?Promise:void 0,_b=typeof queueMicrotask=="function"?queueMicrotask:typeof vm<"u"?function(t){return vm.resolve(null).then(t).catch(mb)}:od;function mb(t){setTimeout(function(){throw t})}function Sh(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),ta(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);ta(e)}function br(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function wm(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ji=Math.random().toString(36).slice(2),vn="__reactFiber$"+ji,oa="__reactProps$"+ji,qn="__reactContainer$"+ji,ad="__reactEvents$"+ji,Ab="__reactListeners$"+ji,yb="__reactHandles$"+ji;function is(t){var e=t[vn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[qn]||n[vn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=wm(t);t!==null;){if(n=t[vn])return n;t=wm(t)}return e}t=n,n=t.parentNode}return null}function Ra(t){return t=t[vn]||t[qn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Js(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(L(33))}function Su(t){return t[oa]||null}var cd=[],qs=-1;function zr(t){return{current:t}}function Ae(t){0>qs||(t.current=cd[qs],cd[qs]=null,qs--)}function _e(t,e){qs++,cd[qs]=t.current,t.current=e}var Fr={},et=zr(Fr),gt=zr(!1),ms=Fr;function wi(t,e){var n=t.type.contextTypes;if(!n)return Fr;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function _t(t){return t=t.childContextTypes,t!=null}function gl(){Ae(gt),Ae(et)}function Rm(t,e,n){if(et.current!==Fr)throw Error(L(168));_e(et,e),_e(gt,n)}function DE(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(L(108,rR(t)||"Unknown",s));return ve({},n,r)}function _l(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Fr,ms=et.current,_e(et,t),_e(gt,gt.current),!0}function bm(t,e,n){var r=t.stateNode;if(!r)throw Error(L(169));n?(t=DE(t,e,ms),r.__reactInternalMemoizedMergedChildContext=t,Ae(gt),Ae(et),_e(et,t)):Ae(gt),_e(gt,n)}var Hn=null,Cu=!1,Ch=!1;function UE(t){Hn===null?Hn=[t]:Hn.push(t)}function Tb(t){Cu=!0,UE(t)}function jr(){if(!Ch&&Hn!==null){Ch=!0;var t=0,e=le;try{var n=Hn;for(le=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Hn=null,Cu=!1}catch(s){throw Hn!==null&&(Hn=Hn.slice(t+1)),cE(kp,jr),s}finally{le=e,Ch=!1}}return null}var Qs=[],Zs=0,ml=null,Al=0,Nt=[],Ft=0,As=null,jn=1,Wn="";function Zr(t,e){Qs[Zs++]=Al,Qs[Zs++]=ml,ml=t,Al=e}function kE(t,e,n){Nt[Ft++]=jn,Nt[Ft++]=Wn,Nt[Ft++]=As,As=t;var r=jn;t=Wn;var s=32-rn(r)-1;r&=~(1<<s),n+=1;var i=32-rn(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,jn=1<<32-rn(e)+s|n<<s|r,Wn=i+t}else jn=1<<i|n<<s|r,Wn=t}function $p(t){t.return!==null&&(Zr(t,1),kE(t,1,0))}function Kp(t){for(;t===ml;)ml=Qs[--Zs],Qs[Zs]=null,Al=Qs[--Zs],Qs[Zs]=null;for(;t===As;)As=Nt[--Ft],Nt[Ft]=null,Wn=Nt[--Ft],Nt[Ft]=null,jn=Nt[--Ft],Nt[Ft]=null}var Rt=null,Ct=null,ye=!1,Jt=null;function LE(t,e){var n=Dt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Im(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Rt=t,Ct=br(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Rt=t,Ct=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=As!==null?{id:jn,overflow:Wn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Dt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Rt=t,Ct=null,!0):!1;default:return!1}}function ld(t){return(t.mode&1)!==0&&(t.flags&128)===0}function ud(t){if(ye){var e=Ct;if(e){var n=e;if(!Im(t,e)){if(ld(t))throw Error(L(418));e=br(n.nextSibling);var r=Rt;e&&Im(t,e)?LE(r,n):(t.flags=t.flags&-4097|2,ye=!1,Rt=t)}}else{if(ld(t))throw Error(L(418));t.flags=t.flags&-4097|2,ye=!1,Rt=t}}}function Mm(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Rt=t}function oc(t){if(t!==Rt)return!1;if(!ye)return Mm(t),ye=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!id(t.type,t.memoizedProps)),e&&(e=Ct)){if(ld(t))throw VE(),Error(L(418));for(;e;)LE(t,e),e=br(e.nextSibling)}if(Mm(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(L(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Ct=br(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Ct=null}}else Ct=Rt?br(t.stateNode.nextSibling):null;return!0}function VE(){for(var t=Ct;t;)t=br(t.nextSibling)}function Ri(){Ct=Rt=null,ye=!1}function Yp(t){Jt===null?Jt=[t]:Jt.push(t)}var Eb=nr.ReactCurrentBatchConfig;function io(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(L(309));var r=n.stateNode}if(!r)throw Error(L(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(L(284));if(!n._owner)throw Error(L(290,t))}return t}function ac(t,e){throw t=Object.prototype.toString.call(e),Error(L(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Bm(t){var e=t._init;return e(t._payload)}function HE(t){function e(_,g){if(t){var T=_.deletions;T===null?(_.deletions=[g],_.flags|=16):T.push(g)}}function n(_,g){if(!t)return null;for(;g!==null;)e(_,g),g=g.sibling;return null}function r(_,g){for(_=new Map;g!==null;)g.key!==null?_.set(g.key,g):_.set(g.index,g),g=g.sibling;return _}function s(_,g){return _=Pr(_,g),_.index=0,_.sibling=null,_}function i(_,g,T){return _.index=T,t?(T=_.alternate,T!==null?(T=T.index,T<g?(_.flags|=2,g):T):(_.flags|=2,g)):(_.flags|=1048576,g)}function o(_){return t&&_.alternate===null&&(_.flags|=2),_}function a(_,g,T,C){return g===null||g.tag!==6?(g=Bh(T,_.mode,C),g.return=_,g):(g=s(g,T),g.return=_,g)}function c(_,g,T,C){var I=T.type;return I===Gs?u(_,g,T.props.children,C,T.key):g!==null&&(g.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===pr&&Bm(I)===g.type)?(C=s(g,T.props),C.ref=io(_,g,T),C.return=_,C):(C=Qc(T.type,T.key,T.props,null,_.mode,C),C.ref=io(_,g,T),C.return=_,C)}function l(_,g,T,C){return g===null||g.tag!==4||g.stateNode.containerInfo!==T.containerInfo||g.stateNode.implementation!==T.implementation?(g=Ph(T,_.mode,C),g.return=_,g):(g=s(g,T.children||[]),g.return=_,g)}function u(_,g,T,C,I){return g===null||g.tag!==7?(g=ds(T,_.mode,C,I),g.return=_,g):(g=s(g,T),g.return=_,g)}function h(_,g,T){if(typeof g=="string"&&g!==""||typeof g=="number")return g=Bh(""+g,_.mode,T),g.return=_,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Ja:return T=Qc(g.type,g.key,g.props,null,_.mode,T),T.ref=io(_,null,g),T.return=_,T;case Xs:return g=Ph(g,_.mode,T),g.return=_,g;case pr:var C=g._init;return h(_,C(g._payload),T)}if(Eo(g)||eo(g))return g=ds(g,_.mode,T,null),g.return=_,g;ac(_,g)}return null}function f(_,g,T,C){var I=g!==null?g.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return I!==null?null:a(_,g,""+T,C);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Ja:return T.key===I?c(_,g,T,C):null;case Xs:return T.key===I?l(_,g,T,C):null;case pr:return I=T._init,f(_,g,I(T._payload),C)}if(Eo(T)||eo(T))return I!==null?null:u(_,g,T,C,null);ac(_,T)}return null}function p(_,g,T,C,I){if(typeof C=="string"&&C!==""||typeof C=="number")return _=_.get(T)||null,a(g,_,""+C,I);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Ja:return _=_.get(C.key===null?T:C.key)||null,c(g,_,C,I);case Xs:return _=_.get(C.key===null?T:C.key)||null,l(g,_,C,I);case pr:var P=C._init;return p(_,g,T,P(C._payload),I)}if(Eo(C)||eo(C))return _=_.get(T)||null,u(g,_,C,I,null);ac(g,C)}return null}function m(_,g,T,C){for(var I=null,P=null,x=g,N=g=0,D=null;x!==null&&N<T.length;N++){x.index>N?(D=x,x=null):D=x.sibling;var F=f(_,x,T[N],C);if(F===null){x===null&&(x=D);break}t&&x&&F.alternate===null&&e(_,x),g=i(F,g,N),P===null?I=F:P.sibling=F,P=F,x=D}if(N===T.length)return n(_,x),ye&&Zr(_,N),I;if(x===null){for(;N<T.length;N++)x=h(_,T[N],C),x!==null&&(g=i(x,g,N),P===null?I=x:P.sibling=x,P=x);return ye&&Zr(_,N),I}for(x=r(_,x);N<T.length;N++)D=p(x,_,N,T[N],C),D!==null&&(t&&D.alternate!==null&&x.delete(D.key===null?N:D.key),g=i(D,g,N),P===null?I=D:P.sibling=D,P=D);return t&&x.forEach(function(X){return e(_,X)}),ye&&Zr(_,N),I}function y(_,g,T,C){var I=eo(T);if(typeof I!="function")throw Error(L(150));if(T=I.call(T),T==null)throw Error(L(151));for(var P=I=null,x=g,N=g=0,D=null,F=T.next();x!==null&&!F.done;N++,F=T.next()){x.index>N?(D=x,x=null):D=x.sibling;var X=f(_,x,F.value,C);if(X===null){x===null&&(x=D);break}t&&x&&X.alternate===null&&e(_,x),g=i(X,g,N),P===null?I=X:P.sibling=X,P=X,x=D}if(F.done)return n(_,x),ye&&Zr(_,N),I;if(x===null){for(;!F.done;N++,F=T.next())F=h(_,F.value,C),F!==null&&(g=i(F,g,N),P===null?I=F:P.sibling=F,P=F);return ye&&Zr(_,N),I}for(x=r(_,x);!F.done;N++,F=T.next())F=p(x,_,N,F.value,C),F!==null&&(t&&F.alternate!==null&&x.delete(F.key===null?N:F.key),g=i(F,g,N),P===null?I=F:P.sibling=F,P=F);return t&&x.forEach(function(q){return e(_,q)}),ye&&Zr(_,N),I}function w(_,g,T,C){if(typeof T=="object"&&T!==null&&T.type===Gs&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case Ja:e:{for(var I=T.key,P=g;P!==null;){if(P.key===I){if(I=T.type,I===Gs){if(P.tag===7){n(_,P.sibling),g=s(P,T.props.children),g.return=_,_=g;break e}}else if(P.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===pr&&Bm(I)===P.type){n(_,P.sibling),g=s(P,T.props),g.ref=io(_,P,T),g.return=_,_=g;break e}n(_,P);break}else e(_,P);P=P.sibling}T.type===Gs?(g=ds(T.props.children,_.mode,C,T.key),g.return=_,_=g):(C=Qc(T.type,T.key,T.props,null,_.mode,C),C.ref=io(_,g,T),C.return=_,_=C)}return o(_);case Xs:e:{for(P=T.key;g!==null;){if(g.key===P)if(g.tag===4&&g.stateNode.containerInfo===T.containerInfo&&g.stateNode.implementation===T.implementation){n(_,g.sibling),g=s(g,T.children||[]),g.return=_,_=g;break e}else{n(_,g);break}else e(_,g);g=g.sibling}g=Ph(T,_.mode,C),g.return=_,_=g}return o(_);case pr:return P=T._init,w(_,g,P(T._payload),C)}if(Eo(T))return m(_,g,T,C);if(eo(T))return y(_,g,T,C);ac(_,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,g!==null&&g.tag===6?(n(_,g.sibling),g=s(g,T),g.return=_,_=g):(n(_,g),g=Bh(T,_.mode,C),g.return=_,_=g),o(_)):n(_,g)}return w}var bi=HE(!0),zE=HE(!1),yl=zr(null),Tl=null,ei=null,Jp=null;function qp(){Jp=ei=Tl=null}function Qp(t){var e=yl.current;Ae(yl),t._currentValue=e}function hd(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function _i(t,e){Tl=t,Jp=ei=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(dt=!0),t.firstContext=null)}function jt(t){var e=t._currentValue;if(Jp!==t)if(t={context:t,memoizedValue:e,next:null},ei===null){if(Tl===null)throw Error(L(308));ei=t,Tl.dependencies={lanes:0,firstContext:t}}else ei=ei.next=t;return e}var os=null;function Zp(t){os===null?os=[t]:os.push(t)}function jE(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Zp(e)):(n.next=s.next,s.next=n),e.interleaved=n,Qn(t,r)}function Qn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var gr=!1;function eg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function WE(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Yn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ir(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ne&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Qn(t,n)}return s=r.interleaved,s===null?(e.next=e,Zp(r)):(e.next=s.next,s.next=e),r.interleaved=e,Qn(t,n)}function Gc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Lp(t,n)}}function Pm(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function El(t,e,n,r){var s=t.updateQueue;gr=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?i=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;o=0,u=l=c=null,a=i;do{var f=a.lane,p=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,y=a;switch(f=e,p=n,y.tag){case 1:if(m=y.payload,typeof m=="function"){h=m.call(p,h,f);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=y.payload,f=typeof m=="function"?m.call(p,h,f):m,f==null)break e;h=ve({},h,f);break e;case 2:gr=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[a]:f.push(a))}else p={eventTime:p,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=p,c=h):u=u.next=p,o|=f;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;f=a,a=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(1);if(u===null&&(c=h),s.baseState=c,s.firstBaseUpdate=l,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Ts|=o,t.lanes=o,t.memoizedState=h}}function Om(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(L(191,s));s.call(r)}}}var ba={},Pn=zr(ba),aa=zr(ba),ca=zr(ba);function as(t){if(t===ba)throw Error(L(174));return t}function tg(t,e){switch(_e(ca,e),_e(aa,t),_e(Pn,ba),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Xf(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Xf(e,t)}Ae(Pn),_e(Pn,e)}function Ii(){Ae(Pn),Ae(aa),Ae(ca)}function XE(t){as(ca.current);var e=as(Pn.current),n=Xf(e,t.type);e!==n&&(_e(aa,t),_e(Pn,n))}function ng(t){aa.current===t&&(Ae(Pn),Ae(aa))}var Ee=zr(0);function Sl(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var vh=[];function rg(){for(var t=0;t<vh.length;t++)vh[t]._workInProgressVersionPrimary=null;vh.length=0}var $c=nr.ReactCurrentDispatcher,wh=nr.ReactCurrentBatchConfig,ys=0,Ce=null,Ne=null,Le=null,Cl=!1,Fo=!1,la=0,Sb=0;function $e(){throw Error(L(321))}function sg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!cn(t[n],e[n]))return!1;return!0}function ig(t,e,n,r,s,i){if(ys=i,Ce=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,$c.current=t===null||t.memoizedState===null?Rb:bb,t=n(r,s),Fo){i=0;do{if(Fo=!1,la=0,25<=i)throw Error(L(301));i+=1,Le=Ne=null,e.updateQueue=null,$c.current=Ib,t=n(r,s)}while(Fo)}if($c.current=vl,e=Ne!==null&&Ne.next!==null,ys=0,Le=Ne=Ce=null,Cl=!1,e)throw Error(L(300));return t}function og(){var t=la!==0;return la=0,t}function Sn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Le===null?Ce.memoizedState=Le=t:Le=Le.next=t,Le}function Wt(){if(Ne===null){var t=Ce.alternate;t=t!==null?t.memoizedState:null}else t=Ne.next;var e=Le===null?Ce.memoizedState:Le.next;if(e!==null)Le=e,Ne=t;else{if(t===null)throw Error(L(310));Ne=t,t={memoizedState:Ne.memoizedState,baseState:Ne.baseState,baseQueue:Ne.baseQueue,queue:Ne.queue,next:null},Le===null?Ce.memoizedState=Le=t:Le=Le.next=t}return Le}function ua(t,e){return typeof e=="function"?e(t):e}function Rh(t){var e=Wt(),n=e.queue;if(n===null)throw Error(L(311));n.lastRenderedReducer=t;var r=Ne,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,c=null,l=i;do{var u=l.lane;if((ys&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:t(r,l.action);else{var h={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=h,o=r):c=c.next=h,Ce.lanes|=u,Ts|=u}l=l.next}while(l!==null&&l!==i);c===null?o=r:c.next=a,cn(r,e.memoizedState)||(dt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Ce.lanes|=i,Ts|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function bh(t){var e=Wt(),n=e.queue;if(n===null)throw Error(L(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);cn(i,e.memoizedState)||(dt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function GE(){}function $E(t,e){var n=Ce,r=Wt(),s=e(),i=!cn(r.memoizedState,s);if(i&&(r.memoizedState=s,dt=!0),r=r.queue,ag(JE.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Le!==null&&Le.memoizedState.tag&1){if(n.flags|=2048,ha(9,YE.bind(null,n,r,s,e),void 0,null),Ve===null)throw Error(L(349));ys&30||KE(n,e,s)}return s}function KE(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Ce.updateQueue,e===null?(e={lastEffect:null,stores:null},Ce.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function YE(t,e,n,r){e.value=n,e.getSnapshot=r,qE(e)&&QE(t)}function JE(t,e,n){return n(function(){qE(e)&&QE(t)})}function qE(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!cn(t,n)}catch{return!0}}function QE(t){var e=Qn(t,1);e!==null&&sn(e,t,1,-1)}function xm(t){var e=Sn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ua,lastRenderedState:t},e.queue=t,t=t.dispatch=wb.bind(null,Ce,t),[e.memoizedState,t]}function ha(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Ce.updateQueue,e===null?(e={lastEffect:null,stores:null},Ce.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function ZE(){return Wt().memoizedState}function Kc(t,e,n,r){var s=Sn();Ce.flags|=t,s.memoizedState=ha(1|e,n,void 0,r===void 0?null:r)}function vu(t,e,n,r){var s=Wt();r=r===void 0?null:r;var i=void 0;if(Ne!==null){var o=Ne.memoizedState;if(i=o.destroy,r!==null&&sg(r,o.deps)){s.memoizedState=ha(e,n,i,r);return}}Ce.flags|=t,s.memoizedState=ha(1|e,n,i,r)}function Nm(t,e){return Kc(8390656,8,t,e)}function ag(t,e){return vu(2048,8,t,e)}function eS(t,e){return vu(4,2,t,e)}function tS(t,e){return vu(4,4,t,e)}function nS(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function rS(t,e,n){return n=n!=null?n.concat([t]):null,vu(4,4,nS.bind(null,e,t),n)}function cg(){}function sS(t,e){var n=Wt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&sg(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function iS(t,e){var n=Wt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&sg(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function oS(t,e,n){return ys&21?(cn(n,e)||(n=hE(),Ce.lanes|=n,Ts|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,dt=!0),t.memoizedState=n)}function Cb(t,e){var n=le;le=n!==0&&4>n?n:4,t(!0);var r=wh.transition;wh.transition={};try{t(!1),e()}finally{le=n,wh.transition=r}}function aS(){return Wt().memoizedState}function vb(t,e,n){var r=Br(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},cS(t))lS(e,n);else if(n=jE(t,e,n,r),n!==null){var s=it();sn(n,t,r,s),uS(n,e,r)}}function wb(t,e,n){var r=Br(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(cS(t))lS(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(s.hasEagerState=!0,s.eagerState=a,cn(a,o)){var c=e.interleaved;c===null?(s.next=s,Zp(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=jE(t,e,s,r),n!==null&&(s=it(),sn(n,t,r,s),uS(n,e,r))}}function cS(t){var e=t.alternate;return t===Ce||e!==null&&e===Ce}function lS(t,e){Fo=Cl=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function uS(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Lp(t,n)}}var vl={readContext:jt,useCallback:$e,useContext:$e,useEffect:$e,useImperativeHandle:$e,useInsertionEffect:$e,useLayoutEffect:$e,useMemo:$e,useReducer:$e,useRef:$e,useState:$e,useDebugValue:$e,useDeferredValue:$e,useTransition:$e,useMutableSource:$e,useSyncExternalStore:$e,useId:$e,unstable_isNewReconciler:!1},Rb={readContext:jt,useCallback:function(t,e){return Sn().memoizedState=[t,e===void 0?null:e],t},useContext:jt,useEffect:Nm,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Kc(4194308,4,nS.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Kc(4194308,4,t,e)},useInsertionEffect:function(t,e){return Kc(4,2,t,e)},useMemo:function(t,e){var n=Sn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Sn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=vb.bind(null,Ce,t),[r.memoizedState,t]},useRef:function(t){var e=Sn();return t={current:t},e.memoizedState=t},useState:xm,useDebugValue:cg,useDeferredValue:function(t){return Sn().memoizedState=t},useTransition:function(){var t=xm(!1),e=t[0];return t=Cb.bind(null,t[1]),Sn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Ce,s=Sn();if(ye){if(n===void 0)throw Error(L(407));n=n()}else{if(n=e(),Ve===null)throw Error(L(349));ys&30||KE(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Nm(JE.bind(null,r,i,t),[t]),r.flags|=2048,ha(9,YE.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Sn(),e=Ve.identifierPrefix;if(ye){var n=Wn,r=jn;n=(r&~(1<<32-rn(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=la++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Sb++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},bb={readContext:jt,useCallback:sS,useContext:jt,useEffect:ag,useImperativeHandle:rS,useInsertionEffect:eS,useLayoutEffect:tS,useMemo:iS,useReducer:Rh,useRef:ZE,useState:function(){return Rh(ua)},useDebugValue:cg,useDeferredValue:function(t){var e=Wt();return oS(e,Ne.memoizedState,t)},useTransition:function(){var t=Rh(ua)[0],e=Wt().memoizedState;return[t,e]},useMutableSource:GE,useSyncExternalStore:$E,useId:aS,unstable_isNewReconciler:!1},Ib={readContext:jt,useCallback:sS,useContext:jt,useEffect:ag,useImperativeHandle:rS,useInsertionEffect:eS,useLayoutEffect:tS,useMemo:iS,useReducer:bh,useRef:ZE,useState:function(){return bh(ua)},useDebugValue:cg,useDeferredValue:function(t){var e=Wt();return Ne===null?e.memoizedState=t:oS(e,Ne.memoizedState,t)},useTransition:function(){var t=bh(ua)[0],e=Wt().memoizedState;return[t,e]},useMutableSource:GE,useSyncExternalStore:$E,useId:aS,unstable_isNewReconciler:!1};function Kt(t,e){if(t&&t.defaultProps){e=ve({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function fd(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ve({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var wu={isMounted:function(t){return(t=t._reactInternals)?ws(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=it(),s=Br(t),i=Yn(r,s);i.payload=e,n!=null&&(i.callback=n),e=Ir(t,i,s),e!==null&&(sn(e,t,s,r),Gc(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=it(),s=Br(t),i=Yn(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Ir(t,i,s),e!==null&&(sn(e,t,s,r),Gc(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=it(),r=Br(t),s=Yn(n,r);s.tag=2,e!=null&&(s.callback=e),e=Ir(t,s,r),e!==null&&(sn(e,t,r,n),Gc(e,t,r))}};function Fm(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!ra(n,r)||!ra(s,i):!0}function hS(t,e,n){var r=!1,s=Fr,i=e.contextType;return typeof i=="object"&&i!==null?i=jt(i):(s=_t(e)?ms:et.current,r=e.contextTypes,i=(r=r!=null)?wi(t,s):Fr),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=wu,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Dm(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&wu.enqueueReplaceState(e,e.state,null)}function dd(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},eg(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=jt(i):(i=_t(e)?ms:et.current,s.context=wi(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(fd(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&wu.enqueueReplaceState(s,s.state,null),El(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Mi(t,e){try{var n="",r=e;do n+=nR(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Ih(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function pd(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Mb=typeof WeakMap=="function"?WeakMap:Map;function fS(t,e,n){n=Yn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Rl||(Rl=!0,vd=r),pd(t,e)},n}function dS(t,e,n){n=Yn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){pd(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){pd(t,e),typeof r!="function"&&(Mr===null?Mr=new Set([this]):Mr.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Um(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new Mb;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=jb.bind(null,t,e,n),e.then(t,t))}function km(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Lm(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Yn(-1,1),e.tag=2,Ir(n,e,1))),n.lanes|=1),t)}var Bb=nr.ReactCurrentOwner,dt=!1;function st(t,e,n,r){e.child=t===null?zE(e,null,n,r):bi(e,t.child,n,r)}function Vm(t,e,n,r,s){n=n.render;var i=e.ref;return _i(e,s),r=ig(t,e,n,r,i,s),n=og(),t!==null&&!dt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Zn(t,e,s)):(ye&&n&&$p(e),e.flags|=1,st(t,e,r,s),e.child)}function Hm(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!_g(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,pS(t,e,i,r,s)):(t=Qc(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:ra,n(o,r)&&t.ref===e.ref)return Zn(t,e,s)}return e.flags|=1,t=Pr(i,r),t.ref=e.ref,t.return=e,e.child=t}function pS(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(ra(i,r)&&t.ref===e.ref)if(dt=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(dt=!0);else return e.lanes=t.lanes,Zn(t,e,s)}return gd(t,e,n,r,s)}function gS(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},_e(ni,Et),Et|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,_e(ni,Et),Et|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,_e(ni,Et),Et|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,_e(ni,Et),Et|=r;return st(t,e,s,n),e.child}function _S(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function gd(t,e,n,r,s){var i=_t(n)?ms:et.current;return i=wi(e,i),_i(e,s),n=ig(t,e,n,r,i,s),r=og(),t!==null&&!dt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Zn(t,e,s)):(ye&&r&&$p(e),e.flags|=1,st(t,e,n,s),e.child)}function zm(t,e,n,r,s){if(_t(n)){var i=!0;_l(e)}else i=!1;if(_i(e,s),e.stateNode===null)Yc(t,e),hS(e,n,r),dd(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=jt(l):(l=_t(n)?ms:et.current,l=wi(e,l));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||c!==l)&&Dm(e,o,r,l),gr=!1;var f=e.memoizedState;o.state=f,El(e,r,o,s),c=e.memoizedState,a!==r||f!==c||gt.current||gr?(typeof u=="function"&&(fd(e,n,u,r),c=e.memoizedState),(a=gr||Fm(e,n,a,r,f,c,l))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=l,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,WE(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:Kt(e.type,a),o.props=l,h=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=jt(c):(c=_t(n)?ms:et.current,c=wi(e,c));var p=n.getDerivedStateFromProps;(u=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==c)&&Dm(e,o,r,c),gr=!1,f=e.memoizedState,o.state=f,El(e,r,o,s);var m=e.memoizedState;a!==h||f!==m||gt.current||gr?(typeof p=="function"&&(fd(e,n,p,r),m=e.memoizedState),(l=gr||Fm(e,n,l,r,f,m,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,m,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,m,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),o.props=r,o.state=m,o.context=c,r=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return _d(t,e,n,r,i,s)}function _d(t,e,n,r,s,i){_S(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&bm(e,n,!1),Zn(t,e,i);r=e.stateNode,Bb.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=bi(e,t.child,null,i),e.child=bi(e,null,a,i)):st(t,e,a,i),e.memoizedState=r.state,s&&bm(e,n,!0),e.child}function mS(t){var e=t.stateNode;e.pendingContext?Rm(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Rm(t,e.context,!1),tg(t,e.containerInfo)}function jm(t,e,n,r,s){return Ri(),Yp(s),e.flags|=256,st(t,e,n,r),e.child}var md={dehydrated:null,treeContext:null,retryLane:0};function Ad(t){return{baseLanes:t,cachePool:null,transitions:null}}function AS(t,e,n){var r=e.pendingProps,s=Ee.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),_e(Ee,s&1),t===null)return ud(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Iu(o,r,0,null),t=ds(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Ad(n),e.memoizedState=md,t):lg(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return Pb(t,e,o,r,a,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,a=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Pr(s,c),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Pr(a,i):(i=ds(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Ad(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=md,r}return i=t.child,t=i.sibling,r=Pr(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function lg(t,e){return e=Iu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function cc(t,e,n,r){return r!==null&&Yp(r),bi(e,t.child,null,n),t=lg(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Pb(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=Ih(Error(L(422))),cc(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Iu({mode:"visible",children:r.children},s,0,null),i=ds(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&bi(e,t.child,null,o),e.child.memoizedState=Ad(o),e.memoizedState=md,i);if(!(e.mode&1))return cc(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(L(419)),r=Ih(i,r,void 0),cc(t,e,o,r)}if(a=(o&t.childLanes)!==0,dt||a){if(r=Ve,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Qn(t,s),sn(r,t,s,-1))}return gg(),r=Ih(Error(L(421))),cc(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=Wb.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Ct=br(s.nextSibling),Rt=e,ye=!0,Jt=null,t!==null&&(Nt[Ft++]=jn,Nt[Ft++]=Wn,Nt[Ft++]=As,jn=t.id,Wn=t.overflow,As=e),e=lg(e,r.children),e.flags|=4096,e)}function Wm(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),hd(t.return,e,n)}function Mh(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function yS(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(st(t,e,r.children,n),r=Ee.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Wm(t,n,e);else if(t.tag===19)Wm(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(_e(Ee,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Sl(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Mh(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Sl(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Mh(e,!0,n,null,i);break;case"together":Mh(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Yc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Zn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ts|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(L(153));if(e.child!==null){for(t=e.child,n=Pr(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Pr(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Ob(t,e,n){switch(e.tag){case 3:mS(e),Ri();break;case 5:XE(e);break;case 1:_t(e.type)&&_l(e);break;case 4:tg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;_e(yl,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(_e(Ee,Ee.current&1),e.flags|=128,null):n&e.child.childLanes?AS(t,e,n):(_e(Ee,Ee.current&1),t=Zn(t,e,n),t!==null?t.sibling:null);_e(Ee,Ee.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return yS(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),_e(Ee,Ee.current),r)break;return null;case 22:case 23:return e.lanes=0,gS(t,e,n)}return Zn(t,e,n)}var TS,yd,ES,SS;TS=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};yd=function(){};ES=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,as(Pn.current);var i=null;switch(n){case"input":s=Hf(t,s),r=Hf(t,r),i=[];break;case"select":s=ve({},s,{value:void 0}),r=ve({},r,{value:void 0}),i=[];break;case"textarea":s=Wf(t,s),r=Wf(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=pl)}Gf(n,r);var o;n=null;for(l in s)if(!r.hasOwnProperty(l)&&s.hasOwnProperty(l)&&s[l]!=null)if(l==="style"){var a=s[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Jo.hasOwnProperty(l)?i||(i=[]):(i=i||[]).push(l,null));for(l in r){var c=r[l];if(a=s!=null?s[l]:void 0,r.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(i=i||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Jo.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&me("scroll",t),i||a===c||(i=[])):(i=i||[]).push(l,c))}n&&(i=i||[]).push("style",n);var l=i;(e.updateQueue=l)&&(e.flags|=4)}};SS=function(t,e,n,r){n!==r&&(e.flags|=4)};function oo(t,e){if(!ye)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ke(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function xb(t,e,n){var r=e.pendingProps;switch(Kp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ke(e),null;case 1:return _t(e.type)&&gl(),Ke(e),null;case 3:return r=e.stateNode,Ii(),Ae(gt),Ae(et),rg(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(oc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Jt!==null&&(bd(Jt),Jt=null))),yd(t,e),Ke(e),null;case 5:ng(e);var s=as(ca.current);if(n=e.type,t!==null&&e.stateNode!=null)ES(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(L(166));return Ke(e),null}if(t=as(Pn.current),oc(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[vn]=e,r[oa]=i,t=(e.mode&1)!==0,n){case"dialog":me("cancel",r),me("close",r);break;case"iframe":case"object":case"embed":me("load",r);break;case"video":case"audio":for(s=0;s<Co.length;s++)me(Co[s],r);break;case"source":me("error",r);break;case"img":case"image":case"link":me("error",r),me("load",r);break;case"details":me("toggle",r);break;case"input":Z_(r,i),me("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},me("invalid",r);break;case"textarea":tm(r,i),me("invalid",r)}Gf(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&ic(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&ic(r.textContent,a,t),s=["children",""+a]):Jo.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&me("scroll",r)}switch(n){case"input":qa(r),em(r,i,!0);break;case"textarea":qa(r),nm(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=pl)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=J0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[vn]=e,t[oa]=r,TS(t,e,!1,!1),e.stateNode=t;e:{switch(o=$f(n,r),n){case"dialog":me("cancel",t),me("close",t),s=r;break;case"iframe":case"object":case"embed":me("load",t),s=r;break;case"video":case"audio":for(s=0;s<Co.length;s++)me(Co[s],t);s=r;break;case"source":me("error",t),s=r;break;case"img":case"image":case"link":me("error",t),me("load",t),s=r;break;case"details":me("toggle",t),s=r;break;case"input":Z_(t,r),s=Hf(t,r),me("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=ve({},r,{value:void 0}),me("invalid",t);break;case"textarea":tm(t,r),s=Wf(t,r),me("invalid",t);break;default:s=r}Gf(n,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="style"?Z0(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&q0(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&qo(t,c):typeof c=="number"&&qo(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Jo.hasOwnProperty(i)?c!=null&&i==="onScroll"&&me("scroll",t):c!=null&&xp(t,i,c,o))}switch(n){case"input":qa(t),em(t,r,!1);break;case"textarea":qa(t),nm(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Nr(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?fi(t,!!r.multiple,i,!1):r.defaultValue!=null&&fi(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=pl)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ke(e),null;case 6:if(t&&e.stateNode!=null)SS(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(L(166));if(n=as(ca.current),as(Pn.current),oc(e)){if(r=e.stateNode,n=e.memoizedProps,r[vn]=e,(i=r.nodeValue!==n)&&(t=Rt,t!==null))switch(t.tag){case 3:ic(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ic(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[vn]=e,e.stateNode=r}return Ke(e),null;case 13:if(Ae(Ee),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ye&&Ct!==null&&e.mode&1&&!(e.flags&128))VE(),Ri(),e.flags|=98560,i=!1;else if(i=oc(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(L(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(L(317));i[vn]=e}else Ri(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ke(e),i=!1}else Jt!==null&&(bd(Jt),Jt=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Ee.current&1?Fe===0&&(Fe=3):gg())),e.updateQueue!==null&&(e.flags|=4),Ke(e),null);case 4:return Ii(),yd(t,e),t===null&&sa(e.stateNode.containerInfo),Ke(e),null;case 10:return Qp(e.type._context),Ke(e),null;case 17:return _t(e.type)&&gl(),Ke(e),null;case 19:if(Ae(Ee),i=e.memoizedState,i===null)return Ke(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)oo(i,!1);else{if(Fe!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Sl(t),o!==null){for(e.flags|=128,oo(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return _e(Ee,Ee.current&1|2),e.child}t=t.sibling}i.tail!==null&&Ie()>Bi&&(e.flags|=128,r=!0,oo(i,!1),e.lanes=4194304)}else{if(!r)if(t=Sl(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),oo(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!ye)return Ke(e),null}else 2*Ie()-i.renderingStartTime>Bi&&n!==1073741824&&(e.flags|=128,r=!0,oo(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Ie(),e.sibling=null,n=Ee.current,_e(Ee,r?n&1|2:n&1),e):(Ke(e),null);case 22:case 23:return pg(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Et&1073741824&&(Ke(e),e.subtreeFlags&6&&(e.flags|=8192)):Ke(e),null;case 24:return null;case 25:return null}throw Error(L(156,e.tag))}function Nb(t,e){switch(Kp(e),e.tag){case 1:return _t(e.type)&&gl(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ii(),Ae(gt),Ae(et),rg(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return ng(e),null;case 13:if(Ae(Ee),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(L(340));Ri()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ae(Ee),null;case 4:return Ii(),null;case 10:return Qp(e.type._context),null;case 22:case 23:return pg(),null;case 24:return null;default:return null}}var lc=!1,Qe=!1,Fb=typeof WeakSet=="function"?WeakSet:Set,W=null;function ti(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Re(t,e,r)}else n.current=null}function Td(t,e,n){try{n()}catch(r){Re(t,e,r)}}var Xm=!1;function Db(t,e){if(rd=hl,t=bE(),Gp(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,u=0,h=t,f=null;t:for(;;){for(var p;h!==n||s!==0&&h.nodeType!==3||(a=o+s),h!==i||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(p=h.firstChild)!==null;)f=h,h=p;for(;;){if(h===t)break t;if(f===n&&++l===s&&(a=o),f===i&&++u===r&&(c=o),(p=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=p}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(sd={focusedElem:t,selectionRange:n},hl=!1,W=e;W!==null;)if(e=W,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,W=t;else for(;W!==null;){e=W;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var y=m.memoizedProps,w=m.memoizedState,_=e.stateNode,g=_.getSnapshotBeforeUpdate(e.elementType===e.type?y:Kt(e.type,y),w);_.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(L(163))}}catch(C){Re(e,e.return,C)}if(t=e.sibling,t!==null){t.return=e.return,W=t;break}W=e.return}return m=Xm,Xm=!1,m}function Do(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Td(e,n,i)}s=s.next}while(s!==r)}}function Ru(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Ed(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function CS(t){var e=t.alternate;e!==null&&(t.alternate=null,CS(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[vn],delete e[oa],delete e[ad],delete e[Ab],delete e[yb])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function vS(t){return t.tag===5||t.tag===3||t.tag===4}function Gm(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||vS(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Sd(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=pl));else if(r!==4&&(t=t.child,t!==null))for(Sd(t,e,n),t=t.sibling;t!==null;)Sd(t,e,n),t=t.sibling}function Cd(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Cd(t,e,n),t=t.sibling;t!==null;)Cd(t,e,n),t=t.sibling}var We=null,Yt=!1;function ar(t,e,n){for(n=n.child;n!==null;)wS(t,e,n),n=n.sibling}function wS(t,e,n){if(Bn&&typeof Bn.onCommitFiberUnmount=="function")try{Bn.onCommitFiberUnmount(Au,n)}catch{}switch(n.tag){case 5:Qe||ti(n,e);case 6:var r=We,s=Yt;We=null,ar(t,e,n),We=r,Yt=s,We!==null&&(Yt?(t=We,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):We.removeChild(n.stateNode));break;case 18:We!==null&&(Yt?(t=We,n=n.stateNode,t.nodeType===8?Sh(t.parentNode,n):t.nodeType===1&&Sh(t,n),ta(t)):Sh(We,n.stateNode));break;case 4:r=We,s=Yt,We=n.stateNode.containerInfo,Yt=!0,ar(t,e,n),We=r,Yt=s;break;case 0:case 11:case 14:case 15:if(!Qe&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Td(n,e,o),s=s.next}while(s!==r)}ar(t,e,n);break;case 1:if(!Qe&&(ti(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Re(n,e,a)}ar(t,e,n);break;case 21:ar(t,e,n);break;case 22:n.mode&1?(Qe=(r=Qe)||n.memoizedState!==null,ar(t,e,n),Qe=r):ar(t,e,n);break;default:ar(t,e,n)}}function $m(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Fb),e.forEach(function(r){var s=Xb.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Gt(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:We=a.stateNode,Yt=!1;break e;case 3:We=a.stateNode.containerInfo,Yt=!0;break e;case 4:We=a.stateNode.containerInfo,Yt=!0;break e}a=a.return}if(We===null)throw Error(L(160));wS(i,o,s),We=null,Yt=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(l){Re(s,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)RS(e,t),e=e.sibling}function RS(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Gt(e,t),gn(t),r&4){try{Do(3,t,t.return),Ru(3,t)}catch(y){Re(t,t.return,y)}try{Do(5,t,t.return)}catch(y){Re(t,t.return,y)}}break;case 1:Gt(e,t),gn(t),r&512&&n!==null&&ti(n,n.return);break;case 5:if(Gt(e,t),gn(t),r&512&&n!==null&&ti(n,n.return),t.flags&32){var s=t.stateNode;try{qo(s,"")}catch(y){Re(t,t.return,y)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&K0(s,i),$f(a,o);var l=$f(a,i);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];u==="style"?Z0(s,h):u==="dangerouslySetInnerHTML"?q0(s,h):u==="children"?qo(s,h):xp(s,u,h,l)}switch(a){case"input":zf(s,i);break;case"textarea":Y0(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?fi(s,!!i.multiple,p,!1):f!==!!i.multiple&&(i.defaultValue!=null?fi(s,!!i.multiple,i.defaultValue,!0):fi(s,!!i.multiple,i.multiple?[]:"",!1))}s[oa]=i}catch(y){Re(t,t.return,y)}}break;case 6:if(Gt(e,t),gn(t),r&4){if(t.stateNode===null)throw Error(L(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(y){Re(t,t.return,y)}}break;case 3:if(Gt(e,t),gn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ta(e.containerInfo)}catch(y){Re(t,t.return,y)}break;case 4:Gt(e,t),gn(t);break;case 13:Gt(e,t),gn(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(fg=Ie())),r&4&&$m(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Qe=(l=Qe)||u,Gt(e,t),Qe=l):Gt(e,t),gn(t),r&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for(W=t,u=t.child;u!==null;){for(h=W=u;W!==null;){switch(f=W,p=f.child,f.tag){case 0:case 11:case 14:case 15:Do(4,f,f.return);break;case 1:ti(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(y){Re(r,n,y)}}break;case 5:ti(f,f.return);break;case 22:if(f.memoizedState!==null){Ym(h);continue}}p!==null?(p.return=f,W=p):Ym(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{s=h.stateNode,l?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=Q0("display",o))}catch(y){Re(t,t.return,y)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(y){Re(t,t.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Gt(e,t),gn(t),r&4&&$m(t);break;case 21:break;default:Gt(e,t),gn(t)}}function gn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(vS(n)){var r=n;break e}n=n.return}throw Error(L(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(qo(s,""),r.flags&=-33);var i=Gm(t);Cd(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Gm(t);Sd(t,a,o);break;default:throw Error(L(161))}}catch(c){Re(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Ub(t,e,n){W=t,bS(t)}function bS(t,e,n){for(var r=(t.mode&1)!==0;W!==null;){var s=W,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||lc;if(!o){var a=s.alternate,c=a!==null&&a.memoizedState!==null||Qe;a=lc;var l=Qe;if(lc=o,(Qe=c)&&!l)for(W=s;W!==null;)o=W,c=o.child,o.tag===22&&o.memoizedState!==null?Jm(s):c!==null?(c.return=o,W=c):Jm(s);for(;i!==null;)W=i,bS(i),i=i.sibling;W=s,lc=a,Qe=l}Km(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,W=i):Km(t)}}function Km(t){for(;W!==null;){var e=W;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Qe||Ru(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Qe)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Kt(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Om(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Om(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&ta(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(L(163))}Qe||e.flags&512&&Ed(e)}catch(f){Re(e,e.return,f)}}if(e===t){W=null;break}if(n=e.sibling,n!==null){n.return=e.return,W=n;break}W=e.return}}function Ym(t){for(;W!==null;){var e=W;if(e===t){W=null;break}var n=e.sibling;if(n!==null){n.return=e.return,W=n;break}W=e.return}}function Jm(t){for(;W!==null;){var e=W;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Ru(4,e)}catch(c){Re(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Re(e,s,c)}}var i=e.return;try{Ed(e)}catch(c){Re(e,i,c)}break;case 5:var o=e.return;try{Ed(e)}catch(c){Re(e,o,c)}}}catch(c){Re(e,e.return,c)}if(e===t){W=null;break}var a=e.sibling;if(a!==null){a.return=e.return,W=a;break}W=e.return}}var kb=Math.ceil,wl=nr.ReactCurrentDispatcher,ug=nr.ReactCurrentOwner,Vt=nr.ReactCurrentBatchConfig,ne=0,Ve=null,xe=null,Xe=0,Et=0,ni=zr(0),Fe=0,fa=null,Ts=0,bu=0,hg=0,Uo=null,ft=null,fg=0,Bi=1/0,kn=null,Rl=!1,vd=null,Mr=null,uc=!1,Er=null,bl=0,ko=0,wd=null,Jc=-1,qc=0;function it(){return ne&6?Ie():Jc!==-1?Jc:Jc=Ie()}function Br(t){return t.mode&1?ne&2&&Xe!==0?Xe&-Xe:Eb.transition!==null?(qc===0&&(qc=hE()),qc):(t=le,t!==0||(t=window.event,t=t===void 0?16:AE(t.type)),t):1}function sn(t,e,n,r){if(50<ko)throw ko=0,wd=null,Error(L(185));va(t,n,r),(!(ne&2)||t!==Ve)&&(t===Ve&&(!(ne&2)&&(bu|=n),Fe===4&&yr(t,Xe)),mt(t,r),n===1&&ne===0&&!(e.mode&1)&&(Bi=Ie()+500,Cu&&jr()))}function mt(t,e){var n=t.callbackNode;ER(t,e);var r=ul(t,t===Ve?Xe:0);if(r===0)n!==null&&im(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&im(n),e===1)t.tag===0?Tb(qm.bind(null,t)):UE(qm.bind(null,t)),_b(function(){!(ne&6)&&jr()}),n=null;else{switch(fE(r)){case 1:n=kp;break;case 4:n=lE;break;case 16:n=ll;break;case 536870912:n=uE;break;default:n=ll}n=FS(n,IS.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function IS(t,e){if(Jc=-1,qc=0,ne&6)throw Error(L(327));var n=t.callbackNode;if(mi()&&t.callbackNode!==n)return null;var r=ul(t,t===Ve?Xe:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Il(t,r);else{e=r;var s=ne;ne|=2;var i=BS();(Ve!==t||Xe!==e)&&(kn=null,Bi=Ie()+500,fs(t,e));do try{Hb();break}catch(a){MS(t,a)}while(1);qp(),wl.current=i,ne=s,xe!==null?e=0:(Ve=null,Xe=0,e=Fe)}if(e!==0){if(e===2&&(s=Qf(t),s!==0&&(r=s,e=Rd(t,s))),e===1)throw n=fa,fs(t,0),yr(t,r),mt(t,Ie()),n;if(e===6)yr(t,r);else{if(s=t.current.alternate,!(r&30)&&!Lb(s)&&(e=Il(t,r),e===2&&(i=Qf(t),i!==0&&(r=i,e=Rd(t,i))),e===1))throw n=fa,fs(t,0),yr(t,r),mt(t,Ie()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(L(345));case 2:es(t,ft,kn);break;case 3:if(yr(t,r),(r&130023424)===r&&(e=fg+500-Ie(),10<e)){if(ul(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){it(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=od(es.bind(null,t,ft,kn),e);break}es(t,ft,kn);break;case 4:if(yr(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-rn(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Ie()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*kb(r/1960))-r,10<r){t.timeoutHandle=od(es.bind(null,t,ft,kn),r);break}es(t,ft,kn);break;case 5:es(t,ft,kn);break;default:throw Error(L(329))}}}return mt(t,Ie()),t.callbackNode===n?IS.bind(null,t):null}function Rd(t,e){var n=Uo;return t.current.memoizedState.isDehydrated&&(fs(t,e).flags|=256),t=Il(t,e),t!==2&&(e=ft,ft=n,e!==null&&bd(e)),t}function bd(t){ft===null?ft=t:ft.push.apply(ft,t)}function Lb(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!cn(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function yr(t,e){for(e&=~hg,e&=~bu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-rn(e),r=1<<n;t[n]=-1,e&=~r}}function qm(t){if(ne&6)throw Error(L(327));mi();var e=ul(t,0);if(!(e&1))return mt(t,Ie()),null;var n=Il(t,e);if(t.tag!==0&&n===2){var r=Qf(t);r!==0&&(e=r,n=Rd(t,r))}if(n===1)throw n=fa,fs(t,0),yr(t,e),mt(t,Ie()),n;if(n===6)throw Error(L(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,es(t,ft,kn),mt(t,Ie()),null}function dg(t,e){var n=ne;ne|=1;try{return t(e)}finally{ne=n,ne===0&&(Bi=Ie()+500,Cu&&jr())}}function Es(t){Er!==null&&Er.tag===0&&!(ne&6)&&mi();var e=ne;ne|=1;var n=Vt.transition,r=le;try{if(Vt.transition=null,le=1,t)return t()}finally{le=r,Vt.transition=n,ne=e,!(ne&6)&&jr()}}function pg(){Et=ni.current,Ae(ni)}function fs(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,gb(n)),xe!==null)for(n=xe.return;n!==null;){var r=n;switch(Kp(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&gl();break;case 3:Ii(),Ae(gt),Ae(et),rg();break;case 5:ng(r);break;case 4:Ii();break;case 13:Ae(Ee);break;case 19:Ae(Ee);break;case 10:Qp(r.type._context);break;case 22:case 23:pg()}n=n.return}if(Ve=t,xe=t=Pr(t.current,null),Xe=Et=e,Fe=0,fa=null,hg=bu=Ts=0,ft=Uo=null,os!==null){for(e=0;e<os.length;e++)if(n=os[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}os=null}return t}function MS(t,e){do{var n=xe;try{if(qp(),$c.current=vl,Cl){for(var r=Ce.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Cl=!1}if(ys=0,Le=Ne=Ce=null,Fo=!1,la=0,ug.current=null,n===null||n.return===null){Fe=1,fa=e,xe=null;break}e:{var i=t,o=n.return,a=n,c=e;if(e=Xe,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=km(o);if(p!==null){p.flags&=-257,Lm(p,o,a,i,e),p.mode&1&&Um(i,l,e),e=p,c=l;var m=e.updateQueue;if(m===null){var y=new Set;y.add(c),e.updateQueue=y}else m.add(c);break e}else{if(!(e&1)){Um(i,l,e),gg();break e}c=Error(L(426))}}else if(ye&&a.mode&1){var w=km(o);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Lm(w,o,a,i,e),Yp(Mi(c,a));break e}}i=c=Mi(c,a),Fe!==4&&(Fe=2),Uo===null?Uo=[i]:Uo.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var _=fS(i,c,e);Pm(i,_);break e;case 1:a=c;var g=i.type,T=i.stateNode;if(!(i.flags&128)&&(typeof g.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Mr===null||!Mr.has(T)))){i.flags|=65536,e&=-e,i.lanes|=e;var C=dS(i,a,e);Pm(i,C);break e}}i=i.return}while(i!==null)}OS(n)}catch(I){e=I,xe===n&&n!==null&&(xe=n=n.return);continue}break}while(1)}function BS(){var t=wl.current;return wl.current=vl,t===null?vl:t}function gg(){(Fe===0||Fe===3||Fe===2)&&(Fe=4),Ve===null||!(Ts&268435455)&&!(bu&268435455)||yr(Ve,Xe)}function Il(t,e){var n=ne;ne|=2;var r=BS();(Ve!==t||Xe!==e)&&(kn=null,fs(t,e));do try{Vb();break}catch(s){MS(t,s)}while(1);if(qp(),ne=n,wl.current=r,xe!==null)throw Error(L(261));return Ve=null,Xe=0,Fe}function Vb(){for(;xe!==null;)PS(xe)}function Hb(){for(;xe!==null&&!fR();)PS(xe)}function PS(t){var e=NS(t.alternate,t,Et);t.memoizedProps=t.pendingProps,e===null?OS(t):xe=e,ug.current=null}function OS(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Nb(n,e),n!==null){n.flags&=32767,xe=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Fe=6,xe=null;return}}else if(n=xb(n,e,Et),n!==null){xe=n;return}if(e=e.sibling,e!==null){xe=e;return}xe=e=t}while(e!==null);Fe===0&&(Fe=5)}function es(t,e,n){var r=le,s=Vt.transition;try{Vt.transition=null,le=1,zb(t,e,n,r)}finally{Vt.transition=s,le=r}return null}function zb(t,e,n,r){do mi();while(Er!==null);if(ne&6)throw Error(L(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(L(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(SR(t,i),t===Ve&&(xe=Ve=null,Xe=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||uc||(uc=!0,FS(ll,function(){return mi(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Vt.transition,Vt.transition=null;var o=le;le=1;var a=ne;ne|=4,ug.current=null,Db(t,n),RS(n,t),cb(sd),hl=!!rd,sd=rd=null,t.current=n,Ub(n),dR(),ne=a,le=o,Vt.transition=i}else t.current=n;if(uc&&(uc=!1,Er=t,bl=s),i=t.pendingLanes,i===0&&(Mr=null),_R(n.stateNode),mt(t,Ie()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Rl)throw Rl=!1,t=vd,vd=null,t;return bl&1&&t.tag!==0&&mi(),i=t.pendingLanes,i&1?t===wd?ko++:(ko=0,wd=t):ko=0,jr(),null}function mi(){if(Er!==null){var t=fE(bl),e=Vt.transition,n=le;try{if(Vt.transition=null,le=16>t?16:t,Er===null)var r=!1;else{if(t=Er,Er=null,bl=0,ne&6)throw Error(L(331));var s=ne;for(ne|=4,W=t.current;W!==null;){var i=W,o=i.child;if(W.flags&16){var a=i.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(W=l;W!==null;){var u=W;switch(u.tag){case 0:case 11:case 15:Do(8,u,i)}var h=u.child;if(h!==null)h.return=u,W=h;else for(;W!==null;){u=W;var f=u.sibling,p=u.return;if(CS(u),u===l){W=null;break}if(f!==null){f.return=p,W=f;break}W=p}}}var m=i.alternate;if(m!==null){var y=m.child;if(y!==null){m.child=null;do{var w=y.sibling;y.sibling=null,y=w}while(y!==null)}}W=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,W=o;else e:for(;W!==null;){if(i=W,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Do(9,i,i.return)}var _=i.sibling;if(_!==null){_.return=i.return,W=_;break e}W=i.return}}var g=t.current;for(W=g;W!==null;){o=W;var T=o.child;if(o.subtreeFlags&2064&&T!==null)T.return=o,W=T;else e:for(o=g;W!==null;){if(a=W,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Ru(9,a)}}catch(I){Re(a,a.return,I)}if(a===o){W=null;break e}var C=a.sibling;if(C!==null){C.return=a.return,W=C;break e}W=a.return}}if(ne=s,jr(),Bn&&typeof Bn.onPostCommitFiberRoot=="function")try{Bn.onPostCommitFiberRoot(Au,t)}catch{}r=!0}return r}finally{le=n,Vt.transition=e}}return!1}function Qm(t,e,n){e=Mi(n,e),e=fS(t,e,1),t=Ir(t,e,1),e=it(),t!==null&&(va(t,1,e),mt(t,e))}function Re(t,e,n){if(t.tag===3)Qm(t,t,n);else for(;e!==null;){if(e.tag===3){Qm(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Mr===null||!Mr.has(r))){t=Mi(n,t),t=dS(e,t,1),e=Ir(e,t,1),t=it(),e!==null&&(va(e,1,t),mt(e,t));break}}e=e.return}}function jb(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=it(),t.pingedLanes|=t.suspendedLanes&n,Ve===t&&(Xe&n)===n&&(Fe===4||Fe===3&&(Xe&130023424)===Xe&&500>Ie()-fg?fs(t,0):hg|=n),mt(t,e)}function xS(t,e){e===0&&(t.mode&1?(e=ec,ec<<=1,!(ec&130023424)&&(ec=4194304)):e=1);var n=it();t=Qn(t,e),t!==null&&(va(t,e,n),mt(t,n))}function Wb(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),xS(t,n)}function Xb(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(L(314))}r!==null&&r.delete(e),xS(t,n)}var NS;NS=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||gt.current)dt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return dt=!1,Ob(t,e,n);dt=!!(t.flags&131072)}else dt=!1,ye&&e.flags&1048576&&kE(e,Al,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Yc(t,e),t=e.pendingProps;var s=wi(e,et.current);_i(e,n),s=ig(null,e,r,t,s,n);var i=og();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,_t(r)?(i=!0,_l(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,eg(e),s.updater=wu,e.stateNode=s,s._reactInternals=e,dd(e,r,t,n),e=_d(null,e,r,!0,i,n)):(e.tag=0,ye&&i&&$p(e),st(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Yc(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=$b(r),t=Kt(r,t),s){case 0:e=gd(null,e,r,t,n);break e;case 1:e=zm(null,e,r,t,n);break e;case 11:e=Vm(null,e,r,t,n);break e;case 14:e=Hm(null,e,r,Kt(r.type,t),n);break e}throw Error(L(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Kt(r,s),gd(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Kt(r,s),zm(t,e,r,s,n);case 3:e:{if(mS(e),t===null)throw Error(L(387));r=e.pendingProps,i=e.memoizedState,s=i.element,WE(t,e),El(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Mi(Error(L(423)),e),e=jm(t,e,r,n,s);break e}else if(r!==s){s=Mi(Error(L(424)),e),e=jm(t,e,r,n,s);break e}else for(Ct=br(e.stateNode.containerInfo.firstChild),Rt=e,ye=!0,Jt=null,n=zE(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ri(),r===s){e=Zn(t,e,n);break e}st(t,e,r,n)}e=e.child}return e;case 5:return XE(e),t===null&&ud(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,id(r,s)?o=null:i!==null&&id(r,i)&&(e.flags|=32),_S(t,e),st(t,e,o,n),e.child;case 6:return t===null&&ud(e),null;case 13:return AS(t,e,n);case 4:return tg(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=bi(e,null,r,n):st(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Kt(r,s),Vm(t,e,r,s,n);case 7:return st(t,e,e.pendingProps,n),e.child;case 8:return st(t,e,e.pendingProps.children,n),e.child;case 12:return st(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,_e(yl,r._currentValue),r._currentValue=o,i!==null)if(cn(i.value,o)){if(i.children===s.children&&!gt.current){e=Zn(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Yn(-1,n&-n),c.tag=2;var l=i.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),hd(i.return,n,e),a.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(L(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),hd(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}st(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,_i(e,n),s=jt(s),r=r(s),e.flags|=1,st(t,e,r,n),e.child;case 14:return r=e.type,s=Kt(r,e.pendingProps),s=Kt(r.type,s),Hm(t,e,r,s,n);case 15:return pS(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Kt(r,s),Yc(t,e),e.tag=1,_t(r)?(t=!0,_l(e)):t=!1,_i(e,n),hS(e,r,s),dd(e,r,s,n),_d(null,e,r,!0,t,n);case 19:return yS(t,e,n);case 22:return gS(t,e,n)}throw Error(L(156,e.tag))};function FS(t,e){return cE(t,e)}function Gb(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dt(t,e,n,r){return new Gb(t,e,n,r)}function _g(t){return t=t.prototype,!(!t||!t.isReactComponent)}function $b(t){if(typeof t=="function")return _g(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Fp)return 11;if(t===Dp)return 14}return 2}function Pr(t,e){var n=t.alternate;return n===null?(n=Dt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Qc(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")_g(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Gs:return ds(n.children,s,i,e);case Np:o=8,s|=8;break;case Uf:return t=Dt(12,n,e,s|2),t.elementType=Uf,t.lanes=i,t;case kf:return t=Dt(13,n,e,s),t.elementType=kf,t.lanes=i,t;case Lf:return t=Dt(19,n,e,s),t.elementType=Lf,t.lanes=i,t;case X0:return Iu(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case j0:o=10;break e;case W0:o=9;break e;case Fp:o=11;break e;case Dp:o=14;break e;case pr:o=16,r=null;break e}throw Error(L(130,t==null?t:typeof t,""))}return e=Dt(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function ds(t,e,n,r){return t=Dt(7,t,r,e),t.lanes=n,t}function Iu(t,e,n,r){return t=Dt(22,t,r,e),t.elementType=X0,t.lanes=n,t.stateNode={isHidden:!1},t}function Bh(t,e,n){return t=Dt(6,t,null,e),t.lanes=n,t}function Ph(t,e,n){return e=Dt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Kb(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=hh(0),this.expirationTimes=hh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=hh(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function mg(t,e,n,r,s,i,o,a,c){return t=new Kb(t,e,n,a,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Dt(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},eg(i),t}function Yb(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Xs,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function DS(t){if(!t)return Fr;t=t._reactInternals;e:{if(ws(t)!==t||t.tag!==1)throw Error(L(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(_t(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(L(171))}if(t.tag===1){var n=t.type;if(_t(n))return DE(t,n,e)}return e}function US(t,e,n,r,s,i,o,a,c){return t=mg(n,r,!0,t,s,i,o,a,c),t.context=DS(null),n=t.current,r=it(),s=Br(n),i=Yn(r,s),i.callback=e??null,Ir(n,i,s),t.current.lanes=s,va(t,s,r),mt(t,r),t}function Mu(t,e,n,r){var s=e.current,i=it(),o=Br(s);return n=DS(n),e.context===null?e.context=n:e.pendingContext=n,e=Yn(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Ir(s,e,o),t!==null&&(sn(t,s,o,i),Gc(t,s,o)),o}function Ml(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Zm(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Ag(t,e){Zm(t,e),(t=t.alternate)&&Zm(t,e)}function Jb(){return null}var kS=typeof reportError=="function"?reportError:function(t){console.error(t)};function yg(t){this._internalRoot=t}Bu.prototype.render=yg.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(L(409));Mu(t,e,null,null)};Bu.prototype.unmount=yg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Es(function(){Mu(null,t,null,null)}),e[qn]=null}};function Bu(t){this._internalRoot=t}Bu.prototype.unstable_scheduleHydration=function(t){if(t){var e=gE();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ar.length&&e!==0&&e<Ar[n].priority;n++);Ar.splice(n,0,t),n===0&&mE(t)}};function Tg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Pu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function eA(){}function qb(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var l=Ml(o);i.call(l)}}var o=US(e,r,t,0,null,!1,!1,"",eA);return t._reactRootContainer=o,t[qn]=o.current,sa(t.nodeType===8?t.parentNode:t),Es(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var l=Ml(c);a.call(l)}}var c=mg(t,0,!1,null,null,!1,!1,"",eA);return t._reactRootContainer=c,t[qn]=c.current,sa(t.nodeType===8?t.parentNode:t),Es(function(){Mu(e,c,n,r)}),c}function Ou(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var c=Ml(o);a.call(c)}}Mu(e,o,t,s)}else o=qb(n,e,t,s,r);return Ml(o)}dE=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=So(e.pendingLanes);n!==0&&(Lp(e,n|1),mt(e,Ie()),!(ne&6)&&(Bi=Ie()+500,jr()))}break;case 13:Es(function(){var r=Qn(t,1);if(r!==null){var s=it();sn(r,t,1,s)}}),Ag(t,1)}};Vp=function(t){if(t.tag===13){var e=Qn(t,134217728);if(e!==null){var n=it();sn(e,t,134217728,n)}Ag(t,134217728)}};pE=function(t){if(t.tag===13){var e=Br(t),n=Qn(t,e);if(n!==null){var r=it();sn(n,t,e,r)}Ag(t,e)}};gE=function(){return le};_E=function(t,e){var n=le;try{return le=t,e()}finally{le=n}};Yf=function(t,e,n){switch(e){case"input":if(zf(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Su(r);if(!s)throw Error(L(90));$0(r),zf(r,s)}}}break;case"textarea":Y0(t,n);break;case"select":e=n.value,e!=null&&fi(t,!!n.multiple,e,!1)}};nE=dg;rE=Es;var Qb={usingClientEntryPoint:!1,Events:[Ra,Js,Su,eE,tE,dg]},ao={findFiberByHostInstance:is,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Zb={bundleType:ao.bundleType,version:ao.version,rendererPackageName:ao.rendererPackageName,rendererConfig:ao.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:nr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=oE(t),t===null?null:t.stateNode},findFiberByHostInstance:ao.findFiberByHostInstance||Jb,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hc.isDisabled&&hc.supportsFiber)try{Au=hc.inject(Zb),Bn=hc}catch{}}It.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qb;It.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Tg(e))throw Error(L(200));return Yb(t,e,null,n)};It.createRoot=function(t,e){if(!Tg(t))throw Error(L(299));var n=!1,r="",s=kS;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=mg(t,1,!1,null,null,n,!1,r,s),t[qn]=e.current,sa(t.nodeType===8?t.parentNode:t),new yg(e)};It.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(L(188)):(t=Object.keys(t).join(","),Error(L(268,t)));return t=oE(e),t=t===null?null:t.stateNode,t};It.flushSync=function(t){return Es(t)};It.hydrate=function(t,e,n){if(!Pu(e))throw Error(L(200));return Ou(null,t,e,!0,n)};It.hydrateRoot=function(t,e,n){if(!Tg(t))throw Error(L(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=kS;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=US(e,null,t,1,n??null,s,!1,i,o),t[qn]=e.current,sa(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Bu(e)};It.render=function(t,e,n){if(!Pu(e))throw Error(L(200));return Ou(null,t,e,!1,n)};It.unmountComponentAtNode=function(t){if(!Pu(t))throw Error(L(40));return t._reactRootContainer?(Es(function(){Ou(null,null,t,!1,function(){t._reactRootContainer=null,t[qn]=null})}),!0):!1};It.unstable_batchedUpdates=dg;It.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Pu(n))throw Error(L(200));if(t==null||t._reactInternals===void 0)throw Error(L(38));return Ou(t,e,n,!1,r)};It.version="18.3.1-next-f1338f8080-20240426";function LS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(LS)}catch(t){console.error(t)}}LS(),L0.exports=It;var Eg=L0.exports,VS,tA=Eg;VS=tA.createRoot,tA.hydrateRoot;const eI="modulepreload",tI=function(t){return"/"+t},nA={},nI=function(e,n,r){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=tI(i),i in nA)return;nA[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=s.length-1;u>=0;u--){const h=s[u];if(h.href===i&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":eI,o||(l.as="script",l.crossOrigin=""),l.href=i,document.head.appendChild(l),o)return new Promise((u,h)=>{l.addEventListener("load",u),l.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},rI=H.createContext(null);function sI(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,s=Array.isArray(e)?e[0]:e?e.x:0,i=Array.isArray(e)?e[1]:e?e.y:0;return n===s&&r===i}function zn(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!zn(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const s of n)if(!e.hasOwnProperty(s)||!zn(t[s],e[s]))return!1;return!0}return!1}function iI(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function rA(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();zn(n,r)||e.setProjection(n)}function sA(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function iA(t,e){const n=e.viewState||e;let r=!1;if("longitude"in n&&"latitude"in n){const s=t.center;t.center=new s.constructor(n.longitude,n.latitude),r=r||s!==t.center}if("zoom"in n){const s=t.zoom;t.zoom=n.zoom,r=r||s!==t.zoom}if("bearing"in n){const s=t.bearing;t.bearing=n.bearing,r=r||s!==t.bearing}if("pitch"in n){const s=t.pitch;t.pitch=n.pitch,r=r||s!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),r}const oI=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function oA(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let s=null;"interactive"in r&&(s=Object.assign({},r),delete s.interactive);const i=e[r.ref];if(i){s=s||Object.assign({},r),delete s.ref;for(const o of oI)o in i&&(s[o]=i[o])}return s||r});return{...t,layers:n}}const aA={version:8,sources:{},layers:[]},cA={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Oh={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},lA={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},aI=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],cI=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Pi{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=s=>{const i=this.props[lA[s.type]];i?i(s):s.type==="error"&&console.error(s.error)},this._onPointerEvent=s=>{(s.type==="mousemove"||s.type==="mouseout")&&this._updateHover(s);const i=this.props[cA[s.type]];i&&(this.props.interactiveLayerIds&&s.type!=="mouseover"&&s.type!=="mouseout"&&(s.features=this._hoveredFeatures||this._queryRenderedFeatures(s.point)),i(s),delete s.features)},this._onCameraEvent=s=>{if(!this._internalUpdate){const i=this.props[Oh[s.type]];i&&i(s)}s.type in this._deferredEvents&&(this._deferredEvents[s.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const s=this._updateSize(e),i=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||s||i&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=Pi.savedMaps.pop();if(!r)return null;const s=r.map,i=s.getContainer();for(n.className=i.className;i.childNodes.length>0;)n.appendChild(i.childNodes[0]);s._container=n;const o=s._resizeObserver;o&&(o.disconnect(),o.observe(n)),r.setProps({...e,styleDiffing:!1}),s.resize();const{initialViewState:a}=e;return a&&(a.bounds?s.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):r._updateViewState(a,!1)),s.isStyleLoaded()?s.fire("load"):s.once("styledata",()=>s.fire("load")),s._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=aA}=n,s={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||lI()||null,container:e,style:oA(r)},i=s.initialViewState||s.viewState||s;if(Object.assign(s,{center:[i.longitude||0,i.latitude||0],zoom:i.zoom||0,pitch:i.pitch||0,bearing:i.bearing||0}),n.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,n.gl)}const o=new this._MapClass(s);i.padding&&o.setPadding(i.padding),n.cursor&&(o.getCanvas().style.cursor=n.cursor),this._createShadowTransform(o);const a=o._render;o._render=u=>{this._inRender=!0,a.call(o,u),this._inRender=!1};const c=o._renderTaskQueue.run;o._renderTaskQueue.run=u=>{c.call(o._renderTaskQueue,u),this._onBeforeRepaint()},o.on("render",()=>this._onAfterRepaint());const l=o.fire;o.fire=this._fireEvent.bind(this,l),o.on("resize",()=>{this._renderTransform.resize(o.transform.width,o.transform.height)}),o.on("styledata",()=>{this._updateStyleComponents(this.props,{}),rA(o.transform,this._renderTransform)}),o.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in cA)o.on(u,this._onPointerEvent);for(const u in Oh)o.on(u,this._onCameraEvent);for(const u in lA)o.on(u,this._onEvent);this._map=o}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),Pi.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=iI(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,s=this._renderTransform,{zoom:i,pitch:o,bearing:a}=s,c=r.isMoving();c&&(s.cameraElevationReference="sea");const l=iA(s,{...sA(r.transform),...e});if(c&&(s.cameraElevationReference="ground"),l&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=i!==s.zoom),u.rotate||(u.rotate=a!==s.bearing),u.pitch||(u.pitch=o!==s.pitch)}return c||iA(r.transform,e),l}_updateSettings(e,n){const r=this._map;let s=!1;for(const i of aI)if(i in e&&!zn(e[i],n[i])){s=!0;const o=r[`set${i[0].toUpperCase()}${i.slice(1)}`];o==null||o.call(r,e[i])}return s}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:r=aA,styleDiffing:s=!0}=e,i={diff:s};return"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(oA(r),i),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let s=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!zn(e.light,n.light)&&(s=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!zn(e.fog,n.fog)&&(s=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!zn(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(s=!0,r.setTerrain(e.terrain))),s}_updateHandlers(e,n){var r,s;const i=this._map;let o=!1;for(const a of cI){const c=(r=e[a])!==null&&r!==void 0?r:!0,l=(s=n[a])!==null&&s!==void 0?s:!0;zn(c,l)||(o=!0,c?i[a].enable(c):i[a].disable())}return o}_queryRenderedFeatures(e){const n=this._map,r=n.transform,{interactiveLayerIds:s=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:s.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=r}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const i=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),c=a.length>0;!c&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,c&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=i}else this._hoveredFeatures=null}_fireEvent(e,n,r){const s=this._map,i=s.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in Oh&&(typeof n=="object"&&(n.viewState=sA(i)),this._map.isMoving())?(s.transform=this._renderTransform,e.call(s,n,r),s.transform=i,s):(e.call(s,n,r),s)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{rA(this._renderTransform,n),e.transform=n}}}Pi.savedMaps=[];function lI(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const uI=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function hI(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const s=e.transform;e.transform=t.transform;const i=e.project(r);return e.transform=s,i},unproject:r=>{const s=e.transform;e.transform=t.transform;const i=e.unproject(r);return e.transform=s,i},queryTerrainElevation:(r,s)=>{const i=e.transform;e.transform=t.transform;const o=e.queryTerrainElevation(r,s);return e.transform=i,o},queryRenderedFeatures:(r,s)=>{const i=e.transform;e.transform=t.transform;const o=e.queryRenderedFeatures(r,s);return e.transform=i,o}};for(const r of fI(e))!(r in n)&&!uI.includes(r)&&(n[r]=e[r].bind(e));return n}function fI(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const dI=typeof document<"u"?H.useLayoutEffect:H.useEffect,pI=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function gI(t,e){for(const r of pI)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!0)}const xu=H.createContext(null);function _I(t,e,n){const r=H.useContext(rI),[s,i]=H.useState(null),o=H.useRef(),{current:a}=H.useRef({mapLib:null,map:null});H.useEffect(()=>{const u=t.mapLib;let h=!0,f;return Promise.resolve(u||n).then(p=>{if(!h)return;if(!p)throw new Error("Invalid mapLib");const m="Map"in p?p:p.default;if(!m.Map)throw new Error("Invalid mapLib");if(gI(m,t),!m.supported||m.supported(t))t.reuseMaps&&(f=Pi.reuse(t,o.current)),f||(f=new Pi(m.Map,t,o.current)),a.map=hI(f),a.mapLib=m,i(f),r==null||r.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(p=>{const{onError:m}=t;m?m({type:"error",target:null,originalEvent:null,error:p}):console.error(p)}),()=>{h=!1,f&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?f.recycle():f.destroy())}},[]),dI(()=>{s&&s.setProps(t)}),H.useImperativeHandle(e,()=>a.map,[s]);const c=H.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),l={height:"100%"};return H.createElement("div",{id:t.id,ref:o,style:c},s&&H.createElement(xu.Provider,{value:a},H.createElement("div",{"mapboxgl-children":"",style:l},t.children)))}const mI=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Rs(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const s=e[r];Number.isFinite(s)&&!mI.test(r)?n[r]=`${s}px`:n[r]=s}}function AI(t,e){const{map:n,mapLib:r}=H.useContext(xu),s=H.useRef({props:t});s.current.props=t;const i=H.useMemo(()=>{let y=!1;H.Children.forEach(t.children,g=>{g&&(y=!0)});const w={...t,element:y?document.createElement("div"):null},_=new r.Marker(w);return _.setLngLat([t.longitude,t.latitude]),_.getElement().addEventListener("click",g=>{var T,C;(C=(T=s.current.props).onClick)===null||C===void 0||C.call(T,{type:"click",target:_,originalEvent:g})}),_.on("dragstart",g=>{var T,C;const I=g;I.lngLat=i.getLngLat(),(C=(T=s.current.props).onDragStart)===null||C===void 0||C.call(T,I)}),_.on("drag",g=>{var T,C;const I=g;I.lngLat=i.getLngLat(),(C=(T=s.current.props).onDrag)===null||C===void 0||C.call(T,I)}),_.on("dragend",g=>{var T,C;const I=g;I.lngLat=i.getLngLat(),(C=(T=s.current.props).onDragEnd)===null||C===void 0||C.call(T,I)}),_},[]);H.useEffect(()=>(i.addTo(n.getMap()),()=>{i.remove()}),[]);const{longitude:o,latitude:a,offset:c,style:l,draggable:u=!1,popup:h=null,rotation:f=0,rotationAlignment:p="auto",pitchAlignment:m="auto"}=t;return H.useEffect(()=>{Rs(i.getElement(),l)},[l]),H.useImperativeHandle(e,()=>i,[]),(i.getLngLat().lng!==o||i.getLngLat().lat!==a)&&i.setLngLat([o,a]),c&&!sI(i.getOffset(),c)&&i.setOffset(c),i.isDraggable()!==u&&i.setDraggable(u),i.getRotation()!==f&&i.setRotation(f),i.getRotationAlignment()!==p&&i.setRotationAlignment(p),i.getPitchAlignment()!==m&&i.setPitchAlignment(m),i.getPopup()!==h&&i.setPopup(h),Eg.createPortal(t.children,i.getElement())}H.memo(H.forwardRef(AI));function uA(t){return new Set(t?t.trim().split(/\s+/):[])}function yI(t,e){const{map:n,mapLib:r}=H.useContext(xu),s=H.useMemo(()=>document.createElement("div"),[]),i=H.useRef({props:t});i.current.props=t;const o=H.useMemo(()=>{const a={...t},c=new r.Popup(a);return c.setLngLat([t.longitude,t.latitude]),c.once("open",l=>{var u,h;(h=(u=i.current.props).onOpen)===null||h===void 0||h.call(u,l)}),c},[]);if(H.useEffect(()=>{const a=c=>{var l,u;(u=(l=i.current.props).onClose)===null||u===void 0||u.call(l,c)};return o.on("close",a),o.setDOMContent(s).addTo(n.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),H.useEffect(()=>{Rs(o.getElement(),t.style)},[t.style]),H.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!zn(o.options.offset,t.offset)&&o.setOffset(t.offset),(o.options.anchor!==t.anchor||o.options.maxWidth!==t.maxWidth)&&(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const a=uA(o.options.className),c=uA(t.className);for(const l of a)c.has(l)||o.removeClassName(l);for(const l of c)a.has(l)||o.addClassName(l);o.options.className=t.className}return Eg.createPortal(t.children,s)}H.memo(H.forwardRef(yI));function Ia(t,e,n,r){const s=H.useContext(xu),i=H.useMemo(()=>t(s),[]);return H.useEffect(()=>{const o=r||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,c=typeof n=="function"?n:typeof e=="function"?e:null,{map:l}=s;return l.hasControl(i)||(l.addControl(i,o==null?void 0:o.position),a&&a(s)),()=>{c&&c(s),l.hasControl(i)&&l.removeControl(i)}},[]),i}function TI(t){const e=Ia(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return H.useEffect(()=>{Rs(e._container,t.style)},[t.style]),null}H.memo(TI);function EI(t){const e=Ia(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return H.useEffect(()=>{Rs(e._controlContainer,t.style)},[t.style]),null}H.memo(EI);function SI(t,e){const n=H.useRef({props:t}),r=Ia(({mapLib:s})=>{const i=new s.GeolocateControl(t),o=i._setupUI;return i._setupUI=a=>{i._container.hasChildNodes()||o(a)},i.on("geolocate",a=>{var c,l;(l=(c=n.current.props).onGeolocate)===null||l===void 0||l.call(c,a)}),i.on("error",a=>{var c,l;(l=(c=n.current.props).onError)===null||l===void 0||l.call(c,a)}),i.on("outofmaxbounds",a=>{var c,l;(l=(c=n.current.props).onOutOfMaxBounds)===null||l===void 0||l.call(c,a)}),i.on("trackuserlocationstart",a=>{var c,l;(l=(c=n.current.props).onTrackUserLocationStart)===null||l===void 0||l.call(c,a)}),i.on("trackuserlocationend",a=>{var c,l;(l=(c=n.current.props).onTrackUserLocationEnd)===null||l===void 0||l.call(c,a)}),i},{position:t.position});return n.current.props=t,H.useImperativeHandle(e,()=>r,[]),H.useEffect(()=>{Rs(r._container,t.style)},[t.style]),null}H.memo(H.forwardRef(SI));function CI(t){const e=Ia(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return H.useEffect(()=>{Rs(e._container,t.style)},[t.style]),null}H.memo(CI);function vI(t){const e=Ia(({mapLib:i})=>new i.ScaleControl(t),{position:t.position}),n=H.useRef(t),r=n.current;n.current=t;const{style:s}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),H.useEffect(()=>{Rs(e._container,s)},[s]),null}H.memo(vI);const wI=nI(()=>import("./maplibre-gl-cd0de166.js").then(t=>t.m),[]),RI=(()=>H.forwardRef(function(e,n){return _I(e,n,wI)}))();async function Ma(t,e,n,r){return r._parse(t,e,n,r)}function ae(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Nu=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),hA=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);hA&&parseFloat(hA[1]);const fc=globalThis,xs=globalThis.process||{},bI=globalThis.navigator||{};function HS(t){var r,s;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Wr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||HS()}function II(t){return!t&&!Wr()?"Node":HS(t)?"Electron":(t||bI.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const zS="4.0.7";function MI(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class BI{constructor(e,n,r="sessionStorage"){this.storage=MI(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function PI(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function OI(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var Bl;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Bl||(Bl={}));const xI=10;function fA(t){return typeof t!="string"?t:(t=t.toUpperCase(),Bl[t]||Bl.WHITE)}function NI(t,e,n){return!Wr&&typeof t=="string"&&(e&&(t=`\x1B[${fA(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${fA(n)+xI}m${t}\x1B[49m`)),t}function FI(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),s=t;for(const i of r){const o=s[i];typeof o=="function"&&(e.find(a=>i===a)||(s[i]=o.bind(t)))}}function Sg(t,e){if(!t)throw new Error(e||"Assertion failed")}function Ns(){var e,n,r;let t;if(Wr()&&fc.performance)t=(n=(e=fc==null?void 0:fc.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in xs){const s=(r=xs==null?void 0:xs.hrtime)==null?void 0:r.call(xs);t=s[0]*1e3+s[1]/1e6}else t=Date.now();return t}const Fs={debug:Wr()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},DI={enabled:!0,level:0};function Ds(){}const dA={},pA={once:!0};class Wi{constructor({id:e}={id:""}){this.VERSION=zS,this._startTs=Ns(),this._deltaTs=Ns(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new BI(`__probe-${this.id}__`,DI),this.timeStamp(`${this.id} started`),FI(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ns()-this._startTs).toPrecision(10))}getDelta(){return Number((Ns()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Fs.warn,arguments,pA)}error(e){return this._getLogFunction(0,e,Fs.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,Fs.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Fs.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Fs.debug||Fs.info,arguments,pA)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Ds,r&&[r],{tag:kI(n)}):Ds}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Ds)}group(e,n,r={collapsed:!1}){const s=gA({logLevel:e,message:n,opts:r}),{collapsed:i}=r;return s.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ds)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=jS(e)}_getLogFunction(e,n,r,s,i){if(this._shouldLog(e)){i=gA({logLevel:e,message:n,args:s,opts:i}),r=r||i.method,Sg(r),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=Ns();const o=i.tag||i.message;if(i.once&&o)if(!dA[o])dA[o]=Ns();else return Ds;return n=UI(this.id,i.message,i),r.bind(console,n,...i.args)}return Ds}}Wi.VERSION=zS;function jS(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Sg(Number.isFinite(e)&&e>=0),e}function gA(t){const{logLevel:e,message:n}=t;t.logLevel=jS(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return Sg(s==="string"||s==="object"),Object.assign(t,{args:r},t.opts)}function UI(t,e,n){if(typeof e=="string"){const r=n.time?OI(PI(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=NI(e,n.color,n.background)}return e}function kI(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}globalThis.probe={};const WS=new Wi({id:"@probe.gl/log"});function LI(t,e){return XS(t||{},e)}function XS(t,e,n=0){if(n>3)return e;const r={...t};for(const[s,i]of Object.entries(e))i&&typeof i=="object"&&!Array.isArray(i)?r[s]=XS(r[s]||{},e[s],n+1):r[s]=e[s];return r}function VI(t){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,t)}function HI(t){var n,r;return((r=(n=globalThis.loaders)==null?void 0:n.modules)==null?void 0:r[t])||null}const zI="latest";function jI(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.4"),globalThis._loadersgl_.version}const GS=jI();function er(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Ht=typeof process!="object"||String(process)!=="[object process]"||process.browser,Cg=typeof importScripts=="function",WI=typeof window<"u"&&typeof window.orientation<"u",_A=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);_A&&parseFloat(_A[1]);class XI{constructor(e,n){d(this,"name");d(this,"workerThread");d(this,"isRunning",!0);d(this,"result");d(this,"_resolve",()=>{});d(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,s)=>{this._resolve=r,this._reject=s})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){er(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){er(this.isRunning),this.isRunning=!1,this._reject(e)}}class xh{terminate(){}}const Nh=new Map;function GI(t){er(t.source&&!t.url||!t.source&&t.url);let e=Nh.get(t.source||t.url);return e||(t.url&&(e=$I(t.url),Nh.set(t.url,e)),t.source&&(e=$S(t.source),Nh.set(t.source,e))),er(e),e}function $I(t){if(!t.startsWith("http"))return t;const e=KI(t);return $S(e)}function $S(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function KI(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function KS(t,e=!0,n){const r=n||new Set;if(t){if(mA(t))r.add(t);else if(mA(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const s in t)KS(t[s],e,r)}}return n===void 0?Array.from(r):[]}function mA(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Fh=()=>{};class Id{constructor(e){d(this,"name");d(this,"source");d(this,"url");d(this,"terminated",!1);d(this,"worker");d(this,"onMessage");d(this,"onError");d(this,"_loadableURL","");const{name:n,source:r,url:s}=e;er(r||s),this.name=n,this.source=r,this.url=s,this.onMessage=Fh,this.onError=i=>console.log(i),this.worker=Ht?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Ht||typeof xh<"u"&&!Ht}destroy(){this.onMessage=Fh,this.onError=Fh,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||KS(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=GI({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new xh(r,{eval:!1})}else if(this.source)e=new xh(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class YI{constructor(e){d(this,"name","unnamed");d(this,"source");d(this,"url");d(this,"maxConcurrency",1);d(this,"maxMobileConcurrency",1);d(this,"onDebug",()=>{});d(this,"reuseWorkers",!0);d(this,"props",{});d(this,"jobQueue",[]);d(this,"idleQueue",[]);d(this,"count",0);d(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Id.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(s,i,o)=>s.done(o),r=(s,i)=>s.error(i)){const s=new Promise(i=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:i}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new XI(n.name,e);e.onMessage=s=>n.onMessage(r,s.type,s.payload),e.onError=s=>n.onError(r,s),n.onStart(r);try{await r.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Ht||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Id({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return WI?this.maxMobileConcurrency:this.maxConcurrency}}const JI={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},mr=class mr{constructor(e){d(this,"props");d(this,"workerPools",new Map);this.props={...JI},this.setProps(e),this.workerPools=new Map}static isSupported(){return Id.isSupported()}static getWorkerFarm(e={}){return mr._workerFarm=mr._workerFarm||new mr({}),mr._workerFarm.setProps(e),mr._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:s}=e;let i=this.workerPools.get(n);return i||(i=new YI({name:n,source:r,url:s}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};d(mr,"_workerFarm");let Pl=mr;function qI(t,e={}){const n=e[t.id]||{},r=Ht?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let s=n.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(Ht?s=`modules/${t.module}/dist/${r}`:s=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!s){let i=t.version;i==="latest"&&(i=zI);const o=i?`@${i}`:"";s=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return er(s),s}function QI(t,e=GS){er(t,"no worker provided");const n=t.version;return!(!e||!n)}const Dh={};async function ps(t,e=null,n={},r=null){return e&&(t=ZI(t,e,n,r)),Dh[t]=Dh[t]||e3(t),await Dh[t]}function ZI(t,e,n={},r=null){if(!n.useLocalLibraries&&t.startsWith("http"))return t;r=r||t;const s=n.modules||{};return s[r]?s[r]:Ht?n.CDN?(er(n.CDN.startsWith("http")),`${n.CDN}/${e}@${GS}/dist/libs/${r}`):Cg?`../src/libs/${r}`:`modules/${e}/src/libs/${r}`:`modules/${e}/dist/libs/${r}`}async function e3(t){if(t.endsWith("wasm"))return await n3(t);if(!Ht)try{const{requireFromFile:n}=globalThis.loaders||{};return await(n==null?void 0:n(t))}catch(n){return console.error(n),null}if(Cg)return importScripts(t);const e=await r3(t);return t3(e,t)}function t3(t,e){if(!Ht){const{requireFromString:r}=globalThis.loaders||{};return r==null?void 0:r(t,e)}if(Cg)return eval.call(globalThis,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch{n.text=t}return document.body.appendChild(n),null}async function n3(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Ht||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function r3(t){const{readFileAsText:e}=globalThis.loaders||{};return Ht||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function s3(t,e){return!Pl.isSupported()||!Ht&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function i3(t,e,n,r,s){const i=t.id,o=qI(t,n),c=Pl.getWorkerFarm(n).getWorkerPool({name:i,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const l=await c.startJob("process-on-worker",o3.bind(null,s));return l.postMessage("process",{input:e,options:n,context:r}),await(await l.result).result}async function o3(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:s,input:i,options:o}=r;try{const a=await t(i,o);e.postMessage("done",{id:s,result:a})}catch(a){const c=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:s,error:c})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function a3(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?AA(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?AA(t,0,e):""}function AA(t,e,n){if(t.byteLength<=e+n)return"";const r=new DataView(t);let s="";for(let i=0;i<n;i++)s+=String.fromCharCode(r.getUint8(e+i));return s}function c3(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${a3(t)}"`)}}function l3(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),s=new Uint8Array(e);for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}function u3(...t){return h3(t)}function h3(t){const e=t.map(i=>i instanceof ArrayBuffer?new Uint8Array(i):i),n=e.reduce((i,o)=>i+o.byteLength,0),r=new Uint8Array(n);let s=0;for(const i of e)r.set(i,s),s+=i.byteLength;return r.buffer}function vg(t,e,n){const r=n!==void 0?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(r).buffer}function Ba(t,e){return ae(t>=0),ae(e>0),t+(e-1)&~(e-1)}function f3(t,e,n){let r;if(t instanceof ArrayBuffer)r=new Uint8Array(t);else{const s=t.byteOffset,i=t.byteLength;r=new Uint8Array(t.buffer||t.arrayBuffer,s,i)}return e.set(r,n),n+Ba(r.byteLength,4)}async function d3(t){const e=[];for await(const n of t)e.push(n);return u3(...e)}function yA(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class TA{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=yA(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(yA()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Xi{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let s=this.stats[n];return s||(e instanceof TA?s=e:s=new TA(n,r),this.stats[n]=s),s}}const p3="Queued Requests",g3="Active Requests",_3="Cancelled Requests",m3="Queued Requests Ever",A3="Active Requests Ever",y3={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class T3{constructor(e={}){d(this,"props");d(this,"stats");d(this,"activeRequestCount",0);d(this,"requestQueue",[]);d(this,"requestMap",new Map);d(this,"updateTimer",null);this.props={...y3,...e},this.stats=new Xi({id:this.props.id}),this.stats.get(p3),this.stats.get(g3),this.stats.get(_3),this.stats.get(m3),this.stats.get(A3)}scheduleRequest(e,n=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:n},s=new Promise(i=>(r.resolve=i,r));return this.requestQueue.push(r),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){const{handle:n,resolve:r}=e;let s=!1;const i=()=>{s||(s=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:i}):Promise.resolve({done:i})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const r=e[n];this._updateRequest(r)||(e.splice(n,1),this.requestMap.delete(r.handle),n--)}e.sort((n,r)=>n.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let E3="";const EA={};function S3(t){for(const e in EA)if(t.startsWith(e)){const n=EA[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${E3}${t}`),t}function C3(t){return t&&typeof t=="object"&&t.isBuffer}function YS(t){if(C3(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function v3(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=(e=window.location)==null?void 0:e.pathname;return(t==null?void 0:t.slice(0,t.lastIndexOf("/")+1))||""}function JS(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function wg(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function w3(...t){const e=[];for(let i=0;i<t.length;i++)e[i]=t[i];let n="",r=!1,s;for(let i=e.length-1;i>=-1&&!r;i--){let o;i>=0?o=e[i]:(s===void 0&&(s=v3()),o=s),o.length!==0&&(n=`${o}/${n}`,r=o.charCodeAt(0)===vo)}return n=R3(n,!r),r?`/${n}`:n.length>0?n:"."}const vo=47,Uh=46;function R3(t,e){let n="",r=-1,s=0,i,o=!1;for(let a=0;a<=t.length;++a){if(a<t.length)i=t.charCodeAt(a);else{if(i===vo)break;i=vo}if(i===vo){if(!(r===a-1||s===1))if(r!==a-1&&s===2){if(n.length<2||!o||n.charCodeAt(n.length-1)!==Uh||n.charCodeAt(n.length-2)!==Uh){if(n.length>2){const c=n.length-1;let l=c;for(;l>=0&&n.charCodeAt(l)!==vo;--l);if(l!==c){n=l===-1?"":n.slice(0,l),r=a,s=0,o=!1;continue}}else if(n.length===2||n.length===1){n="",r=a,s=0,o=!1;continue}}e&&(n.length>0?n+="/..":n="..",o=!0)}else{const c=t.slice(r+1,a);n.length>0?n+=`/${c}`:n=c,o=!1}r=a,s=0}else i===Uh&&s!==-1?++s:s=-1}return n}const b3=t=>typeof t=="boolean",Lo=t=>typeof t=="function",Pa=t=>t!==null&&typeof t=="object",SA=t=>Pa(t)&&t.constructor==={}.constructor,I3=t=>!!t&&typeof t[Symbol.iterator]=="function",M3=t=>t&&typeof t[Symbol.asyncIterator]=="function",bs=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Is=t=>typeof Blob<"u"&&t instanceof Blob,B3=t=>t&&typeof t=="object"&&t.isBuffer,P3=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Pa(t)&&Lo(t.tee)&&Lo(t.cancel)&&Lo(t.getReader),O3=t=>Pa(t)&&Lo(t.read)&&Lo(t.pipe)&&b3(t.readable),qS=t=>P3(t)||O3(t);class x3 extends Error{constructor(n,r){super(n);d(this,"reason");d(this,"url");d(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const N3=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,F3=/^([-\w.]+\/[-\w.+]+)/;function CA(t,e){return t.toLowerCase()===e.toLowerCase()}function D3(t){const e=F3.exec(t);return e?e[1]:t}function vA(t){const e=N3.exec(t);return e?e[1]:""}const QS=/\?.*/;function U3(t){const e=t.match(QS);return e&&e[0]}function Rg(t){return t.replace(QS,"")}function k3(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Fu(t){return bs(t)?t.url:Is(t)?t.name||"":typeof t=="string"?t:""}function bg(t){if(bs(t)){const e=t,n=e.headers.get("content-type")||"",r=Rg(e.url);return D3(n)||vA(r)}return Is(t)?t.type||"":typeof t=="string"?vA(t):""}function L3(t){return bs(t)?t.headers["content-length"]||-1:Is(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function ZS(t){if(bs(t))return t;const e={},n=L3(t);n>=0&&(e["content-length"]=String(n));const r=Fu(t),s=bg(t);s&&(e["content-type"]=s);const i=await z3(t);i&&(e["x-first-bytes"]=i),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function V3(t){if(!t.ok)throw await H3(t)}async function H3(t){const e=k3(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const s=t.headers.get("Content-Type");r.reason=s!=null&&s.includes("application/json")?await t.json():t.text()}catch{}return new x3(n,r)}async function z3(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const s=new FileReader;s.onload=i=>{var o;return r((o=i==null?void 0:i.target)==null?void 0:o.result)},s.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${j3(n)}`}return null}function j3(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function W3(t){return!X3(t)&&!G3(t)}function X3(t){return t.startsWith("http:")||t.startsWith("https:")}function G3(t){return t.startsWith("data:")}async function da(t,e){var n,r;if(typeof t=="string"){const s=S3(t);return W3(s)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(s,e):await fetch(s,e)}return await ZS(t)}const wA=new Wi({id:"loaders.gl"});class $3{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class K3{constructor(){d(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const eC={fetch:null,mimeType:void 0,nothrow:!1,log:new K3,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Nu,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Y3={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function tC(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function nC(){const t=tC();return t.globalOptions=t.globalOptions||{...eC},t.globalOptions}function J3(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],q3(t,n),Z3(e,t,r)}function q3(t,e){RA(t,null,eC,Y3,e);for(const n of e){const r=t&&t[n.id]||{},s=n.options&&n.options[n.id]||{},i=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};RA(r,n.id,s,i,e)}}function RA(t,e,n,r,s){const i=e||"Top level",o=e?`${e}.`:"";for(const a in t){const c=!e&&Pa(t[a]),l=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!l&&!u){if(a in r)wA.warn(`${i} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!c){const h=Q3(a,s);wA.warn(`${i} loader option '${o}${a}' not recognized. ${h}`)()}}}}function Q3(t,e){const n=t.toLowerCase();let r="";for(const s of e)for(const i in s.options){if(t===i)return`Did you mean '${s.id}.${i}'?`;const o=i.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${s.id}.${i}'?`)}return r}function Z3(t,e,n){const s={...t.options||{}};return eM(s,n),s.log===null&&(s.log=new $3),bA(s,nC()),bA(s,e),s}function bA(t,e){for(const n in e)if(n in e){const r=e[n];SA(r)&&SA(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function eM(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Ig(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function Mg(t){ae(t,"null loader"),ae(Ig(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const rC=()=>{const t=tC();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function tM(t){const e=rC();t=Array.isArray(t)?t:[t];for(const n of t){const r=Mg(n);e.find(s=>r===s)||e.unshift(r)}}function nM(){return rC()}const rM=new Wi({id:"loaders.gl"}),sM=/\.([^.]+)$/;async function iM(t,e=[],n,r){if(!sC(t))return null;let s=IA(t,e,{...n,nothrow:!0},r);if(s)return s;if(Is(t)&&(t=await t.slice(0,10).arrayBuffer(),s=IA(t,e,n,r)),!s&&!(n!=null&&n.nothrow))throw new Error(iC(t));return s}function IA(t,e=[],n,r){if(!sC(t))return null;if(e&&!Array.isArray(e))return Mg(e);let s=[];e&&(s=s.concat(e)),n!=null&&n.ignoreRegisteredLoaders||s.push(...nM()),aM(s);const i=oM(t,s,n,r);if(!i&&!(n!=null&&n.nothrow))throw new Error(iC(t));return i}function oM(t,e,n,r){const s=Fu(t),i=bg(t),o=Rg(s)||(r==null?void 0:r.url);let a=null,c="";return n!=null&&n.mimeType&&(a=kh(e,n==null?void 0:n.mimeType),c=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||cM(e,o),c=c||(a?`matched url ${o}`:""),a=a||kh(e,i),c=c||(a?`matched MIME type ${i}`:""),a=a||uM(e,t),c=c||(a?`matched initial data ${oC(t)}`:""),n!=null&&n.fallbackMimeType&&(a=a||kh(e,n==null?void 0:n.fallbackMimeType),c=c||(a?`matched fallback MIME type ${i}`:"")),c&&rM.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${c}.`),a}function sC(t){return!(t instanceof Response&&t.status===204)}function iC(t){const e=Fu(t),n=bg(t);let r="No valid loader found (";r+=e?`${JS(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const s=t?oC(t):"";return r+=s?` first bytes: "${s}"`:"first bytes: not available",r+=")",r}function aM(t){for(const e of t)Mg(e)}function cM(t,e){const n=e&&sM.exec(e),r=n&&n[1];return r?lM(t,r):null}function lM(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function kh(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(s=>CA(e,s))||CA(e,`application/x.${r.id}`))return r;return null}function uM(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(hM(e,n))return n}else if(ArrayBuffer.isView(e)){if(MA(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&MA(e,0,n))return n;return null}function hM(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function MA(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(s=>fM(t,e,n,s))}function fM(t,e,n,r){if(r instanceof ArrayBuffer)return l3(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const s=Md(t,e,r.length);return r===s;default:return!1}}function oC(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Md(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Md(t,0,e):""}function Md(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let s="";for(let i=0;i<n;i++)s+=String.fromCharCode(r.getUint8(e+i));return s}const dM=256*1024;function*pM(t,e){const n=(e==null?void 0:e.chunkSize)||dM;let r=0;const s=new TextEncoder;for(;r<t.length;){const i=Math.min(t.length-r,n),o=t.slice(r,r+i);r+=i,yield s.encode(o)}}const gM=256*1024;function*_M(t,e={}){const{chunkSize:n=gM}=e;let r=0;for(;r<t.byteLength;){const s=Math.min(t.byteLength-r,n),i=new ArrayBuffer(s),o=new Uint8Array(t,r,s);new Uint8Array(i).set(o),r+=s,yield i}}const mM=1024*1024;async function*AM(t,e){const n=(e==null?void 0:e.chunkSize)||mM;let r=0;for(;r<t.size;){const s=r+n,i=await t.slice(r,s).arrayBuffer();r=s,yield i}}function BA(t,e){return Nu?yM(t,e):TM(t)}async function*yM(t,e){const n=t.getReader();let r;try{for(;;){const s=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:i,value:o}=await s;if(i)return;yield YS(o)}}catch{n.releaseLock()}}async function*TM(t,e){for await(const n of t)yield YS(n)}function EM(t,e){if(typeof t=="string")return pM(t,e);if(t instanceof ArrayBuffer)return _M(t,e);if(Is(t))return AM(t,e);if(qS(t))return BA(t,e);if(bs(t))return BA(t.body,e);throw new Error("makeIterator")}const aC="Cannot convert supplied data type";function SM(t,e,n){if(e.text&&typeof t=="string")return t;if(B3(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+s)),r}throw new Error(aC)}async function CM(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return SM(t,e);if(Is(t)&&(t=await ZS(t)),bs(t)){const s=t;return await V3(s),e.binary?await s.arrayBuffer():await s.text()}if(qS(t)&&(t=EM(t,n)),I3(t)||M3(t))return d3(t);throw new Error(aC)}function cC(t,e){const n=nC(),r=t||n;return typeof r.fetch=="function"?r.fetch:Pa(r.fetch)?s=>da(s,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:da}function vM(t,e,n){if(n)return n;const r={fetch:cC(e,t),...t};if(r.url){const s=Rg(r.url);r.baseUrl=s,r.queryString=U3(r.url),r.filename=JS(s),r.baseUrl=wg(s)}return Array.isArray(r.loaders)||(r.loaders=null),r}function wM(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function Ol(t,e,n,r){e&&!Array.isArray(e)&&!Ig(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const s=Fu(t),o=wM(e,r),a=await iM(t,o,n);return a?(n=J3(n,a,o,s),r=vM({url:s,_parse:Ol,loaders:o},n,r||null),await RM(a,t,n,r)):null}async function RM(t,e,n,r){if(QI(t),n=LI(t.options,n),bs(e)){const i=e,{ok:o,redirected:a,status:c,statusText:l,type:u,url:h}=i,f=Object.fromEntries(i.headers.entries());r.response={headers:f,ok:o,redirected:a,status:c,statusText:l,type:u,url:h}}e=await CM(e,t,n);const s=t;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,n,r);if(s3(t,n))return await i3(t,e,n,r,Ol);if(s.parseText&&typeof e=="string")return await s.parseText(e,n,r);if(s.parse)return await s.parse(e,n,r);throw er(!s.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function bM(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function lC(t){let e=1/0,n=1/0,r=1/0,s=-1/0,i=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],c=a&&a.length;for(let l=0;l<c;l+=3){const u=a[l],h=a[l+1],f=a[l+2];e=u<e?u:e,n=h<n?h:n,r=f<r?f:r,s=u>s?u:s,i=h>i?h:i,o=f>o?f:o}return[[e,n,r],[s,i,o]]}function IM(t,e,n){const r=bM(e.value),s=n||MM(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:r}]},nullable:!1,metadata:s}}function MM(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function Dr(t,e,n,r){let s,i;!Array.isArray(e)&&!Ig(e)?(s=[],i=e):(s=e,i=n);const o=cC(i);let a=t;return typeof t=="string"&&(a=await o(t)),Is(t)&&(a=await o(t)),Array.isArray(s)?await Ol(a,s,i):await Ol(a,s,i)}const BM="4.2.4";var I0;const PM=(I0=globalThis.loaders)==null?void 0:I0.parseImageNode,Bd=typeof Image<"u",Pd=typeof ImageBitmap<"u",OM=!!PM,Od=Nu?!0:OM;function xM(t){switch(t){case"auto":return Pd||Bd||Od;case"imagebitmap":return Pd;case"image":return Bd;case"data":return Od;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function NM(){if(Pd)return"imagebitmap";if(Bd)return"image";if(Od)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function FM(t){const e=DM(t);if(!e)throw new Error("Not an image");return e}function uC(t){switch(FM(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function DM(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const UM=/^data:image\/svg\+xml/,kM=/\.svg((\?|#).*)?$/;function Bg(t){return t&&(UM.test(t)||kM.test(t))}function LM(t,e){if(Bg(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return hC(t,e)}function hC(t,e){if(Bg(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function fC(t,e,n){const r=LM(t,n),s=self.URL||self.webkitURL,i=typeof r!="string"&&s.createObjectURL(r);try{return await VM(i||r,e)}finally{i&&s.revokeObjectURL(i)}}async function VM(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,s)=>{try{n.onload=()=>r(n),n.onerror=i=>{const o=i instanceof Error?i.message:"error";s(new Error(o))}}catch(i){s(i)}})}const HM={};let PA=!0;async function zM(t,e,n){let r;Bg(n)?r=await fC(t,e,n):r=hC(t,n);const s=e&&e.imagebitmap;return await jM(r,s)}async function jM(t,e=null){if((WM(e)||!PA)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),PA=!1}return await createImageBitmap(t)}function WM(t){for(const e in t||HM)return!1;return!0}function XM(t){return!YM(t,"ftyp",4)||!(t[8]&96)?null:GM(t)}function GM(t){switch($M(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function $M(t,e,n){return String.fromCharCode(...t.slice(e,n))}function KM(t){return[...t].map(e=>e.charCodeAt(0))}function YM(t,e,n=0){const r=KM(e);for(let s=0;s<r.length;++s)if(r[s]!==t[s+n])return!1;return!0}const wn=!1,Vo=!0;function Pg(t){const e=Oa(t);return qM(e)||eB(e)||QM(e)||ZM(e)||JM(e)}function JM(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=XM(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function qM(t){const e=Oa(t);return e.byteLength>=24&&e.getUint32(0,wn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,wn),height:e.getUint32(20,wn)}:null}function QM(t){const e=Oa(t);return e.byteLength>=10&&e.getUint32(0,wn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Vo),height:e.getUint16(8,Vo)}:null}function ZM(t){const e=Oa(t);return e.byteLength>=14&&e.getUint16(0,wn)===16973&&e.getUint32(2,Vo)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Vo),height:e.getUint32(22,Vo)}:null}function eB(t){const e=Oa(t);if(!(e.byteLength>=3&&e.getUint16(0,wn)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:s}=tB();let i=2;for(;i+9<e.byteLength;){const o=e.getUint16(i,wn);if(s.has(o))return{mimeType:"image/jpeg",height:e.getUint16(i+5,wn),width:e.getUint16(i+7,wn)};if(!r.has(o))return null;i+=2,i+=e.getUint16(i,wn)}return null}function tB(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Oa(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function nB(t,e){var s;const{mimeType:n}=Pg(t)||{},r=(s=globalThis.loaders)==null?void 0:s.parseImageNode;return ae(r),await r(t,n)}async function rB(t,e,n){e=e||{};const s=(e.image||{}).type||"auto",{url:i}=n||{},o=sB(s);let a;switch(o){case"imagebitmap":a=await zM(t,e,i);break;case"image":a=await fC(t,e,i);break;case"data":a=await nB(t);break;default:ae(!1)}return s==="data"&&(a=uC(a)),a}function sB(t){switch(t){case"auto":case"data":return NM();default:return xM(t),t}}const iB=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],oB=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],aB={image:{type:"auto",decode:!0}},dC={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:BM,mimeTypes:oB,extensions:iB,parse:rB,tests:[t=>!!Pg(new DataView(t))],options:aB},Lh={};function cB(t){if(Lh[t]===void 0){const e=Nu?uB(t):lB(t);Lh[t]=e}return Lh[t]}function lB(t){var s,i;const e=["image/png","image/jpeg","image/gif"],n=((s=globalThis.loaders)==null?void 0:s.imageFormatsNode)||e;return!!((i=globalThis.loaders)==null?void 0:i.parseImageNode)&&n.includes(t)}function uB(t){switch(t){case"image/avif":case"image/webp":return hB(t);default:return!0}}function hB(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}const fB=new Wi({id:"deck"}),ie=fB;let xd={};function dB(t){xd=t}function Je(t,e,n,r){ie.level>0&&xd[t]&&xd[t].call(null,e,n,r)}function pB(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const gB={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:pB,parseTextSync:JSON.parse};function _B(){const t="9.0.33",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(ie.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:ie,_registerLoggers:dB},tM([gB,[dC,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const mB=_B();function cs(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Vh={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function AB(t){const e={};for(const[n,r]of Object.entries(t))e[n]=TB(r);return e}function yB(t,e,n){const r={};for(const[s,i]of Object.entries(e))t&&s in t&&!i.private?(i.validate&&cs(i.validate(t[s],i),`${n}: invalid ${s}`),r[s]=t[s]):r[s]=i.value;return r}function TB(t){let e=OA(t);if(e!=="object")return{value:t,...Vh[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Vh[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=OA(t.value),{...t,...Vh[e],type:e}):{type:"object",value:null};throw new Error("props")}function OA(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const EB=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,SB=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,CB={vertex:EB,fragment:SB},xA=/void\s+main\s*\([^)]*\)\s*\{\n?/,NA=/}\n?[^{}]*$/,Hh=[],Zc="__LUMA_INJECT_DECLARATIONS__";function vB(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const s=wB(n);typeof r=="string"&&(r={order:0,injection:r}),e[s][n]=r}return e}function wB(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function xl(t,e,n,r=!1){const s=e==="vertex";for(const i in n){const o=n[i];o.sort((c,l)=>c.order-l.order),Hh.length=o.length;for(let c=0,l=o.length;c<l;++c)Hh[c]=o[c].injection;const a=`${Hh.join(`
`)}
`;switch(i){case"vs:#decl":s&&(t=t.replace(Zc,a));break;case"vs:#main-start":s&&(t=t.replace(xA,c=>c+a));break;case"vs:#main-end":s&&(t=t.replace(NA,c=>a+c));break;case"fs:#decl":s||(t=t.replace(Zc,a));break;case"fs:#main-start":s||(t=t.replace(xA,c=>c+a));break;case"fs:#main-end":s||(t=t.replace(NA,c=>a+c));break;default:t=t.replace(i,c=>c+a)}}return t=t.replace(Zc,""),r&&(t=t.replace(/\}\s*$/,i=>i+CB[e])),t}let RB=1;class ls{constructor(e){d(this,"name");d(this,"vs");d(this,"fs");d(this,"getModuleUniforms");d(this,"dependencies");d(this,"deprecations");d(this,"defines");d(this,"injections");d(this,"uniforms",{});d(this,"uniformTypes",{});const{name:n,vs:r,fs:s,dependencies:i=[],uniformTypes:o={},uniformPropTypes:a={},getUniforms:c,deprecations:l=[],defines:u={},inject:h={}}=e;cs(typeof n=="string"),this.name=n,this.vs=r,this.fs=s,this.getModuleUniforms=c,this.dependencies=ls.instantiateModules(i),this.deprecations=this._parseDeprecationDefinitions(l),this.defines=u,this.injections=vB(h),this.uniformTypes=o,a&&(this.uniforms=AB(a))}static instantiateModules(e){return e.map(n=>{if(n instanceof ls)return n;cs(typeof n!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(n)}' and use it directly.`),n.name||(console.warn("shader module has no name"),n.name=`shader-module-${RB++}`);const r=new ls(n);return r.dependencies=ls.instantiateModules(n.dependencies||[]),r})}getModuleSource(e){let n;switch(e){case"vertex":n=this.vs||"";break;case"fragment":n=this.fs||"";break;default:cs(!1)}const r=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${r}
${n}

`}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):yB(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{var s;(s=r.regex)!=null&&s.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp(`\\b${n.old}\\(`);break;default:n.regex=new RegExp(`${n.type} ${n.old};`)}}),e}_defaultGetUniforms(e={}){const n={},r=this.uniforms;for(const s in r){const i=r[s];s in e&&!i.private?(i.validate&&cs(i.validate(e[s],i),`${this.name}: invalid ${s}`),n[s]=e[s]):n[s]=i.value}return n}}function FA(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=DA(t.platformInfo,t.vs);let n;return t.fs&&(n=DA(t.platformInfo,t.fs)),{...t,vs:e,fs:n}}function DA(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function Du(t){const e=ls.instantiateModules(t);return bB(e)}function bB(t){const e={},n={};return pC({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,s)=>n[s]-n[r]).map(r=>e[r])}function pC(t){const{modules:e,level:n,moduleMap:r,moduleDepth:s}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const i of e)r[i.name]=i,(s[i.name]===void 0||s[i.name]<n)&&(s[i.name]=n);for(const i of e)i.dependencies&&pC({modules:i.dependencies,level:n+1,moduleMap:r,moduleDepth:s})}function IB(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function MB(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=UA(t,BB),t;case"fragment":return t=UA(t,PB),t;default:throw new Error(e)}}const gC=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],BB=[...gC,[Nd("attribute"),"in $1"],[Nd("varying"),"out $1"]],PB=[...gC,[Nd("varying"),"in $1"]];function UA(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function Nd(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function _C(t,e){let n="";for(const r in t){const s=t[r];if(n+=`void ${s.signature} {
`,s.header&&(n+=`  ${s.header}`),e[r]){const i=e[r];i.sort((o,a)=>o.order-a.order);for(const o of i)n+=`  ${o.injection}
`}s.footer&&(n+=`  ${s.footer}`),n+=`}
`}return n}function mC(t){const e={vertex:{},fragment:{}};for(const n of t){let r,s;typeof n!="string"?(r=n,s=r.hook):(r={},s=n),s=s.trim();const[i,o]=s.split(":"),a=s.replace(/\(.+/,""),c=Object.assign(r,{signature:o});switch(i){case"vs":e.vertex[a]=c;break;case"fs":e.fragment[a]=c;break;default:throw new Error(i)}}return e}function OB(t,e){return{name:xB(t,e),language:"glsl",version:NB(t)}}function xB(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function NB(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const AC=`

${Zc}
`,FB=`precision highp float;
`;function DB(t){const e=Du(t.modules||[]);return{source:Fd(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:Og(e)}}function UB(t){const e=Du(t.modules||[]);return{vs:Fd(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:Fd(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:Og(e)}}function kB(t){const{vs:e,fs:n}=t,r=Du(t.modules||[]);return{vs:kA(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:kA(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:Og(r)}}function Fd(t,e){const{source:n,stage:r,modules:s,hookFunctions:i=[],inject:o={},log:a}=e;cs(typeof n=="string","shader source must be a string");const c=n;let l="";const u=mC(i),h={},f={},p={};for(const y in o){const w=typeof o[y]=="string"?{injection:o[y],order:0}:o[y],_=/^(v|f)s:(#)?([\w-]+)$/.exec(y);if(_){const g=_[2],T=_[3];g?T==="decl"?f[y]=[w]:p[y]=[w]:h[y]=[w]}else p[y]=[w]}const m=t.type!=="webgpu"?s:[];for(const y of m){a&&y.checkDeprecations(c,a);const w=y.getModuleSource(r,"wgsl");l+=w;const _=y.injections[r];for(const g in _){const T=/^(v|f)s:#([\w-]+)$/.exec(g);if(T){const I=T[2]==="decl"?f:p;I[g]=I[g]||[],I[g].push(_[g])}else h[g]=h[g]||[],h[g].push(_[g])}}return l+=AC,l=xl(l,r,f),l+=_C(u[r],h),l+=c,l=xl(l,r,p),l}function kA(t,e){const{id:n,source:r,stage:s,language:i="glsl",modules:o,defines:a={},hookFunctions:c=[],inject:l={},prologue:u=!0,log:h}=e;cs(typeof r=="string","shader source must be a string");const f=i==="glsl"?OB(r).version:-1,p=t.shaderLanguageVersion,m=f===100?"#version 100":"#version 300 es",w=r.split(`
`).slice(1).join(`
`),_={};o.forEach(x=>{Object.assign(_,x.getDefines())}),Object.assign(_,a);let g="";switch(i){case"wgsl":break;case"glsl":g=u?`${m}

// ----- PROLOGUE -------------------------
${LB({id:n,source:r,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}
${IB(t)}
${s==="fragment"?FB:""}

// ----- APPLICATION DEFINES -------------------------

${VB(_)}

`:`${m}
`;break}const T=mC(c),C={},I={},P={};for(const x in l){const N=typeof l[x]=="string"?{injection:l[x],order:0}:l[x],D=/^(v|f)s:(#)?([\w-]+)$/.exec(x);if(D){const F=D[2],X=D[3];F?X==="decl"?I[x]=[N]:P[x]=[N]:C[x]=[N]}else P[x]=[N]}for(const x of o){h&&x.checkDeprecations(w,h);const N=x.getModuleSource(s);g+=N;const D=x.injections[s];for(const F in D){const X=/^(v|f)s:#([\w-]+)$/.exec(F);if(X){const ee=X[2]==="decl"?I:P;ee[F]=ee[F]||[],ee[F].push(D[F])}else C[F]=C[F]||[],C[F].push(D[F])}}return g+="// ----- MAIN SHADER SOURCE -------------------------",g+=AC,g=xl(g,s,I),g+=_C(T[s],C),g+=w,g=xl(g,s,P),i==="glsl"&&f!==p&&(g=MB(g,s)),g.trim()}function Og(t){return function(n){const r={};for(const s of t){const i=s.getUniforms(n,r);Object.assign(r,i)}return r}}function LB(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}

`:""}function VB(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}const rs=class rs{constructor(){d(this,"_hookFunctions",[]);d(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return rs.defaultShaderAssembler=rs.defaultShaderAssembler||new rs,rs.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,s=FA(e);return{...DB({platformInfo:e.platformInfo,...s,modules:n,hookFunctions:r}),modules:n}}assembleShaderPair(e){const n=FA(e),r=this._getModuleList(e.modules),s=this._hookFunctions,{platformInfo:i}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?UB({platformInfo:i,...n,modules:r,hookFunctions:s}):kB({platformInfo:i,...n,modules:r,hookFunctions:s}),modules:r}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let s=0;for(let i=0,o=this._defaultModules.length;i<o;++i){const a=this._defaultModules[i],c=a.name;n[s++]=a,r[c]=!0}for(let i=0,o=e.length;i<o;++i){const a=e[i],c=a.name;r[c]||(n[s++]=a,r[c]=!0)}return n.length=s,ls.instantiateModules(n)}};d(rs,"defaultShaderAssembler");let Nl=rs;const HB=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,zB=`#version 300 es
${HB}`;function jB(t){const{input:e,inputChannels:n,output:r}=t||{};if(!e)return zB;if(!n)throw new Error("inputChannels");const s=WB(n),i=XB(e,n);return`#version 300 es
in ${s} ${e};
out vec4 ${r};
void main() {
  ${r} = ${i};
}`}function WB(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function XB(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const k=new Wi({id:"luma.gl"});class GB{constructor(){d(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Xi({id:e})),this.stats.get(e)}}const xg=new GB;function $B(){const t="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(Wr()&&k.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:k,stats:xg}),t}const KB=$B();function YB(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function pa(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:YB(t)}const zh={};function Xr(t="id"){zh[t]=zh[t]||1;const e=zh[t]++;return`${t}-${e}`}function Fl(t){let e=!0;for(const n in t){e=!1;break}return e}var Nf;let de=(Nf=class{constructor(e,n,r){d(this,"id");d(this,"props");d(this,"userData",{});d(this,"_device");d(this,"destroyed",!1);d(this,"allocatedBytes",0);d(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=JB(n,r);const s=this.props.id!=="undefined"?this.props.id:Xr(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},d(Nf,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Nf);function JB(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const je=class je extends de{constructor(n,r){const s={...r};(r.usage||0)&je.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?s.indexType="uint32":r.data instanceof Uint16Array&&(s.indexType="uint16"));super(n,s,je.defaultProps);d(this,"usage");d(this,"indexType");d(this,"updateTimestamp");d(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=s.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,s){const i=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:s,je.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(o):r===0&&s===n.byteLength?this.debugData=i.slice(0,o):this.debugData=i.slice(r,r+o)}};d(je,"defaultProps",{...de.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),d(je,"MAP_READ",1),d(je,"MAP_WRITE",2),d(je,"COPY_SRC",4),d(je,"COPY_DST",8),d(je,"INDEX",16),d(je,"VERTEX",32),d(je,"UNIFORM",64),d(je,"STORAGE",128),d(je,"INDIRECT",256),d(je,"QUERY_RESOLVE",512),d(je,"DEBUG_DATA_MAX_LENGTH",32);let Se=je;function yC(t){const e=LA[t],n=qB(e),r=t.includes("norm"),s=!r&&!t.startsWith("float"),i=t.startsWith("s");return{dataType:LA[t],byteLength:n,integer:s,signed:i,normalized:r}}function qB(t){return QB[t]}const LA={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},QB={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},ZB=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],eP=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function tP(t){return ZB.some(e=>t.startsWith(e))}function TC(t){const e=eP.exec(t);if(e){const[,n,r,s,i,o]=e;if(n){const a=`${s}${r}`,c=yC(a);return{format:n,components:n.length,srgb:i==="-srgb",unsized:o==="-unsized",webgl:o==="-webgl",...c}}}return rP(t)}const nP={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function rP(t){var n;const e=nP[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((n=e.format)==null?void 0:n.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class sP{}class iP{constructor(e=[],n){d(this,"features");d(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const Ko=class Ko{constructor(e){d(this,"id");d(this,"props");d(this,"userData",{});d(this,"statsManager",xg);d(this,"_lumaData",{});d(this,"timestamp",0);this.props={...Ko.defaultProps,...e},this.id=this.props.id||Xr(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return tP(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&Se.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":k.warn("indices buffer content must be of integer type")()),n}};d(Ko,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!k.get("debug"),spector:!!(k.get("spector")||k.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>k.error(e.message)}),d(Ko,"VERSION",KB);let Oi=Ko;function oe(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const co=new Map,hi=class hi{static registerDevices(e){for(const n of e)oe(n.type&&n.isSupported&&n.create),co.set(n.type,n)}static getAvailableDevices(){return Array.from(co).map(e=>e.type)}static getSupportedDevices(){return Array.from(co).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(Oi.defaultProps,e)}static async attachDevice(e){const n=VA(e.devices)||co;if(e.handle instanceof WebGL2RenderingContext){const r=n.get("webgl");if(r)return await r.attach(e.handle)}if(e.handle===null){const r=n.get("unknown");if(r)return await r.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var i,o;e={...hi.defaultProps,...e},e.gl&&(e.type="webgl");const n=VA(e.devices)||co;let r,s;switch(e.type){case"webgpu":if(r=n.get("webgpu"),r)return await r.create(e);break;case"webgl":if(s=n.get("webgl"),s)return await s.create(e);break;case"unknown":const a=n.get("unknown");if(a)return await a.create(e);break;case"best-available":if(r=n.get("webgpu"),(i=r==null?void 0:r.isSupported)!=null&&i.call(r))return await r.create(e);if(s=n.get("webgl"),(o=s==null?void 0:s.isSupported)!=null&&o.call(s))return await s.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const n=HTMLCanvasElement.prototype;if(!e&&n.originalGetContext){n.getContext=n.originalGetContext,n.originalGetContext=void 0;return}n.originalGetContext=n.getContext,n.getContext=function(r,s){return r==="webgl"||r==="experimental-webgl"?this.originalGetContext("webgl2",s):this.originalGetContext(r,s)}}};d(hi,"defaultProps",{...Oi.defaultProps,type:"best-available",devices:void 0}),d(hi,"stats",xg),d(hi,"log",k);let Ai=hi;function VA(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const n of t)e.set(n.type,n);return e}const oP=Wr()&&typeof document<"u",Uu=()=>oP&&document.readyState==="complete",aP={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class Ng{constructor(e){d(this,"id");d(this,"props");d(this,"canvas");d(this,"htmlCanvas");d(this,"offscreenCanvas");d(this,"type");d(this,"width",1);d(this,"height",1);d(this,"resizeObserver");d(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...aP,...e},e=this.props,!Wr()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=uP(e.canvas):this.canvas=e.canvas;else{const n=hP(e),r=lP((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return Uu()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:n}=this._canvasSizeInfo;return n?e/n:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[s,i]=this.getDrawingBufferSize();return fP(e,r,s,i,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,s="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!s)&&(k.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const i=this._canvasSizeInfo;if(i.clientWidth!==r||i.clientHeight!==s||i.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),c=Math.floor(s*o);this.htmlCanvas.width=a,this.htmlCanvas.height=c;const[l,u]=this.getDrawingBufferSize();(l!==a||u!==c)&&(o=Math.min(l/r,u/s),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(s*o),k.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}d(Ng,"pageLoaded",cP());function cP(){return Uu()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function lP(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!Uu())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function uP(t){const e=document.getElementById(t);if(!e&&!Uu())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function hP(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function fP(t,e,n,r,s){const i=t,o=HA(i[0],e,n);let a=zA(i[1],e,r,s),c=HA(i[0]+1,e,n);const l=c===n-1?c:c-1;c=zA(i[1]+1,e,r,s);let u;return s?(c=c===0?c:c+1,u=a,a=c):u=c===r-1?c:c-1,{x:o,y:a,width:Math.max(l-o+1,1),height:Math.max(u-a+1,1)}}function HA(t,e,n){return Math.min(Math.round(t*e),n-1)}function zA(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Vn=class Vn extends de{constructor(n,r,s=Vn.defaultProps){super(n,r,s);d(this,"dimension");d(this,"format");d(this,"width");d(this,"height");d(this,"depth");d(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};d(Vn,"defaultProps",{...de.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),d(Vn,"COPY_SRC",1),d(Vn,"COPY_DST",2),d(Vn,"TEXTURE_BINDING",4),d(Vn,"STORAGE_BINDING",8),d(Vn,"RENDER_ATTACHMENT",16);let vt=Vn;const ru=class ru extends de{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,ru.defaultProps)}};d(ru,"defaultProps",{...de.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Dl=ru;function dP(t,e,n){let r="";const s=e.split(/\r?\n/),i=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=s.length;a++)for(r+=EC(s[a-1],a,n);i.length>o&&i[o].lineNum===a;){const c=i[o++];r+=jA(c,s,c.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const a of t)r+=jA(a,s,a.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function jA(t,e,n,r){if(r!=null&&r.inlineSource){const s=pP(e,n),i=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${i}${t.type.toUpperCase()}: ${t.message}

`}return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function pP(t,e,n){let r="";for(let s=e-2;s<=e;s++){const i=t[s-1];i!==void 0&&(r+=EC(i,e,n))}return r}function EC(t,e,n){const r=n!=null&&n.html?_P(t):t;return`${gP(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function gP(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function _P(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function SC(t,e){return{name:mP(t,e),language:"glsl",version:AP(t)}}function mP(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}function AP(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const su=class su extends de{constructor(n,r){super(n,{id:yP(r),...r},su.defaultProps);d(this,"stage");d(this,"source");d(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(n=this.props.debug){switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var l;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=SC(this.source).name,s=`${this.stage} ${r}`;let i=dP(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${i}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const c=document.getElementsByClassName("luma-compiler-log-error");(l=c[0])!=null&&l.scrollIntoView&&c[0].scrollIntoView(),a.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}};d(su,"defaultProps",{...de.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let Ul=su;function yP(t){return SC(t.source).name||t.id||Xr(`unnamed ${t.stage}-shader`)}const iu=class iu extends de{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){super(e,n,iu.defaultProps)}};d(iu,"defaultProps",{...de.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let kl=iu;const ou=class ou extends de{constructor(n,r={}){super(n,r,ou.defaultProps);d(this,"width");d(this,"height");d(this,"colorAttachments",[]);d(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(n){let r=!n;if(n){const[s,i]=Array.isArray(n)?n:[n.width,n.height];r=r||i!==this.height||s!==this.width,this.width=s,this.height=i}r&&(k.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const s=this.createColorTexture(r);return this.attachResource(s),s.view}return r instanceof vt?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof vt?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n){return this.device.createTexture({id:"color-attachment",usage:vt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}createDepthStencilTexture(n){return this.device.createTexture({id:"depth-stencil-attachment",usage:vt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}resizeAttachments(n,r){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const i=this.device._createTexture({...this.colorAttachments[s].props,width:n,height:r});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const s=this.device._createTexture({...this.depthStencilAttachment.props,width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}}};d(ou,"defaultProps",{...de.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Ll=ou;const au=class au extends de{constructor(n,r){super(n,r,au.defaultProps);d(this,"shaderLayout");d(this,"bufferLayout");d(this,"linkStatus","pending");d(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};d(au,"defaultProps",{...de.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let xi=au;const cu=class cu extends de{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){super(e,n,cu.defaultProps)}};d(cu,"defaultProps",{...de.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Dd=cu;const lu=class lu extends de{constructor(n,r){super(n,r,lu.defaultProps);d(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};d(lu,"defaultProps",{...de.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Vl=lu;const uu=class uu extends de{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,uu.defaultProps)}};d(uu,"defaultProps",{...de.defaultProps,measureExecutionTime:void 0});let Ud=uu;const hu=class hu extends de{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,hu.defaultProps)}};d(hu,"defaultProps",{...de.defaultProps});let kd=hu;function TP(t){const[e,n]=SP[t],r=e==="i32"||e==="u32",s=e!=="u32",i=CP[e]*n,o=EP(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:i,integer:r,signed:s}}function EP(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const SP={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},CP={f32:4,f16:2,i32:4,u32:4};function CC(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),s=n,i=r?parseInt(r):1,o=yC(s),a={type:s,components:i,byteLength:o.byteLength*i,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function vC(t,e){const n={};for(const r of t.attributes)n[r.name]=wP(t,e,r.name);return n}function vP(t,e,n=16){const r=vC(t,e),s=new Array(n).fill(null);for(const i of Object.values(r))s[i.location]=i;return s}function wP(t,e,n){const r=RP(t,n),s=bP(e,n);if(!r)return null;const i=TP(r.type),o=(s==null?void 0:s.vertexFormat)||i.defaultVertexFormat,a=CC(o);return{attributeName:(s==null?void 0:s.attributeName)||r.name,bufferName:(s==null?void 0:s.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:i.dataType,shaderComponents:i.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:i.integer,stepMode:(s==null?void 0:s.stepMode)||r.stepMode,byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function RP(t,e){const n=t.attributes.find(r=>r.name===e);return n||k.warn(`shader layout attribute "${e}" not present in shader`),n||null}function bP(t,e){IP(t);let n=MP(t,e);return n||(n=BP(t,e),n)?n:(k.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function IP(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&k.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function MP(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function BP(t,e){var n;for(const r of t){let s=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const a=CC(o.format);s+=a.byteLength}const i=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(i)return{attributeName:i.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:s}}return null}function PP(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const s=n.attributes.find(i=>i.name===r.name);s?(s.type=r.type||s.type,s.stepMode=r.stepMode||s.stepMode):k.warn(`shader layout attribute ${r.name} not present in shader`)}return n}const fu=class fu extends de{constructor(n,r){super(n,r,fu.defaultProps);d(this,"maxVertexAttributes");d(this,"attributeInfos");d(this,"indexBuffer",null);d(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=vP(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){throw new Error("constant attributes not supported")}};d(fu,"defaultProps",{...de.defaultProps,renderPipeline:null});let Ld=fu;const du=class du extends de{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,du.defaultProps)}};d(du,"defaultProps",{...de.defaultProps,layout:void 0,buffers:{}});let Vd=du;const pu=class pu extends de{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,pu.defaultProps)}};d(pu,"defaultProps",{...de.defaultProps,type:void 0,count:void 0});let Hd=pu;const OP={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function xP(t){const e=OP[t];return oe(t),e}function NP(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let dc;function wC(t){return(!dc||dc.byteLength<t)&&(dc=new ArrayBuffer(t)),dc}function FP(t,e){const n=wC(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function DP(t){const{target:e,source:n,start:r=0,count:s=1}=t,i=n.length,o=s*i;let a=0;for(let c=r;a<i;a++)e[c++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return t.target}const WA=1024;class UP{constructor(e){d(this,"layout",{});d(this,"byteLength");let n=0;for(const[s,i]of Object.entries(e)){const o=xP(i),{type:a,components:c}=o;n=NP(n,c);const l=n;n+=c,this.layout[s]={type:a,size:c,offset:l}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,WA)}getData(e){const n=Math.max(this.byteLength,WA),r=wC(n),s={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[i,o]of Object.entries(e)){const a=this.layout[i];if(!a){k.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}const{type:c,size:l,offset:u}=a,h=s[c];if(l===1){if(typeof o!="number"&&typeof o!="boolean"){k.warn(`Supplied value for single component uniform ${i} is not a number: ${o}`)();continue}h[u]=Number(o)}else{const f=pa(o);if(!f){k.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${o}`)();continue}h.set(f,u)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function kP(t,e,n=16){if(t!==e)return!1;const r=pa(t);if(!r)return!1;const s=pa(e);if(s&&r.length===s.length){for(let i=0;i<r.length;++i)if(s[i]!==r[i])return!1}return!0}function LP(t){const e=pa(t);return e?e.slice():t}class VP{constructor(e){d(this,"name");d(this,"uniforms",{});d(this,"modifiedUniforms",{});d(this,"modified",!0);d(this,"bindingLayout",{});d(this,"needsRedraw","initialized");var n;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(i=>i.type==="uniform"&&i.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const s=r;for(const i of s.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){kP(this.uniforms[e],n)||(this.uniforms[e]=LP(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class HP{constructor(e){d(this,"uniformBlocks",new Map);d(this,"uniformBufferLayouts",new Map);d(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const s=n,i=new UP(r.uniformTypes||{});this.uniformBufferLayouts.set(s,i);const o=new VP({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(s,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[n,r]of Object.entries(e))this.uniformBlocks.get(n).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const n=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const s=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:Se.UNIFORM|Se.COPY_DST,byteLength:s}),o=this.getUniformBufferData(n);return i.write(o),i}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:Se.UNIFORM|Se.COPY_DST,byteLength:r});this.uniformBuffers.set(n,s)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&k.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const n=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e);let s=!1;if(r&&n.needsRedraw){s||(s=n.needsRedraw);const i=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(i);const a=this.uniformBlocks.get(e).getAllUniforms();k.log(4,`Writing to uniform buffer ${String(e)}`,i,a)()}return s}}function RC(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function bC(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function zP(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let s=RC(t);if(s==="uint8"&&n&&r===1)return"unorm8-webgl";if(s==="uint8"&&n&&r===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(s=s.replace("int","norm")),`${s}x${r}`}if(s==="uint16"||s==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(s=s.replace("int","norm")),`${s}x${r}`}return r===1?s:`${s}x${r}`}function jP(t){return pa(t)!==null||typeof t=="number"||typeof t=="boolean"}function Fg(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];jP(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function WP(t,e,n){const{removedProps:r={},deprecatedProps:s={},replacedProps:i={}}=n;for(const a in r)if(a in e){const l=r[a]?`${t}.${r[a]}`:"N/A";k.removed(`${t}.${a}`,l)()}for(const a in s)if(a in e){const c=s[a];k.deprecated(`${t}.${a}`,`${t}.${c}`)()}let o=null;for(const[a,c]of Object.entries(i))a in e&&(k.deprecated(`${t}.${a}`,`${t}.${c}`)(),o=o||Object.assign({},e),o[c]=e[a],delete o[a]);return o||e}let XP="";async function GP(t,e){return await new Promise((n,r)=>{try{const s=new Image;s.onload=()=>n(s),s.onerror=()=>r(new Error(`Could not load image ${t}.`)),s.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",s.src=t.startsWith("http")?t:XP+t}catch(s){r(s)}})}async function IC(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),e&&(r.id=e),new Promise((s,i)=>{r.onload=s,r.onerror=o=>i(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}function zd(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!zd(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(const i of r)if(!e.hasOwnProperty(i)||!zd(t[i],e[i],n-1))return!1;return!0}return!1}function $P(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function KP(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class YP{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class rr{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,n){if(e){n(Hl.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(zl.instance)}}}class Hl extends rr{}Hl.instance=new Hl;class zl extends rr{}zl.instance=new zl;class Te extends rr{constructor(){super()}}class jd extends Te{constructor(e,n,r,s,i,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=s,this.startLine=i,this.endLine=o}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class JP extends Te{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class qP extends Te{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class QP extends Te{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class ZP extends Te{constructor(e,n,r,s){super(),this.init=e,this.condition=n,this.increment=r,this.body=s}get astNodeType(){return"for"}search(e){var n,r,s;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class ns extends Te{constructor(e,n,r,s,i){super(),this.name=e,this.type=n,this.storage=r,this.access=s,this.value=i}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class MC extends Te{constructor(e,n,r){super(),this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class Wd extends Te{constructor(e,n,r,s,i){super(),this.name=e,this.type=n,this.storage=r,this.access=s,this.value=i}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class XA extends Te{constructor(e,n,r,s,i){super(),this.name=e,this.type=n,this.storage=r,this.access=s,this.value=i}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var Ni;(function(t){t.increment="++",t.decrement="--"})(Ni||(Ni={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}t.parse=e})(Ni||(Ni={}));class e2 extends Te{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var ga;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(ga||(ga={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}t.parse=e})(ga||(ga={}));class t2 extends Te{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class BC extends Te{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}search(e){for(const n of this.args)n.search(e);e(this)}}class n2 extends Te{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class r2 extends Te{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"body"}}class s2 extends Te{constructor(e,n,r,s){super(),this.condition=e,this.body=n,this.elseif=r,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class i2 extends Te{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class o2 extends Te{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class a2 extends Te{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class c2 extends Te{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class PC extends Te{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class l2 extends Te{constructor(){super()}get astNodeType(){return"discard"}}class u2 extends Te{constructor(){super()}get astNodeType(){return"break"}}class h2 extends Te{constructor(){super()}get astNodeType(){return"continue"}}class Ms extends Te{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class ts extends Ms{constructor(e,n,r,s){super(e),this.members=n,this.startLine=r,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}}class OC extends Ms{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}}class f2 extends Ms{constructor(e,n,r,s){super(e),this.storage=n,this.type=r,this.access=s}get astNodeType(){return"pointer"}}class xC extends Ms{constructor(e,n,r,s){super(e),this.attributes=n,this.format=r,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class wo extends Ms{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class un extends rr{constructor(){super()}}class GA extends un{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class ri extends un{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){e(this);for(const n of this.args)n.search(e)}}class NC extends un{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const n of this.args)n.search(e);e(this)}}class Xd extends un{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const n=e.constants.get(this.name);if(!n)throw new Error("Cannot evaluate node");return n.evaluate(e)}}class $A extends un{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}evaluate(e){var n,r;if(this.initializer instanceof ri){const s=(n=this.postfix)===null||n===void 0?void 0:n.evaluateString(e),i=(r=this.initializer.type)===null||r===void 0?void 0:r.name,o=e.structs.get(i),a=o==null?void 0:o.getMemberIndex(s);if(a!=-1)return this.initializer.args[a].evaluate(e);console.log(a)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class KA extends un{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class d2 extends un{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class p2 extends un{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}search(e){this.searchBlock(this.args,e)}}class YA extends un{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class g2 extends un{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class FC extends un{constructor(){super()}}class _2 extends FC{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class _n extends FC{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class DC extends rr{constructor(){super()}}class m2 extends DC{constructor(e,n){super(),this.selector=e,this.body=n}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class A2 extends DC{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class y2 extends rr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class T2 extends rr{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class E2 extends rr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}let S2=class extends rr{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}};var B,R;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(R||(R={}));class b{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class S{}B=S;S.none=new b("",R.reserved,"");S.eof=new b("EOF",R.token,"");S.reserved={asm:new b("asm",R.reserved,"asm"),bf16:new b("bf16",R.reserved,"bf16"),do:new b("do",R.reserved,"do"),enum:new b("enum",R.reserved,"enum"),f16:new b("f16",R.reserved,"f16"),f64:new b("f64",R.reserved,"f64"),handle:new b("handle",R.reserved,"handle"),i8:new b("i8",R.reserved,"i8"),i16:new b("i16",R.reserved,"i16"),i64:new b("i64",R.reserved,"i64"),mat:new b("mat",R.reserved,"mat"),premerge:new b("premerge",R.reserved,"premerge"),regardless:new b("regardless",R.reserved,"regardless"),typedef:new b("typedef",R.reserved,"typedef"),u8:new b("u8",R.reserved,"u8"),u16:new b("u16",R.reserved,"u16"),u64:new b("u64",R.reserved,"u64"),unless:new b("unless",R.reserved,"unless"),using:new b("using",R.reserved,"using"),vec:new b("vec",R.reserved,"vec"),void:new b("void",R.reserved,"void")};S.keywords={array:new b("array",R.keyword,"array"),atomic:new b("atomic",R.keyword,"atomic"),bool:new b("bool",R.keyword,"bool"),f32:new b("f32",R.keyword,"f32"),i32:new b("i32",R.keyword,"i32"),mat2x2:new b("mat2x2",R.keyword,"mat2x2"),mat2x3:new b("mat2x3",R.keyword,"mat2x3"),mat2x4:new b("mat2x4",R.keyword,"mat2x4"),mat3x2:new b("mat3x2",R.keyword,"mat3x2"),mat3x3:new b("mat3x3",R.keyword,"mat3x3"),mat3x4:new b("mat3x4",R.keyword,"mat3x4"),mat4x2:new b("mat4x2",R.keyword,"mat4x2"),mat4x3:new b("mat4x3",R.keyword,"mat4x3"),mat4x4:new b("mat4x4",R.keyword,"mat4x4"),ptr:new b("ptr",R.keyword,"ptr"),sampler:new b("sampler",R.keyword,"sampler"),sampler_comparison:new b("sampler_comparison",R.keyword,"sampler_comparison"),struct:new b("struct",R.keyword,"struct"),texture_1d:new b("texture_1d",R.keyword,"texture_1d"),texture_2d:new b("texture_2d",R.keyword,"texture_2d"),texture_2d_array:new b("texture_2d_array",R.keyword,"texture_2d_array"),texture_3d:new b("texture_3d",R.keyword,"texture_3d"),texture_cube:new b("texture_cube",R.keyword,"texture_cube"),texture_cube_array:new b("texture_cube_array",R.keyword,"texture_cube_array"),texture_multisampled_2d:new b("texture_multisampled_2d",R.keyword,"texture_multisampled_2d"),texture_storage_1d:new b("texture_storage_1d",R.keyword,"texture_storage_1d"),texture_storage_2d:new b("texture_storage_2d",R.keyword,"texture_storage_2d"),texture_storage_2d_array:new b("texture_storage_2d_array",R.keyword,"texture_storage_2d_array"),texture_storage_3d:new b("texture_storage_3d",R.keyword,"texture_storage_3d"),texture_depth_2d:new b("texture_depth_2d",R.keyword,"texture_depth_2d"),texture_depth_2d_array:new b("texture_depth_2d_array",R.keyword,"texture_depth_2d_array"),texture_depth_cube:new b("texture_depth_cube",R.keyword,"texture_depth_cube"),texture_depth_cube_array:new b("texture_depth_cube_array",R.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new b("texture_depth_multisampled_2d",R.keyword,"texture_depth_multisampled_2d"),texture_external:new b("texture_external",R.keyword,"texture_external"),u32:new b("u32",R.keyword,"u32"),vec2:new b("vec2",R.keyword,"vec2"),vec3:new b("vec3",R.keyword,"vec3"),vec4:new b("vec4",R.keyword,"vec4"),bitcast:new b("bitcast",R.keyword,"bitcast"),block:new b("block",R.keyword,"block"),break:new b("break",R.keyword,"break"),case:new b("case",R.keyword,"case"),continue:new b("continue",R.keyword,"continue"),continuing:new b("continuing",R.keyword,"continuing"),default:new b("default",R.keyword,"default"),diagnostic:new b("diagnostic",R.keyword,"diagnostic"),discard:new b("discard",R.keyword,"discard"),else:new b("else",R.keyword,"else"),enable:new b("enable",R.keyword,"enable"),fallthrough:new b("fallthrough",R.keyword,"fallthrough"),false:new b("false",R.keyword,"false"),fn:new b("fn",R.keyword,"fn"),for:new b("for",R.keyword,"for"),function:new b("function",R.keyword,"function"),if:new b("if",R.keyword,"if"),let:new b("let",R.keyword,"let"),const:new b("const",R.keyword,"const"),loop:new b("loop",R.keyword,"loop"),while:new b("while",R.keyword,"while"),private:new b("private",R.keyword,"private"),read:new b("read",R.keyword,"read"),read_write:new b("read_write",R.keyword,"read_write"),return:new b("return",R.keyword,"return"),requires:new b("requires",R.keyword,"requires"),storage:new b("storage",R.keyword,"storage"),switch:new b("switch",R.keyword,"switch"),true:new b("true",R.keyword,"true"),alias:new b("alias",R.keyword,"alias"),type:new b("type",R.keyword,"type"),uniform:new b("uniform",R.keyword,"uniform"),var:new b("var",R.keyword,"var"),override:new b("override",R.keyword,"override"),workgroup:new b("workgroup",R.keyword,"workgroup"),write:new b("write",R.keyword,"write"),r8unorm:new b("r8unorm",R.keyword,"r8unorm"),r8snorm:new b("r8snorm",R.keyword,"r8snorm"),r8uint:new b("r8uint",R.keyword,"r8uint"),r8sint:new b("r8sint",R.keyword,"r8sint"),r16uint:new b("r16uint",R.keyword,"r16uint"),r16sint:new b("r16sint",R.keyword,"r16sint"),r16float:new b("r16float",R.keyword,"r16float"),rg8unorm:new b("rg8unorm",R.keyword,"rg8unorm"),rg8snorm:new b("rg8snorm",R.keyword,"rg8snorm"),rg8uint:new b("rg8uint",R.keyword,"rg8uint"),rg8sint:new b("rg8sint",R.keyword,"rg8sint"),r32uint:new b("r32uint",R.keyword,"r32uint"),r32sint:new b("r32sint",R.keyword,"r32sint"),r32float:new b("r32float",R.keyword,"r32float"),rg16uint:new b("rg16uint",R.keyword,"rg16uint"),rg16sint:new b("rg16sint",R.keyword,"rg16sint"),rg16float:new b("rg16float",R.keyword,"rg16float"),rgba8unorm:new b("rgba8unorm",R.keyword,"rgba8unorm"),rgba8unorm_srgb:new b("rgba8unorm_srgb",R.keyword,"rgba8unorm_srgb"),rgba8snorm:new b("rgba8snorm",R.keyword,"rgba8snorm"),rgba8uint:new b("rgba8uint",R.keyword,"rgba8uint"),rgba8sint:new b("rgba8sint",R.keyword,"rgba8sint"),bgra8unorm:new b("bgra8unorm",R.keyword,"bgra8unorm"),bgra8unorm_srgb:new b("bgra8unorm_srgb",R.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new b("rgb10a2unorm",R.keyword,"rgb10a2unorm"),rg11b10float:new b("rg11b10float",R.keyword,"rg11b10float"),rg32uint:new b("rg32uint",R.keyword,"rg32uint"),rg32sint:new b("rg32sint",R.keyword,"rg32sint"),rg32float:new b("rg32float",R.keyword,"rg32float"),rgba16uint:new b("rgba16uint",R.keyword,"rgba16uint"),rgba16sint:new b("rgba16sint",R.keyword,"rgba16sint"),rgba16float:new b("rgba16float",R.keyword,"rgba16float"),rgba32uint:new b("rgba32uint",R.keyword,"rgba32uint"),rgba32sint:new b("rgba32sint",R.keyword,"rgba32sint"),rgba32float:new b("rgba32float",R.keyword,"rgba32float"),static_assert:new b("static_assert",R.keyword,"static_assert")};S.tokens={decimal_float_literal:new b("decimal_float_literal",R.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new b("hex_float_literal",R.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new b("int_literal",R.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new b("uint_literal",R.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new b("ident",R.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new b("and",R.token,"&"),and_and:new b("and_and",R.token,"&&"),arrow:new b("arrow ",R.token,"->"),attr:new b("attr",R.token,"@"),forward_slash:new b("forward_slash",R.token,"/"),bang:new b("bang",R.token,"!"),bracket_left:new b("bracket_left",R.token,"["),bracket_right:new b("bracket_right",R.token,"]"),brace_left:new b("brace_left",R.token,"{"),brace_right:new b("brace_right",R.token,"}"),colon:new b("colon",R.token,":"),comma:new b("comma",R.token,","),equal:new b("equal",R.token,"="),equal_equal:new b("equal_equal",R.token,"=="),not_equal:new b("not_equal",R.token,"!="),greater_than:new b("greater_than",R.token,">"),greater_than_equal:new b("greater_than_equal",R.token,">="),shift_right:new b("shift_right",R.token,">>"),less_than:new b("less_than",R.token,"<"),less_than_equal:new b("less_than_equal",R.token,"<="),shift_left:new b("shift_left",R.token,"<<"),modulo:new b("modulo",R.token,"%"),minus:new b("minus",R.token,"-"),minus_minus:new b("minus_minus",R.token,"--"),period:new b("period",R.token,"."),plus:new b("plus",R.token,"+"),plus_plus:new b("plus_plus",R.token,"++"),or:new b("or",R.token,"|"),or_or:new b("or_or",R.token,"||"),paren_left:new b("paren_left",R.token,"("),paren_right:new b("paren_right",R.token,")"),semicolon:new b("semicolon",R.token,";"),star:new b("star",R.token,"*"),tilde:new b("tilde",R.token,"~"),underscore:new b("underscore",R.token,"_"),xor:new b("xor",R.token,"^"),plus_equal:new b("plus_equal",R.token,"+="),minus_equal:new b("minus_equal",R.token,"-="),times_equal:new b("times_equal",R.token,"*="),division_equal:new b("division_equal",R.token,"/="),modulo_equal:new b("modulo_equal",R.token,"%="),and_equal:new b("and_equal",R.token,"&="),or_equal:new b("or_equal",R.token,"|="),xor_equal:new b("xor_equal",R.token,"^="),shift_right_equal:new b("shift_right_equal",R.token,">>="),shift_left_equal:new b("shift_left_equal",R.token,"<<=")};S.simpleTokens={"@":B.tokens.attr,"{":B.tokens.brace_left,"}":B.tokens.brace_right,":":B.tokens.colon,",":B.tokens.comma,"(":B.tokens.paren_left,")":B.tokens.paren_right,";":B.tokens.semicolon};S.literalTokens={"&":B.tokens.and,"&&":B.tokens.and_and,"->":B.tokens.arrow,"/":B.tokens.forward_slash,"!":B.tokens.bang,"[":B.tokens.bracket_left,"]":B.tokens.bracket_right,"=":B.tokens.equal,"==":B.tokens.equal_equal,"!=":B.tokens.not_equal,">":B.tokens.greater_than,">=":B.tokens.greater_than_equal,">>":B.tokens.shift_right,"<":B.tokens.less_than,"<=":B.tokens.less_than_equal,"<<":B.tokens.shift_left,"%":B.tokens.modulo,"-":B.tokens.minus,"--":B.tokens.minus_minus,".":B.tokens.period,"+":B.tokens.plus,"++":B.tokens.plus_plus,"|":B.tokens.or,"||":B.tokens.or_or,"*":B.tokens.star,"~":B.tokens.tilde,_:B.tokens.underscore,"^":B.tokens.xor,"+=":B.tokens.plus_equal,"-=":B.tokens.minus_equal,"*=":B.tokens.times_equal,"/=":B.tokens.division_equal,"%=":B.tokens.modulo_equal,"&=":B.tokens.and_equal,"|=":B.tokens.or_equal,"^=":B.tokens.xor_equal,">>=":B.tokens.shift_right_equal,"<<=":B.tokens.shift_left_equal};S.regexTokens={decimal_float_literal:B.tokens.decimal_float_literal,hex_float_literal:B.tokens.hex_float_literal,int_literal:B.tokens.int_literal,uint_literal:B.tokens.uint_literal,ident:B.tokens.ident};S.storage_class=[B.keywords.function,B.keywords.private,B.keywords.workgroup,B.keywords.uniform,B.keywords.storage];S.access_mode=[B.keywords.read,B.keywords.write,B.keywords.read_write];S.sampler_type=[B.keywords.sampler,B.keywords.sampler_comparison];S.sampled_texture_type=[B.keywords.texture_1d,B.keywords.texture_2d,B.keywords.texture_2d_array,B.keywords.texture_3d,B.keywords.texture_cube,B.keywords.texture_cube_array];S.multisampled_texture_type=[B.keywords.texture_multisampled_2d];S.storage_texture_type=[B.keywords.texture_storage_1d,B.keywords.texture_storage_2d,B.keywords.texture_storage_2d_array,B.keywords.texture_storage_3d];S.depth_texture_type=[B.keywords.texture_depth_2d,B.keywords.texture_depth_2d_array,B.keywords.texture_depth_cube,B.keywords.texture_depth_cube_array,B.keywords.texture_depth_multisampled_2d];S.texture_external_type=[B.keywords.texture_external];S.any_texture_type=[...B.sampled_texture_type,...B.multisampled_texture_type,...B.storage_texture_type,...B.depth_texture_type,...B.texture_external_type];S.texel_format=[B.keywords.r8unorm,B.keywords.r8snorm,B.keywords.r8uint,B.keywords.r8sint,B.keywords.r16uint,B.keywords.r16sint,B.keywords.r16float,B.keywords.rg8unorm,B.keywords.rg8snorm,B.keywords.rg8uint,B.keywords.rg8sint,B.keywords.r32uint,B.keywords.r32sint,B.keywords.r32float,B.keywords.rg16uint,B.keywords.rg16sint,B.keywords.rg16float,B.keywords.rgba8unorm,B.keywords.rgba8unorm_srgb,B.keywords.rgba8snorm,B.keywords.rgba8uint,B.keywords.rgba8sint,B.keywords.bgra8unorm,B.keywords.bgra8unorm_srgb,B.keywords.rgb10a2unorm,B.keywords.rg11b10float,B.keywords.rg32uint,B.keywords.rg32sint,B.keywords.rg32float,B.keywords.rgba16uint,B.keywords.rgba16sint,B.keywords.rgba16float,B.keywords.rgba32uint,B.keywords.rgba32sint,B.keywords.rgba32float];S.const_literal=[B.tokens.int_literal,B.tokens.uint_literal,B.tokens.decimal_float_literal,B.tokens.hex_float_literal,B.keywords.true,B.keywords.false];S.literal_or_ident=[B.tokens.ident,B.tokens.int_literal,B.tokens.uint_literal,B.tokens.decimal_float_literal,B.tokens.hex_float_literal];S.element_count_expression=[B.tokens.int_literal,B.tokens.uint_literal,B.tokens.ident];S.template_types=[B.keywords.vec2,B.keywords.vec3,B.keywords.vec4,B.keywords.mat2x2,B.keywords.mat2x3,B.keywords.mat2x4,B.keywords.mat3x2,B.keywords.mat3x3,B.keywords.mat3x4,B.keywords.mat4x2,B.keywords.mat4x3,B.keywords.mat4x4,B.keywords.atomic,B.keywords.bitcast,...B.any_texture_type];S.attribute_name=[B.tokens.ident,B.keywords.block,B.keywords.diagnostic];S.assignment_operators=[B.tokens.equal,B.tokens.plus_equal,B.tokens.minus_equal,B.tokens.times_equal,B.tokens.division_equal,B.tokens.modulo_equal,B.tokens.and_equal,B.tokens.or_equal,B.tokens.xor_equal,B.tokens.shift_right_equal,B.tokens.shift_left_equal];S.increment_operators=[B.tokens.plus_plus,B.tokens.minus_minus];class JA{constructor(e,n,r){this.type=e,this.lexeme=n,this.line=r}toString(){return this.lexeme}isTemplateType(){return S.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==S.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class C2{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new JA(S.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=S.simpleTokens[e];if(n)return this._addToken(n),!0;let r=S.none;const s=this._isAlpha(e),i=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(s){const o=S.keywords[e];if(o)return this._addToken(o),!0}if(s||i)return this._addToken(S.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(S.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(S.tokens.minus_minus),!0;const c=this._tokens.length-1;if((S.literal_or_ident.indexOf(this._tokens[c].type)!=-1||this._tokens[c].type==S.tokens.paren_right)&&a!=">")return this._addToken(o),!0}if(e==">"&&(a==">"||a=="=")){let c=!1,l=this._tokens.length-1;for(let u=0;u<5&&l>=0&&S.assignment_operators.indexOf(this._tokens[l].type)===-1;++u,--l)if(this._tokens[l].type===S.tokens.less_than){l>0&&this._tokens[l-1].isArrayOrTemplateType()&&(c=!0);break}if(c)return this._addToken(o),!0}if(o===S.none){let c=e,l=0;const u=2;for(let h=0;h<u;++h)if(c+=this._peekAhead(h),o=this._findType(c),o!==S.none){l=h;break}if(o===S.none)return r===S.none?!1:(this._current--,this._addToken(r),!0);e=c,this._current+=l+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r===S.none?!1:(this._addToken(r),!0)}_findType(e){for(const r in S.regexTokens){const s=S.regexTokens[r];if(this._match(e,s.rule))return s}const n=S.literalTokens[e];return n||S.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new JA(e,n,this._line))}}class v2{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new YP,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const s=r.arrayType,i=r.countNode;if(i instanceof Xd){const a=i.name,c=this._context.constants.get(a);if(c)try{const l=c.evaluate(this._context);s.count=l}catch{}}}this._deferArrayCountEval.length=0}return n}_initialize(e){if(e)if(typeof e=="string"){const n=new C2(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,n){return{token:e,message:n,toString:function(){return`${n}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==S.eof}_match(e){if(e instanceof b)return this._check(e)?(this._advance(),!0):!1;for(let n=0,r=e.length;n<r;++n){const s=e[n];if(this._check(s))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),n)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;return e.indexOf(r)!=-1}return n.type==e}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._match(S.keywords.alias)){const n=this._type_alias();return this._consume(S.tokens.semicolon,"Expected ';'"),n}if(this._match(S.keywords.diagnostic)){const n=this._diagnostic();return this._consume(S.tokens.semicolon,"Expected ';'"),n}if(this._match(S.keywords.requires)){const n=this._requires_directive();return this._consume(S.tokens.semicolon,"Expected ';'"),n}if(this._match(S.keywords.enable)){const n=this._enable_directive();return this._consume(S.tokens.semicolon,"Expected ';'"),n}const e=this._attribute();if(this._check(S.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),n}if(this._check(S.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),n}return null}_function_decl(){if(!this._match(S.keywords.fn))return null;const e=this._currentLine,n=this._consume(S.tokens.ident,"Expected function name.").toString();this._consume(S.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(S.tokens.paren_right))do{if(this._check(S.tokens.paren_right))break;const a=this._attribute(),c=this._consume(S.tokens.ident,"Expected argument name.").toString();this._consume(S.tokens.colon,"Expected ':' for argument type.");const l=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=l,r.push(new y2(c,u,a)))}while(this._match(S.tokens.comma));this._consume(S.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(S.tokens.arrow)){const a=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=a)}const i=this._compound_statement(),o=this._currentLine;return new jd(n,r,s,i,e,o)}_compound_statement(){const e=[];for(this._consume(S.tokens.brace_left,"Expected '{' for block.");!this._check(S.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(S.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._check(S.tokens.attr)&&this._attribute(),this._check(S.keywords.if))return this._if_statement();if(this._check(S.keywords.switch))return this._switch_statement();if(this._check(S.keywords.loop))return this._loop_statement();if(this._check(S.keywords.for))return this._for_statement();if(this._check(S.keywords.while))return this._while_statement();if(this._check(S.keywords.continuing))return this._continuing_statement();if(this._check(S.keywords.static_assert))return this._static_assert_statement();if(this._check(S.tokens.brace_left))return this._compound_statement();let e=null;return this._check(S.keywords.return)?e=this._return_statement():this._check([S.keywords.var,S.keywords.let,S.keywords.const])?e=this._variable_statement():this._match(S.keywords.discard)?e=new l2:this._match(S.keywords.break)?e=new u2:this._match(S.keywords.continue)?e=new h2:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(S.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(S.keywords.static_assert))return null;const e=this._optional_paren_expression();return new JP(e)}_while_statement(){if(!this._match(S.keywords.while))return null;const e=this._optional_paren_expression();this._check(S.tokens.attr)&&this._attribute();const n=this._compound_statement();return new qP(e,n)}_continuing_statement(){if(!this._match(S.keywords.continuing))return null;const e=this._compound_statement();return new QP(e)}_for_statement(){if(!this._match(S.keywords.for))return null;this._consume(S.tokens.paren_left,"Expected '('.");const e=this._check(S.tokens.semicolon)?null:this._for_init();this._consume(S.tokens.semicolon,"Expected ';'.");const n=this._check(S.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(S.tokens.semicolon,"Expected ';'.");const r=this._check(S.tokens.paren_right)?null:this._for_increment();this._consume(S.tokens.paren_right,"Expected ')'."),this._check(S.tokens.attr)&&this._attribute();const s=this._compound_statement();return new ZP(e,n,r,s)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(S.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(S.tokens.equal)&&(n=this._short_circuit_or_expression()),new ns(e.name,e.type,e.storage,e.access,n)}if(this._match(S.keywords.let)){const e=this._consume(S.tokens.ident,"Expected name for let.").toString();let n=null;if(this._match(S.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}this._consume(S.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new Wd(e,n,null,null,r)}if(this._match(S.keywords.const)){const e=this._consume(S.tokens.ident,"Expected name for const.").toString();let n=null;if(this._match(S.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}this._consume(S.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new XA(e,n,null,null,r)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(S.increment_operators))return this._current=e,null;const r=this._consume(S.increment_operators,"Expected increment operator");return new e2(r.type===S.tokens.plus_plus?Ni.increment:Ni.decrement,n)}_assignment_statement(){let e=null;if(this._check(S.tokens.brace_right))return null;let n=this._match(S.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const r=this._consume(S.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return new t2(ga.parse(r.lexeme),e,s)}_func_call_statement(){if(!this._check(S.tokens.ident))return null;const e=this._current,n=this._consume(S.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):new BC(n.lexeme,r)}_loop_statement(){if(!this._match(S.keywords.loop))return null;this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Expected '{' for loop.");const e=[];let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let s of n)e.push(s);else e.push(n);n=this._statement()}let r=null;return this._match(S.keywords.continuing)&&(r=this._compound_statement()),this._consume(S.tokens.brace_right,"Expected '}' for loop."),new n2(e,r)}_switch_statement(){if(!this._match(S.keywords.switch))return null;const e=this._optional_paren_expression();this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Expected '{' for switch.");const n=this._switch_body();if(n==null||n.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(S.tokens.brace_right,"Expected '}' for switch."),new r2(e,n)}_switch_body(){const e=[];if(this._match(S.keywords.case)){const n=this._case_selectors();this._match(S.tokens.colon),this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch case."),e.push(new m2(n,r))}if(this._match(S.keywords.default)){this._match(S.tokens.colon),this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch default."),e.push(new A2(n))}if(this._check([S.keywords.default,S.keywords.case])){const n=this._switch_body();e.push(n[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(S.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(S.keywords.fallthrough))return this._consume(S.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(S.keywords.if))return null;const e=this._optional_paren_expression();this._check(S.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(S.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let s=null;return this._match(S.keywords.else)&&(this._check(S.tokens.attr)&&this._attribute(),s=this._compound_statement()),new s2(e,n,r,s)}_match_elseif(){return this._tokens[this._current].type===S.keywords.else&&this._tokens[this._current+1].type===S.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(new T2(n,r)),this._match_elseif()&&(this._check(S.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(S.keywords.return))return null;const e=this._short_circuit_or_expression();return new i2(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(S.tokens.or_or);)e=new _n(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(S.tokens.and_and);)e=new _n(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(S.tokens.or);)e=new _n(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(S.tokens.xor);)e=new _n(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(S.tokens.and);)e=new _n(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([S.tokens.equal_equal,S.tokens.not_equal])?new _n(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([S.tokens.less_than,S.tokens.greater_than,S.tokens.less_than_equal,S.tokens.greater_than_equal]);)e=new _n(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([S.tokens.shift_left,S.tokens.shift_right]);)e=new _n(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([S.tokens.plus,S.tokens.minus]);)e=new _n(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([S.tokens.star,S.tokens.forward_slash,S.tokens.modulo]);)e=new _n(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([S.tokens.minus,S.tokens.bang,S.tokens.tilde,S.tokens.star,S.tokens.and])?new _2(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(S.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(S.tokens.bracket_right,"Expected ']'.");const n=new g2(e),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(S.tokens.period)){const e=this._consume(S.tokens.ident,"Expected member name."),n=this._postfix_expression(),r=new GA(e.lexeme);return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(S.tokens.ident)){const r=this._previous().toString();if(this._check(S.tokens.paren_left)){const s=this._argument_expression_list(),i=this._getStruct(r);return i!=null?new ri(i,s):new NC(r,s)}if(this._context.constants.has(r)){const s=this._context.constants.get(r);return new $A(r,s.value)}return new Xd(r)}if(this._match(S.const_literal))return new KA(parseFloat(this._previous().toString()));if(this._check(S.tokens.paren_left))return this._paren_expression();if(this._match(S.keywords.bitcast)){this._consume(S.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(S.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return new d2(r,s)}const e=this._type_decl(),n=this._argument_expression_list();return new p2(e,n)}_argument_expression_list(){if(!this._match(S.tokens.paren_left))return null;const e=[];do{if(this._check(S.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(S.tokens.comma));return this._consume(S.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(S.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(S.tokens.paren_right),new YA([e])}_paren_expression(){this._consume(S.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(S.tokens.paren_right,"Expected ')'."),new YA([e])}_struct_decl(){if(!this._match(S.keywords.struct))return null;const e=this._currentLine,n=this._consume(S.tokens.ident,"Expected name for struct.").toString();this._consume(S.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(S.tokens.brace_right);){const o=this._attribute(),a=this._consume(S.tokens.ident,"Expected variable name.").toString();this._consume(S.tokens.colon,"Expected ':' for struct member type.");const c=this._attribute(),l=this._type_decl();l!=null&&(l.attributes=c),this._check(S.tokens.brace_right)?this._match(S.tokens.comma):this._consume(S.tokens.comma,"Expected ',' for struct member."),r.push(new E2(a,l,o))}this._consume(S.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,i=new ts(n,r,e,s);return this._context.structs.set(n,i),i}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(S.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(S.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(S.keywords.const))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let n=null;if(this._match(S.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}let r=null;if(this._match(S.tokens.equal)){const i=this._short_circuit_or_expression();if(i instanceof ri)r=i;else if(i instanceof $A&&i.initializer instanceof ri)r=i.initializer;else try{const o=i.evaluate(this._context);r=new KA(o)}catch{r=i}}const s=new XA(e.toString(),n,"","",r);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(S.keywords.let))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let n=null;if(this._match(S.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let r=null;return this._match(S.tokens.equal)&&(r=this._const_expression()),new Wd(e.toString(),n,"","",r)}_const_expression(){if(this._match(S.const_literal))return new GA(this._previous().toString());const e=this._type_decl();this._consume(S.tokens.paren_left,"Expected '('.");let n=[];for(;!this._check(S.tokens.paren_right)&&(n.push(this._const_expression()),!!this._check(S.tokens.comma));)this._advance();return this._consume(S.tokens.paren_right,"Expected ')'."),new ri(e,n)}_variable_decl(){if(!this._match(S.keywords.var))return null;let e="",n="";this._match(S.tokens.less_than)&&(e=this._consume(S.storage_class,"Expected storage_class.").toString(),this._match(S.tokens.comma)&&(n=this._consume(S.access_mode,"Expected access_mode.").toString()),this._consume(S.tokens.greater_than,"Expected '>'."));const r=this._consume(S.tokens.ident,"Expected variable name");let s=null;if(this._match(S.tokens.colon)){const i=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=i)}return new ns(r.toString(),s,e,n,null)}_override_decl(){if(!this._match(S.keywords.override))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let n=null;if(this._match(S.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return new MC(e.toString(),n,null)}_diagnostic(){this._consume(S.tokens.paren_left,"Expected '('");const e=this._consume(S.tokens.ident,"Expected severity control name.");this._consume(S.tokens.comma,"Expected ','");const n=this._consume(S.tokens.ident,"Expected diagnostic rule name.");return this._consume(S.tokens.paren_right,"Expected ')'"),new c2(e.toString(),n.toString())}_enable_directive(){const e=this._consume(S.tokens.ident,"identity expected.");return new o2(e.toString())}_requires_directive(){const e=[this._consume(S.tokens.ident,"identity expected.").toString()];for(;this._match(S.tokens.comma);){const n=this._consume(S.tokens.ident,"identity expected.");e.push(n.toString())}return new a2(e)}_type_alias(){const e=this._consume(S.tokens.ident,"identity expected.");this._consume(S.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=new PC(e.toString(),n);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([S.tokens.ident,...S.texel_format,S.keywords.bool,S.keywords.f32,S.keywords.i32,S.keywords.u32])){const r=this._advance(),s=r.toString();return this._context.structs.has(s)?this._context.structs.get(s):this._context.aliases.has(s)?this._context.aliases.get(s).type:new Ms(r.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(S.template_types)){let r=this._advance().toString(),s=null,i=null;return this._match(S.tokens.less_than)&&(s=this._type_decl(),i=null,this._match(S.tokens.comma)&&(i=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for type.")),new OC(r,s,i)}if(this._match(S.keywords.ptr)){let r=this._previous().toString();this._consume(S.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(S.storage_class,"Expected storage_class for pointer");this._consume(S.tokens.comma,"Expected ',' for pointer.");const i=this._type_decl();let o=null;return this._match(S.tokens.comma)&&(o=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for pointer."),new f2(r,s.toString(),i,o)}const n=this._attribute();if(this._match(S.keywords.array)){let r=null,s=-1;const i=this._previous();let o=null;if(this._match(S.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let c="";if(this._match(S.tokens.comma)){o=this._shift_expression();try{c=o.evaluate(this._context).toString(),o=null}catch{c="1"}}this._consume(S.tokens.greater_than,"Expected '>' for array."),s=c?parseInt(c):0}const a=new xC(i.toString(),n,r,s);return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(S.sampler_type))return new wo(this._previous().toString(),null,null);if(this._match(S.depth_texture_type))return new wo(this._previous().toString(),null,null);if(this._match(S.sampled_texture_type)||this._match(S.multisampled_texture_type)){const e=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),new wo(e.toString(),n,null)}if(this._match(S.storage_texture_type)){const e=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(S.texel_format,"Invalid texel format.").toString();this._consume(S.tokens.comma,"Expected ',' after texel format.");const r=this._consume(S.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),new wo(e.toString(),n,r)}return null}_attribute(){let e=[];for(;this._match(S.tokens.attr);){const n=this._consume(S.attribute_name,"Expected attribute name"),r=new S2(n.toString(),null);if(this._match(S.tokens.paren_left)){if(r.value=this._consume(S.literal_or_ident,"Expected attribute value").toString(),this._check(S.tokens.comma)){this._advance();do{const s=this._consume(S.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(s)}while(this._match(S.tokens.comma))}this._consume(S.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class yi{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class qA{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class pc extends yi{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class jh extends yi{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}}class QA extends yi{constructor(e,n,r,s){super(e,r),this.format=n,this.access=s}get isTemplate(){return!0}}var _r;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(_r||(_r={}));class gc{constructor(e,n,r,s,i,o,a){this.name=e,this.type=n,this.group=r,this.binding=s,this.attributes=i,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class w2{constructor(e,n){this.name=e,this.type=n}}class _c{constructor(e,n){this.align=e,this.size=n}}class R2{constructor(e,n,r,s){this.name=e,this.type=n,this.locationType=r,this.location=s,this.interpolation=null}}class ZA{constructor(e,n,r,s){this.name=e,this.type=n,this.locationType=r,this.location=s}}class b2{constructor(e,n=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n}}class I2{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class M2{constructor(e,n,r,s){this.name=e,this.type=n,this.attributes=r,this.id=s}}class B2{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Xn{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new I2,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new v2().parse(e);for(const s of r)s instanceof jd&&this._functions.set(s.name,new B2(s));for(const s of r)if(s instanceof ts){const i=this._getTypeInfo(s,null);i instanceof pc&&this.structs.push(i)}for(const s of r){if(s instanceof PC){this.aliases.push(this._getAliasInfo(s));continue}if(s instanceof MC){const i=s,o=this._getAttributeNum(i.attributes,"id",0),a=i.type!=null?this._getTypeInfo(i.type,i.attributes):null;this.overrides.push(new M2(i.name,a,i.attributes,o));continue}if(this._isUniformVar(s)){const i=s,o=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),c=this._getTypeInfo(i.type,i.attributes),l=new gc(i.name,c,o,a,i.attributes,_r.Uniform,i.access);this.uniforms.push(l);continue}if(this._isStorageVar(s)){const i=s,o=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),c=this._getTypeInfo(i.type,i.attributes),l=this._isStorageTexture(c),u=new gc(i.name,c,o,a,i.attributes,l?_r.StorageTexture:_r.Storage,i.access);this.storage.push(u);continue}if(this._isTextureVar(s)){const i=s,o=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),c=this._getTypeInfo(i.type,i.attributes),l=this._isStorageTexture(c),u=new gc(i.name,c,o,a,i.attributes,l?_r.StorageTexture:_r.Texture,i.access);l?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(s)){const i=s,o=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),c=this._getTypeInfo(i.type,i.attributes),l=new gc(i.name,c,o,a,i.attributes,_r.Sampler,i.access);this.samplers.push(l);continue}if(s instanceof jd){const i=this._getAttribute(s,"vertex"),o=this._getAttribute(s,"fragment"),a=this._getAttribute(s,"compute"),c=i||o||a,l=new b2(s.name,c==null?void 0:c.name);l.startLine=s.startLine,l.endLine=s.endLine,this.functions.push(l),this._functions.get(s.name).info=l,c&&(this._functions.get(s.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(s,!!c),l.inputs=this._getInputs(s.args),l.outputs=this._getOutputs(s.returnType),this.entry[c.name].push(l));continue}}for(const s of this._functions.values())s.info&&(s.info.inUse=s.inUse,this._addCalls(s.node,s.info.calls));for(const s of this.uniforms)this._markStructsInUse(s.type);for(const s of this.storage)this._markStructsInUse(s.type)}_markStructsInUse(e){if(e.isStruct){e.inUse=!0;for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const s of e.calls){const i=(r=this._functions.get(s.name))===null||r===void 0?void 0:r.info;i&&n.add(i)}}findResource(e,n){for(const r of this.uniforms)if(r.group==e&&r.binding==n)return r;for(const r of this.storage)if(r.group==e&&r.binding==n)return r;for(const r of this.textures)if(r.group==e&&r.binding==n)return r;for(const r of this.samplers)if(r.group==e&&r.binding==n)return r;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this._getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],s=this,i=[];return e.search(o=>{if(o instanceof Hl)i.push({});else if(o instanceof zl)i.pop();else if(o instanceof ns){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),i.length>0&&(i[i.length-1][a.name]=a)}else if(o instanceof ri){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof Wd){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),i.length>0&&(i[i.length-1][a.name]=a)}else if(o instanceof Xd){const a=o;if(i.length>0&&i[i.length-1][a.name])return;const c=s._findResource(a.name);c&&r.push(c)}else if(o instanceof NC){const a=o,c=s._functions.get(a.name);c&&(n&&(c.inUse=!0),e.calls.add(c.node),c.resources===null&&(c.resources=s._findResources(c.node,n)),r.push(...c.resources))}else if(o instanceof BC){const a=o,c=s._functions.get(a.name);c&&(n&&(c.inUse=!0),e.calls.add(c.node),c.resources===null&&(c.resources=s._findResources(c.node,n)),r.push(...c.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,s){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),s>=e[r].length&&(e[r].length=s+1)}for(const r of this.uniforms){n(r.group,r.binding);const s=e[r.group];s[r.binding]=r}for(const r of this.storage){n(r.group,r.binding);const s=e[r.group];s[r.binding]=r}for(const r of this.textures){n(r.group,r.binding);const s=e[r.group];s[r.binding]=r}for(const r of this.samplers){n(r.group,r.binding);const s=e[r.group];s[r.binding]=r}return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof ts)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof ts)this._getStructOutputs(r.type,n);else{const s=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(s!==null){const i=this._getTypeInfo(r.type,r.type.attributes),o=this._parseInt(s.value),a=new ZA(r.name,i,s.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getTypeInfo(e,e.attributes),s=this._parseInt(n.value);return new ZA("",r,n.name,s)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof ts)this._getStructInputs(r.type,n);else{const s=this._getInputInfo(r);s!==null&&n.push(s)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof ts)this._getStructInputs(r.type,n);else{const s=this._getInputInfo(r);s!==null&&n.push(s)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),s=this._getTypeInfo(e.type,e.attributes),i=this._parseInt(n.value),o=new R2(e.name,s,n.name,i);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new w2(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,n){if(this._types.has(e))return this._types.get(e);if(e instanceof xC){const s=e,i=this._getTypeInfo(s.format,s.attributes),o=new jh(s.name,n);return o.format=i,o.count=s.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof ts){const s=e,i=new pc(s.name,n);i.startLine=s.startLine,i.endLine=s.endLine;for(const o of s.members){const a=this._getTypeInfo(o.type,o.attributes);i.members.push(new qA(o.name,a,o.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof wo){const s=e,i=s.format instanceof Ms,o=s.format?i?this._getTypeInfo(s.format,null):new yi(s.format,null):null,a=new QA(s.name,o,n,s.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof OC){const s=e,i=s.format?this._getTypeInfo(s.format,null):null,o=new QA(s.name,i,n,s.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new yi(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r;const s=this._getTypeSize(e);if(e.size=(n=s==null?void 0:s.size)!==null&&n!==void 0?n:0,e instanceof jh){const i=this._getTypeSize(e.format);e.stride=(r=i==null?void 0:i.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(e.format)}e instanceof pc&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,s=0,i=0,o=0;for(let a=0,c=e.members.length;a<c;++a){const l=e.members[a],u=this._getTypeSize(l);if(!u)continue;(n=this._getAlias(l.type.name))!==null&&n!==void 0||l.type;const h=u.align,f=u.size;r=this._roundUp(h,r+s),s=f,i=r,o=Math.max(o,h),l.offset=r,l.size=f,this._updateTypeInfo(l.type)}e.size=this._roundUp(o,i+s),e.align=o}_getTypeSize(e){var n,r;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),i=this._getAttributeNum(e.attributes,"align",0);if(e instanceof qA&&(e=e.type),e instanceof yi){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Xn._typeInfo[e.name];if(o!==void 0){const a=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new _c(Math.max(i,o.align/a),Math.max(s,o.size/a))}}{const o=Xn._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const a=e.name[e.name.length-1]==="h"?2:1;return new _c(Math.max(i,o.align/a),Math.max(s,o.size/a))}}if(e instanceof jh){let o=e,a=8,c=8;const l=this._getTypeSize(o.format);l!==null&&(c=l.size,a=l.align);const u=o.count,h=this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,c));return c=u*h,s&&(c=s),new _c(Math.max(i,a),Math.max(s,c))}if(e instanceof pc){let o=0,a=0,c=0,l=0,u=0;for(const h of e.members){const f=this._getTypeSize(h.type);f!==null&&(o=Math.max(f.align,o),c=this._roundUp(f.align,c+l),l=f.size,u=c)}return a=this._roundUp(o,u+l),new _c(Math.max(i,o),Math.max(s,a))}return null}_isUniformVar(e){return e instanceof ns&&e.storage=="uniform"}_isStorageVar(e){return e instanceof ns&&e.storage=="storage"}_isTextureVar(e){return e instanceof ns&&e.type!==null&&Xn._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof ns&&e.type!==null&&Xn._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const s=r.attributes;for(let i of s)if(i.name==n)return i;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let s of e)if(s.name==n){let i=s!==null&&s.value!==null?s.value:r;return i instanceof Array&&(i=i[0]),typeof i=="number"?i:typeof i=="string"?parseInt(i):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}Xn._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};Xn._textureTypes=S.any_texture_type.map(t=>t.name);Xn._samplerTypes=S.sampler_type.map(t=>t.name);function P2(t){var i;const e={attributes:[],bindings:[]};let n;try{n=O2(t)}catch(o){return k.error(o.message)(),e}for(const o of n.uniforms){const a=[];for(const c of((i=o.type)==null?void 0:i.members)||[])a.push({name:c.name,type:ey(c.type)});e.bindings.push({type:"uniform",name:o.name,location:o.binding,group:o.group,members:a})}const r=n.entry.vertex[0],s=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<s;o++){const a=r.inputs[o];if(a.locationType==="location"){const c=ey(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:c})}}return e}function ey(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function O2(t){try{return new Xn(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const x2=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,N2={name:"fp32",vs:x2},F2=[0,1,1,1],D2=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,U2=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,ty={name:"picking",vs:D2,fs:U2,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:F2},getUniforms:k2};function k2(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,s=>s/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}function UC(t,e=[],n=0){const r=Math.fround(t),s=t-r;return e[n]=r,e[n+1]=s,e}function L2(t){return t-Math.fround(t)}function V2(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const s=n*4+r;UC(t[r*4+n],e,s*2)}return e}const H2=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,z2={ONE:1};function j2(){return z2}const W2={name:"fp64-arithmetic",vs:H2,getUniforms:j2,fp64ify:UC,fp64LowPart:L2,fp64ifyMatrix4:V2},X2=1/Math.PI*180,G2=1/180*Math.PI,$2={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...$2}};const De=globalThis.mathgl.config;function K2(t,{precision:e=De.precision}={}){return t=Q2(t),`${parseFloat(t.toPrecision(e))}`}function Ur(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Y2(t){return q2(t)}function J2(t){return qt(t)}function q2(t,e){return Dg(t,n=>n*G2,e)}function qt(t,e){return Dg(t,n=>n*X2,e)}function Gn(t,e,n){return Dg(t,r=>Math.max(e,Math.min(n,r)))}function jl(t,e,n){return Ur(t)?t.map((r,s)=>jl(r,e[s],n)):n*e+(1-n)*t}function on(t,e,n){const r=De.EPSILON;n&&(De.EPSILON=n);try{if(t===e)return!0;if(Ur(t)&&Ur(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!on(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=De.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{De.EPSILON=r}}function Q2(t){return Math.round(t/De.EPSILON)*De.EPSILON}function Z2(t){return t.clone?t.clone():new Array(t.length)}function Dg(t,e,n){if(Ur(t)){const r=t;n=n||Z2(r);for(let s=0;s<n.length&&s<r.length;++s){const i=typeof t=="number"?t:t[s];n[s]=e(i,s,n)}return n}return e(t)}class Ug extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Ur(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(De)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+K2(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!on(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let s=0;s<this.ELEMENTS;++s){const i=e[s],o=typeof n=="number"?n:n[s];this[s]=i+r*(o-i)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(De.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function eO(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function se(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Ho(t,e,n=""){if(De.debug&&!eO(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function Qt(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class kg extends Ug{get x(){return this[0]}set x(e){this[0]=se(e)}get y(){return this[1]}set y(e){this[1]=se(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-e[r];n+=s*s}return se(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return se(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Qt(e>=0&&e<this.ELEMENTS,"index is out of range"),se(this[e])}setComponent(e,n){return Qt(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const zo=1e-6;let ln=typeof Float32Array<"u"?Float32Array:Array;function tO(){const t=new ln(2);return ln!=Float32Array&&(t[0]=0,t[1]=0),t}function ny(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function nO(t,e){return t[0]=-e[0],t[1]=-e[1],t}function kC(t,e,n,r){const s=e[0],i=e[1];return t[0]=s+r*(n[0]-s),t[1]=i+r*(n[1]-i),t}function rO(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[2]*s,t[1]=n[1]*r+n[3]*s,t}function sO(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[2]*s+n[4],t[1]=n[1]*r+n[3]*s+n[5],t}function LC(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[3]*s+n[6],t[1]=n[1]*r+n[4]*s+n[7],t}function VC(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[4]*s+n[12],t[1]=n[1]*r+n[5]*s+n[13],t}(function(){const t=tO();return function(e,n,r,s,i,o){let a,c;for(n||(n=2),r||(r=0),s?c=Math.min(s*n+r,e.length):c=e.length,a=r;a<c;a+=n)t[0]=e[a],t[1]=e[a+1],i(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function HC(t,e,n){const r=e[0],s=e[1],i=n[3]*r+n[7]*s||1;return t[0]=(n[0]*r+n[4]*s)/i,t[1]=(n[1]*r+n[5]*s)/i,t}function zC(t,e,n){const r=e[0],s=e[1],i=e[2],o=n[3]*r+n[7]*s+n[11]*i||1;return t[0]=(n[0]*r+n[4]*s+n[8]*i)/o,t[1]=(n[1]*r+n[5]*s+n[9]*i)/o,t[2]=(n[2]*r+n[6]*s+n[10]*i)/o,t}function iO(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[2]*s,t[1]=n[1]*r+n[3]*s,t[2]=e[2],t}function oO(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[2]*s,t[1]=n[1]*r+n[3]*s,t[2]=e[2],t[3]=e[3],t}function jC(t,e,n){const r=e[0],s=e[1],i=e[2];return t[0]=n[0]*r+n[3]*s+n[6]*i,t[1]=n[1]*r+n[4]*s+n[7]*i,t[2]=n[2]*r+n[5]*s+n[8]*i,t[3]=e[3],t}class Lg extends kg{constructor(e=0,n=0){super(2),Ur(e)&&arguments.length===1?this.copy(e):(De.debug&&(se(e),se(n)),this[0]=e,this[1]=n)}set(e,n){return this[0]=e,this[1]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return De.debug&&(se(e.x),se(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return VC(this,this,e),this.check()}transformAsVector(e){return HC(this,this,e),this.check()}transformByMatrix3(e){return LC(this,this,e),this.check()}transformByMatrix2x3(e){return sO(this,this,e),this.check()}transformByMatrix2(e){return rO(this,this,e),this.check()}}function WC(){const t=new ln(3);return ln!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function XC(t){const e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}function ry(t,e,n){const r=new ln(3);return r[0]=t,r[1]=e,r[2]=n,r}function aO(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function cO(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function lO(t,e){const n=e[0],r=e[1],s=e[2];let i=n*n+r*r+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Vg(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function el(t,e,n){const r=e[0],s=e[1],i=e[2],o=n[0],a=n[1],c=n[2];return t[0]=s*c-i*a,t[1]=i*o-r*c,t[2]=r*a-s*o,t}function Hg(t,e,n){const r=e[0],s=e[1],i=e[2];let o=n[3]*r+n[7]*s+n[11]*i+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*s+n[8]*i+n[12])/o,t[1]=(n[1]*r+n[5]*s+n[9]*i+n[13])/o,t[2]=(n[2]*r+n[6]*s+n[10]*i+n[14])/o,t}function GC(t,e,n){const r=e[0],s=e[1],i=e[2];return t[0]=r*n[0]+s*n[3]+i*n[6],t[1]=r*n[1]+s*n[4]+i*n[7],t[2]=r*n[2]+s*n[5]+i*n[8],t}function $C(t,e,n){const r=n[0],s=n[1],i=n[2],o=n[3],a=e[0],c=e[1],l=e[2];let u=s*l-i*c,h=i*a-r*l,f=r*c-s*a,p=s*f-i*h,m=i*u-r*f,y=r*h-s*u;const w=o*2;return u*=w,h*=w,f*=w,p*=2,m*=2,y*=2,t[0]=a+u+p,t[1]=c+h+m,t[2]=l+f+y,t}function uO(t,e,n,r){const s=[],i=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],i[0]=s[0],i[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),i[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function hO(t,e,n,r){const s=[],i=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],i[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),i[1]=s[1],i[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function fO(t,e,n,r){const s=[],i=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],i[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),i[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),i[2]=s[2],t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function dO(t,e){const n=t[0],r=t[1],s=t[2],i=e[0],o=e[1],a=e[2],c=Math.sqrt((n*n+r*r+s*s)*(i*i+o*o+a*a)),l=c&&Vg(t,e)/c;return Math.acos(Math.min(Math.max(l,-1),1))}const pO=aO,gO=XC;(function(){const t=WC();return function(e,n,r,s,i,o){let a,c;for(n||(n=3),r||(r=0),s?c=Math.min(s*n+r,e.length):c=e.length,a=r;a<c;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],i(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Wh=[0,0,0];let mc;class M extends kg{static get ZERO(){return mc||(mc=new M(0,0,0),Object.freeze(mc)),mc}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&Ur(e)?this.copy(e):(De.debug&&(se(e),se(n),se(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return De.debug&&(se(e.x),se(e.y),se(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=se(e)}angle(e){return dO(this,e)}cross(e){return el(this,this,e),this.check()}rotateX({radians:e,origin:n=Wh}){return uO(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Wh}){return hO(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Wh}){return fO(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Hg(this,this,e),this.check()}transformAsVector(e){return zC(this,this,e),this.check()}transformByMatrix3(e){return GC(this,this,e),this.check()}transformByMatrix2(e){return iO(this,this,e),this.check()}transformByQuaternion(e){return $C(this,this,e),this.check()}}let Ac;class zg extends kg{static get ZERO(){return Ac||(Ac=new zg(0,0,0,0),Object.freeze(Ac)),Ac}constructor(e=0,n=0,r=0,s=0){super(-0,-0,-0,-0),Ur(e)&&arguments.length===1?this.copy(e):(De.debug&&(se(e),se(n),se(r),se(s)),this[0]=e,this[1]=n,this[2]=r,this[3]=s)}set(e,n,r,s){return this[0]=e,this[1]=n,this[2]=r,this[3]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return De.debug&&(se(e.x),se(e.y),se(e.z),se(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=se(e)}get w(){return this[3]}set w(e){this[3]=se(e)}transform(e){return Hg(this,this,e),this.check()}transformByMatrix3(e){return jC(this,this,e),this.check()}transformByMatrix2(e){return oO(this,this,e),this.check()}transformByQuaternion(e){return $C(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class KC extends Ug{toString(){let e="[";if(De.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=se(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)n[s]=this[r+s];return n}setColumn(e,n){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)this[r+s]=n[s];return this}}function _O(){const t=new ln(9);return ln!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function mO(t,e){if(t===e){const n=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function AO(t,e){const n=e[0],r=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,f=-u*i+a*c,p=l*i-o*c;let m=n*h+r*f+s*p;return m?(m=1/m,t[0]=h*m,t[1]=(-u*r+s*l)*m,t[2]=(a*r-s*o)*m,t[3]=f*m,t[4]=(u*n-s*c)*m,t[5]=(-a*n+s*i)*m,t[6]=p*m,t[7]=(-l*n+r*c)*m,t[8]=(o*n-r*i)*m,t):null}function yO(t){const e=t[0],n=t[1],r=t[2],s=t[3],i=t[4],o=t[5],a=t[6],c=t[7],l=t[8];return e*(l*i-o*c)+n*(-l*s+o*a)+r*(c*s-i*a)}function sy(t,e,n){const r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=n[0],p=n[1],m=n[2],y=n[3],w=n[4],_=n[5],g=n[6],T=n[7],C=n[8];return t[0]=f*r+p*o+m*l,t[1]=f*s+p*a+m*u,t[2]=f*i+p*c+m*h,t[3]=y*r+w*o+_*l,t[4]=y*s+w*a+_*u,t[5]=y*i+w*c+_*h,t[6]=g*r+T*o+C*l,t[7]=g*s+T*a+C*u,t[8]=g*i+T*c+C*h,t}function TO(t,e,n){const r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=n[0],p=n[1];return t[0]=r,t[1]=s,t[2]=i,t[3]=o,t[4]=a,t[5]=c,t[6]=f*r+p*o+l,t[7]=f*s+p*a+u,t[8]=f*i+p*c+h,t}function EO(t,e,n){const r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=Math.sin(n),p=Math.cos(n);return t[0]=p*r+f*o,t[1]=p*s+f*a,t[2]=p*i+f*c,t[3]=p*o-f*r,t[4]=p*a-f*s,t[5]=p*c-f*i,t[6]=l,t[7]=u,t[8]=h,t}function iy(t,e,n){const r=n[0],s=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function SO(t,e){const n=e[0],r=e[1],s=e[2],i=e[3],o=n+n,a=r+r,c=s+s,l=n*o,u=r*o,h=r*a,f=s*o,p=s*a,m=s*c,y=i*o,w=i*a,_=i*c;return t[0]=1-h-m,t[3]=u-_,t[6]=f+w,t[1]=u+_,t[4]=1-l-m,t[7]=p-y,t[2]=f-w,t[5]=p+y,t[8]=1-l-h,t}var Gd;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(Gd||(Gd={}));const CO=Object.freeze([1,0,0,0,1,0,0,0,1]);class be extends KC{static get IDENTITY(){return wO()}static get ZERO(){return vO()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Gd}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(CO)}fromObject(e){return this.check()}fromQuaternion(e){return SO(this,e),this.check()}set(e,n,r,s,i,o,a,c,l){return this[0]=e,this[1]=n,this[2]=r,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(e,n,r,s,i,o,a,c,l){return this[0]=e,this[1]=s,this[2]=a,this[3]=n,this[4]=i,this[5]=c,this[6]=r,this[7]=o,this[8]=l,this.check()}determinant(){return yO(this)}transpose(){return mO(this,this),this.check()}invert(){return AO(this,this),this.check()}multiplyLeft(e){return sy(this,e,this),this.check()}multiplyRight(e){return sy(this,this,e),this.check()}rotate(e){return EO(this,this,e),this.check()}scale(e){return Array.isArray(e)?iy(this,this,e):iy(this,this,[e,e]),this.check()}translate(e){return TO(this,this,e),this.check()}transform(e,n){let r;switch(e.length){case 2:r=LC(n||[-0,-0],e,this);break;case 3:r=GC(n||[-0,-0,-0],e,this);break;case 4:r=jC(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ho(r,e.length),r}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let yc,Tc=null;function vO(){return yc||(yc=new be([0,0,0,0,0,0,0,0,0]),Object.freeze(yc)),yc}function wO(){return Tc||(Tc=new be,Object.freeze(Tc)),Tc}function RO(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function bO(t,e){if(t===e){const n=e[1],r=e[2],s=e[3],i=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=i,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function $d(t,e){const n=e[0],r=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],f=e[10],p=e[11],m=e[12],y=e[13],w=e[14],_=e[15],g=n*a-r*o,T=n*c-s*o,C=n*l-i*o,I=r*c-s*a,P=r*l-i*a,x=s*l-i*c,N=u*y-h*m,D=u*w-f*m,F=u*_-p*m,X=h*w-f*y,q=h*_-p*y,ee=f*_-p*w;let K=g*ee-T*q+C*X+I*F-P*D+x*N;return K?(K=1/K,t[0]=(a*ee-c*q+l*X)*K,t[1]=(s*q-r*ee-i*X)*K,t[2]=(y*x-w*P+_*I)*K,t[3]=(f*P-h*x-p*I)*K,t[4]=(c*F-o*ee-l*D)*K,t[5]=(n*ee-s*F+i*D)*K,t[6]=(w*C-m*x-_*T)*K,t[7]=(u*x-f*C+p*T)*K,t[8]=(o*q-a*F+l*N)*K,t[9]=(r*F-n*q-i*N)*K,t[10]=(m*P-y*C+_*g)*K,t[11]=(h*C-u*P-p*g)*K,t[12]=(a*D-o*X-c*N)*K,t[13]=(n*X-r*D+s*N)*K,t[14]=(y*T-m*I-w*g)*K,t[15]=(u*I-h*T+f*g)*K,t):null}function IO(t){const e=t[0],n=t[1],r=t[2],s=t[3],i=t[4],o=t[5],a=t[6],c=t[7],l=t[8],u=t[9],h=t[10],f=t[11],p=t[12],m=t[13],y=t[14],w=t[15],_=e*o-n*i,g=e*a-r*i,T=n*a-r*o,C=l*m-u*p,I=l*y-h*p,P=u*y-h*m,x=e*P-n*I+r*C,N=i*P-o*I+a*C,D=l*T-u*g+h*_,F=p*T-m*g+y*_;return c*x-s*N+w*D-f*F}function gs(t,e,n){const r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=e[9],p=e[10],m=e[11],y=e[12],w=e[13],_=e[14],g=e[15];let T=n[0],C=n[1],I=n[2],P=n[3];return t[0]=T*r+C*a+I*h+P*y,t[1]=T*s+C*c+I*f+P*w,t[2]=T*i+C*l+I*p+P*_,t[3]=T*o+C*u+I*m+P*g,T=n[4],C=n[5],I=n[6],P=n[7],t[4]=T*r+C*a+I*h+P*y,t[5]=T*s+C*c+I*f+P*w,t[6]=T*i+C*l+I*p+P*_,t[7]=T*o+C*u+I*m+P*g,T=n[8],C=n[9],I=n[10],P=n[11],t[8]=T*r+C*a+I*h+P*y,t[9]=T*s+C*c+I*f+P*w,t[10]=T*i+C*l+I*p+P*_,t[11]=T*o+C*u+I*m+P*g,T=n[12],C=n[13],I=n[14],P=n[15],t[12]=T*r+C*a+I*h+P*y,t[13]=T*s+C*c+I*f+P*w,t[14]=T*i+C*l+I*p+P*_,t[15]=T*o+C*u+I*m+P*g,t}function Wl(t,e,n){const r=n[0],s=n[1],i=n[2];let o,a,c,l,u,h,f,p,m,y,w,_;return e===t?(t[12]=e[0]*r+e[4]*s+e[8]*i+e[12],t[13]=e[1]*r+e[5]*s+e[9]*i+e[13],t[14]=e[2]*r+e[6]*s+e[10]*i+e[14],t[15]=e[3]*r+e[7]*s+e[11]*i+e[15]):(o=e[0],a=e[1],c=e[2],l=e[3],u=e[4],h=e[5],f=e[6],p=e[7],m=e[8],y=e[9],w=e[10],_=e[11],t[0]=o,t[1]=a,t[2]=c,t[3]=l,t[4]=u,t[5]=h,t[6]=f,t[7]=p,t[8]=m,t[9]=y,t[10]=w,t[11]=_,t[12]=o*r+u*s+m*i+e[12],t[13]=a*r+h*s+y*i+e[13],t[14]=c*r+f*s+w*i+e[14],t[15]=l*r+p*s+_*i+e[15]),t}function jg(t,e,n){const r=n[0],s=n[1],i=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function MO(t,e,n,r){let s=r[0],i=r[1],o=r[2],a=Math.sqrt(s*s+i*i+o*o),c,l,u,h,f,p,m,y,w,_,g,T,C,I,P,x,N,D,F,X,q,ee,K,He;return a<zo?null:(a=1/a,s*=a,i*=a,o*=a,l=Math.sin(n),c=Math.cos(n),u=1-c,h=e[0],f=e[1],p=e[2],m=e[3],y=e[4],w=e[5],_=e[6],g=e[7],T=e[8],C=e[9],I=e[10],P=e[11],x=s*s*u+c,N=i*s*u+o*l,D=o*s*u-i*l,F=s*i*u-o*l,X=i*i*u+c,q=o*i*u+s*l,ee=s*o*u+i*l,K=i*o*u-s*l,He=o*o*u+c,t[0]=h*x+y*N+T*D,t[1]=f*x+w*N+C*D,t[2]=p*x+_*N+I*D,t[3]=m*x+g*N+P*D,t[4]=h*F+y*X+T*q,t[5]=f*F+w*X+C*q,t[6]=p*F+_*X+I*q,t[7]=m*F+g*X+P*q,t[8]=h*ee+y*K+T*He,t[9]=f*ee+w*K+C*He,t[10]=p*ee+_*K+I*He,t[11]=m*ee+g*K+P*He,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function YC(t,e,n){const r=Math.sin(n),s=Math.cos(n),i=e[4],o=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*s+l*r,t[5]=o*s+u*r,t[6]=a*s+h*r,t[7]=c*s+f*r,t[8]=l*s-i*r,t[9]=u*s-o*r,t[10]=h*s-a*r,t[11]=f*s-c*r,t}function BO(t,e,n){const r=Math.sin(n),s=Math.cos(n),i=e[0],o=e[1],a=e[2],c=e[3],l=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s-l*r,t[1]=o*s-u*r,t[2]=a*s-h*r,t[3]=c*s-f*r,t[8]=i*r+l*s,t[9]=o*r+u*s,t[10]=a*r+h*s,t[11]=c*r+f*s,t}function JC(t,e,n){const r=Math.sin(n),s=Math.cos(n),i=e[0],o=e[1],a=e[2],c=e[3],l=e[4],u=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s+l*r,t[1]=o*s+u*r,t[2]=a*s+h*r,t[3]=c*s+f*r,t[4]=l*s-i*r,t[5]=u*s-o*r,t[6]=h*s-a*r,t[7]=f*s-c*r,t}function PO(t,e){const n=e[0],r=e[1],s=e[2],i=e[4],o=e[5],a=e[6],c=e[8],l=e[9],u=e[10];return t[0]=Math.sqrt(n*n+r*r+s*s),t[1]=Math.sqrt(i*i+o*o+a*a),t[2]=Math.sqrt(c*c+l*l+u*u),t}function OO(t,e){const n=e[0],r=e[1],s=e[2],i=e[3],o=n+n,a=r+r,c=s+s,l=n*o,u=r*o,h=r*a,f=s*o,p=s*a,m=s*c,y=i*o,w=i*a,_=i*c;return t[0]=1-h-m,t[1]=u+_,t[2]=f-w,t[3]=0,t[4]=u-_,t[5]=1-l-m,t[6]=p+y,t[7]=0,t[8]=f+w,t[9]=p-y,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xO(t,e,n,r,s,i,o){const a=1/(n-e),c=1/(s-r),l=1/(i-o);return t[0]=i*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i*2*c,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(s+r)*c,t[10]=(o+i)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i*2*l,t[15]=0,t}function NO(t,e,n,r,s){const i=1/Math.tan(e/2);if(t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0){const o=1/(r-s);t[10]=(s+r)*o,t[14]=2*s*r*o}else t[10]=-1,t[14]=-2*r;return t}const FO=NO;function DO(t,e,n,r,s,i,o){const a=1/(e-n),c=1/(r-s),l=1/(i-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*a,t[13]=(s+r)*c,t[14]=(o+i)*l,t[15]=1,t}const UO=DO;function kO(t,e,n,r){let s,i,o,a,c,l,u,h,f,p;const m=e[0],y=e[1],w=e[2],_=r[0],g=r[1],T=r[2],C=n[0],I=n[1],P=n[2];return Math.abs(m-C)<zo&&Math.abs(y-I)<zo&&Math.abs(w-P)<zo?RO(t):(h=m-C,f=y-I,p=w-P,s=1/Math.sqrt(h*h+f*f+p*p),h*=s,f*=s,p*=s,i=g*p-T*f,o=T*h-_*p,a=_*f-g*h,s=Math.sqrt(i*i+o*o+a*a),s?(s=1/s,i*=s,o*=s,a*=s):(i=0,o=0,a=0),c=f*a-p*o,l=p*i-h*a,u=h*o-f*i,s=Math.sqrt(c*c+l*l+u*u),s?(s=1/s,c*=s,l*=s,u*=s):(c=0,l=0,u=0),t[0]=i,t[1]=c,t[2]=h,t[3]=0,t[4]=o,t[5]=l,t[6]=f,t[7]=0,t[8]=a,t[9]=u,t[10]=p,t[11]=0,t[12]=-(i*m+o*y+a*w),t[13]=-(c*m+l*y+u*w),t[14]=-(h*m+f*y+p*w),t[15]=1,t)}function LO(){const t=new ln(4);return ln!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function VO(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function qC(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function HO(t){const e=t[0],n=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+n*n+r*r+s*s)}function zO(t){const e=t[0],n=t[1],r=t[2],s=t[3];return e*e+n*n+r*r+s*s}function jO(t,e){const n=e[0],r=e[1],s=e[2],i=e[3];let o=n*n+r*r+s*s+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=s*o,t[3]=i*o,t}function WO(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function XO(t,e,n,r){const s=e[0],i=e[1],o=e[2],a=e[3];return t[0]=s+r*(n[0]-s),t[1]=i+r*(n[1]-i),t[2]=o+r*(n[2]-o),t[3]=a+r*(n[3]-a),t}function xa(t,e,n){const r=e[0],s=e[1],i=e[2],o=e[3];return t[0]=n[0]*r+n[4]*s+n[8]*i+n[12]*o,t[1]=n[1]*r+n[5]*s+n[9]*i+n[13]*o,t[2]=n[2]*r+n[6]*s+n[10]*i+n[14]*o,t[3]=n[3]*r+n[7]*s+n[11]*i+n[15]*o,t}function GO(t,e,n){const r=e[0],s=e[1],i=e[2],o=n[0],a=n[1],c=n[2],l=n[3],u=l*r+a*i-c*s,h=l*s+c*r-o*i,f=l*i+o*s-a*r,p=-o*r-a*s-c*i;return t[0]=u*l+p*-o+h*-c-f*-a,t[1]=h*l+p*-a+f*-o-u*-c,t[2]=f*l+p*-c+u*-a-h*-o,t[3]=e[3],t}(function(){const t=LO();return function(e,n,r,s,i,o){let a,c;for(n||(n=4),r||(r=0),s?c=Math.min(s*n+r,e.length):c=e.length,a=r;a<c;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],i(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Kd;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Kd||(Kd={}));const $O=45*Math.PI/180,KO=1,Xh=.1,Gh=500,YO=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Q extends KC{static get IDENTITY(){return qO()}static get ZERO(){return JO()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Kd}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,s,i,o,a,c,l,u,h,f,p,m,y,w){return this[0]=e,this[1]=n,this[2]=r,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=u,this[10]=h,this[11]=f,this[12]=p,this[13]=m,this[14]=y,this[15]=w,this.check()}setRowMajor(e,n,r,s,i,o,a,c,l,u,h,f,p,m,y,w){return this[0]=e,this[1]=i,this[2]=l,this[3]=p,this[4]=n,this[5]=o,this[6]=u,this[7]=m,this[8]=r,this[9]=a,this[10]=h,this[11]=y,this[12]=s,this[13]=c,this[14]=f,this[15]=w,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(YO)}fromObject(e){return this.check()}fromQuaternion(e){return OO(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:s,top:i,near:o=Xh,far:a=Gh}=e;return a===1/0?QO(this,n,r,s,i,o):xO(this,n,r,s,i,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:s=[0,1,0]}=e;return kO(this,n,r,s),this.check()}ortho(e){const{left:n,right:r,bottom:s,top:i,near:o=Xh,far:a=Gh}=e;return UO(this,n,r,s,i,o,a),this.check()}orthographic(e){const{fovy:n=$O,aspect:r=KO,focalDistance:s=1,near:i=Xh,far:o=Gh}=e;oy(n);const a=n/2,c=s*Math.tan(a),l=c*r;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:i,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:s=.1,far:i=500}=e;return oy(n),FO(this,n,r,s,i),this.check()}determinant(){return IO(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),s=1/r[0],i=1/r[1],o=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*i,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*i,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*i,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),s=1/r[0],i=1/r[1],o=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*i,e[2]=this[2]*o,e[3]=this[4]*s,e[4]=this[5]*i,e[5]=this[6]*o,e[6]=this[8]*s,e[7]=this[9]*i,e[8]=this[10]*o,e}transpose(){return bO(this,this),this.check()}invert(){return $d(this,this),this.check()}multiplyLeft(e){return gs(this,e,this),this.check()}multiplyRight(e){return gs(this,this,e),this.check()}rotateX(e){return YC(this,this,e),this.check()}rotateY(e){return BO(this,this,e),this.check()}rotateZ(e){return JC(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return MO(this,this,e,n),this.check()}scale(e){return jg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Wl(this,this,e),this.check()}transform(e,n){return e.length===4?(n=xa(n||[-0,-0,-0,-0],e,this),Ho(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let s;switch(r){case 2:s=VC(n||[-0,-0],e,this);break;case 3:s=Hg(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ho(s,e.length),s}transformAsVector(e,n){let r;switch(e.length){case 2:r=HC(n||[-0,-0],e,this);break;case 3:r=zC(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ho(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let Ec,Sc;function JO(){return Ec||(Ec=new Q([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Ec)),Ec}function qO(){return Sc||(Sc=new Q,Object.freeze(Sc)),Sc}function oy(t){if(t>Math.PI*2)throw Error("expected radians")}function QO(t,e,n,r,s,i){const o=2*i/(n-e),a=2*i/(s-r),c=(n+e)/(n-e),l=(s+r)/(s-r),u=-1,h=-1,f=-2*i;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=c,t[9]=l,t[10]=u,t[11]=h,t[12]=0,t[13]=0,t[14]=f,t[15]=0,t}function ay(){const t=new ln(4);return ln!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function ZO(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function QC(t,e,n){n=n*.5;const r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function cy(t,e,n){const r=e[0],s=e[1],i=e[2],o=e[3],a=n[0],c=n[1],l=n[2],u=n[3];return t[0]=r*u+o*a+s*l-i*c,t[1]=s*u+o*c+i*a-r*l,t[2]=i*u+o*l+r*c-s*a,t[3]=o*u-r*a-s*c-i*l,t}function ex(t,e,n){n*=.5;const r=e[0],s=e[1],i=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=r*c+o*a,t[1]=s*c+i*a,t[2]=i*c-s*a,t[3]=o*c-r*a,t}function tx(t,e,n){n*=.5;const r=e[0],s=e[1],i=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=r*c-i*a,t[1]=s*c+o*a,t[2]=i*c+r*a,t[3]=o*c-s*a,t}function nx(t,e,n){n*=.5;const r=e[0],s=e[1],i=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=r*c+s*a,t[1]=s*c-r*a,t[2]=i*c+o*a,t[3]=o*c-i*a,t}function rx(t,e){const n=e[0],r=e[1],s=e[2];return t[0]=n,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-s*s)),t}function tl(t,e,n,r){const s=e[0],i=e[1],o=e[2],a=e[3];let c=n[0],l=n[1],u=n[2],h=n[3],f,p,m,y,w;return f=s*c+i*l+o*u+a*h,f<0&&(f=-f,c=-c,l=-l,u=-u,h=-h),1-f>zo?(p=Math.acos(f),w=Math.sin(p),m=Math.sin((1-r)*p)/w,y=Math.sin(r*p)/w):(m=1-r,y=r),t[0]=m*s+y*c,t[1]=m*i+y*l,t[2]=m*o+y*u,t[3]=m*a+y*h,t}function sx(t,e){const n=e[0],r=e[1],s=e[2],i=e[3],o=n*n+r*r+s*s+i*i,a=o?1/o:0;return t[0]=-n*a,t[1]=-r*a,t[2]=-s*a,t[3]=i*a,t}function ix(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function ZC(t,e){const n=e[0]+e[4]+e[8];let r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);const i=(s+1)%3,o=(s+2)%3;r=Math.sqrt(e[s*3+s]-e[i*3+i]-e[o*3+o]+1),t[s]=.5*r,r=.5/r,t[3]=(e[i*3+o]-e[o*3+i])*r,t[i]=(e[i*3+s]+e[s*3+i])*r,t[o]=(e[o*3+s]+e[s*3+o])*r}return t}const ox=VO,ax=qC,cx=WO,lx=XO,ux=HO,hx=zO,ev=jO,fx=function(){const t=WC(),e=ry(1,0,0),n=ry(0,1,0);return function(r,s,i){const o=Vg(s,i);return o<-.999999?(el(t,e,s),gO(t)<1e-6&&el(t,n,s),lO(t,t),QC(r,t,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(el(t,s,i),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+o,ev(r,r))}}();(function(){const t=ay(),e=ay();return function(n,r,s,i,o,a){return tl(t,r,o,a),tl(e,s,i,a),tl(n,t,e,2*a*(1-a)),n}})();(function(){const t=_O();return function(e,n,r,s){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],ev(e,ZC(e,t))}})();const dx=[0,0,0,1];class _a extends Ug{constructor(e=0,n=0,r=0,s=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,r,s)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,r,s){return this[0]=e,this[1]=n,this[2]=r,this[3]=s,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return ZC(this,e),this.check()}fromAxisRotation(e,n){return QC(this,e,n),this.check()}identity(){return ZO(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=se(e)}get y(){return this[1]}set y(e){this[1]=se(e)}get z(){return this[2]}set z(e){this[2]=se(e)}get w(){return this[3]}set w(e){this[3]=se(e)}len(){return ux(this)}lengthSquared(){return hx(this)}dot(e){return cx(this,e)}rotationTo(e,n){return fx(this,e,n),this.check()}add(e){return ox(this,this,e),this.check()}calculateW(){return rx(this,this),this.check()}conjugate(){return ix(this,this),this.check()}invert(){return sx(this,this),this.check()}lerp(e,n,r){return r===void 0?this.lerp(this,e,n):(lx(this,e,n,r),this.check())}multiplyRight(e){return cy(this,this,e),this.check()}multiplyLeft(e){return cy(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return ex(this,this,e),this.check()}rotateY(e){return tx(this,this,e),this.check()}rotateZ(e){return nx(this,this,e),this.check()}scale(e){return ax(this,this,e),this.check()}slerp(e,n,r){let s,i,o;switch(arguments.length){case 1:({start:s=dx,target:i,ratio:o}=e);break;case 2:s=this,i=e,o=n;break;default:s=e,i=n,o=r}return tl(this,s,i,o),this.check()}transformVector4(e,n=new zg){return GO(n,e,this),Ho(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const px=.1,gx=1e-12,tv=1e-15,_x=1e-20,ly=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,mx={lightSources:{}};function $h(t={}){const{color:e=[0,0,0],intensity:n=1}=t;return e.map(r=>r*n/255)}function Ax({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const r={};return t?r["lighting_uAmbientLight.color"]=$h(t):r["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((s,i)=>{r[`lighting_uPointLight[${i}].color`]=$h(s),r[`lighting_uPointLight[${i}].position`]=s.position,r[`lighting_uPointLight[${i}].attenuation`]=s.attenuation||[1,0,0]}),r.lighting_uPointLightCount=e.length,n.forEach((s,i)=>{r[`lighting_uDirectionalLight[${i}].color`]=$h(s),r[`lighting_uDirectionalLight[${i}].direction`]=s.direction}),r.lighting_uDirectionalLightCount=n.length,r}function nv(t=mx){var e,n;if("lightSources"in t){const{ambientLight:r,pointLights:s,directionalLights:i}=t.lightSources||{};return r||s&&s.length>0||i&&i.length>0?Object.assign({},Ax({ambientLight:r,pointLights:s,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const r={pointLights:[],directionalLights:[]};for(const s of t.lights||[])switch(s.type){case"ambient":r.ambientLight=s;break;case"directional":(e=r.directionalLights)==null||e.push(s);break;case"point":(n=r.pointLights)==null||n.push(s);break}return nv({lightSources:r})}return{}}const Wg={name:"lights",vs:ly,fs:ly,getUniforms:nv,defines:{MAX_LIGHTS:3}},rv=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,yx={};function Tx(t){const{ambient:e=.35,diffuse:n=.6,shininess:r=32,specularColor:s=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:r,lighting_uSpecularColor:s.map(i=>i/255)}}function sv(t=yx){if(!("material"in t))return{};const{material:e}=t;return e?Tx(e):{lighting_uEnabled:!1}}const Ex={name:"gouraud-lighting",dependencies:[Wg],vs:rv,defines:{LIGHTING_VERTEX:1},getUniforms:sv},Sx={name:"phong-lighting",dependencies:[Wg],fs:rv,defines:{LIGHTING_FRAGMENT:1},getUniforms:sv},Cx=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;
out vec3 pbr_vPosition;
out vec2 pbr_vUV;
#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif
void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
vec4 pos = u_ModelMatrix * position;
pbr_vPosition = vec3(pos.xyz) / pos.w;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0.,0.);
#endif
}
`,vx=`precision highp float;
uniform bool pbr_uUnlit;
#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif
#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif
uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;
uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif
in vec3 pbr_vPosition;
in vec2 pbr_vUV;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif
struct PBRInfo
{
float NdotL;
float NdotV;
float NdotH;
float LdotH;
float VdotH;
float perceptualRoughness;
float metalness;
vec3 reflectance0;
vec3 reflectance90;
float alphaRoughness;
vec3 diffuseColor;
vec3 specularColor;
vec3 n;
vec3 v;
};
const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;
vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
return vec4(linOut,srgbIn.w);;
#else
return srgbIn;
#endif
}
vec3 getNormal()
{
#ifndef HAS_TANGENTS
vec3 pos_dx = dFdx(pbr_vPosition);
vec3 pos_dy = dFdy(pbr_vPosition);
vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
#ifdef HAS_NORMALS
vec3 ng = normalize(pbr_vNormal);
#else
vec3 ng = cross(pos_dx, pos_dy);
#endif
t = normalize(t - ng * dot(ng, t));
vec3 b = normalize(cross(ng, t));
mat3 tbn = mat3(t, b, ng);
#else
mat3 tbn = pbr_vTBN;
#endif
#ifdef HAS_NORMALMAP
vec3 n = texture(u_NormalSampler, pbr_vUV).rgb;
n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
vec3 n = normalize(tbn[2].xyz);
#endif
return n;
}
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
float mipCount = 9.0;
float lod = (pbrInputs.perceptualRoughness * mipCount);
vec3 brdf = SRGBtoLINEAR(texture(u_brdfLUT,
vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;
#ifdef USE_TEX_LOD
vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif
vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
diffuse *= u_ScaleIBLAmbient.x;
specular *= u_ScaleIBLAmbient.y;
return diffuse + specular;
}
#endif
vec3 diffuse(PBRInfo pbrInputs)
{
return pbrInputs.diffuseColor / M_PI;
}
vec3 specularReflection(PBRInfo pbrInputs)
{
return pbrInputs.reflectance0 +
(pbrInputs.reflectance90 - pbrInputs.reflectance0) *
pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}
float geometricOcclusion(PBRInfo pbrInputs)
{
float NdotL = pbrInputs.NdotL;
float NdotV = pbrInputs.NdotV;
float r = pbrInputs.alphaRoughness;
float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
return attenuationL * attenuationV;
}
float microfacetDistribution(PBRInfo pbrInputs)
{
float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
return roughnessSq / (M_PI * f * f);
}
void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
pbrInputs.NdotL = 1.0;
pbrInputs.NdotH = 0.0;
pbrInputs.LdotH = 0.0;
pbrInputs.VdotH = 1.0;
}
void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
vec3 n = pbrInputs.n;
vec3 v = pbrInputs.v;
vec3 l = normalize(lightDirection);
vec3 h = normalize(l+v);
pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}
void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}
vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
vec3 F = specularReflection(pbrInputs);
float G = geometricOcclusion(pbrInputs);
float D = microfacetDistribution(pbrInputs);
vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}
vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
vec4 baseColor = SRGBtoLINEAR(texture(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
vec4 baseColor = u_BaseColorFactor;
#endif
#ifdef ALPHA_CUTOFF
if (baseColor.a < u_AlphaCutoff) {
discard;
}
#endif
vec3 color = vec3(0, 0, 0);
if(pbr_uUnlit){
color.rgb = baseColor.rgb;
}
else{
float perceptualRoughness = u_MetallicRoughnessValues.y;
float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
vec4 mrSample = texture(u_MetallicRoughnessSampler, pbr_vUV);
perceptualRoughness = mrSample.g * perceptualRoughness;
metallic = mrSample.b * metallic;
#endif
perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
metallic = clamp(metallic, 0.0, 1.0);
float alphaRoughness = perceptualRoughness * perceptualRoughness;
vec3 f0 = vec3(0.04);
vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
diffuseColor *= 1.0 - metallic;
vec3 specularColor = mix(f0, baseColor.rgb, metallic);
float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
vec3 specularEnvironmentR0 = specularColor.rgb;
vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;
vec3 n = getNormal();
vec3 v = normalize(u_Camera - pbr_vPosition);
float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
vec3 reflection = -normalize(reflect(v, n));
PBRInfo pbrInputs = PBRInfo(
0.0,
NdotV,
0.0,
0.0,
0.0,
perceptualRoughness,
metallic,
specularEnvironmentR0,
specularEnvironmentR90,
alphaRoughness,
diffuseColor,
specularColor,
n,
v
);
#ifdef USE_LIGHTS
PBRInfo_setAmbientLight(pbrInputs);
color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
for(int i = 0; i < lighting_uDirectionalLightCount; i++) {
if (i < lighting_uDirectionalLightCount) {
PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
}
}
for(int i = 0; i < lighting_uPointLightCount; i++) {
if (i < lighting_uPointLightCount) {
PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
}
}
#endif
#ifdef USE_IBL
color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
float ao = texture(u_OcclusionSampler, pbr_vUV).r;
color = mix(color, color * ao, u_OcclusionStrength);
#endif
#ifdef HAS_EMISSIVEMAP
vec3 emissive = SRGBtoLINEAR(texture(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
color += emissive;
#endif
#ifdef PBR_DEBUG
color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif
}
return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,Xg={name:"pbr",vs:Cx,fs:vx,defines:{LIGHTING_FRAGMENT:1},dependencies:[Wg]},iv="#define SMOOTH_EDGE_RADIUS 0.5",wx=`
${iv}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Rx=`
${iv}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,bx={name:"geometry",vs:wx,fs:Rx},Z={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Z,"IDENTITY",{get:()=>(ie.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const bn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Yd={common:0,meters:1,pixels:2},Jd={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Ix=Object.keys(Z).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Z[t]};`).join(""),Mx=Object.keys(bn).map(t=>`const int PROJECTION_MODE_${t} = ${bn[t]};`).join(""),Bx=Object.keys(Yd).map(t=>`const int UNIT_${t.toUpperCase()} = ${Yd[t]};`).join(""),Px=`${Ix}
${Mx}
${Bx}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function Ox(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Na(t){let e={},n;return r=>{for(const s in r)if(!Ox(r[s],e[s])){n=t(r),e=r;break}return n}}const uy=[0,0,0,0],xx=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ov=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Nx=[0,0,0],av=[0,0,0],Fx=Na(kx);function cv(t,e,n=av){n.length<3&&(n=[n[0],n[1],0]);let r=n,s,i=!0;switch(e===Z.LNGLAT_OFFSETS||e===Z.METER_OFFSETS?s=n:s=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case bn.WEB_MERCATOR:(e===Z.LNGLAT||e===Z.CARTESIAN)&&(s=[0,0,0],i=!1);break;case bn.WEB_MERCATOR_AUTO_OFFSET:e===Z.LNGLAT?r=s:e===Z.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],s=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case bn.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case bn.GLOBE:i=!1,s=null;break;default:i=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:r,offsetMode:i}}function Dx(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:s}=t;let{viewMatrix:i,viewProjectionMatrix:o}=t,a=uy,c=uy,l=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:f}=cv(t,e,n);return f&&(c=t.projectPosition(u||h),l=[l[0]-c[0],l[1]-c[1],l[2]-c[2]],c[3]=1,a=xa([],c,o),i=r||i,o=gs([],s,i),o=gs([],o,xx)),{viewMatrix:i,viewProjectionMatrix:o,projectionCenter:a,originCommon:c,cameraPosCommon:l,shaderCoordinateOrigin:h,geospatialOrigin:u}}function Ux({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=Z.DEFAULT,coordinateOrigin:s=av,autoWrapLongitude:i=!1}){r===Z.DEFAULT&&(r=t.isGeospatial?Z.LNGLAT:Z.CARTESIAN);const o=Fx({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:s});return o.project_uWrapLongitude=i,o.project_uModelMatrix=n||ov,o}function kx({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:s,viewProjectionMatrix:i,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:c,geospatialOrigin:l}=Dx(t,n,r),u=t.getDistanceScales(),h=[t.width*e,t.height*e],f=xa([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,p={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:c,project_uCommonOrigin:o.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:h,project_uDevicePixelRatio:e,project_uFocalDistance:f,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:Nx,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:i,project_uModelMatrix:ov,project_uCameraPosition:a};if(l){const m=t.getDistanceScales(l);switch(n){case Z.METER_OFFSETS:p.project_uCommonUnitsPerWorldUnit=m.unitsPerMeter,p.project_uCommonUnitsPerWorldUnit2=m.unitsPerMeter2;break;case Z.LNGLAT:case Z.LNGLAT_OFFSETS:t._pseudoMeters||(p.project_uCommonUnitsPerMeter=m.unitsPerMeter),p.project_uCommonUnitsPerWorldUnit=m.unitsPerDegree,p.project_uCommonUnitsPerWorldUnit2=m.unitsPerDegree2;break;case Z.CARTESIAN:p.project_uCommonUnitsPerWorldUnit=[1,1,m.unitsPerMeter[2]],p.project_uCommonUnitsPerWorldUnit2=[0,0,m.unitsPerMeter2[2]];break}}return p}const Lx={};function Vx(t=Lx){return"viewport"in t?Ux(t):{}}const Gg={name:"project",dependencies:[N2,bx],vs:Px,getUniforms:Vx},Hx=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,$g={name:"project32",dependencies:[Gg],vs:Hx};function zx(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ti(t,e){const n=xa([],e,t);return qC(n,n,1/n[3]),n}function hy(t,e){const n=t%e;return n<0?e+n:n}function qd(t,e,n){return t<e?e:t>n?n:t}function jx(t){return Math.log(t)*Math.LOG2E}const Kg=Math.log2||jx;function tr(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const en=Math.PI,lv=en/4,zt=en/180,Qd=180/en,Fi=512,Xl=4003e4,Cc=85.051129,Wx=1.5;function Xx(t){return Kg(t)}function Gl(t){const[e,n]=t;tr(Number.isFinite(e)),tr(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*zt,s=n*zt,i=Fi*(r+en)/(2*en),o=Fi*(en+Math.log(Math.tan(lv+s*.5)))/(2*en);return[i,o]}function Di(t){const[e,n]=t,r=e/Fi*(2*en)-en,s=2*(Math.atan(Math.exp(n/Fi*(2*en)-en))-lv);return[r*Qd,s*Qd]}function Gx(t){const{latitude:e}=t;tr(Number.isFinite(e));const n=Math.cos(e*zt);return Xx(Xl*n)-9}function Kh(t){const e=Math.cos(t*zt);return Fi/Xl/e}function Zd(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;tr(Number.isFinite(e)&&Number.isFinite(n));const s=Fi,i=Math.cos(e*zt),o=s/360,a=o/i,c=s/Xl/i,l={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[o,a,c],degreesPerUnit:[1/o,1/a,1/c]};if(r){const u=zt*Math.tan(e*zt)/i,h=o*u/2,f=s/Xl*u,p=f/a*c;l.unitsPerDegree2=[0,h,f],l.unitsPerMeter2=[p,0,p]}return l}function uv(t,e){const[n,r,s]=t,[i,o,a]=e,{unitsPerMeter:c,unitsPerMeter2:l}=Zd({longitude:n,latitude:r,highPrecision:!0}),u=Gl(t);u[0]+=i*(c[0]+l[0]*o),u[1]+=o*(c[1]+l[1]*o);const h=Di(u),f=(s||0)+(a||0);return Number.isFinite(s)||Number.isFinite(a)?[h[0],h[1],f]:h}function $x(t){const{height:e,pitch:n,bearing:r,altitude:s,scale:i,center:o}=t,a=zx();Wl(a,a,[0,0,-s]),YC(a,a,-n*zt),JC(a,a,r*zt);const c=i/e;return jg(a,a,[c,c,c]),o&&Wl(a,a,cO([],o)),a}function Kx(t){const{width:e,height:n,altitude:r,pitch:s=0,offset:i,center:o,scale:a,nearZMultiplier:c=1,farZMultiplier:l=1}=t;let{fovy:u=$l(Wx)}=t;r!==void 0&&(u=$l(r));const h=u*zt,f=s*zt,p=hv(u);let m=p;o&&(m+=o[2]*a/Math.cos(f)/n);const y=h*(.5+(i?i[1]:0)/n),w=Math.sin(y)*m/Math.sin(qd(Math.PI/2-f-y,.01,Math.PI-.01)),_=Math.sin(f)*w+m,g=m*10,T=Math.min(_*l,g);return{fov:h,aspect:e/n,focalDistance:p,near:c,far:T}}function $l(t){return 2*Math.atan(.5/t)*Qd}function hv(t){return .5/Math.tan(.5*t*zt)}function fv(t,e){const[n,r,s=0]=t;return tr(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(s)),Ti(e,[n,r,s,1])}function Yg(t,e,n=0){const[r,s,i]=t;if(tr(Number.isFinite(r)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(i))return Ti(e,[r,s,i,1]);const o=Ti(e,[r,s,0,1]),a=Ti(e,[r,s,1,1]),c=o[2],l=a[2],u=c===l?0:((n||0)-c)/(l-c);return kC([],o,a,u)}function Yx(t){const{width:e,height:n,bounds:r,minExtent:s=0,maxZoom:i=24,offset:o=[0,0]}=t,[[a,c],[l,u]]=r,h=Jx(t.padding),f=Gl([a,qd(u,-Cc,Cc)]),p=Gl([l,qd(c,-Cc,Cc)]),m=[Math.max(Math.abs(p[0]-f[0]),s),Math.max(Math.abs(p[1]-f[1]),s)],y=[e-h.left-h.right-Math.abs(o[0])*2,n-h.top-h.bottom-Math.abs(o[1])*2];tr(y[0]>0&&y[1]>0);const w=y[0]/m[0],_=y[1]/m[1],g=(h.right-h.left)/2/w,T=(h.top-h.bottom)/2/_,C=[(p[0]+f[0])/2+g,(p[1]+f[1])/2+T],I=Di(C),P=Math.min(i,Kg(Math.abs(Math.min(w,_))));return tr(Number.isFinite(P)),{longitude:I[0],latitude:I[1],zoom:P}}function Jx(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(tr(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const fy=Math.PI/180;function qx(t,e=0){const{width:n,height:r,unproject:s}=t,i={targetZ:e},o=s([0,r],i),a=s([n,r],i);let c,l;const u=t.fovy?.5*t.fovy*fy:Math.atan(.5/t.altitude),h=(90-t.pitch)*fy;return u>h-.01?(c=dy(t,0,e),l=dy(t,n,e)):(c=s([0,0],i),l=s([n,0],i)),[o,a,l,c]}function dy(t,e,n){const{pixelUnprojectionMatrix:r}=t,s=Ti(r,[e,0,1,1]),i=Ti(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-s[2])/(i[2]-s[2]),c=kC([],s,i,a),l=Di(c);return l.push(n),l}const py=512;function Qx(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:s,latitude:i,zoom:o,bearing:a=0}=t;(s<-180||s>180)&&(s=hy(s+180,360)-180),(a<-180||a>180)&&(a=hy(a+180,360)-180);const c=Kg(n/py);if(o<=c)o=c,i=0;else{const l=n/2/Math.pow(2,o),u=Di([0,l])[1];if(i<u)i=u;else{const h=Di([0,py-l])[1];i>h&&(i=h)}}return{width:e,height:n,longitude:s,latitude:i,zoom:o,pitch:r,bearing:a}}const Zx=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,eN=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,tN=Na(oN),nN=Na(aN),rN=[0,0,0,1],sN=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function iN(t,e){const[n,r,s]=t,i=Yg([n,r,s],e);return Number.isFinite(s)?i:[i[0],i[1],0]}function oN({viewport:t,center:e}){return new Q(t.viewProjectionMatrix).invert().transform(e)}function aN({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,i=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>iN(o,r));for(const o of e){const a=o.clone().translate(new M(t.center).negate()),c=i.map(u=>a.transform(u)),l=new Q().ortho({left:Math.min(...c.map(u=>u[0])),right:Math.max(...c.map(u=>u[0])),bottom:Math.min(...c.map(u=>u[1])),top:Math.max(...c.map(u=>u[1])),near:Math.min(...c.map(u=>-u[2])),far:Math.max(...c.map(u=>-u[2]))});n.push(l.multiplyRight(o))}return n}function cN(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||rN,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},s=tN({viewport:t.viewport,center:e.project_uCenter}),i=[],o=nN({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const c=o[a],l=c.clone().translate(new M(t.viewport.center).negate());e.project_uCoordinateSystem===Z.LNGLAT&&e.project_uProjectionMode===bn.WEB_MERCATOR?(o[a]=l,i[a]=s):(o[a]=c.clone().multiplyRight(sN),i[a]=l.transform(s))}for(let a=0;a<o.length;a++)r[`shadow_uViewProjectionMatrices[${a}]`]=o[a],r[`shadow_uProjectCenters[${a}]`]=i[a];for(let a=0;a<2;a++)r[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return r}const gy={name:"shadow",dependencies:[Gg],vs:Zx,fs:eN,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?cN(t,e):{}},Jg={...ty,defaultUniforms:{...ty.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},lN=[Gg],uN=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function hN(){const t=Nl.getDefaultShaderAssembler();for(const e of lN)t.addDefaultModule(e);for(const e of uN)t.addShaderHook(e);return t}const fN=[255,255,255],dN=1;let pN=0;class gN{constructor(e={}){this.type="ambient";const{color:n=fN}=e,{intensity:r=dN}=e;this.id=e.id||`ambient-${pN++}`,this.color=n,this.intensity=r}}const _N=[255,255,255],mN=1,AN=[0,0,-1];let yN=0;class _y{constructor(e={}){this.type="directional";const{color:n=_N}=e,{intensity:r=mN}=e,{direction:s=AN}=e,{_shadow:i=!1}=e;this.id=e.id||`directional-${yN++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new M(s).normalize().toArray(),this.shadow=i}getProjectedLight(e){return this}}class TN{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class qg extends TN{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,i=e.clearColor??(s?[0,0,0,0]:!1),o=s?1:!1,a=s?0:!1,c=e.colorMask??15,l={viewport:[0,0,n,r]};e.colorMask&&(l.colorMask=c),e.scissorRect&&(l.scissorRect=e.scissorRect);const u=this.device.beginRenderPass({framebuffer:e.target,parameters:l,clearColor:i,clearDepth:o,clearStencil:a});try{return this._drawLayers(u,e)}finally{u.end()}}_drawLayers(e,n){const{target:r,moduleParameters:s,viewports:i,views:o,onViewportActive:a,clearStack:c=!0}=n;n.pass=n.pass||"unknown",c&&(this._lastRenderIndex=-1);const l=[];for(const u of i){const h=o&&o[u.id];a==null||a(u);const f=this._getDrawLayerParams(u,n),p=u.subViewports||[u];for(const m of p){const y=this._drawLayersInViewport(e,{target:r,moduleParameters:s,viewport:m,view:h,pass:n.pass,layers:n.layers},f);l.push(y)}}return l}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:s=!1,layerFilter:i,cullRect:o,effects:a,moduleParameters:c},l=!1){var m;const u=[],h=dv(this._lastRenderIndex+1),f={layer:n[0],viewport:e,isPicking:s,renderPass:r,cullRect:o},p={};for(let y=0;y<n.length;y++){const w=n[y],_=this._shouldDrawLayer(w,f,i,p),g={shouldDrawLayer:_};_&&!l&&(g.layerRenderIndex=h(w,_),g.moduleParameters=this._getModuleParameters(w,a,r,c),g.layerParameters={...(m=w.context.deck)==null?void 0:m.props.parameters,...this.getLayerParameters(w,y,e)}),u[y]=g}return u}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:s,target:i,viewport:o,view:a},c){const l=EN(this.device,{moduleParameters:r,target:i,viewport:o});if(a&&a.props.clear){const h=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:l},()=>this.device.clearWebGL(h))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let h=0;h<n.length;h++){const f=n[h],{shouldDrawLayer:p,layerRenderIndex:m,moduleParameters:y,layerParameters:w}=c[h];if(p&&f.props.pickable&&u.pickableCount++,f.isComposite)u.compositeCount++;else if(p){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,m),y.viewport=o,f.context.renderPass=e;try{f._drawLayer({renderPass:e,moduleParameters:y,uniforms:{layerIndex:m},parameters:w})}catch(_){f.raiseError(_,`drawing ${f} to ${s}`)}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in s||(s[a]=r(n)),!s[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,s){var a,c;const i=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:i});if(n)for(const l of n)Object.assign(o,(c=l.getModuleParameters)==null?void 0:c.call(l,e));return Object.assign(o,this.getModuleParameters(e,n),s)}}function dv(t=0,e={}){const n={},r=(s,i)=>{const o=s.props._offset,a=s.id,c=s.parent&&s.parent.id;let l;if(c&&!(c in e)&&r(s.parent,!1),c in n){const u=n[c]=n[c]||dv(e[c],e);l=u(s,i),n[a]=u}else Number.isFinite(o)?(l=o+(e[c]||0),n[a]=null):l=t;return i&&l>=t&&(t=l+1),e[a]=l,l};return r}function EN(t,{moduleParameters:e,target:n,viewport:r}){const s=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,i]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:i,a=r;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}class SN extends qg{constructor(e,n){super(e,n),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],i=s.width*r,o=s.height*r,a=[1,1,1,1];(i!==n.width||o!==n.height)&&n.resize({width:i,height:o}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const CN={color:[255,255,255],intensity:1},my=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],vN=[0,0,0,200/255];class pv{constructor(e={}){this.id="lighting-effect",this.shadowColor=vN,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(gy),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:s,views:i}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:s,views:i,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(gy))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new Q().lookAt({eye:new M(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new SN(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new gN(CN),this.directionalLights.push(new _y(my[0]),new _y(my[1])))}}class wN{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:s,padding:i=0,copy:o=!1,initialize:a=!1,maxCount:c}){const l=s||e&&e.constructor||Float32Array,u=n*r+i;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,u)}let h=1/0;c&&(h=c*r+i);const f=this._allocate(l,u,a,h);return e&&o?f.set(e):a||f.fill(0,0,4),this._release(e),f}release(e){this._release(e)}_allocate(e,n,r,s){let i=Math.max(Math.ceil(n*this.opts.overAlloc),1);i>s&&(i=s);const o=this._pool,a=e.BYTES_PER_ELEMENT*i,c=o.findIndex(l=>l.byteLength>=a);if(c>=0){const l=new e(o.splice(c,1)[0],0,i);return r&&l.fill(0),l}return new e(i)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:s}=r,i=n.findIndex(o=>o.byteLength>=s);i<0?n.push(r):(i>0||n.length<this.opts.poolSize)&&n.splice(i,0,r),n.length>this.opts.poolSize&&n.shift()}}const ma=new wN;function Ro(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function RN(t){return[t[12],t[13],t[14]]}function bN(t){return{left:Us(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Us(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Us(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Us(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Us(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Us(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const Ay=new M;function Us(t,e,n,r){Ay.set(t,e,n);const s=Ay.len();return{distance:r/s,normal:new M(-t/s,-e/s,-n/s)}}function IN(t){return t-Math.fround(t)}let lo;function Yh(t,e){const{size:n=1,startIndex:r=0}=e,s=e.endIndex!==void 0?e.endIndex:t.length,i=(s-r)/n;lo=ma.allocate(lo,i,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<s;){for(let c=0;c<n;c++){const l=t[o++];lo[a+c]=l,lo[a+c+n]=IN(l)}a+=n*2}return lo.subarray(0,i*n*2)}function MN(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const BN=Math.PI/180,PN=Ro(),yy=[0,0,0],ON={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function xN({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:s,padding:i,near:o,far:a}){const c=t/e,l=n?new Q().orthographic({fovy:r,aspect:c,focalDistance:s,near:o,far:a}):new Q().perspective({fovy:r,aspect:c,near:o,far:a});if(i){const{left:u=0,right:h=0,top:f=0,bottom:p=0}=i,m=Gn((u+t-h)/2,0,t)-t/2,y=Gn((f+e-p)/2,0,e)-e/2;l[8]-=m*2/t,l[9]+=y*2/e}return l}class ku{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||ON,this.focalDistance=e.focalDistance||1,this.position=e.position||yy,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?bn.WEB_MERCATOR:bn.WEB_MERCATOR_AUTO_OFFSET:bn.IDENTITY}equals(e){return e instanceof ku?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&on(e.projectionMatrix,this.projectionMatrix)&&on(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),s=fv(r,this.pixelProjectionMatrix),[i,o]=s,a=n?o:this.height-o;return e.length===2?[i,a]:[i,a,s[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[s,i,o]=e,a=n?i:this.height-i,c=r&&r*this.distanceScales.unitsPerMeter[2],l=Yg([s,a,o],this.pixelUnprojectionMatrix,c),[u,h,f]=this.unprojectPosition(l);return Number.isFinite(o)?[u,h,f]:Number.isFinite(r)?[u,h,r]:[u,h]}projectPosition(e){const[n,r]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,s]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,s]}projectFlat(e){if(this.isGeospatial){const n=Gl(e);return n[1]=Gn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Di(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),s=this.unproject([this.width,0],n),i=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],s[0],i[0],o[0]),Math.min(r[1],s[1],i[1],o[1]),Math.max(r[0],s[0],i[0],o[0]),Math.max(r[1],s[1],i[1],o[1])]}getDistanceScales(e){return e?Zd({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:s=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,bN(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=Gx({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Zd({latitude:r,longitude:n}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:i,modelMatrix:o}=e;let a=yy;if(i&&(a=o?new Q(o).transformAsVector(i,[]):i),this.isGeospatial){const c=this.projectPosition([n,r,0]);this.center=new M(a).scale(this.distanceScales.unitsPerMeter).add(c)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=PN,projectionMatrix:r=null,orthographic:s=!1,fovyRadians:i,fovy:o=75,near:a=.1,far:c=1e3,padding:l=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Q().multiplyRight(n).translate(new M(this.center).negate()),this.projectionMatrix=r||xN({width:this.width,height:this.height,orthographic:s,fovyRadians:i||o*BN,focalDistance:u,padding:l,near:a,far:c});const h=Ro();gs(h,h,this.projectionMatrix),gs(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=$d([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=RN(this.viewMatrixInverse);const f=Ro(),p=Ro();jg(f,f,[this.width/2,-this.height/2,1]),Wl(f,f,[1,-1,0]),gs(p,f,this.viewProjectionMatrix),this.pixelProjectionMatrix=p,this.pixelUnprojectionMatrix=$d(Ro(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ie.warn("Pixel project matrix not invertible")()}}ku.displayName="Viewport";const gv=ku;class Aa extends gv{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:s=0,pitch:i=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:c=1.01,nearZ:l,farZ:u,orthographic:h=!1,projectionMatrix:f,repeat:p=!1,worldOffset:m=0,position:y,padding:w,legacyMeterSizes:_=!1}=e;let{width:g,height:T,altitude:C=1.5}=e;const I=Math.pow(2,s);g=g||1,T=T||1;let P,x=null;if(f)C=f[5]/2,P=$l(C);else{e.fovy?(P=e.fovy,C=hv(P)):P=$l(C);let D;if(w){const{top:F=0,bottom:X=0}=w;D=[0,Gn((F+T-X)/2,0,T)-T/2]}x=Kx({width:g,height:T,scale:I,center:y&&[0,0,y[2]*Kh(n)],offset:D,pitch:i,fovy:P,nearZMultiplier:a,farZMultiplier:c}),Number.isFinite(l)&&(x.near=l),Number.isFinite(u)&&(x.far=u)}let N=$x({height:T,pitch:i,bearing:o,scale:I,altitude:C});m&&(N=new Q().translate([512*m,0,0]).multiplyLeft(N)),super({...e,width:g,height:T,viewMatrix:N,longitude:r,latitude:n,zoom:s,...x,fovy:P,focalDistance:C}),this.latitude=n,this.longitude=r,this.zoom=s,this.pitch=i,this.bearing=o,this.altitude=C,this.fovy=P,this.orthographic=h,this._subViewports=p?[]:null,this._pseudoMeters=_,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let s=n;s<=r;s++){const i=s?new Aa({...this,worldOffset:s}):this;this._subViewports.push(i)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),s=(e[2]||0)*Kh(e[1]);return[n,r,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),s=(e[2]||0)/Kh(r);return[n,r,s]}addMetersToLngLat(e,n){return uv(e,n)}panByPosition(e,n){const r=Yg(n,this.pixelUnprojectionMatrix),s=this.projectFlat(e),i=ny([],s,nO([],r)),o=ny([],this.center,i),[a,c]=this.unprojectFlat(o);return{longitude:a,latitude:c}}getBounds(e={}){const n=qx(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:s}=this,{longitude:i,latitude:o,zoom:a}=Yx({width:r,height:s,bounds:e,...n});return new Aa({width:r,height:s,longitude:i,latitude:o,zoom:a})}}Aa.displayName="WebMercatorViewport";const _v=Aa,Ty=[0,0,0];function Jh(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof _v){const[s,i,o=0]=t,a=e.getDistanceScales([s,i]);r[2]=o*a.unitsPerMeter[2]}return r}function NN(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:s,fromCoordinateSystem:i,fromCoordinateOrigin:o}=t;return s===Z.DEFAULT&&(s=e.isGeospatial?Z.LNGLAT:Z.CARTESIAN),i===void 0&&(i=s),o===void 0&&(o=r),{viewport:e,coordinateSystem:s,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:i,fromCoordinateOrigin:o}}function mv(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:s,offsetMode:i}){let[o,a,c=0]=t;switch(n&&([o,a,c]=xa([],[o,a,c,1],n)),r){case Z.LNGLAT:return Jh([o,a,c],e,i);case Z.LNGLAT_OFFSETS:return Jh([o+s[0],a+s[1],c+(s[2]||0)],e,i);case Z.METER_OFFSETS:return Jh(uv(s,[o,a,c]),e,i);case Z.CARTESIAN:default:return e.isGeospatial?[o+s[0],a+s[1],c+s[2]]:e.projectPosition([o,a,c])}}function FN(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:s,modelMatrix:i,fromCoordinateSystem:o,fromCoordinateOrigin:a}=NN(e),{autoOffset:c=!0}=e,{geospatialOrigin:l=Ty,shaderCoordinateOrigin:u=Ty,offsetMode:h=!1}=c?cv(n,r,s):{},f=mv(t,{viewport:n,modelMatrix:i,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});if(h){const p=n.projectPosition(l||u);pO(f,f,p)}return f}let DN=1,UN=1;class Av{constructor(){d(this,"time",0);d(this,"channels",new Map);d(this,"animations",new Map);d(this,"playing",!1);d(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:s=1,repeat:i=1}=e,o=DN++,a={time:0,delay:n,duration:r,rate:s,repeat:i};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const s of n)this._setChannelTime(s,this.time);const r=this.animations.values();for(const s of r){const{animation:i,channel:o}=s;i.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=UN++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,s=e.duration*e.repeat;r>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}let kN=0;const LN={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Ai.stats.get(`animation-loop-${kN++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class VN{constructor(e){d(this,"device",null);d(this,"canvas",null);d(this,"props");d(this,"animationProps",null);d(this,"timeline",null);d(this,"stats");d(this,"cpuTime");d(this,"gpuTime");d(this,"frameRate");d(this,"display");d(this,"needsRedraw","initialized");d(this,"_initialized",!1);d(this,"_running",!1);d(this,"_animationFrameId",null);d(this,"_nextFramePromise",null);d(this,"_resolveNextFrame",null);d(this,"_cpuStartTime",0);if(this.props={...LN,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new Xi({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=$P(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(KP(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,n;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(n=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:n.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var i,o,a,c;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const s=(c=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:c.canvas;return s&&s.clientHeight?r=s.clientWidth/s.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class Ey{constructor(e){d(this,"id");d(this,"userData",{});d(this,"topology");d(this,"bufferLayout",[]);d(this,"vertexCount");d(this,"indices");d(this,"attributes");this.id=e.id||Xr("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&oe(this.indices.usage===Se.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function HN(t,e){if(e instanceof Ey)return e;const n=zN(t,e),{attributes:r,bufferLayout:s}=jN(t,e);return new Ey({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:n,attributes:r})}function zN(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:Se.INDEX,data:n})}function jN(t,e){const n=[],r={};for(const[i,o]of Object.entries(e.attributes)){let a=i;switch(i){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}r[a]=t.createBuffer({data:o.value,id:`${i}-buffer`});const{value:c,size:l,normalized:u}=o;n.push({name:a,format:zP(c,l,u)})}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:s}}class WN{constructor(e){d(this,"modules");d(this,"moduleUniforms");d(this,"moduleBindings");d(this,"moduleUniformsChanged");const n=Du(Object.values(e).filter(r=>r.dependencies));for(const r of n)e[r.name]=r;k.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,s]of Object.entries(e)){const i=r;this.moduleUniforms[i]=s.defaultUniforms||{},this.moduleBindings[i]={}}}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const s=r,i=e[s],o=this.modules[s];if(!o){k.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[s],c=this.moduleBindings[s],l=((n=o.getUniforms)==null?void 0:n.call(o,i,a))||i,{uniforms:u,bindings:h}=Fg(l);this.moduleUniforms[s]={...a,...u},this.moduleBindings[s]={...c,...h}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,s]of Object.entries(this.moduleUniforms))for(const[i,o]of Object.entries(s))e[`${r}.${i}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[i],value:String(o)};return e}}const gu=class gu{constructor(e){d(this,"device");d(this,"_hashCounter",0);d(this,"_hashes",{});d(this,"_renderPipelineCache",{});d(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new gu(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...xi.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const s=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});s.hash=r,this._renderPipelineCache[r]={pipeline:s,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...Vl.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const s=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});s.hash=r,this._computePipelineCache[r]={pipeline:s,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof Vl?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=this._getHash(e.vs.source),r=e.fs?this._getHash(e.fs.source):0,s="-",i=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${s}BL${i}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${s}T${e.topology}P${o}BL${i}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};d(gu,"defaultProps",{...xi.defaultProps});let ep=gu;const _u=class _u{constructor(e){d(this,"device");d(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new _u(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:s,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};d(_u,"defaultProps",{...Ul.defaultProps});let tp=_u;function XN(t,e){var s;const n={},r="Values";if(t.attributes.length===0&&!((s=t.varyings)!=null&&s.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const i of t.attributes)if(i){const o=`${i.location} ${i.name}: ${i.type}`;n[`in ${o}`]={[r]:i.stepMode||"vertex"}}for(const i of t.varyings||[]){const o=`${i.location} ${i.name}`;n[`out ${o}`]={[r]:JSON.stringify(i.accessor)}}return n}let ke=null,qh=null;function GN(t,{id:e,minimap:n,opaque:r,top:s="0",left:i="0",rgbaScale:o=1}){ke||(ke=document.createElement("canvas"),ke.id=e,ke.title=e,ke.style.zIndex="100",ke.style.position="absolute",ke.style.top=s,ke.style.left=i,ke.style.border="blue 1px solid",ke.style.transform="scaleY(-1)",document.body.appendChild(ke),qh=ke.getContext("2d")),(ke.width!==t.width||ke.height!==t.height)&&(ke.width=t.width/2,ke.height=t.height/2,ke.style.width="400px",ke.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),c=qh.createImageData(t.width,t.height),l=0;for(let u=0;u<a.length;u+=4)c.data[l+u+0]=a[u+0]*o,c.data[l+u+1]=a[u+1]*o,c.data[l+u+2]=a[u+2]*o,c.data[l+u+3]=r?255:a[u+3]*o;qh.putImageData(c,0,0)}const ks=2,$N=1e4,mu=class mu{constructor(e,n){d(this,"device");d(this,"id");d(this,"source");d(this,"vs");d(this,"fs");d(this,"pipelineFactory");d(this,"shaderFactory");d(this,"userData",{});d(this,"parameters");d(this,"topology");d(this,"bufferLayout");d(this,"isInstanced");d(this,"instanceCount",0);d(this,"vertexCount");d(this,"indexBuffer",null);d(this,"bufferAttributes",{});d(this,"constantAttributes",{});d(this,"bindings",{});d(this,"uniforms",{});d(this,"vertexArray");d(this,"transformFeedback",null);d(this,"pipeline");d(this,"shaderInputs");d(this,"_uniformStore");d(this,"_attributeInfos",{});d(this,"_gpuGeometry",null);d(this,"_getModuleUniforms");d(this,"props");d(this,"_pipelineNeedsUpdate","newly created");d(this,"_needsRedraw","initializing");d(this,"_destroyed",!1);d(this,"_lastDrawTimestamp",-1);d(this,"_lastLogTime",0);d(this,"_logOpen",!1);d(this,"_drawCount",0);var a,c,l,u;this.props={...mu.defaultProps,...n},n=this.props,this.id=n.id||Xr("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(h=>[h.name,h]))||[]);this.setShaderInputs(n.shaderInputs||new WN(r));const s=KN(e),i=(((c=this.props.modules)==null?void 0:c.length)>0?this.props.modules:(l=this.shaderInputs)==null?void 0:l.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(u=this.props).shaderLayout||(u.shaderLayout=P2(this.props.source));const{source:h,getUniforms:f}=this.props.shaderAssembler.assembleShader({platformInfo:s,...this.props,modules:i});this.source=h,this._getModuleUniforms=f}else{const{vs:h,fs:f,getUniforms:p}=this.props.shaderAssembler.assembleShaderPair({platformInfo:s,...this.props,modules:i});this.vs=h,this.fs=f,this._getModuleUniforms=p}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||ep.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||tp.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniforms(n.uniforms),n.moduleSettings&&this.updateModuleSettings(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let n;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),Fl(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,s=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&HN(this.device,e);n&&(this.setTopology(n.topology||"triangle-list"),this.bufferLayout=Sy(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)),this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?Sy(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){zd(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new HP(this.shaderInputs.modules);for(const n of Object.keys(this.shaderInputs.modules)){const r=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){e.indices&&k.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[r,s]of Object.entries(e)){const i=this.bufferLayout.find(c=>Cy(c).includes(r));if(!i){k.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const o=Cy(i);let a=!1;for(const c of o){const l=this._attributeInfos[c];l&&(this.vertexArray.setBuffer(l.location,s),a=!0)}!a&&!((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)&&k.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,s]of Object.entries(e)){const i=this._attributeInfos[r];i?this.vertexArray.setConstantWebGL(i.location,s):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||k.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){Fl(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:n,uniforms:r}=Fg(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof Dl?e=Math.max(e,n.texture.updateTimestamp):n instanceof Se||n instanceof vt?e=Math.max(e,n.updateTimestamp):n instanceof kl||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(s=>s.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(k.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let s=null;this.source?s=r:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:r,fs:s}),this._attributeInfos=vC(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=k.level>3?0:$N;k.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,k.group(ks,`>>> DRAWING MODEL ${this.id}`,{collapsed:k.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=XN(this.pipeline.shaderLayout,this.id);k.table(ks,e)();const n=this.shaderInputs.getDebugTable();for(const[s,i]of Object.entries(this.uniforms))n[s]={value:i};k.table(ks,n)();const r=this._getAttributeDebugTable();k.table(ks,this._attributeInfos)(),k.table(ks,r)(),k.groupEnd(ks)(),this._logOpen=!1}}_logFramebuffer(e){const n=k.get("framebuffer");if(this._drawCount++,!n||this._drawCount++>3&&this._drawCount%60)return;const r=e.props.framebuffer;r&&GN(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos))e[r.location]={name:n,type:r.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[r.location],r.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=bC(n);return(e instanceof Se?new r(e.debugData):e).toString()}};d(mu,"defaultProps",{...xi.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Nl.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let kr=mu;function Sy(t,e){const n=[...t];for(const r of e){const s=n.findIndex(i=>i.name===r.name);s<0?n.push(r):n[s]=r}return n}function KN(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function Cy(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(n=>n.attribute):[t.name]}class ya{constructor(e,n=kr.defaultProps){d(this,"device");d(this,"model");d(this,"transformFeedback");oe(ya.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new kr(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||jB(),topology:n.topology||"point-list",...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(n instanceof Se)return n.readAsync();const{buffer:r,byteOffset:s=0,byteLength:i=r.byteLength}=n;return r.readAsync(s,i)}}class Ei{constructor(e){d(this,"id");d(this,"topology");d(this,"vertexCount");d(this,"indices");d(this,"attributes");d(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:s=null}=e;this.id=e.id||Xr("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[i,o]of Object.entries(n)){const a=ArrayBuffer.isView(o)?{value:o}:o;oe(ArrayBuffer.isView(a.value),`${this._print(i)}: must be typed array or object with value as typed array`),(i==="POSITION"||i==="positions")&&!a.size&&(a.size=3),i==="indices"?(oe(!this.indices),this.indices=a):this.attributes[i]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const s of Object.values(e)){const{value:i,size:o,constant:a}=s;!a&&i&&o>=1&&(r=Math.min(r,i.length/o))}return oe(Number.isFinite(r)),r}}class Kl{constructor(e={}){d(this,"id");d(this,"matrix",new Q);d(this,"display",!0);d(this,"position",new M);d(this,"rotation",new M);d(this,"scale",new M(1,1,1));d(this,"userData",{});d(this,"props",{});const{id:n}=e;this.id=n||Xr(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return oe(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return oe(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return oe(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e,n=!0){n?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:n,rotation:r,scale:s,update:i=!0}=e;return n&&this.setPosition(n),r&&this.setRotation(r),s&&this.setScale(s),i&&this.updateMatrix(),this}updateMatrix(){const e=this.position,n=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(n),this.matrix.scale(r),this}update(e={}){const{position:n,rotation:r,scale:s}=e;return n&&this.setPosition(n),r&&this.setRotation(r),s&&this.setScale(s),this.updateMatrix(),this}getCoordinateUniforms(e,n){oe(e),n=n||this.matrix;const r=new Q(e).multiplyRight(n),s=r.invert(),i=s.transpose();return{viewMatrix:e,modelMatrix:n,objectMatrix:n,worldMatrix:r,worldInverseMatrix:s,worldInverseTransposeMatrix:i}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Si extends Kl{constructor(n={}){n=Array.isArray(n)?{children:n}:n;const{children:r=[]}=n;k.assert(r.every(s=>s instanceof Kl),"every child must an instance of ScenegraphNode");super(n);d(this,"children");this.children=r}getBounds(){const n=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,{worldMatrix:s})=>{const i=r.getBounds();if(!i)return;const[o,a]=i,c=new M(o).add(a).divide([2,2,2]);s.transformAsPoint(c,c);const l=new M(a).subtract(o).divide([2,2,2]);s.transformAsVector(l,l);for(let u=0;u<8;u++){const h=new M(u&1?-1:1,u&2?-1:1,u&4?-1:1).multiply(l).add(c);for(let f=0;f<3;f++)n[0][f]=Math.min(n[0][f],h[f]),n[1][f]=Math.max(n[1][f],h[f])}}),Number.isFinite(n[0][0])?n:null}destroy(){this.children.forEach(n=>n.destroy()),this.removeAll(),super.destroy()}add(...n){for(const r of n)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(n){const r=this.children,s=r.indexOf(n);return s>-1&&r.splice(s,1),this}removeAll(){return this.children=[],this}traverse(n,{worldMatrix:r=new Q}={}){const s=new Q(r).multiplyRight(this.matrix);for(const i of this.children)i instanceof Si?i.traverse(n,{worldMatrix:s}):n(i,{worldMatrix:s})}}class np extends Kl{constructor(n){super(n);d(this,"model");d(this,"bounds",null);d(this,"managedResources");this.model=n.model,this.managedResources=n.managedResources||[],this.bounds=n.bounds||null,this.setProps(n)}getBounds(){return this.bounds}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(n=>n.destroy()),this.managedResources=[]}draw(n){return this.model.draw(n)}}const YN={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class yv extends qg{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:s,onViewportActive:i,pickingFBO:o,deviceRect:{x:a,y:c,width:l,height:u},cullRect:h,effects:f,pass:p="picking",pickZ:m,moduleParameters:y}){this.pickZ=m;const w=this._resetColorEncoder(m),_=[a,c,l,u],g=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:s,onViewportActive:i,cullRect:h,effects:f==null?void 0:f.filter(C=>C.useInPicking),pass:p,isPicking:!0,moduleParameters:y,clearColor:[0,0,0,0],colorMask:15,scissorRect:_});return this._colorEncoderState=null,{decodePickingColor:w&&qN.bind(null,w),stats:g}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,n,r){const s={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:i,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?s.blend=!1:i&&o.includes("draw")&&(Object.assign(s,YN),s.blend=!0,s.blendColor=JN(this._colorEncoderState,e,r)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function JN(t,e,n){const{byLayer:r,byAlpha:s}=t;let i,o=r.get(e);return o?(o.viewports.push(n),i=o.a):(i=r.size+1,i<=255?(o={a:i,layer:e,viewports:[n]},r.set(e,o),s[i]=o):(ie.warn("Too many pickable layers, only picking the first 255")(),i=0)),[0,0,0,i/255]}function qN(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const js={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Yl=Symbol.for("component"),Or=Symbol.for("propTypes"),Qh=Symbol.for("deprecatedProps"),Ci=Symbol.for("asyncPropDefaults"),Ss=Symbol.for("asyncPropOriginal"),Sr=Symbol.for("asyncPropResolved");function Qg(t,e=()=>!0){return Array.isArray(t)?Tv(t,e,[]):e(t)?[t]:[]}function Tv(t,e,n){let r=-1;for(;++r<t.length;){const s=t[r];Array.isArray(s)?Tv(s,e,n):e(s)&&n.push(s)}return n}function QN({target:t,source:e,start:n=0,count:r=1}){const s=e.length,i=r*s;let o=0;for(let a=n;o<s;o++)t[a++]=e[o];for(;o<i;)o<i-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+i-o),o=i);return t}class ZN{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let s=e;typeof e=="string"&&(s=Dr(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(i=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=i)}).catch(i=>{this._loadCount===r&&(this.isLoaded=!0,this._error=i||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const i of this._subscribers)i.onChange(this.getData())}}class eF{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:s=!0}){let i=this._resources[e];i?i.setData(n,r):(i=new ZN(e,n,this._context),this._resources[e]=i),i.persistent=s}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const s=n[r],i=this._resources[s.resourceId];i&&i.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:s="default"}){const{_resources:i,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),i[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=i[e];if(this._track(r,s,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,s){const i=this._consumers,o=i[e]=i[e]||{};let a=o[n];const c=a&&a.resourceId&&this._resources[a.resourceId];c&&(c.unsubscribe(a),this.prune()),r&&(a?(a.onChange=s,a.resourceId=r.id):a={onChange:s,resourceId:r.id},o[n]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const tF="layerManager.setLayers",nF="layerManager.activateViewport";class rF{constructor(e,n){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Je(nF,this,a),a&&(this.context.viewport=a)};const{deck:r,stats:s,viewport:i,timeline:o}=n||{};this.layers=[],this.resourceManager=new eF({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:hN(),defaultShaderModules:[],renderPass:void 0,stats:s||new Xi({id:"deck.gl"}),viewport:i||new gv({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Av,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const s=r.getNeedsRedraw(e);n=n||s}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Je(tF,this,n,e),this._lastRenderedLayers=e;const r=Qg(e,Boolean);for(const s of r)s.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(s=>s.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?ie.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(n,r,s),this._finalizeOldLayers(r);let i=!1;for(const o of s)if(o.hasUniformTransition()){i=`Uniform transition in ${o}`;break}this._needsUpdate=i,this.layers=s}_updateSublayersRecursively(e,n,r){for(const s of e){s.context=this.context;const i=n[s.id];i===null&&ie.warn(`Multiple new layers with same id ${s.id}`)(),n[s.id]=null;let o=null;try{this._debug&&i!==s&&s.validateProps(),i?(this._transferLayerState(i,s),this._updateLayer(s)):this._initializeLayer(s),r.push(s),o=s.isComposite?s.getSubLayers():null}catch(a){this._handleError("matching",a,s)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=js.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=js.MATCHED,n!==e&&(e.lifecycle=js.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=js.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=js.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function tn(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!tn(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(const i of r)if(!e.hasOwnProperty(i)||!tn(t[i],e[i],n-1))return!1;return!0}return!1}class sF{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),s={x:e[0],y:e[1]};for(let i=r.length-1;i>=0;--i){const o=r[i];if(o.containsPixel(s)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Qg(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!tn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ie.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:i=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:i,width:this.width,height:this.height})}})}_updateController(e,n,r,s){const i=e.controller;if(i&&r){const o={...n,...i,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!s||s.constructor!==i.type)&&(s=this._createController(e,o)),s&&s.setProps(o),s}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let s=e.length;s--;){const i=e[s],o=this.getViewState(i),a=i.makeViewport({viewState:o,width:this.width,height:this.height});let c=n[i.id];const l=!!i.controller;l&&!c&&(r=!0),(r||!l)&&c&&(c.finalize(),c=null),this.controllers[i.id]=this._updateController(i,o,a,c),a&&this._viewports.unshift(a)}for(const s in n){const i=n[s];i&&!this.controllers[s]&&i.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,s)=>!e[s].equals(n[s]))}}const iF=/([0-9]+\.?[0-9]*)(%|px)/;function cr(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=iF.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function lr(t,e){return t.relative?Math.round(t.position*e):t.position}class Ui{constructor(e){const{id:n,x:r=0,y:s=0,width:i="100%",height:o="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=cr(r),this._y=cr(s),this._width=cr(i),this._height=cr(o),this._padding=a&&{left:cr(a.left||0),right:cr(a.right||0),top:cr(a.top||0),bottom:cr(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&tn(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const s=this.getDimensions({width:e,height:n});return!s.height||!s.width?null:new this.ViewportType({...r,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:lr(this._x,e),y:lr(this._y,n),width:lr(this._width,e),height:lr(this._height,n)};return this._padding&&(r.padding={left:lr(this._padding.left,e),top:lr(this._padding.top,n),right:lr(this._padding.right,e),bottom:lr(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Lu{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:s}=this;this._handle=r.addChannel({delay:r.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const vy=()=>{},rp={BREAK:1,SNAP_TO_END:2,IGNORE:3},oF=t=>t,aF=rp.BREAK;class cF{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:s,startProps:i,endProps:o,duration:a,easing:c}}=n,l=c(r/a),u=s.interpolateProps(i,o,l);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Lu(e.timeline),this.onViewStateChange=e.onViewStateChange||vy,this.onStateChange=e.onStateChange||vy}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let s=r;if(this.transition.inProgress){const{interruption:i,endProps:o}=this.transition.settings;s={...r,...i===rp.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(s,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===rp.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),s=this.getControllerState(n).shortestPathFrom(r),i=n.transitionInterpolator,o=i.getDuration?i.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=i.initializeProps(e,s);this.propsInTransition={};const c={duration:o,easing:n.transitionEasing||oF,interpolator:i,interruption:n.transitionInterruption||aF,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(c),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function Ze(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class lF{constructor(e){const{compare:n,extract:r,required:s}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=s}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!on(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},s={};for(const i of this._propsToExtract)(i in e||i in n)&&(r[i]=e[i],s[i]=n[i]);return this._checkRequiredProps(r),this._checkRequiredProps(s),{start:r,end:s}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];Ze(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const uF=["longitude","latitude","zoom","bearing","pitch"],hF=["longitude","latitude","zoom"];class Ev extends lF{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:uF,required:hF},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:s,around:i}=this.opts;if(s&&i){const o=s(e),a=s(n),c=o.unproject(i);r.start.around=i,Object.assign(r.end,{around:a.project(c),aroundPosition:c,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const s={};for(const i of this._propsToExtract)s[i]=jl(e[i]||0,n[i]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const i=this.opts.makeViewport({...n,...s});Object.assign(s,i.panByPosition(n.aroundPosition,jl(e.around,n.around,r)))}return s}}const ur={transitionDuration:0},fF=300,vc=t=>1-(1-t)*(1-t),Ls={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Jr={};class dF{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new cF({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:s}=e;return[s.x-n,s.y-r]}isPointInBounds(e,n){const{width:r,height:s}=this.props;if(n&&n.handled)return!1;const i=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=s;return i&&n&&n.stopPropagation(),i}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?fF:0;const{scrollZoom:r=!0,dragPan:s=!0,dragRotate:i=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:c=!1,keyboard:l=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(Ls.WHEEL,u&&r),this.toggleEvents(Ls.PAN,u),this.toggleEvents(Ls.PINCH,u&&(a||c)),this.toggleEvents(Ls.TRIPLE_PAN,u&&c),this.toggleEvents(Ls.DOUBLE_TAP,u&&o),this.toggleEvents(Ls.KEYBOARD,u&&l),this.scrollZoom=r,this.dragPan=s,this.dragRotate=i,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=c,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const s={...e.getViewportProps(),...n},i=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),i){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const s=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(s,ur,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,ur,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],i=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:vc},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,ur,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],i=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:vc},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:i}=e;let o=2/(1+Math.exp(-Math.abs(i*r)));i<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,ur,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,ur,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),s=[r[0],r[1]+=e.velocityY*n/2],i=this.controllerState.rotate({pos:s});this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:vc},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Jr._startPinchRotation=e.rotation,Jr._lastPinchEvent=e,this.updateViewport(r,ur,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,s=this.getCenter(e);n=n.zoom({pos:s,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:Jr._startPinchRotation-r})}return this.updateViewport(n,ur,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Jr._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=Jr;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const s=this.getCenter(e);let i=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),c=Math.pow(2,o+a*n/2);i=i.zoom({pos:s,scale:c}).zoomEnd(),this.updateViewport(i,{...this._getTransitionProps({around:s}),transitionDuration:n,transitionEasing:vc},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Jr._startPinchRotation=null,Jr._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(s,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:s,rotateSpeedX:i,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let c;const l={};switch(e.srcEvent.code){case"Minus":c=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),l.isZooming=!0;break;case"Equal":c=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),l.isZooming=!0;break;case"ArrowLeft":n?(c=a.rotateLeft(i),l.isRotating=!0):(c=a.moveLeft(s),l.isPanning=!0);break;case"ArrowRight":n?(c=a.rotateRight(i),l.isRotating=!0):(c=a.moveRight(s),l.isPanning=!0);break;case"ArrowUp":n?(c=a.rotateUp(o),l.isRotating=!0):(c=a.moveUp(s),l.isPanning=!0);break;case"ArrowDown":n?(c=a.rotateDown(o),l.isRotating=!0):(c=a.moveDown(s),l.isPanning=!0);break;default:return!1}return this.updateViewport(c,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?ur:e?{...n,transitionInterpolator:new Ev({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class pF{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const wy=5,gF=1.2;class _F extends pF{constructor(e){const{width:n,height:r,latitude:s,longitude:i,zoom:o,bearing:a=0,pitch:c=0,altitude:l=1.5,position:u=[0,0,0],maxZoom:h=20,minZoom:f=0,maxPitch:p=60,minPitch:m=0,startPanLngLat:y,startZoomLngLat:w,startRotatePos:_,startBearing:g,startPitch:T,startZoom:C,normalize:I=!0}=e;Ze(Number.isFinite(i)),Ze(Number.isFinite(s)),Ze(Number.isFinite(o)),super({width:n,height:r,latitude:s,longitude:i,zoom:o,bearing:a,pitch:c,altitude:l,maxZoom:h,minZoom:f,maxPitch:p,minPitch:m,normalize:I,position:u},{startPanLngLat:y,startZoomLngLat:w,startRotatePos:_,startBearing:g,startPitch:T,startZoom:C}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const i=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:s,startBearing:i,startPitch:o}=this.getState();if(!s||i===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,s,o,i):a={bearing:i+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:s,startZoomLngLat:i}=this.getState();if(i||(s=this.getViewportProps().zoom,i=this._unproject(n)||this._unproject(e)),!i)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let c=s+Math.log2(r);c=Gn(c,a,o);const l=this.makeViewport({...this.getViewportProps(),zoom:c});return this._getUpdatedState({zoom:c,...l.panByPosition(i,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:s,longitude:i}=r;return Math.abs(s-n.bearing)>180&&(r.bearing=s<0?s+360:s-360),Math.abs(i-n.longitude)>180&&(r.longitude=i<0?i+360:i-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:s}=e;e.zoom=Gn(s,r,n);const{maxPitch:i,minPitch:o,pitch:a}=e;e.pitch=Gn(a,o,i);const{normalize:c=!0}=e;return c&&Object.assign(e,Qx(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,s){const i=e[0]-n[0],o=e[1]-n[1],a=e[1],c=n[1],{width:l,height:u}=this.getViewportProps(),h=i/l;let f=0;o>0?Math.abs(u-c)>wy&&(f=o/(c-u)*gF):o<0&&c>wy&&(f=1-a/c),f=Gn(f,-1,1);const{minPitch:p,maxPitch:m}=this.getViewportProps(),y=s+180*h;let w=r;return f>0?w=r+f*(m-r):f<0&&(w=r-f*(p-r)),{pitch:w,bearing:y}}}class mF extends dF{constructor(){super(...arguments),this.ControllerState=_F,this.transition={transitionDuration:300,transitionInterpolator:new Ev({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Sv extends Ui{constructor(e={}){super(e)}get ViewportType(){return _v}get ControllerType(){return mF}}Sv.displayName="MapView";const AF=Sv,yF=new pv;function TF(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class EF{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(s=>TF(s,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(tn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const s of this.effects)n[s.id]=s;const r=[];for(const s of e){const i=n[s.id];let o=s;i&&i!==s?i.setProps?(i.setProps(s.props),o=i):i.cleanup(this._context):i||s.setup(this._context),r.push(o),delete n[s.id]}for(const s in n)n[s].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(s=>s instanceof pv)||this._resolvedEffects.push(yF),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class SF extends qg{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const CF="deckRenderer.renderLayers";class vF{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new SF(e),this.pickLayersPass=new yv(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const s=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const i=n.render({...r,target:s});r.effects&&this._postRender(r.effects,r),this.renderCount++,Je(CF,this,i,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[s]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,s={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const i of e)if(i.postRender){s.target=i.id===this.lastPostProcessEffect?n.target:void 0;const o=i.postRender(s);s.inputBuffer=o,s.swapBuffer=o===r[0]?r[1]:r[0]}}}const wF={pickedColor:null,pickedObjectIndex:-1};function RF({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:s,deviceRect:i}){const{x:o,y:a,width:c,height:l}=i;let u=s*s,h=-1,f=0;for(let p=0;p<l;p++){const m=p+a-r,y=m*m;if(y>u)f+=4*c;else for(let w=0;w<c;w++){if(t[f+3]-1>=0){const g=w+o-n,T=g*g+y;T<=u&&(u=T,h=f)}f+=4}}if(h>=0){const p=t.slice(h,h+4),m=e(p);if(m){const y=Math.floor(h/4/c),w=h/4-y*c;return{...m,pickedColor:p,pickedX:o+w,pickedY:a+y}}ie.error("Picked non-existent layer. Is picking buffer corrupt?")()}return wF}function bF({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const i=t.slice(r,r+4),o=i.join(",");if(!n.has(o)){const a=e(i);a?n.set(o,{...a,color:i}):ie.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function Cv({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:s,z:i}){let o=e[0];e.length>1&&(o=MF((t==null?void 0:t.pickedViewports)||e,{x:r,y:s}));let a;if(o){const c=[r-o.x,s-o.y];i!==void 0&&(c[2]=i),a=o.unproject(c)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:s,pixel:[r,s],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function IF(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:s}=t,{pickedColor:i,pickedLayer:o,pickedObjectIndex:a}=e,c=o?[o]:[];if(r==="hover"){const h=n.index,f=n.layerId,p=o?o.props.id:null;if(p!==f||a!==h){if(p!==f){const m=s.find(y=>y.props.id===f);m&&c.unshift(m)}n.layerId=p,n.index=a,n.info=null}}const l=Cv(t),u=new Map;return u.set(null,l),c.forEach(h=>{let f={...l};h===o&&(f.color=i,f.index=a,f.picked=!0),f=vv({layer:h,info:f,mode:r});const p=f.layer;h===o&&r==="hover"&&(n.info=f),u.set(p.id,f),r==="hover"&&p.updateAutoHighlight(f)}),u}function vv({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function MF(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class BF{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new yv(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:s},i=this.lastPickedInfo.info){const o=i&&i.layer&&i.layer.id,a=i&&i.viewport&&i.viewport.id,c=o?r.find(f=>f.id===o):null,l=a&&s.find(f=>f.id===a)||s[0],u=l&&l.unproject([e-l.x,n-l.y]);return{...i,...{x:e,y:n,viewport:l,coordinate:u,layer:c}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const{canvas:e}=this.device.getCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:s,y:i,radius:o=0,depth:a=1,mode:c="query",unproject3D:l,onViewportActive:u,effects:h}){const f=this.device.canvasContext.cssToDeviceRatio(),p=this._getPickable(e);if(!p||r.length===0)return{result:[],emptyInfo:Cv({viewports:r,x:s,y:i,pixelRatio:f})};this._resizeBuffer();const m=this.device.canvasContext.cssToDevicePixels([s,i],!0),y=[m.x+Math.floor(m.width/2),m.y+Math.floor(m.height/2)],w=Math.round(o*f),{width:_,height:g}=this.pickingFBO,T=this._getPickingRect({deviceX:y[0],deviceY:y[1],deviceRadius:w,deviceWidth:_,deviceHeight:g}),C={x:s-o,y:i-o,width:o*2+1,height:o*2+1};let I;const P=[],x=new Set;for(let N=0;N<a;N++){let D;if(T){const X=this._drawAndSample({layers:p,views:n,viewports:r,onViewportActive:u,deviceRect:T,cullRect:C,effects:h,pass:`picking:${c}`});D=RF({...X,deviceX:y[0],deviceY:y[1],deviceRadius:w,deviceRect:T})}else D={pickedColor:null,pickedObjectIndex:-1};let F;if(D.pickedLayer&&l&&this.depthFBO){const{pickedColors:X}=this._drawAndSample({layers:[D.pickedLayer],views:n,viewports:r,onViewportActive:u,deviceRect:{x:D.pickedX,y:D.pickedY,width:1,height:1},cullRect:C,effects:h,pass:`picking:${c}:z`},!0);X[3]&&(F=X[0])}D.pickedLayer&&N+1<a&&(x.add(D.pickedLayer),D.pickedLayer.disablePickingIndex(D.pickedObjectIndex)),I=IF({pickInfo:D,lastPickedInfo:this.lastPickedInfo,mode:c,layers:p,viewports:r,x:s,y:i,z:F,pixelRatio:f});for(const X of I.values())X.layer&&P.push(X);if(!D.pickedColor)break}for(const N of x)N.restorePickingColors();return{result:P,emptyInfo:I.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:s,y:i,width:o=1,height:a=1,mode:c="query",maxObjects:l=null,onViewportActive:u,effects:h}){const f=this._getPickable(e);if(!f||r.length===0)return[];this._resizeBuffer();const p=this.device.canvasContext.cssToDeviceRatio(),m=this.device.canvasContext.cssToDevicePixels([s,i],!0),y=m.x,w=m.y+m.height,_=this.device.canvasContext.cssToDevicePixels([s+o,i+a],!0),g=_.x+_.width,T=_.y,C={x:y,y:T,width:g-y,height:w-T},I=this._drawAndSample({layers:f,views:n,viewports:r,onViewportActive:u,deviceRect:C,cullRect:{x:s,y:i,width:o,height:a},effects:h,pass:`picking:${c}`}),P=bF(I),x=new Map,N=[],D=Number.isFinite(l);for(let F=0;F<P.length&&!(D&&N.length>=l);F++){const X=P[F];let q={color:X.pickedColor,layer:null,index:X.pickedObjectIndex,picked:!0,x:s,y:i,pixelRatio:p};q=vv({layer:X.pickedLayer,info:q,mode:c});const ee=q.layer.id;x.has(ee)||x.set(ee,new Set);const K=x.get(ee),He=q.object??q.index;K.has(He)||(K.add(He),N.push(q))}return N}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:s,deviceRect:i,cullRect:o,effects:a,pass:c},l=!1){const u=l?this.depthFBO:this.pickingFBO,h={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:s,pickingFBO:u,deviceRect:i,cullRect:o,effects:a,pass:c,pickZ:l,preRenderStats:{}};for(const g of a)g.useInPicking&&(h.preRenderStats[g.id]=g.preRender(h));const{decodePickingColor:f}=this.pickLayersPass.render(h),{x:p,y:m,width:y,height:w}=i,_=new(l?Float32Array:Uint8Array)(y*w*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:p,sourceY:m,sourceWidth:y,sourceHeight:w,target:_}),{pickedColors:_,decodePickingColor:f}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:s,deviceHeight:i}){const o=Math.max(0,e-r),a=Math.max(0,n-r),c=Math.min(s,e+r+1)-o,l=Math.min(i,n+r+1)-a;return c<=0||l<=0?null:{x:o,y:a,width:c,height:l}}}const PF={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},OF="top-left",Ry="__root";class xF{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!tn(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const s=n[r.id];s?s.viewId!==r.viewId||s.placement!==r.placement?(this._remove(s),this._add(r)):r!==s&&(s.setProps(r.props),r=s):this._add(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const s=n[r];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:n=null,placement:r=OF}=e,s=e.onAdd({deck:this.deck,viewId:n});s&&this._getContainer(n,r).append(s),e._element=s}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const r=e||Ry;let s=this.containers[r];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(o=this.parentElement)==null||o.append(s),this.containers[r]=s);let i=s.querySelector(`.${n}`);return i||(i=document.createElement("div"),i.className=n,i.style.position="absolute",i.style.zIndex="2",Object.assign(i.style,PF[n]),s.append(i)),i}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const s=this.lastViewports[r]||null,i=r===Ry||s,o=this.containers[r];i?(o.style.display="block",o.style.left=`${s?s.x:0}px`,o.style.top=`${s?s.y:0}px`,o.style.width=`${s?s.width:e}px`,o.style.height=`${s?s.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var i,o;const r=e.reduce((a,c)=>(a[c.id]=c,a),{}),{lastViewports:s}=this;for(const a of this.getWidgets()){const{viewId:c}=a;if(c){const l=r[c];l&&(a.onViewportChange&&!l.equals(s[c])&&a.onViewportChange(l),(i=a.onRedraw)==null||i.call(a,{viewports:[l],layers:n}))}else{if(a.onViewportChange)for(const l of e)l.equals(s[l.id])||a.onViewportChange(l);(o=a.onRedraw)==null||o.call(a,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,s;for(const i of this.getWidgets()){const{viewId:o}=i;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((s=i.onHover)==null||s.call(i,e,n))}}onEvent(e,n){var s,i;const r=Jd[n.type];if(r)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((s=e.viewport)==null?void 0:s.id))&&((i=o[r.handler])==null||i.call(o,e,n))}}}const NF={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class FF{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,NF),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const s=r(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,n,r){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var si;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(si||(si={}));const Zg={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Pe=(t,e,n)=>e?t.enable(n):t.disable(n),by=(t,e,n)=>t.hint(n,e),At=(t,e,n)=>t.pixelStorei(n,e),Iy=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},uo=(t,e,n)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(s,e)};function Zh(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const DF={3042:Pe,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Pe,2885:(t,e)=>t.cullFace(e),2929:Pe,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Pe,35723:by,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:Iy,36010:Iy,34964:uo,36662:uo,36663:uo,35053:uo,35055:uo,2886:(t,e)=>t.frontFace(e),33170:by,2849:(t,e)=>t.lineWidth(e),32823:Pe,32824:"polygonOffset",10752:"polygonOffset",35977:Pe,32926:Pe,32928:Pe,32938:"sampleCoverage",32939:"sampleCoverage",3089:Pe,3088:(t,e)=>t.scissor(...e),2960:Pe,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Pe,10754:Pe,12288:Pe,12289:Pe,12290:Pe,12291:Pe,12292:Pe,12293:Pe,12294:Pe,12295:Pe,3333:At,3317:At,37440:At,37441:At,37443:At,3330:At,3332:At,3331:At,3314:At,32878:At,3316:At,3315:At,32877:At,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Zh(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=Zh(e)&&e.length===3?[...e,...e]:e;const[n,r,s,i,o,a]=e;t.stencilFuncSeparate(1028,n,r,s),t.stencilFuncSeparate(1029,i,o,a)},stencilOp:(t,e)=>{e=Zh(e)&&e.length===3?[...e,...e]:e;const[n,r,s,i,o,a]=e;t.stencilOpSeparate(1028,n,r,s),t.stencilOpSeparate(1029,i,o,a)},viewport:(t,e)=>t.viewport(...e)};function we(t,e,n){return e[t]!==void 0?e[t]:n[t]}const UF={blendEquation:(t,e,n)=>t.blendEquationSeparate(we(32777,e,n),we(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(we(32969,e,n),we(32968,e,n),we(32971,e,n),we(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(we(32824,e,n),we(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(we(32938,e,n),we(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,we(2962,e,n),we(2967,e,n),we(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,we(34816,e,n),we(36003,e,n),we(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,we(2964,e,n),we(2965,e,n),we(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,we(34817,e,n),we(34818,e,n),we(34819,e,n))},My={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,s)=>t({32773:new Float32Array([e,n,r,s])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,s)=>t({32969:e,32968:n,32971:r,32970:s}),clearColor:(t,e,n,r,s)=>t({3106:new Float32Array([e,n,r,s])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,s)=>t({3107:[e,n,r,s]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,s)=>t({3088:new Int32Array([e,n,r,s])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,s)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:s}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,s)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:s}),viewport:(t,e,n,r,s)=>t({2978:[e,n,r,s]})},mn=(t,e)=>t.isEnabled(e),By={3042:mn,2884:mn,2929:mn,3024:mn,32823:mn,32926:mn,32928:mn,3089:mn,2960:mn,35977:mn},kF=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Gi(t,e){if(VF(e))return;const n={};for(const s in e){const i=Number(s),o=DF[s];o&&(typeof o=="string"?n[o]=!0:o(t,e[s],i))}const r=t.state&&t.state.cache;if(r)for(const s in n){const i=UF[s];i(t,e,r)}}function wv(t,e=Zg){if(typeof e=="number"){const s=e,i=By[s];return i?i(t,s):t.getParameter(s)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const s of n){const i=By[s];r[s]=i?i(t,Number(s)):t.getParameter(Number(s))}return r}function LF(t){Gi(t,Zg)}function VF(t){for(const e in t)return!1;return!0}function HF(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}return!1}class zF{constructor(e,{copyState:n=!1,log:r=()=>{}}={}){d(this,"gl");d(this,"program",null);d(this,"stateStack",[]);d(this,"enable",!0);d(this,"cache");d(this,"log");this.gl=e,this.cache=n?wv(e):Object.assign({},Zg),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){oe(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Gi(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const i in e){oe(i!==void 0);const o=e[i],a=this.cache[i];HF(o,a)||(n=!0,r=a,s&&!(i in s)&&(s[i]=a),this.cache[i]=o)}return{valueChanged:n,oldValue:r}}}function Cs(t){return t.state}function Rv(t,e){const{enable:n=!0,copyState:r}=e;if(oe(r!==void 0),!t.state){t.state=new zF(t,{copyState:r}),WF(t);for(const i in My){const o=My[i];jF(t,i,o)}Py(t,"getParameter"),Py(t,"isEnabled")}const s=Cs(t);return s.enable=n,t}function Vu(t){let e=Cs(t);e||(Rv(t,{copyState:!1}),e=Cs(t)),e.push()}function Ta(t){const e=Cs(t);oe(e),e.pop()}function Py(t,e){const n=t[e].bind(t);t[e]=function(s){if(s===void 0||kF.has(s))return n(s);const i=Cs(t);return s in i.cache||(i.cache[s]=n(s)),i.enable?i.cache[s]:n(s)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function jF(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...i){const o=Cs(t),{valueChanged:a,oldValue:c}=n(o._updateCache,...i);return a&&r(...i),c},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function WF(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const s=Cs(t);s.program!==r&&(e(r),s.program=r)}}const XF={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function GF(t,e){e={...XF,...e};let n=null;const r=i=>n=i.statusMessage||n;t.addEventListener("webglcontextcreationerror",r,!1);let s=null;if(s||(s=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",r,!1),!s)throw new Error(`Failed to create WebGL context: ${n||"Unknown error"}`);if(e.onContextLost){const{onContextLost:i}=e;t.addEventListener("webglcontextlost",o=>i(o),!1)}if(e.onContextRestored){const{onContextRestored:i}=e;t.addEventListener("webglcontextrestored",o=>i(o),!1)}return s}function Lr(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function $F(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);Lr(t,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,i=t.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),a=i||n,c=o||r,l=t.getParameter(7938),u=bv(a,c),h=KF(a,c),f=YF(a,c);return{type:"webgl",gpu:u,gpuType:f,gpuBackend:h,vendor:a,renderer:c,version:l,shadingLanguage:"glsl",shadingLanguageVersion:300}}function bv(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function KF(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function YF(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(bv(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function Iv(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Ye="texture-compression-bc",he="texture-compression-astc",An="texture-compression-etc2",JF="texture-compression-etc1-webgl",wc="texture-compression-pvrtc-webgl",ef="texture-compression-atc-webgl",ho="float32-renderable-webgl",tf="float16-renderable-webgl",qF="rgb9e5ufloat_renderable-webgl",nf="snorm8-renderable-webgl",fo="norm16-renderable-webgl",rf="snorm16-renderable-webgl",Rc="float32-filterable",Oy="float16-filterable-webgl",bo="WEBGL_compressed_texture_s3tc",Io="WEBGL_compressed_texture_s3tc_srgb",ii="EXT_texture_compression_rgtc",oi="EXT_texture_compression_bptc",QF="WEBGL_compressed_texture_etc",ZF="WEBGL_compressed_texture_astc",eD="WEBGL_compressed_texture_etc1",tD="WEBGL_compressed_texture_pvrtc",nD="WEBGL_compressed_texture_atc",xy="EXT_texture_norm16",Ny="EXT_render_snorm",rD="EXT_color_buffer_float",e_={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Ny],"norm16-renderable-webgl":[xy],"snorm16-renderable-webgl":[xy,Ny],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[bo,Io,ii,oi],"texture-compression-bc5-webgl":[ii],"texture-compression-bc7-webgl":[oi],"texture-compression-etc2":[QF],"texture-compression-astc":[ZF],"texture-compression-etc1-webgl":[eD],"texture-compression-pvrtc-webgl":[tD],"texture-compression-atc-webgl":[nD]};function sD(t){return t in e_}function iD(t,e,n){return(e_[e]||[]).every(s=>Lr(t,s,n))}const Hu={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:nf},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:nf},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:tf,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:fo,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:rf},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:nf},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:tf,filter:Oy,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:fo},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:rf},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:ho,filter:Rc},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:qF},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:ho,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:fo},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:fo},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:ho,filter:Rc,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:tf,filter:Oy},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:fo,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:rf},"rgb32float-webgl":{gl:34837,render:ho,filter:Rc,gl2ext:rD,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:ho,filter:Rc,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:bo,f:Ye},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Io,f:Ye},"bc1-rgba-unorm":{gl:33777,x:bo,f:Ye},"bc1-rgba-unorm-srgb":{gl:35916,x:Io,f:Ye},"bc2-rgba-unorm":{gl:33778,x:bo,f:Ye},"bc2-rgba-unorm-srgb":{gl:35918,x:Io,f:Ye},"bc3-rgba-unorm":{gl:33779,x:bo,f:Ye},"bc3-rgba-unorm-srgb":{gl:35919,x:Io,f:Ye},"bc4-r-unorm":{gl:36283,x:ii,f:Ye},"bc4-r-snorm":{gl:36284,x:ii,f:Ye},"bc5-rg-unorm":{gl:36285,x:ii,f:Ye},"bc5-rg-snorm":{gl:36286,x:ii,f:Ye},"bc6h-rgb-ufloat":{gl:36495,x:oi,f:Ye},"bc6h-rgb-float":{gl:36494,x:oi,f:Ye},"bc7-rgba-unorm":{gl:36492,x:oi,f:Ye},"bc7-rgba-unorm-srgb":{gl:36493,x:oi,f:Ye},"etc2-rgb8unorm":{gl:37492,f:An},"etc2-rgb8unorm-srgb":{gl:37494,f:An},"etc2-rgb8a1unorm":{gl:37496,f:An},"etc2-rgb8a1unorm-srgb":{gl:37497,f:An},"etc2-rgba8unorm":{gl:37493,f:An},"etc2-rgba8unorm-srgb":{gl:37495,f:An},"eac-r11unorm":{gl:37488,f:An},"eac-r11snorm":{gl:37489,f:An},"eac-rg11unorm":{gl:37490,f:An},"eac-rg11snorm":{gl:37491,f:An},"astc-4x4-unorm":{gl:37808,f:he},"astc-4x4-unorm-srgb":{gl:37840,f:he},"astc-5x4-unorm":{gl:37809,f:he},"astc-5x4-unorm-srgb":{gl:37841,f:he},"astc-5x5-unorm":{gl:37810,f:he},"astc-5x5-unorm-srgb":{gl:37842,f:he},"astc-6x5-unorm":{gl:37811,f:he},"astc-6x5-unorm-srgb":{gl:37843,f:he},"astc-6x6-unorm":{gl:37812,f:he},"astc-6x6-unorm-srgb":{gl:37844,f:he},"astc-8x5-unorm":{gl:37813,f:he},"astc-8x5-unorm-srgb":{gl:37845,f:he},"astc-8x6-unorm":{gl:37814,f:he},"astc-8x6-unorm-srgb":{gl:37846,f:he},"astc-8x8-unorm":{gl:37815,f:he},"astc-8x8-unorm-srgb":{gl:37847,f:he},"astc-10x5-unorm":{gl:37819,f:he},"astc-10x5-unorm-srgb":{gl:37851,f:he},"astc-10x6-unorm":{gl:37817,f:he},"astc-10x6-unorm-srgb":{gl:37849,f:he},"astc-10x8-unorm":{gl:37818,f:he},"astc-10x8-unorm-srgb":{gl:37850,f:he},"astc-10x10-unorm":{gl:37819,f:he},"astc-10x10-unorm-srgb":{gl:37851,f:he},"astc-12x10-unorm":{gl:37820,f:he},"astc-12x10-unorm-srgb":{gl:37852,f:he},"astc-12x12-unorm":{gl:37821,f:he},"astc-12x12-unorm-srgb":{gl:37853,f:he},"pvrtc-rgb4unorm-webgl":{gl:35840,f:wc},"pvrtc-rgba4unorm-webgl":{gl:35842,f:wc},"pvrtc-rbg2unorm-webgl":{gl:35841,f:wc},"pvrtc-rgba2unorm-webgl":{gl:35843,f:wc},"etc1-rbg-unorm-webgl":{gl:36196,f:JF},"atc-rgb-unorm-webgl":{gl:35986,f:ef},"atc-rgba-unorm-webgl":{gl:35986,f:ef},"atc-rgbai-unorm-webgl":{gl:34798,f:ef}},oD={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},aD={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function t_(t,e,n){const r=Hu[e];if(!r||r.gl===void 0)return!1;const s=r.x||r.gl2ext;return s?!!Lr(t,s,n):!0}function Mv(t){const e=Hu[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}function cD(t,e,n){if(!t_(t,e,n)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(TC(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!Lr(t,"OES_texture_float_linear, extensions",n):e.endsWith("16float")?!!Lr(t,"OES_texture_half_float_linear, extensions",n):!0}function lD(t,e,n){return!(!t_(t,e,n)||typeof e=="number")}function Jl(t){var s;const e=Hu[t],n=Mv(t),r=TC(t);return{format:n,dataFormat:(e==null?void 0:e.dataFormat)||hD(r.format,r.integer,r.normalized,n),type:r.dataType?Iv(r.dataType):((s=e==null?void 0:e.types)==null?void 0:s[0])||5121,compressed:r.compressed}}function uD(t){const e=Hu[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function Fy(t){const e=Jl(t),n=oD[e.dataFormat]||4,r=aD[e.type]||1;return n*r}function hD(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;default:return 6408}}const Dy={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class fD extends iP{constructor(n,r,s){super([],s);d(this,"gl");d(this,"extensions");d(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,Lr(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){return this.disabledFeatures[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),sD(n)&&iD(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(Dy),...Object.keys(e_)]}getWebGLFeature(n){const r=Dy[n];return typeof r=="string"?!!Lr(this.gl,r,this.extensions):!!r}}class dD extends sP{constructor(n){super();d(this,"gl");d(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]}}function Cr(t,e,n){if(pD(e))return n(t);const{nocatch:r=!0}=e;Vu(t),Gi(t,e);let s;if(r)s=n(t),Ta(t);else try{s=n(t)}finally{Ta(t)}return s}function pD(t){for(const e in t)return!1;return!0}function gD(t,e,n,r){if(Fl(e))return r(t);const s=t;Vu(s.gl);try{return _D(t,e),Gi(s.gl,n),r(t)}finally{Ta(s.gl)}}function _D(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(_s("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const i=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=_s("provokingVertex",e.provokingVertex,{first:36429,last:36430});i==null||i.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const i=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=_s("polygonMode",e.polygonMode,{fill:6914,line:6913});i==null||i.polygonModeWEBGL(1028,o),i==null||i.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(AD("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(sp("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;r.stencilMaskSeparate(1028,s),r.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&k.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,i=sp("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,i,0,s),r.stencilFuncSeparate(1029,i,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=sf("stencilPassOperation",e.stencilPassOperation),i=sf("stencilFailOperation",e.stencilFailOperation),o=sf("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,i,o,s),r.stencilOpSeparate(1029,i,o,s)}if(e.blendColorOperation||e.blendAlphaOperation){r.enable(3042);const s=Uy("blendColorOperation",e.blendColorOperation||"add"),i=Uy("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(s,i);const o=bc("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=bc("blendColorDstFactor",e.blendColorDstFactor||"zero"),c=bc("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),l=bc("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,c,l)}}function sp(t,e){return _s(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function sf(t,e){return _s(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Uy(t,e){return _s(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function bc(t,e){return _s(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function mD(t,e){return`Illegal parameter ${e} for ${t}`}function _s(t,e,n){if(!(e in n))throw new Error(mD(t,e));return n[e]}function AD(t,e){return e}function Bv(t){const e={};return t.addressModeU&&(e[10242]=of(t.addressModeU)),t.addressModeV&&(e[10243]=of(t.addressModeV)),t.addressModeW&&(e[32882]=of(t.addressModeW)),t.magFilter&&(e[10240]=Pv(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=yD(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=sp("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function of(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Pv(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function yD(t,e){if(!e)return Pv(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class xr extends Se{constructor(n,r={}){super(n,r);d(this,"device");d(this,"gl");d(this,"handle");d(this,"glTarget");d(this,"glUsage");d(this,"glIndexType",5123);d(this,"byteLength");d(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const s=typeof r=="object"?r.handle:void 0;this.handle=s||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=TD(this.props.usage),this.glUsage=ED(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,s=n.byteLength+r){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,s,this.glUsage),this.gl.bufferSubData(i,r,n),this.gl.bindBuffer(i,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(n,r,s),this.trackAllocatedMemory(s)}_initWithByteLength(n){oe(n>=0);let r=n;n===0&&(r=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,r,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const s=new Uint8Array(r),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,s,i,r),this.gl.bindBuffer(36662,null),this._setDebugData(s,n,r),s}}function TD(t){return t&Se.INDEX?34963:t&Se.VERTEX?34962:t&Se.UNIFORM?35345:34962}function ED(t){return t&Se.INDEX||t&Se.VERTEX?35044:t&Se.UNIFORM?35048:35044}class ip extends kl{constructor(n,r){super(n,r);d(this,"device");d(this,"handle");d(this,"parameters");this.device=n,this.parameters=Bv(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,s]of Object.entries(n)){const i=Number(r);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,s);break;default:this.device.gl.samplerParameteri(this.handle,i,s);break}}}}class ai extends Dl{constructor(n,r){super(n,{...vt.defaultProps,...r});d(this,"device");d(this,"gl");d(this,"handle");d(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const SD={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},Yo=class Yo extends vt{constructor(n,r){var s;super(n,{...SD,format:"rgba8unorm",...r});d(this,"MAX_ATTRIBUTES");d(this,"device");d(this,"gl");d(this,"handle");d(this,"sampler");d(this,"view");d(this,"glFormat");d(this,"type");d(this,"dataFormat");d(this,"mipmaps");d(this,"target");d(this,"textureUnit");d(this,"loaded",!1);d(this,"_video");this.device=n,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=CD(this.props),this.loaded=!1,typeof((s=this.props)==null?void 0:s.data)=="string"&&Object.assign(this.props,{data:GP(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(n){return new ai(this.device,{...n,texture:this})}initialize(n={}){if(this.props.dimension==="cube")return this.initializeCube(n);let r=n.data;if(r instanceof Promise)return r.then(_=>this.initialize(Object.assign({},n,{pixels:_,data:_}))),this;const s=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(s&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(n)),this;const{parameters:i={}}=n,{pixels:o=null,pixelStore:a={},textureUnit:c=void 0,mipmaps:l=!0}=n;r||(r=o);let{width:u,height:h,dataFormat:f,type:p,compressed:m=!1}=n;const{depth:y=0}=n,w=Mv(n.format);return{width:u,height:h,compressed:m,dataFormat:f,type:p}=this._deduceParameters({format:n.format,type:p,dataFormat:f,compressed:m,data:r,width:u,height:h}),this.width=u,this.height=h,this.glFormat=w,this.type=p,this.dataFormat=f,this.textureUnit=c,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=l,this.setImageData({data:r,width:u,height:h,depth:y,format:n.format,type:p,dataFormat:f,parameters:a,compressed:m}),this.setSampler(n.sampler),this._setSamplerParameters(i),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),l&&this.device.isTextureFormatFilterable(n.format)&&this.generateMipmap(),s&&(this._video={video:r,parameters:i,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(n){const{mipmaps:r=!0,parameters:s={}}=n;return this.setCubeMapImageData(n).then(()=>{this.loaded=!0,r&&this.generateMipmap(n),this.setSampler(n.sampler),this._setSamplerParameters(s)}),this}setSampler(n={}){let r;n instanceof ip?(this.sampler=n,r=n.props):(this.sampler=new ip(this.device,n),r=n);const s=Bv(r);return this._setSamplerParameters(s),this}resize(n){const{height:r,width:s,mipmaps:i=!1}=n;return s!==this.width||r!==this.height?this.initialize({width:s,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:i}):this}update(){if(this._video){const{video:n,parameters:r,lastTime:s}=this._video;if(s===n.currentTime||n.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:n,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=n.currentTime}}generateMipmap(n={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Cr(this.gl,n,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(n){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(n);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:s=null,level:i=0,glFormat:o=this.glFormat,offset:a=0,parameters:c={}}=n;let{data:l=null,type:u=this.type,width:h=this.width,height:f=this.height,dataFormat:p=this.dataFormat,compressed:m=!1}=n;l||(l=s),{type:u,dataFormat:p,compressed:m,width:h,height:f}=this._deduceParameters({format:this.props.format,type:u,dataFormat:p,compressed:m,data:l,width:h,height:f});const{gl:y}=this;y.bindTexture(this.target,this.handle);let w=null;if({data:l,dataType:w}=this._getDataType({data:l,compressed:m}),Cr(this.gl,c,()=>{switch(w){case"null":y.texImage2D(r,i,o,h,f,0,p,u,l);break;case"typed-array":y.texImage2D(r,i,o,h,f,0,p,u,l,a);break;case"buffer":this.device.gl.bindBuffer(35052,l.handle||l),this.device.gl.texImage2D(r,i,o,h,f,0,p,u,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":y.texImage2D(r,i,o,h,f,0,p,u,l);break;case"compressed":for(const[_,g]of l.entries())y.compressedTexImage2D(r,_,g.format,g.width,g.height,0,g.data);break;default:oe(!1,"Unknown image data type")}}),l&&l.byteLength)this.trackAllocatedMemory(l.byteLength,"Texture");else{const _=Fy(this.props.format);this.trackAllocatedMemory(this.width*this.height*_,"Texture")}return this.loaded=!0,this}setSubImageData({target:n=this.target,pixels:r=null,data:s=null,x:i=0,y:o=0,width:a=this.width,height:c=this.height,level:l=0,glFormat:u=this.glFormat,type:h=this.type,dataFormat:f=this.dataFormat,compressed:p=!1,offset:m=0,parameters:y={}}){if({type:h,dataFormat:f,compressed:p,width:a,height:c}=this._deduceParameters({format:this.props.format,type:h,dataFormat:f,compressed:p,data:s,width:a,height:c}),oe(this.depth===1,"texSubImage not supported for 3D textures"),s||(s=r),s&&s.data){const w=s;s=w.data,a=w.shape[0],c=w.shape[1]}s instanceof xr&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),Cr(this.gl,y,()=>{p?this.gl.compressedTexSubImage2D(n,l,i,o,a,c,u,s):s===null?this.gl.texSubImage2D(n,l,i,o,a,c,f,h,null):ArrayBuffer.isView(s)?this.gl.texSubImage2D(n,l,i,o,a,c,f,h,s,m):typeof WebGLBuffer<"u"&&s instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,s),this.device.gl.texSubImage2D(n,l,i,o,a,c,f,h,m),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(n,l,i,o,a,c,f,h,s)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(n={}){return k.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,this.handle),n}unbind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,null),n}_getDataType({data:n,compressed:r=!1}){return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof xr?{data:n.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(n){const{format:r,data:s}=n;let{width:i,height:o,dataFormat:a,type:c,compressed:l}=n;const u=Jl(r);return a=a||u.dataFormat,c=c||u.type,l=l||u.compressed,{width:i,height:o}=this._deduceImageSize(s,i,o),{dataFormat:a,type:c,compressed:l,width:i,height:o,format:r,data:s}}_deduceImageSize(n,r,s){let i;return typeof ImageData<"u"&&n instanceof ImageData?i={width:n.width,height:n.height}:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement?i={width:n.naturalWidth,height:n.naturalHeight}:typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement?i={width:n.width,height:n.height}:typeof ImageBitmap<"u"&&n instanceof ImageBitmap?i={width:n.width,height:n.height}:typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?i={width:n.videoWidth,height:n.videoHeight}:n?i={width:r,height:s}:i={width:r>=0?r:1,height:s>=0?s:1},oe(i,"Could not deduced texture size"),oe(r===void 0||i.width===r,"Deduced texture width does not match supplied width"),oe(s===void 0||i.height===s,"Deduced texture height does not match supplied height"),i}async setCubeMapImageData(n){const{gl:r}=this,{width:s,height:i,pixels:o,data:a,format:c=6408,type:l=5121}=n,u=o||a,h=await Promise.all(Yo.FACES.map(f=>{const p=u[f];return Promise.all(Array.isArray(p)?p:[p])}));this.bind(),Yo.FACES.forEach((f,p)=>{h[p].length>1&&this.props.mipmaps!==!1&&k.warn(`${this.id} has mipmap and multiple LODs.`)(),h[p].forEach((m,y)=>{s&&i?r.texImage2D(f,y,c,s,i,0,c,l,m):r.texImage2D(f,y,c,c,l,m)})}),this.unbind()}setImageDataForFace(n){const{face:r,width:s,height:i,pixels:o,data:a,format:c=6408,type:l=5121}=n,{gl:u}=this,h=o||a;return this.bind(),h instanceof Promise?h.then(f=>this.setImageDataForFace(Object.assign({},n,{face:r,data:f,pixels:f}))):this.width||this.height?u.texImage2D(r,0,c,s,i,0,c,l,h):u.texImage2D(r,0,c,c,l,h),this}setImageData3D(n){const{level:r=0,dataFormat:s,format:i,type:o,width:a,height:c,depth:l=1,offset:u=0,data:h,parameters:f={}}=n;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const p=Jl(i);if(Cr(this.gl,f,()=>{ArrayBuffer.isView(h)&&this.gl.texImage3D(this.target,r,p.format,a,c,l,0,p.dataFormat,p.type,h),h instanceof xr&&(this.gl.bindBuffer(35052,h.handle),this.gl.texImage3D(this.target,r,s,a,c,l,0,i,o,u))}),h&&h.byteLength)this.trackAllocatedMemory(h.byteLength,"Texture");else{const m=Fy(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*m,"Texture")}return this.loaded=!0,this}_setSamplerParameters(n){if(!Fl(n)){vD(n),this.gl.bindTexture(this.target,this.handle);for(const[r,s]of Object.entries(n)){const i=Number(r),o=s;switch(i){case 33082:case 33083:this.gl.texParameterf(this.target,i,o);break;default:this.gl.texParameteri(this.target,i,o);break}}this.gl.bindTexture(this.target,null)}}};d(Yo,"FACES",[34069,34070,34071,34072,34073,34074]);let In=Yo;function CD(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function vD(t){k.log(1,"texture sampler parameters",t)()}class jo extends Ll{constructor(n,r){super(n,r);d(this,"device");d(this,"gl");d(this,"handle");const s=r.handle===null;if(this.device=n,this.gl=n.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),!s){n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const i=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){const a=this.colorAttachments[o],c=36064+o;a&&this._attachOne(c,a)}if(this.depthStencilAttachment&&this._attachOne(uD(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${RD(o)}`)}this.gl.bindFramebuffer(36160,i)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(n){return new In(this.device,{id:`${this.id}-depth-stencil`,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const s of this.colorAttachments)s.texture.resize({width:n,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:n,height:r}),this}_attachOne(n,r){if(Array.isArray(r)){const[s,i=0,o=0]=r;return this._attachTexture(n,s,i,o),s}if(r instanceof In)return this._attachTexture(n,r,0,0),r;if(r instanceof ai){const s=r;return this._attachTexture(n,s.texture,s.props.baseMipLevel,s.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(n,r,s,i){const{gl:o}=this.device;switch(o.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:o.framebufferTextureLayer(36160,n,r.target,i,s);break;case 34067:const a=wD(s);o.framebufferTexture2D(36160,n,a,r.handle,i);break;case 3553:o.framebufferTexture2D(36160,n,3553,r.handle,i);break;default:oe(!1,"Illegal texture type")}o.bindTexture(r.target,null)}}function wD(t){return t<34069?t+34069:t}function RD(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class bD extends Ng{constructor(n,r){super(r);d(this,"device");d(this,"presentationSize");d(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new jo(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}const ID={spector:k.get("spector")||k.get("spectorjs")},MD="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",BD=1;let fe=null,ky=!1;async function PD(t){if(!globalThis.SPECTOR)try{await IC(MD)}catch(e){k.warn(String(e))}}function OD(t){if(t={...ID,...t},!(t!=null&&t.spector)||(!fe&&globalThis.SPECTOR&&(k.probe(BD,"SPECTOR found and initialized")(),fe=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=fe)),!fe))return null;if(ky||(ky=!0,fe.spyCanvases(),fe==null||fe.onCaptureStarted.add(e=>k.info("Spector capture started:",e)()),fe==null||fe.onCapture.add(e=>{k.info("Spector capture complete:",e)(),fe==null||fe.getResultUI(),fe==null||fe.resultView.display(),fe==null||fe.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return fe;fe==null||fe.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{k.info("Spector capture stopped after 2 seconds")(),fe==null||fe.stopCapture()})}return fe}const xD="https://unpkg.com/webgl-debug@2.0.1/index.js";function Ov(t){return t.luma=t.luma||{},t.luma}async function ND(){Wr()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await IC(xD))}function FD(t,e={}){return t?e.debug?UD(t,e):DD(t):null}function DD(t){const e=Ov(t);return e.realContext?e.realContext:t}function UD(t,e){if(!globalThis.WebGLDebugUtils)return k.warn("webgl-debug not loaded")(),t;const n=Ov(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...si,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,kD.bind(null,e),LD.bind(null,e));for(const o in si)!(o in r)&&typeof si[o]=="number"&&(r[o]=si[o]);class s{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(s,r);const i=Object.create(s);return n.realContext=t,n.debugContext=i,i.debug=!0,i}function af(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function kD(t,e,n,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const s=globalThis.WebGLDebugUtils.glEnumToString(e),i=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${s} in gl.${n}(${i})`;k.error(o)();debugger;if(t.throwOnError)throw new Error(o)}function LD(t,e,n){let r="";if(k.level>=1&&(r=af(e,n),k.log(1,r)()),t.break&&t.break.length>0&&(r=r||af(e,n),t.break.every(i=>r.indexOf(i)!==-1)))debugger;for(const s of n)if(s===void 0){if(r=r||af(e,n),t.throwOnError)throw new Error(`Undefined argument: ${r}`);k.error(`Undefined argument: ${r}`)();debugger}}function VD(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const s=r.split(":");if(s.length===2){const[h,f]=s;n.push({message:f.trim(),type:Ly(h),lineNum:0,linePos:0});continue}const[i,o,a,...c]=s;let l=parseInt(a,10);isNaN(l)&&(l=0);let u=parseInt(o,10);isNaN(u)&&(u=0),n.push({message:c.join(":").trim(),type:Ly(i),lineNum:l,linePos:u})}return n}function Ly(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class HD extends Ul{constructor(n,r){super(n,r);d(this,"device");d(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return VD(n)}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return r==null?void 0:r.getTranslatedShaderSource(this.handle)}async _compile(n){n=(i=>i.startsWith("#version ")?i:`#version 100
${i}`)(n);const{gl:s}=this.device;if(s.shaderSource(this.handle,n),s.compileShader(this.handle),k.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}k.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),k.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const zD=256,jD=1024,WD=16384,cf=6144,XD=[1,2,4,8];class GD extends Dd{constructor(n,r){super(n,r);d(this,"device");d(this,"glParameters");this.device=n,Vu(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){Ta(this.device.gl)}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=XD.map(s=>!!(s&n.colorMask))),this.glParameters=r,Gi(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=WD,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=zD,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=jD,n.clearStencil=this.props.clearStencil),r!==0&&Cr(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){Cr(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(cf,n,r);break;case Uint32Array:this.device.gl.clearBufferuiv(cf,n,r);break;case Float32Array:default:this.device.gl.clearBufferfv(cf,n,r);break}})}}const $D="Failed to deduce GL constant from typed array";function KD(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error($D)}}function op(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const YD={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},JD={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Wo{constructor(...e){d(this,"offset");d(this,"stride");d(this,"type");d(this,"size");d(this,"divisor");d(this,"normalized");d(this,"integer");d(this,"buffer");d(this,"index");e.forEach(n=>this._assign(n)),Object.freeze(this)}static getBytesPerElement(e){return op(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return oe(e.size),op(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Wo(YD,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Wo.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Wo.getBytesPerVertex(this)}_assign(e={}){return e=WP("Accessor",e,JD),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function qD(t){return QD.includes(t)}const QD=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],xv={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function Nv(t){const e=xv[t];if(!e)throw new Error("uniform");const[n,r,,s]=e;return{format:s,components:r,glType:n}}function ZD(t){const e=xv[t];if(!e)throw new Error("attribute");const[,n,,r,s]=e;return{attributeType:r,vertexFormat:s,components:n}}function eU(t,e){const n={attributes:[],bindings:[]};n.attributes=tU(t,e);const r=sU(t,e);for(const a of r){const c=a.uniforms.map(l=>({name:l.name,format:l.format,byteOffset:l.byteOffset,byteStride:l.byteStride,arrayLength:l.arrayLength}));n.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:c})}const s=rU(t,e);let i=0;for(const a of s)if(qD(a.type)){const{viewDimension:c,sampleType:l}=oU(a.type);n.bindings.push({type:"texture",name:a.name,location:i,viewDimension:c,sampleType:l}),a.textureUnit=i,i+=1}s.length&&(n.uniforms=s);const o=nU(t,e);return o!=null&&o.length&&(n.varyings=o),n}function tU(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let s=0;s<r;s++){const i=t.getActiveAttrib(e,s);if(!i)throw new Error("activeInfo");const{name:o,type:a}=i,c=t.getAttribLocation(e,o);if(c>=0){const{attributeType:l}=ZD(a),u=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:c,stepMode:u,type:l})}}return n.sort((s,i)=>s.location-i.location),n}function nU(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let s=0;s<r;s++){const i=t.getTransformFeedbackVarying(e,s);if(!i)throw new Error("activeInfo");const{name:o,type:a,size:c}=i,{glType:l,components:u}=Nv(a),h=new Wo({type:l,size:c*u}),f={location:s,name:o,accessor:h};n.push(f)}return n.sort((s,i)=>s.location-i.location),n}function rU(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let s=0;s<r;s++){const i=t.getActiveUniform(e,s);if(!i)throw new Error("activeInfo");const{name:o,size:a,type:c}=i,{name:l,isArray:u}=aU(o);let h=t.getUniformLocation(e,l);const f={location:h,name:l,size:a,type:c,isArray:u};if(n.push(f),f.size>1)for(let p=0;p<f.size;p++){const m=`${l}[${p}]`;h=t.getUniformLocation(e,m);const y={...f,name:m,location:h};n.push(y)}}return n}function sU(t,e){const n=(i,o)=>t.getActiveUniformBlockParameter(e,i,o),r=[],s=t.getProgramParameter(e,35382);for(let i=0;i<s;i++){const o={name:t.getActiveUniformBlockName(e,i)||"",location:n(i,35391),byteLength:n(i,35392),vertex:n(i,35396),fragment:n(i,35398),uniformCount:n(i,35394),uniforms:[]},a=n(i,35395)||[],c=t.getActiveUniforms(e,a,35383),l=t.getActiveUniforms(e,a,35384),u=t.getActiveUniforms(e,a,35387),h=t.getActiveUniforms(e,a,35388);for(let f=0;f<o.uniformCount;++f){const p=t.getActiveUniform(e,a[f]);if(!p)throw new Error("activeInfo");o.uniforms.push({name:p.name,format:Nv(c[f]).format,type:c[f],arrayLength:l[f],byteOffset:u[f],byteStride:h[f]})}r.push(o)}return r.sort((i,o)=>i.location-o.location),r}const iU={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function oU(t){const e=iU[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function aU(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function cU(t,e,n,r){const s=t;let i=r;i===!0&&(i=1),i===!1&&(i=0);const o=typeof i=="number"?[i]:i;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return s.uniform1uiv(e,o,1);case 36294:return s.uniform2uiv(e,o,2);case 36295:return s.uniform3uiv(e,o,3);case 36296:return s.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return s.uniformMatrix2x3fv(e,!1,o);case 35686:return s.uniformMatrix2x4fv(e,!1,o);case 35687:return s.uniformMatrix3x2fv(e,!1,o);case 35688:return s.uniformMatrix3x4fv(e,!1,o);case 35689:return s.uniformMatrix4x2fv(e,!1,o);case 35690:return s.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function lU(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function uU(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const Vy=4;class hU extends xi{constructor(n,r){super(n,r);d(this,"device");d(this,"handle");d(this,"vs");d(this,"fs");d(this,"introspectedLayout");d(this,"uniforms",{});d(this,"bindings",{});d(this,"varyings",null);d(this,"_uniformCount",0);d(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:s,bufferMode:i=35981}=r;switch(s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,i)),this._linkShaders(),k.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=eU(this.device.gl,this.handle),k.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=PP(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":k.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[s,i]of Object.entries(n)){const o=this.shaderLayout.bindings.find(a=>a.name===s)||this.shaderLayout.bindings.find(a=>a.name===`${s}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(c=>`"${c.name}"`).join(", ");r!=null&&r.disableWarnings||k.warn(`Unknown binding "${s}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(i||k.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(i instanceof xr)&&!(i.buffer instanceof xr))throw new Error("buffer value");break;case"texture":if(!(i instanceof ai||i instanceof In||i instanceof jo))throw new Error("texture value");break;case"sampler":k.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(o.type)}this.bindings[s]=i}}draw(n){var w;const{renderPass:r,parameters:s=this.props.parameters,topology:i=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:c,isInstanced:l=!1,firstVertex:u=0,transformFeedback:h}=n,f=lU(i),p=!!o.indexBuffer,m=(w=o.indexBuffer)==null?void 0:w.glIndexType;if(this.linkStatus!=="success")return k.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return k.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return k.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),h&&h.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const y=r;return gD(this.device,s,y.glParameters,()=>{p&&l?this.device.gl.drawElementsInstanced(f,a||0,m,u,c||0):p?this.device.gl.drawElements(f,a||0,m,u):l?this.device.gl.drawArraysInstanced(f,u,a||0,c||0):this.device.gl.drawArrays(f,u,a||0),h&&h.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=Fg(n);Object.keys(r).forEach(s=>{k.warn(`Unsupported value "${JSON.stringify(r[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),k.time(Vy,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),k.timeEnd(Vy,`linkProgram for ${this.id}`)(),k.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}k.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),k.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(n){var r;switch(n){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((r=this.fs)==null?void 0:r.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${n}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const[,r]of Object.entries(this.bindings))r instanceof In&&(r.update(),n=n&&r.loaded);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,s=0;for(const i of this.shaderLayout.bindings){const o=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:a}=i,c=n.getUniformBlockIndex(this.handle,a);if(c===4294967295)throw new Error(`Invalid uniform block name ${a}`);n.uniformBlockBinding(this.handle,s,c),o instanceof xr?n.bindBufferBase(35345,s,o.handle):n.bindBufferRange(35345,s,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),s+=1;break;case"texture":if(!(o instanceof ai||o instanceof In||o instanceof jo))throw new Error("texture");let l;if(o instanceof ai)l=o.texture;else if(o instanceof In)l=o;else if(o instanceof jo&&o.colorAttachments[0]instanceof ai)k.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),l=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(l.target,l.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:s,type:i,textureUnit:o}=n,a=this.uniforms[r]??o;a!==void 0&&cU(this.device.gl,s,i,a)}}}class fU extends kd{constructor(n){super(n,{});d(this,"device");d(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":dU(this.device,r.options);break;case"copy-buffer-to-texture":pU(this.device,r.options);break;case"copy-texture-to-buffer":gU(this.device,r.options);break;case"copy-texture-to-texture":_U(this.device,r.options);break}}}function dU(t,e){const n=e.source,r=e.destination;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function pU(t,e){throw new Error("Not implemented")}function gU(t,e){const{source:n,mipLevel:r=0,aspect:s="all",width:i=e.source.width,height:o=e.source.height,depthOrArrayLayers:a=0,origin:c=[0,0],destination:l,byteOffset:u=0,bytesPerRow:h,rowsPerImage:f}=e;if(s!=="all")throw new Error("not supported");if(r!==0||a!==0||h||f)throw new Error("not implemented");const{framebuffer:p,destroyFramebuffer:m}=Fv(n);let y;try{const w=l,_=i||p.width,g=o||p.height,T=Jl(p.texture.props.format),C=T.dataFormat,I=T.type;t.gl.bindBuffer(35051,w.handle),y=t.gl.bindFramebuffer(36160,p.handle),t.gl.readPixels(c[0],c[1],_,g,C,I,u)}finally{t.gl.bindBuffer(35051,null),y!==void 0&&t.gl.bindFramebuffer(36160,y),m&&p.destroy()}}function _U(t,e){const{source:n,destinationMipLevel:r=0,origin:s=[0,0],destinationOrigin:i=[0,0],destination:o}=e;let{width:a=e.destination.width,height:c=e.destination.height}=e;const{framebuffer:l,destroyFramebuffer:u}=Fv(n),[h,f]=s,[p,m,y]=i,w=t.gl.bindFramebuffer(36160,l.handle);let _=null,g;if(o instanceof In)_=o,a=Number.isFinite(a)?a:_.width,c=Number.isFinite(c)?c:_.height,_.bind(0),g=_.target;else throw new Error("invalid destination");switch(g){case 3553:case 34067:t.gl.copyTexSubImage2D(g,r,p,m,h,f,a,c);break;case 35866:case 32879:t.gl.copyTexSubImage3D(g,r,p,m,y,h,f,a,c);break}_&&_.unbind(),t.gl.bindFramebuffer(36160,w),u&&l.destroy()}function Fv(t){if(t instanceof vt){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class mU extends Ud{constructor(n,r){super(n,r);d(this,"device");d(this,"commandBuffer");this.device=n,this.commandBuffer=new fU(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,s){}}class n_ extends Ld{constructor(n,r){super(n,r);d(this,"device");d(this,"handle");d(this,"buffer",null);d(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return II()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const s=r;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:i,type:o,stride:a,offset:c,normalized:l,integer:u,divisor:h}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),u?this.device.gl.vertexAttribIPointer(n,i,o,a,c):this.device.gl.vertexAttribPointer(n,i,o,l,a,c),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,h||0),this.attributes[n]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const s=Iv(r.bufferDataType);return{size:r.bufferComponents,type:s,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const i=n_.isConstantAttributeZeroSupported(this.device)||n!==0;(r||i)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const s=AU(r),i=s.byteLength*n,o=s.length*n;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),a=a||!yU(s,this.bufferValue),a){const c=FP(r.constructor,o);DP({target:c,source:s,start:0,count:o}),this.buffer.write(c),this.bufferValue=r}return this.buffer}}function AU(t){return Array.isArray(t)?new Float32Array(t):t}function yU(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class TU extends Vd{constructor(n,r){super(n,r);d(this,"device");d(this,"gl");d(this,"handle");d(this,"layout");d(this,"buffers",{});d(this,"unusedBuffers",{});d(this,"bindOnUse",!0);d(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(uU(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const s=this._getVaryingIndex(n),{buffer:i,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(s<0){this.unusedBuffers[n]=i,k.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[s]={buffer:i,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(s,i,a,o)}getBuffer(n){if(Hy(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof xr)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:s=0,byteLength:i=n.buffer.byteLength}=n;return{buffer:r,byteOffset:s,byteLength:i}}_getVaryingIndex(n){if(Hy(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:s,byteOffset:i}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,i,s)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,s=0,i){const o=r&&r.handle;!o||i===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,s,i)}}function Hy(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class EU extends Hd{constructor(n,r){super(n,r);d(this,"device");d(this,"handle");d(this,"target",null);d(this,"_queryPending",!1);d(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((s,i)=>{const o=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):r++>n?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function Dv(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return oe(!1),0}}function SU(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return oe(!1),0}}function CU(t,e){var w,_;const{sourceX:n=0,sourceY:r=0,sourceFormat:s=6408,sourceAttachment:i=36064}=e||{};let{target:o=null,sourceWidth:a,sourceHeight:c,sourceType:l}=e||{};const{framebuffer:u,deleteFramebuffer:h}=Uv(t);oe(u);const{gl:f,handle:p}=u;a=a||u.width,c=c||u.height;const m=i-36064;l=l||((_=(w=u.colorAttachments[m])==null?void 0:w.texture)==null?void 0:_.type)||5121,o=RU(o,l,s,a,c),l=l||KD(o);const y=f.bindFramebuffer(36160,p);return f.readPixels(n,r,a,c,s,l,o),f.bindFramebuffer(36160,y||null),h&&u.destroy(),o}function vU(t,e){const{target:n,sourceX:r=0,sourceY:s=0,sourceFormat:i=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:c,sourceType:l}=e||{};const{framebuffer:u,deleteFramebuffer:h}=Uv(t);oe(u),a=a||u.width,c=c||u.height;const f=u;l=l||5121;let p=n;if(!p){const y=Dv(i),w=SU(l),_=o+a*c*y*w;p=f.device.createBuffer({byteLength:_})}const m=t.device.createCommandEncoder();return m.copyTextureToBuffer({source:t,width:a,height:c,origin:[r,s],destination:p,byteOffset:o}),m.destroy(),h&&u.destroy(),p}function Uv(t){return t instanceof Ll?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:wU(t),deleteFramebuffer:!0}}function wU(t,e){const{device:n,width:r,height:s,id:i}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${i}`,width:r,height:s,colorAttachments:[t]})}function RU(t,e,n,r,s){if(t)return t;e=e||5121;const i=op(e,{clamped:!1}),o=Dv(n);return new i(r*s*o)}const bU=256,IU=1024,MU=16384,BU="clear: bad arguments";function PU(t,e){const{framebuffer:n=null,color:r=null,depth:s=null,stencil:i=null}=e||{},o={};n&&(o.framebuffer=n);let a=0;r&&(a|=MU,r!==!0&&(o.clearColor=r)),s&&(a|=bU,s!==!0&&(o.clearDepth=s)),i&&(a|=IU,s!==!0&&(o.clearStencil=s)),oe(a!==0,BU);const c=t.gl;Cr(c,o,()=>{c.clear(a)})}const po=1,ss=class ss extends Oi{constructor(n){var c,l;super({...n,id:n.id||Xr("webgl-device")});d(this,"type","webgl");d(this,"handle");d(this,"features");d(this,"limits");d(this,"info");d(this,"canvasContext");d(this,"lost");d(this,"_resolveContextLost");d(this,"renderPass",null);d(this,"gl");d(this,"debug",!1);d(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});d(this,"_extensions",{});d(this,"_polyfilled",!1);d(this,"spectorJS");d(this,"_constants");const r=(c=n.gl)==null?void 0:c.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const s=((l=n.gl)==null?void 0:l.canvas)||n.canvas;this.canvasContext=new bD(this,{...n,canvas:s}),this.lost=new Promise(u=>{this._resolveContextLost=u});let i=n.gl||null;if(i||(i=GF(this.canvasContext.canvas,{...n,onContextLost:u=>{var h;return(h=this._resolveContextLost)==null?void 0:h.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!i)throw new Error("WebGL context creation failed");this.handle=i,this.gl=i,this.gl.device=this,this.gl._version=2,n.spector&&(this.spectorJS=OD({...this.props,canvas:this.handle.canvas})),this.info=$F(this.gl,this._extensions),this.limits=new dD(this.gl),this.features=new fD(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:o=!0,copyState:a=!1}=n;Rv(this.gl,{enable:o,copyState:a,log:(...u)=>k.log(1,...u)()}),n.debug&&(this.gl=FD(this.gl,{...n,throwOnError:!0}),this.debug=!0,k.level=Math.max(k.level,1),k.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(n){if(n instanceof ss)return n;if((n==null?void 0:n.device)instanceof Oi)return n.device;if(!OU(n))throw new Error("Invalid WebGL2RenderingContext");return new ss({gl:n})}static async create(n={}){var a;k.groupCollapsed(po,"WebGLDevice created")();const r=[];n.debug&&r.push(ND()),n.spector&&r.push(PD()),typeof n.canvas=="string"&&r.push(Ng.pageLoaded);const s=await Promise.allSettled(r);for(const c of s)c.status==="rejected"&&k.error(`Failed to initialize debug libraries ${c.reason}`)();if(k.probe(po+1,"DOM is loaded")(),(a=n.gl)!=null&&a.device)return k.warn("reattaching existing device")(),ss.attach(n.gl);const i=new ss(n),o=`Created ${i.type}${i.debug?" debug":""} context: ${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return k.probe(po,o)(),k.table(po,i.info)(),k.groupEnd(po)(),i}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(n){return t_(this.gl,n,this._extensions)}isTextureFormatFilterable(n){return cD(this.gl,n,this._extensions)}isTextureFormatRenderable(n){return lD(this.gl,n,this._extensions)}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._getBufferProps(n);return new xr(this,r)}_createTexture(n){return new In(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new ip(this,n)}createShader(n){return new HD(this,n)}createFramebuffer(n){return new jo(this,n)}createVertexArray(n){return new n_(this,n)}createTransformFeedback(n){return new TU(this,n)}createQuerySet(n){return new EU(this,n)}createRenderPipeline(n){return new hU(this,n)}beginRenderPass(n){return new GD(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n){return new mU(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return CU(n,r)}readPixelsToBufferWebGL(n,r){return vU(n,r)}setParametersWebGL(n){Gi(this.gl,n)}getParametersWebGL(n){return wv(this.gl,n)}withParametersWebGL(n,r){return Cr(this.gl,n,r)}clearWebGL(n){PU(this,n)}resetWebGL(){k.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),LF(this.gl)}loseDevice(){var i;let n=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(n=!0,s.loseContext()),(i=this._resolveContextLost)==null||i.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){Vu(this.gl)}popState(){Ta(this.gl)}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){r=r||this.gl2||this.gl;const s=Number(n);for(const i in r)if(r[i]===s)return`GL.${i}`;return String(n)}setConstantAttributeWebGL(n,r){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const i=this._constants[n];switch(i&&DU(i,r)&&k.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:xU(this,n,r);break;case Int32Array:NU(this,n,r);break;case Uint32Array:FU(this,n,r);break;default:oe(!1)}}getExtension(n){return Lr(this.gl,n,this._extensions),this._extensions}};d(ss,"type","webgl");let Xo=ss;function OU(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function xU(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break;default:oe(!1)}}function NU(t,e,n){t.gl.vertexAttribI4iv(e,n)}function FU(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function DU(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}var kv={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,s){var i=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",c=Math.round,l=Math.abs,u=Date.now;function h(A,E,v){return setTimeout(T(A,v),E)}function f(A,E,v){return Array.isArray(A)?(p(A,v[E],v),!0):!1}function p(A,E,v){var O;if(A)if(A.forEach)A.forEach(E,v);else if(A.length!==s)for(O=0;O<A.length;)E.call(v,A[O],O,A),O++;else for(O in A)A.hasOwnProperty(O)&&E.call(v,A[O],O,A)}function m(A,E,v){var O="DEPRECATED METHOD: "+E+`
`+v+` AT 
`;return function(){var U=new Error("get-stack-trace"),j=U&&U.stack?U.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Y=e.console&&(e.console.warn||e.console.log);return Y&&Y.call(e.console,O,j),A.apply(this,arguments)}}var y;typeof Object.assign!="function"?y=function(E){if(E===s||E===null)throw new TypeError("Cannot convert undefined or null to object");for(var v=Object(E),O=1;O<arguments.length;O++){var U=arguments[O];if(U!==s&&U!==null)for(var j in U)U.hasOwnProperty(j)&&(v[j]=U[j])}return v}:y=Object.assign;var w=m(function(E,v,O){for(var U=Object.keys(v),j=0;j<U.length;)(!O||O&&E[U[j]]===s)&&(E[U[j]]=v[U[j]]),j++;return E},"extend","Use `assign`."),_=m(function(E,v){return w(E,v,!0)},"merge","Use `assign`.");function g(A,E,v){var O=E.prototype,U;U=A.prototype=Object.create(O),U.constructor=A,U._super=O,v&&y(U,v)}function T(A,E){return function(){return A.apply(E,arguments)}}function C(A,E){return typeof A==a?A.apply(E&&E[0]||s,E):A}function I(A,E){return A===s?E:A}function P(A,E,v){p(F(E),function(O){A.addEventListener(O,v,!1)})}function x(A,E,v){p(F(E),function(O){A.removeEventListener(O,v,!1)})}function N(A,E){for(;A;){if(A==E)return!0;A=A.parentNode}return!1}function D(A,E){return A.indexOf(E)>-1}function F(A){return A.trim().split(/\s+/g)}function X(A,E,v){if(A.indexOf&&!v)return A.indexOf(E);for(var O=0;O<A.length;){if(v&&A[O][v]==E||!v&&A[O]===E)return O;O++}return-1}function q(A){return Array.prototype.slice.call(A,0)}function ee(A,E,v){for(var O=[],U=[],j=0;j<A.length;){var Y=E?A[j][E]:A[j];X(U,Y)<0&&O.push(A[j]),U[j]=Y,j++}return v&&(E?O=O.sort(function(ze,rt){return ze[E]>rt[E]}):O=O.sort()),O}function K(A,E){for(var v,O,U=E[0].toUpperCase()+E.slice(1),j=0;j<i.length;){if(v=i[j],O=v?v+U:E,O in A)return O;j++}return s}var He=1;function sr(){return He++}function On(A){var E=A.ownerDocument||A;return E.defaultView||E.parentWindow||e}var z=/mobile|tablet|ip(ad|hone|od)|android/i,G="ontouchstart"in e,$=K(e,"PointerEvent")!==s,pe=G&&z.test(navigator.userAgent),ce="touch",ir="pen",Bt="mouse",Gr="kinect",xn=25,Me=1,$r=2,Be=4,ct=8,La=1,$i=2,Ki=4,Yi=8,Ji=16,fn=$i|Ki,Kr=Yi|Ji,I_=fn|Kr,M_=["x","y"],Va=["clientX","clientY"];function Pt(A,E){var v=this;this.manager=A,this.callback=E,this.element=A.element,this.target=A.options.inputTarget,this.domHandler=function(O){C(A.options.enable,[A])&&v.handler(O)},this.init()}Pt.prototype={handler:function(){},init:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P(On(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(On(this.element),this.evWin,this.domHandler)}};function iw(A){var E,v=A.options.inputClass;return v?E=v:$?E=qu:pe?E=ja:G?E=Qu:E=za,new E(A,ow)}function ow(A,E,v){var O=v.pointers.length,U=v.changedPointers.length,j=E&Me&&O-U===0,Y=E&(Be|ct)&&O-U===0;v.isFirst=!!j,v.isFinal=!!Y,j&&(A.session={}),v.eventType=E,aw(A,v),A.emit("hammer.input",v),A.recognize(v),A.session.prevInput=v}function aw(A,E){var v=A.session,O=E.pointers,U=O.length;v.firstInput||(v.firstInput=B_(E)),U>1&&!v.firstMultiple?v.firstMultiple=B_(E):U===1&&(v.firstMultiple=!1);var j=v.firstInput,Y=v.firstMultiple,Ue=Y?Y.center:j.center,ze=E.center=P_(O);E.timeStamp=u(),E.deltaTime=E.timeStamp-j.timeStamp,E.angle=Ju(Ue,ze),E.distance=Ha(Ue,ze),cw(v,E),E.offsetDirection=x_(E.deltaX,E.deltaY);var rt=O_(E.deltaTime,E.deltaX,E.deltaY);E.overallVelocityX=rt.x,E.overallVelocityY=rt.y,E.overallVelocity=l(rt.x)>l(rt.y)?rt.x:rt.y,E.scale=Y?hw(Y.pointers,O):1,E.rotation=Y?uw(Y.pointers,O):0,E.maxPointers=v.prevInput?E.pointers.length>v.prevInput.maxPointers?E.pointers.length:v.prevInput.maxPointers:E.pointers.length,lw(v,E);var pn=A.element;N(E.srcEvent.target,pn)&&(pn=E.srcEvent.target),E.target=pn}function cw(A,E){var v=E.center,O=A.offsetDelta||{},U=A.prevDelta||{},j=A.prevInput||{};(E.eventType===Me||j.eventType===Be)&&(U=A.prevDelta={x:j.deltaX||0,y:j.deltaY||0},O=A.offsetDelta={x:v.x,y:v.y}),E.deltaX=U.x+(v.x-O.x),E.deltaY=U.y+(v.y-O.y)}function lw(A,E){var v=A.lastInterval||E,O=E.timeStamp-v.timeStamp,U,j,Y,Ue;if(E.eventType!=ct&&(O>xn||v.velocity===s)){var ze=E.deltaX-v.deltaX,rt=E.deltaY-v.deltaY,pn=O_(O,ze,rt);j=pn.x,Y=pn.y,U=l(pn.x)>l(pn.y)?pn.x:pn.y,Ue=x_(ze,rt),A.lastInterval=E}else U=v.velocity,j=v.velocityX,Y=v.velocityY,Ue=v.direction;E.velocity=U,E.velocityX=j,E.velocityY=Y,E.direction=Ue}function B_(A){for(var E=[],v=0;v<A.pointers.length;)E[v]={clientX:c(A.pointers[v].clientX),clientY:c(A.pointers[v].clientY)},v++;return{timeStamp:u(),pointers:E,center:P_(E),deltaX:A.deltaX,deltaY:A.deltaY}}function P_(A){var E=A.length;if(E===1)return{x:c(A[0].clientX),y:c(A[0].clientY)};for(var v=0,O=0,U=0;U<E;)v+=A[U].clientX,O+=A[U].clientY,U++;return{x:c(v/E),y:c(O/E)}}function O_(A,E,v){return{x:E/A||0,y:v/A||0}}function x_(A,E){return A===E?La:l(A)>=l(E)?A<0?$i:Ki:E<0?Yi:Ji}function Ha(A,E,v){v||(v=M_);var O=E[v[0]]-A[v[0]],U=E[v[1]]-A[v[1]];return Math.sqrt(O*O+U*U)}function Ju(A,E,v){v||(v=M_);var O=E[v[0]]-A[v[0]],U=E[v[1]]-A[v[1]];return Math.atan2(U,O)*180/Math.PI}function uw(A,E){return Ju(E[1],E[0],Va)+Ju(A[1],A[0],Va)}function hw(A,E){return Ha(E[0],E[1],Va)/Ha(A[0],A[1],Va)}var fw={mousedown:Me,mousemove:$r,mouseup:Be},dw="mousedown",pw="mousemove mouseup";function za(){this.evEl=dw,this.evWin=pw,this.pressed=!1,Pt.apply(this,arguments)}g(za,Pt,{handler:function(E){var v=fw[E.type];v&Me&&E.button===0&&(this.pressed=!0),v&$r&&E.which!==1&&(v=Be),this.pressed&&(v&Be&&(this.pressed=!1),this.callback(this.manager,v,{pointers:[E],changedPointers:[E],pointerType:Bt,srcEvent:E}))}});var gw={pointerdown:Me,pointermove:$r,pointerup:Be,pointercancel:ct,pointerout:ct},_w={2:ce,3:ir,4:Bt,5:Gr},N_="pointerdown",F_="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(N_="MSPointerDown",F_="MSPointerMove MSPointerUp MSPointerCancel");function qu(){this.evEl=N_,this.evWin=F_,Pt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}g(qu,Pt,{handler:function(E){var v=this.store,O=!1,U=E.type.toLowerCase().replace("ms",""),j=gw[U],Y=_w[E.pointerType]||E.pointerType,Ue=Y==ce,ze=X(v,E.pointerId,"pointerId");j&Me&&(E.button===0||Ue)?ze<0&&(v.push(E),ze=v.length-1):j&(Be|ct)&&(O=!0),!(ze<0)&&(v[ze]=E,this.callback(this.manager,j,{pointers:v,changedPointers:[E],pointerType:Y,srcEvent:E}),O&&v.splice(ze,1))}});var mw={touchstart:Me,touchmove:$r,touchend:Be,touchcancel:ct},Aw="touchstart",yw="touchstart touchmove touchend touchcancel";function D_(){this.evTarget=Aw,this.evWin=yw,this.started=!1,Pt.apply(this,arguments)}g(D_,Pt,{handler:function(E){var v=mw[E.type];if(v===Me&&(this.started=!0),!!this.started){var O=Tw.call(this,E,v);v&(Be|ct)&&O[0].length-O[1].length===0&&(this.started=!1),this.callback(this.manager,v,{pointers:O[0],changedPointers:O[1],pointerType:ce,srcEvent:E})}}});function Tw(A,E){var v=q(A.touches),O=q(A.changedTouches);return E&(Be|ct)&&(v=ee(v.concat(O),"identifier",!0)),[v,O]}var Ew={touchstart:Me,touchmove:$r,touchend:Be,touchcancel:ct},Sw="touchstart touchmove touchend touchcancel";function ja(){this.evTarget=Sw,this.targetIds={},Pt.apply(this,arguments)}g(ja,Pt,{handler:function(E){var v=Ew[E.type],O=Cw.call(this,E,v);O&&this.callback(this.manager,v,{pointers:O[0],changedPointers:O[1],pointerType:ce,srcEvent:E})}});function Cw(A,E){var v=q(A.touches),O=this.targetIds;if(E&(Me|$r)&&v.length===1)return O[v[0].identifier]=!0,[v,v];var U,j,Y=q(A.changedTouches),Ue=[],ze=this.target;if(j=v.filter(function(rt){return N(rt.target,ze)}),E===Me)for(U=0;U<j.length;)O[j[U].identifier]=!0,U++;for(U=0;U<Y.length;)O[Y[U].identifier]&&Ue.push(Y[U]),E&(Be|ct)&&delete O[Y[U].identifier],U++;if(Ue.length)return[ee(j.concat(Ue),"identifier",!0),Ue]}var vw=2500,U_=25;function Qu(){Pt.apply(this,arguments);var A=T(this.handler,this);this.touch=new ja(this.manager,A),this.mouse=new za(this.manager,A),this.primaryTouch=null,this.lastTouches=[]}g(Qu,Pt,{handler:function(E,v,O){var U=O.pointerType==ce,j=O.pointerType==Bt;if(!(j&&O.sourceCapabilities&&O.sourceCapabilities.firesTouchEvents)){if(U)ww.call(this,v,O);else if(j&&Rw.call(this,O))return;this.callback(E,v,O)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ww(A,E){A&Me?(this.primaryTouch=E.changedPointers[0].identifier,k_.call(this,E)):A&(Be|ct)&&k_.call(this,E)}function k_(A){var E=A.changedPointers[0];if(E.identifier===this.primaryTouch){var v={x:E.clientX,y:E.clientY};this.lastTouches.push(v);var O=this.lastTouches,U=function(){var j=O.indexOf(v);j>-1&&O.splice(j,1)};setTimeout(U,vw)}}function Rw(A){for(var E=A.srcEvent.clientX,v=A.srcEvent.clientY,O=0;O<this.lastTouches.length;O++){var U=this.lastTouches[O],j=Math.abs(E-U.x),Y=Math.abs(v-U.y);if(j<=U_&&Y<=U_)return!0}return!1}var L_=K(o.style,"touchAction"),V_=L_!==s,H_="compute",z_="auto",Zu="manipulation",Yr="none",qi="pan-x",Qi="pan-y",Wa=Iw();function eh(A,E){this.manager=A,this.set(E)}eh.prototype={set:function(A){A==H_&&(A=this.compute()),V_&&this.manager.element.style&&Wa[A]&&(this.manager.element.style[L_]=A),this.actions=A.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var A=[];return p(this.manager.recognizers,function(E){C(E.options.enable,[E])&&(A=A.concat(E.getTouchAction()))}),bw(A.join(" "))},preventDefaults:function(A){var E=A.srcEvent,v=A.offsetDirection;if(this.manager.session.prevented){E.preventDefault();return}var O=this.actions,U=D(O,Yr)&&!Wa[Yr],j=D(O,Qi)&&!Wa[Qi],Y=D(O,qi)&&!Wa[qi];if(U){var Ue=A.pointers.length===1,ze=A.distance<2,rt=A.deltaTime<250;if(Ue&&ze&&rt)return}if(!(Y&&j)&&(U||j&&v&fn||Y&&v&Kr))return this.preventSrc(E)},preventSrc:function(A){this.manager.session.prevented=!0,A.preventDefault()}};function bw(A){if(D(A,Yr))return Yr;var E=D(A,qi),v=D(A,Qi);return E&&v?Yr:E||v?E?qi:Qi:D(A,Zu)?Zu:z_}function Iw(){if(!V_)return!1;var A={},E=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(v){A[v]=E?e.CSS.supports("touch-action",v):!0}),A}var Xa=1,Ot=2,Ps=4,or=8,Nn=or,Zi=16,dn=32;function Fn(A){this.options=y({},this.defaults,A||{}),this.id=sr(),this.manager=null,this.options.enable=I(this.options.enable,!0),this.state=Xa,this.simultaneous={},this.requireFail=[]}Fn.prototype={defaults:{},set:function(A){return y(this.options,A),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(A){if(f(A,"recognizeWith",this))return this;var E=this.simultaneous;return A=Ga(A,this),E[A.id]||(E[A.id]=A,A.recognizeWith(this)),this},dropRecognizeWith:function(A){return f(A,"dropRecognizeWith",this)?this:(A=Ga(A,this),delete this.simultaneous[A.id],this)},requireFailure:function(A){if(f(A,"requireFailure",this))return this;var E=this.requireFail;return A=Ga(A,this),X(E,A)===-1&&(E.push(A),A.requireFailure(this)),this},dropRequireFailure:function(A){if(f(A,"dropRequireFailure",this))return this;A=Ga(A,this);var E=X(this.requireFail,A);return E>-1&&this.requireFail.splice(E,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(A){return!!this.simultaneous[A.id]},emit:function(A){var E=this,v=this.state;function O(U){E.manager.emit(U,A)}v<or&&O(E.options.event+j_(v)),O(E.options.event),A.additionalEvent&&O(A.additionalEvent),v>=or&&O(E.options.event+j_(v))},tryEmit:function(A){if(this.canEmit())return this.emit(A);this.state=dn},canEmit:function(){for(var A=0;A<this.requireFail.length;){if(!(this.requireFail[A].state&(dn|Xa)))return!1;A++}return!0},recognize:function(A){var E=y({},A);if(!C(this.options.enable,[this,E])){this.reset(),this.state=dn;return}this.state&(Nn|Zi|dn)&&(this.state=Xa),this.state=this.process(E),this.state&(Ot|Ps|or|Zi)&&this.tryEmit(E)},process:function(A){},getTouchAction:function(){},reset:function(){}};function j_(A){return A&Zi?"cancel":A&or?"end":A&Ps?"move":A&Ot?"start":""}function W_(A){return A==Ji?"down":A==Yi?"up":A==$i?"left":A==Ki?"right":""}function Ga(A,E){var v=E.manager;return v?v.get(A):A}function Xt(){Fn.apply(this,arguments)}g(Xt,Fn,{defaults:{pointers:1},attrTest:function(A){var E=this.options.pointers;return E===0||A.pointers.length===E},process:function(A){var E=this.state,v=A.eventType,O=E&(Ot|Ps),U=this.attrTest(A);return O&&(v&ct||!U)?E|Zi:O||U?v&Be?E|or:E&Ot?E|Ps:Ot:dn}});function $a(){Xt.apply(this,arguments),this.pX=null,this.pY=null}g($a,Xt,{defaults:{event:"pan",threshold:10,pointers:1,direction:I_},getTouchAction:function(){var A=this.options.direction,E=[];return A&fn&&E.push(Qi),A&Kr&&E.push(qi),E},directionTest:function(A){var E=this.options,v=!0,O=A.distance,U=A.direction,j=A.deltaX,Y=A.deltaY;return U&E.direction||(E.direction&fn?(U=j===0?La:j<0?$i:Ki,v=j!=this.pX,O=Math.abs(A.deltaX)):(U=Y===0?La:Y<0?Yi:Ji,v=Y!=this.pY,O=Math.abs(A.deltaY))),A.direction=U,v&&O>E.threshold&&U&E.direction},attrTest:function(A){return Xt.prototype.attrTest.call(this,A)&&(this.state&Ot||!(this.state&Ot)&&this.directionTest(A))},emit:function(A){this.pX=A.deltaX,this.pY=A.deltaY;var E=W_(A.direction);E&&(A.additionalEvent=this.options.event+E),this._super.emit.call(this,A)}});function th(){Xt.apply(this,arguments)}g(th,Xt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Yr]},attrTest:function(A){return this._super.attrTest.call(this,A)&&(Math.abs(A.scale-1)>this.options.threshold||this.state&Ot)},emit:function(A){if(A.scale!==1){var E=A.scale<1?"in":"out";A.additionalEvent=this.options.event+E}this._super.emit.call(this,A)}});function nh(){Fn.apply(this,arguments),this._timer=null,this._input=null}g(nh,Fn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[z_]},process:function(A){var E=this.options,v=A.pointers.length===E.pointers,O=A.distance<E.threshold,U=A.deltaTime>E.time;if(this._input=A,!O||!v||A.eventType&(Be|ct)&&!U)this.reset();else if(A.eventType&Me)this.reset(),this._timer=h(function(){this.state=Nn,this.tryEmit()},E.time,this);else if(A.eventType&Be)return Nn;return dn},reset:function(){clearTimeout(this._timer)},emit:function(A){this.state===Nn&&(A&&A.eventType&Be?this.manager.emit(this.options.event+"up",A):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function rh(){Xt.apply(this,arguments)}g(rh,Xt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Yr]},attrTest:function(A){return this._super.attrTest.call(this,A)&&(Math.abs(A.rotation)>this.options.threshold||this.state&Ot)}});function sh(){Xt.apply(this,arguments)}g(sh,Xt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:fn|Kr,pointers:1},getTouchAction:function(){return $a.prototype.getTouchAction.call(this)},attrTest:function(A){var E=this.options.direction,v;return E&(fn|Kr)?v=A.overallVelocity:E&fn?v=A.overallVelocityX:E&Kr&&(v=A.overallVelocityY),this._super.attrTest.call(this,A)&&E&A.offsetDirection&&A.distance>this.options.threshold&&A.maxPointers==this.options.pointers&&l(v)>this.options.velocity&&A.eventType&Be},emit:function(A){var E=W_(A.offsetDirection);E&&this.manager.emit(this.options.event+E,A),this.manager.emit(this.options.event,A)}});function Ka(){Fn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}g(Ka,Fn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Zu]},process:function(A){var E=this.options,v=A.pointers.length===E.pointers,O=A.distance<E.threshold,U=A.deltaTime<E.time;if(this.reset(),A.eventType&Me&&this.count===0)return this.failTimeout();if(O&&U&&v){if(A.eventType!=Be)return this.failTimeout();var j=this.pTime?A.timeStamp-this.pTime<E.interval:!0,Y=!this.pCenter||Ha(this.pCenter,A.center)<E.posThreshold;this.pTime=A.timeStamp,this.pCenter=A.center,!Y||!j?this.count=1:this.count+=1,this._input=A;var Ue=this.count%E.taps;if(Ue===0)return this.hasRequireFailures()?(this._timer=h(function(){this.state=Nn,this.tryEmit()},E.interval,this),Ot):Nn}return dn},failTimeout:function(){return this._timer=h(function(){this.state=dn},this.options.interval,this),dn},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Nn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Dn(A,E){return E=E||{},E.recognizers=I(E.recognizers,Dn.defaults.preset),new ih(A,E)}Dn.VERSION="2.0.7",Dn.defaults={domEvents:!1,touchAction:H_,enable:!0,inputTarget:null,inputClass:null,preset:[[rh,{enable:!1}],[th,{enable:!1},["rotate"]],[sh,{direction:fn}],[$a,{direction:fn},["swipe"]],[Ka],[Ka,{event:"doubletap",taps:2},["tap"]],[nh]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Mw=1,X_=2;function ih(A,E){this.options=y({},Dn.defaults,E||{}),this.options.inputTarget=this.options.inputTarget||A,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=A,this.input=iw(this),this.touchAction=new eh(this,this.options.touchAction),G_(this,!0),p(this.options.recognizers,function(v){var O=this.add(new v[0](v[1]));v[2]&&O.recognizeWith(v[2]),v[3]&&O.requireFailure(v[3])},this)}ih.prototype={set:function(A){return y(this.options,A),A.touchAction&&this.touchAction.update(),A.inputTarget&&(this.input.destroy(),this.input.target=A.inputTarget,this.input.init()),this},stop:function(A){this.session.stopped=A?X_:Mw},recognize:function(A){var E=this.session;if(!E.stopped){this.touchAction.preventDefaults(A);var v,O=this.recognizers,U=E.curRecognizer;(!U||U&&U.state&Nn)&&(U=E.curRecognizer=null);for(var j=0;j<O.length;)v=O[j],E.stopped!==X_&&(!U||v==U||v.canRecognizeWith(U))?v.recognize(A):v.reset(),!U&&v.state&(Ot|Ps|or)&&(U=E.curRecognizer=v),j++}},get:function(A){if(A instanceof Fn)return A;for(var E=this.recognizers,v=0;v<E.length;v++)if(E[v].options.event==A)return E[v];return null},add:function(A){if(f(A,"add",this))return this;var E=this.get(A.options.event);return E&&this.remove(E),this.recognizers.push(A),A.manager=this,this.touchAction.update(),A},remove:function(A){if(f(A,"remove",this))return this;if(A=this.get(A),A){var E=this.recognizers,v=X(E,A);v!==-1&&(E.splice(v,1),this.touchAction.update())}return this},on:function(A,E){if(A!==s&&E!==s){var v=this.handlers;return p(F(A),function(O){v[O]=v[O]||[],v[O].push(E)}),this}},off:function(A,E){if(A!==s){var v=this.handlers;return p(F(A),function(O){E?v[O]&&v[O].splice(X(v[O],E),1):delete v[O]}),this}},emit:function(A,E){this.options.domEvents&&Bw(A,E);var v=this.handlers[A]&&this.handlers[A].slice();if(!(!v||!v.length)){E.type=A,E.preventDefault=function(){E.srcEvent.preventDefault()};for(var O=0;O<v.length;)v[O](E),O++}},destroy:function(){this.element&&G_(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function G_(A,E){var v=A.element;if(v.style){var O;p(A.options.cssProps,function(U,j){O=K(v.style,j),E?(A.oldCssProps[O]=v.style[O],v.style[O]=U):v.style[O]=A.oldCssProps[O]||""}),E||(A.oldCssProps={})}}function Bw(A,E){var v=n.createEvent("Event");v.initEvent(A,!0,!0),v.gesture=E,E.target.dispatchEvent(v)}y(Dn,{INPUT_START:Me,INPUT_MOVE:$r,INPUT_END:Be,INPUT_CANCEL:ct,STATE_POSSIBLE:Xa,STATE_BEGAN:Ot,STATE_CHANGED:Ps,STATE_ENDED:or,STATE_RECOGNIZED:Nn,STATE_CANCELLED:Zi,STATE_FAILED:dn,DIRECTION_NONE:La,DIRECTION_LEFT:$i,DIRECTION_RIGHT:Ki,DIRECTION_UP:Yi,DIRECTION_DOWN:Ji,DIRECTION_HORIZONTAL:fn,DIRECTION_VERTICAL:Kr,DIRECTION_ALL:I_,Manager:ih,Input:Pt,TouchAction:eh,TouchInput:ja,MouseInput:za,PointerEventInput:qu,TouchMouseInput:Qu,SingleTouchInput:D_,Recognizer:Fn,AttrRecognizer:Xt,Tap:Ka,Pan:$a,Swipe:sh,Pinch:th,Rotate:rh,Press:nh,on:P,off:x,each:p,merge:_,extend:w,assign:y,inherit:g,bindFn:T,prefixed:K});var Pw=typeof e<"u"?e:typeof self<"u"?self:{};Pw.Hammer=Dn,typeof s=="function"&&s.amd?s(function(){return Dn}):t.exports?t.exports=Dn:e[r]=Dn})(window,document,"Hammer")})(kv);var Fa=kv.exports;const UU=M0(Fa),yn=Nw({__proto__:null,default:UU},[Fa]),Lv=1,Vv=2,ap=4,kU={mousedown:Lv,mousemove:Vv,mouseup:ap};function LU(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function VU(t){const e=t.prototype.handler;t.prototype.handler=function(r){const s=this.store;r.button>0&&r.type==="pointerdown"&&(LU(s,i=>i.pointerId===r.pointerId)||s.push(r)),e.call(this,r)}}function HU(t){t.prototype.handler=function(n){let r=kU[n.type];r&Lv&&n.button>=0&&(this.pressed=!0),r&Vv&&n.buttons===0&&(r=ap),this.pressed&&(r&ap&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}VU(Fa.PointerEventInput);HU(Fa.MouseInput);const zU=Fa.Manager;class zu{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const jU=yn?[[yn.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[yn.Rotate,{enable:!1}],[yn.Pinch,{enable:!1}],[yn.Swipe,{enable:!1}],[yn.Pan,{threshold:0,enable:!1}],[yn.Press,{enable:!1}],[yn.Tap,{event:"doubletap",taps:2,enable:!1}],[yn.Tap,{event:"anytap",enable:!1}],[yn.Tap,{enable:!1}]]:null,zy={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},WU={doubletap:["tap"]},XU={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},r_={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},GU={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},jy={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},$U=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",ci=typeof window<"u"?window:global;let cp=!1;try{const t={get passive(){return cp=!0,!0}};ci.addEventListener("test",null,t),ci.removeEventListener("test",null)}catch{cp=!1}const KU=$U.indexOf("firefox")!==-1,{WHEEL_EVENTS:YU}=r_,Wy="wheel",Xy=4.000244140625,JU=40,qU=.25;class QU extends zu{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{if(!this.options.enable)return;let i=s.deltaY;ci.WheelEvent&&(KU&&s.deltaMode===ci.WheelEvent.DOM_DELTA_PIXEL&&(i/=ci.devicePixelRatio),s.deltaMode===ci.WheelEvent.DOM_DELTA_LINE&&(i*=JU)),i!==0&&i%Xy===0&&(i=Math.floor(i/Xy)),s.shiftKey&&i&&(i=i*qU),this.callback({type:Wy,center:{x:s.clientX,y:s.clientY},delta:-i,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat(YU),this.events.forEach(s=>e.addEventListener(s,this.handleEvent,cp?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Wy&&(this.options.enable=n)}}const{MOUSE_EVENTS:ZU}=r_,Gy="pointermove",$y="pointerover",Ky="pointerout",Yy="pointerenter",Jy="pointerleave";class ek extends zu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.handleOverEvent(i),this.handleOutEvent(i),this.handleEnterEvent(i),this.handleLeaveEvent(i),this.handleMoveEvent(i)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(ZU),this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Gy&&(this.enableMoveEvent=n),e===$y&&(this.enableOverEvent=n),e===Ky&&(this.enableOutEvent=n),e===Yy&&(this.enableEnterEvent=n),e===Jy&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit($y,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(Ky,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(Yy,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(Jy,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(Gy,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:tk}=r_,qy="keydown",Qy="keyup";class nk extends zu{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{const i=s.target||s.srcElement;i.tagName==="INPUT"&&i.type==="text"||i.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:qy,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:Qy,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(tk),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===qy&&(this.enableDownEvent=n),e===Qy&&(this.enableUpEvent=n)}}const Zy="contextmenu";class rk extends zu{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{this.options.enable&&this.callback({type:Zy,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===Zy&&(this.options.enable=n)}}const eT=1,lp=2,tT=4,sk={pointerdown:eT,pointermove:lp,pointerup:tT,mousedown:eT,mousemove:lp,mouseup:tT},ik=0,ok=1,ak=2,ck=1,lk=2,uk=4;function hk(t){const e=sk[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let s=!1,i=!1,o=!1;return e===lp?(s=!!(n&ck),i=!!(n&uk),o=!!(n&lk)):(s=r===ik,i=r===ok,o=r===ak),{leftButton:s,middleButton:i,rightButton:o}}function fk(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),s=r.width/e.offsetWidth||1,i=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/s,y:(n.y-r.top-e.clientTop)/i};return{center:n,offsetCenter:o}}const lf={srcElement:"root",priority:0};class dk{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let s=n.srcEvent.target;for(;s&&s!==r.rootElement;){if(this._emit(r,s),r.handled)return;s=s.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,s=!1,i=!1){const{handlers:o,handlersByElement:a}=this;let c=lf;typeof r=="string"||r&&r.addEventListener?c={...lf,srcElement:r}:r&&(c={...lf,...r});let l=a.get(c.srcElement);l||(l=[],a.set(c.srcElement,l));const u={type:e,handler:n,srcElement:c.srcElement,priority:c.priority};s&&(u.once=!0),i&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let h=l.length-1;for(;h>=0&&!(l[h].priority>=u.priority);)h--;l.splice(h+1,0,u)}remove(e,n){const{handlers:r,handlersByElement:s}=this;for(let i=r.length-1;i>=0;i--){const o=r[i];if(o.type===e&&o.handler===n){r.splice(i,1);const a=s.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&s.delete(o.srcElement)}}this._active=r.some(i=>!i.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let s=!1;const i=()=>{e.handled=!0},o=()=>{e.handled=!0,s=!0},a=[];for(let c=0;c<r.length;c++){const{type:l,handler:u,once:h}=r[c];if(u({...e,type:l,stopPropagation:i,stopImmediatePropagation:o}),h&&a.push(r[c]),s)break}for(let c=0;c<a.length;c++){const{type:l,handler:u}=a[c];this.remove(l,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...hk(e),...fk(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const pk={events:null,recognizers:null,recognizerOptions:{},Manager:zU,touchAction:"none",tabIndex:0};class gk{constructor(e=null,n){this._onBasicInput=s=>{const{srcEvent:i}=s,o=XU[i.type];o&&this.manager.emit(o,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...pk,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||jU}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(zy).forEach(s=>{const i=this.manager.get(s);i&&zy[s].forEach(o=>{i.recognizeWith(o)})});for(const s in n.recognizerOptions){const i=this.manager.get(s);if(i){const o=n.recognizerOptions[s];delete o.enable,i.set(o)}}this.wheelInput=new QU(e,this._onOtherEvent,{enable:!1}),this.moveInput=new ek(e,this._onOtherEvent,{enable:!1}),this.keyInput=new nk(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new rk(e,this._onOtherEvent,{enable:!1});for(const[s,i]of this.events)i.isEmpty()||(this._toggleRecognizer(i.recognizerName,!0),this.manager.on(s,i.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const s=r.get(e);if(s&&s.options.enable!==n){s.set({enable:n});const i=WU[e];i&&!this.options.recognizers&&i.forEach(o=>{const a=r.get(o);n?(a.requireFailure(e),s.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,s,i){if(typeof e!="string"){r=n;for(const u in e)this._addEventHandler(u,e[u],r,s,i);return}const{manager:o,events:a}=this,c=jy[e]||e;let l=a.get(c);l||(l=new dk(this),a.set(c,l),l.recognizerName=GU[c]||c,o&&o.on(c,l.handleEvent)),l.add(e,n,r,s,i),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:r}=this,s=jy[e]||e,i=r.get(s);if(i&&(i.remove(e,n),i.isEmpty())){const{recognizerName:o}=i;let a=!1;for(const c of r.values())if(c.recognizerName===o&&!c.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function hr(){}const _k=({isDragging:t})=>t?"grabbing":"grab",Hv={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:hr,onWebGLInitialized:hr,onResize:hr,onViewStateChange:hr,onInteractionStateChange:hr,onBeforeRender:hr,onAfterRender:hr,onLoad:hr,onError:t=>ie.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:_k,getTooltip:null,debug:!1,drawPickingColors:!1};class s_{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Xi({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:s}=this;if(r.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(r.leftButton||r.rightButton)return;{const i=r.offsetCenter;if(!i)return;s.x=i.x,s.y=i.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=r},this._onEvent=r=>{const s=Jd[r.type],i=r.offsetCenter;if(!s||!i||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:o,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:c}=a,l=c&&(c[s.handler]||c.props[s.handler]),u=this.props[s.handler];let h=!1;l&&(h=l.call(c,a,r)),h||(u==null||u(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{const s=r.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo},this.props={...Hv,...e},e=this.props,e.viewState&&e.initialViewState&&ie.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&ie.error("WebGL1 context not supported.")(),this.device=Xo.attach(e.gl));let n=this.device;n||(Ai.registerDevices([Xo]),n=Ai.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&ma.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,s,i,o,a,c,l,u;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(i=this.effectManager)==null||i.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(c=this.eventManager)==null||c.destroy(),this.eventManager=null,(l=this.widgetManager)==null||l.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((u=this.canvas.parentElement)==null||u.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ie.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ie.removed("onLayerClick","onClick")(),e.initialViewState&&!tn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),i=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||s||i||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Ze(this.viewManager),this.viewManager.views}getViewports(e){return Ze(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){Ze(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(n).timeStart();const i=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return s.get(n).timeEnd(),i}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Ze(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var s;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const i=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=i}if(r||r===0){const i=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((s=e.style)==null?void 0:s.position)||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){var s,i;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(s=this.viewManager)==null||s.setProps({width:n,height:r}),(i=this.layerManager)==null||i.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:s,useDevicePixels:i}=n;return new VN({device:e,useDevicePixels:i,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new AF({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,s;const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let a=o,c=!1;for(const l of i)a=l,c=((n=l.layer)==null?void 0:n.onHover(l,e.event))||c;c||((s=(r=this.props).onHover)==null||s.call(r,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var s,i;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(s=this.device.canvasContext)==null?void 0:s.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Xo&&this.props.onWebGLInitialized(this.device.gl);const n=new Av;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new gk(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in Jd)this.eventManager.on(o,this._onEvent);this.viewManager=new sF({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new rF(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new EF({deck:this,device:this.device}),this.deckRenderer=new vF(this.device),this.deckPicker=new BF(this.device),this.widgetManager=new xF({deck:this,parentElement:(i=this.canvas)==null?void 0:i.parentElement}),this.widgetManager.addDefault(new FF),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:s});const i={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(i),i.pass==="screen"&&this.widgetManager.onRedraw({viewports:i.viewports,layers:i.layers}),this.props.onAfterRender({device:r,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ie.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=Ai.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}s_.defaultProps=Hv;s_.VERSION=mB;const mk=s_;function Ak(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return bC(t)}}const yk=RC;function Ic(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function us(t){return t.stride||t.size*t.bytesPerElement}function Tk(t,e){return t.type===e.type&&t.size===e.size&&us(t)===us(e)&&(t.offset||0)===(e.offset||0)}function up(t,e){e.offset&&ie.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=us(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,s=e.elementOffset||0,i=r*n+s*t.bytesPerElement+(t.offset||0);return{...e,offset:i,stride:n}}function Ek(t,e){const n=up(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class Sk{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const s=n.logicalType||n.type,i=s==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;i?a="float32":!s&&n.isIndexed?a="uint32":a=s||"float32";let c=Ak(s||a);this.doublePrecision=i,i&&n.fp64===!1&&(c=Float32Array),this.value=null,this.settings={...n,defaultType:c,defaultValue:o,logicalType:s,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:c.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*us(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),ma.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const s=this.value;if(n){const i=up(this.getAccessor(),n),o=i.offset/s.BYTES_PER_ELEMENT,a=i.size||this.size;r[e]=s.subarray(o,o+a)}else r[e]=s}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),s=[],i={name:this.id,byteStride:us(r),attributes:s};if(this.doublePrecision){const o=Ek(r,n||{});s.push(Ic(e,{...r,...o.high}),Ic(`${e}64Low`,{...r,...o.low}))}else if(n){const o=up(r,n);s.push(Ic(e,{...r,...o}))}else s.push(Ic(e,r));return i}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:s}=this,i=r*s;if(n&&i&&n.length>=i){const o=new Array(s).fill(1/0),a=new Array(s).fill(-1/0);for(let c=0;c<i;)for(let l=0;l<s;l++){const u=n[c++];u<o[l]&&(o[l]=u),u>a[l]&&(a[l]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Se?r={buffer:e}:r=e;const s={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)s.type="float32";else{const o=yk(r.value);s.type=s.normalized?o.replace("int","norm"):o}s.bytesPerElement=r.value.BYTES_PER_ELEMENT,s.stride=us(s)}if(n.bounds=null,r.constant){let i=r.value;if(i=this._normalizeValue(i,[],0),this.settings.normalized&&(i=this.normalizeConstant(i)),!(!n.constant||!this._areValuesEqual(i,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(i)?i:new Float32Array(i)}else if(r.buffer){const i=r.buffer;n.externalBuffer=i,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let i=r.value;n.externalBuffer=null,n.constant=!1,this.value=i;let{buffer:o}=this;const a=us(s),c=(s.vertexOffset||0)*a;if(this.doublePrecision&&i instanceof Float64Array&&(i=Yh(i,s)),this.settings.isIndexed){const u=this.settings.defaultType;i.constructor!==u&&(i=new u(i))}const l=i.byteLength+c+a*2;(!o||o.byteLength<l)&&(o=this._createBuffer(l)),o.write(i,c)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?Yh(n,{size:this.size,startIndex:r,endIndex:s}):n.subarray(r,s),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,s=r.allocatedValue,i=ma.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=i;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<i.byteLength+o)&&(a=this._createBuffer(i.byteLength+o),n&&s&&a.write(s instanceof Float64Array?Yh(s,this):s,o)),r.allocatedValue=i,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=n.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&ie.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:s,size:i}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=i;for(;--o>=0;)n[r+o]=s[o];return n}switch(i){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let o=i;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:s[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let s=0;s<r;s++)if(e[s]!==n[s])return!1;return!0}_createBuffer(e){var s;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(s=this._buffer)==null?void 0:s.props,id:this.id,usage:n?Se.INDEX:Se.VERTEX,indexType:n?r:void 0,byteLength:e}),this._buffer}}const nT=[],rT=[];function zv(t,e=0,n=1/0){let r=nT;const s={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(rT.length=t.length,r=rT):r=nT,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),s.index=e-1),{iterable:r,objectInfo:s}}function jv(t){return t&&t[Symbol.asyncIterator]}function Ck(t,e){const{size:n,stride:r,offset:s,startIndices:i,nested:o}=e,a=t.BYTES_PER_ELEMENT,c=r?r/a:n,l=s?s/a:0,u=Math.floor((t.length-l)/c);return(h,{index:f,target:p})=>{if(!i){const _=f*c+l;for(let g=0;g<n;g++)p[g]=t[_+g];return p}const m=i[f],y=i[f+1]||u;let w;if(o){w=new Array(y-m);for(let _=m;_<y;_++){const g=_*c+l;p=new Array(n);for(let T=0;T<n;T++)p[T]=t[g+T];w[_-m]=p}}else if(c===n)w=t.subarray(m*n+l,y*n+l);else{w=new t.constructor((y-m)*n);let _=0;for(let g=m;g<y;g++){const T=g*c+l;for(let C=0;C<n;C++)w[_++]=t[T+C]}}return w}}const vk=[],nl=[[0,1/0]];function wk(t,e){if(t===nl||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let s=0;for(let i=0;i<r;i++){const o=t[i];o[1]<e[0]?(n.push(o),s=i+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(s,0,e),n}const Rk={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function Wv(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...Rk[n],...e,...t,type:n}}class Xv extends Sk{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:nl}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!Tk(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,s=Array.isArray(n)?e[n.find(i=>e[i])]:e[n];return Wv(s,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:s=1/0}=n;this.state.updateRanges=wk(this.state.updateRanges,[r,s])}else this.state.updateRanges=nl}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=vk}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==nl),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:i},settings:{update:o,noAlloc:a}}=this;let c=!0;if(o){for(const[l,u]of i)o.call(s,this,{data:n,startRow:l,endRow:u,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[l,u]of i){const h=Number.isFinite(l)?this.getVertexOffset(l):0,f=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:h,endOffset:f})}this._checkAttributeArray()}else c=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),c}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:s}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),s.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Ze(ArrayBuffer.isView(o.value),`invalid ${s.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=Ck(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=s??"vertex",!n)return r;for(const i in n){const o=super._getBufferLayout(i,n[i]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:s,props:i,numInstances:o}){if(e.constant)return;const{settings:a,state:c,value:l,size:u,startIndices:h}=e,{accessor:f,transform:p}=a,m=c.binaryAccessor||(typeof f=="function"?f:i[f]);Ze(typeof m=="function",`accessor "${f}" is not a function`);let y=e.getVertexOffset(r);const{iterable:w,objectInfo:_}=zv(n,r,s);for(const g of w){_.index++;let T=m(g,_);if(p&&(T=p.call(this,T)),h){const C=(_.index<h.length-1?h[_.index+1]:o)-h[_.index];if(T&&Array.isArray(T[0])){let I=y;for(const P of T)e._normalizeValue(P,l,I),I+=u}else T&&T.length>u?l.set(T,y):(e._normalizeValue(T,_.target,0),QN({target:l,source:_.target,start:y,count:C}));y+=C*u}else e._normalizeValue(T,l,y),y+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function uf(t){const{source:e,target:n,start:r=0,size:s,getData:i}=t,o=t.end||n.length,a=e.length,c=o-r;if(a>c){n.set(e.subarray(0,c),r);return}if(n.set(e,r),!i)return;let l=a;for(;l<c;){const u=i(l,e);for(let h=0;h<s;h++)n[r+l]=u[h]||0,l++}}function bk({source:t,target:e,size:n,getData:r,sourceStartIndices:s,targetStartIndices:i}){if(!s||!i)return uf({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const c=r&&((u,h)=>r(u+a,h)),l=Math.min(s.length,i.length);for(let u=1;u<l;u++){const h=s[u]*n,f=i[u]*n;uf({source:t.subarray(o,h),target:e,start:a,end:f,size:n,getData:c}),o=h,a=f}return a<e.length&&uf({source:[],target:e,start:a,size:n,getData:c}),e}function Ik(t){const{device:e,settings:n,value:r}=t,s=new Xv(e,n);return s.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),s}function Gv(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function $v(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Kv(t){t.push(t.shift())}function Mk(t,e){const{doublePrecision:n,settings:r,value:s,size:i}=t,o=n&&s instanceof Float64Array?2:1;let a=0;const{shaderAttributes:c}=t.settings;if(c)for(const l of Object.values(c))a=Math.max(a,l.vertexOffset??0);return(r.noAlloc?s.length:(e+a)*i)*o}function Yv({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function Jv({device:t,buffer:e,attribute:n,fromLength:r,toLength:s,fromStartIndices:i,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,c=n.size*a,l=n.byteOffset,u=n.settings.bytesPerElement<4?l/n.settings.bytesPerElement*4:l,h=n.startIndices,f=i&&h,p=n.isConstant;if(!f&&e&&r>=s)return e;const m=n.value instanceof Float64Array?Float32Array:n.value.constructor,y=p?n.value:new m(n.getBuffer().readSyncWebGL(l,s*m.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!p){const T=o;o=(C,I)=>n.normalizeConstant(T(C,I))}const w=p?(T,C)=>o(y,C):(T,C)=>o(y.subarray(T+l,T+l+c),C),_=e?new Float32Array(e.readSyncWebGL(u,r*4).buffer):new Float32Array(0),g=new Float32Array(s);return bk({source:_,target:g,sourceStartIndices:i,targetStartIndices:h,size:c,getData:w}),(!e||e.byteLength<g.byteLength+u)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:g.byteLength+u,usage:35050})),e.write(g,u),e}class qv{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Lu(r),this.attribute=n,this.attributeInTransition=Ik(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Mk(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class Bk extends qv{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=xk(e,n)}start(e,n){const r=this.currentLength,s=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:i,attribute:o}=this;Kv(i),i[0]=Jv({device:this.device,buffer:i[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),i[1]=Yv({device:this.device,source:i[0],target:i[1]}),this.setBuffer(i[1]);const{transform:a}=this,c=a.model;let l=Math.floor(this.currentLength/o.size);Qv(o)&&(l/=2),c.setVertexCount(l),o.isConstant?(c.setAttributes({aFrom:i[0]}),c.setConstantAttributes({aTo:o.value})):c.setAttributes({aFrom:i[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:i[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let s=r/e;n&&(s=n(s));const{model:i}=this.transform;i.setUniforms({time:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const Pk=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,Ok=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Qv(t){return t.doublePrecision&&t.value instanceof Float64Array}function xk(t,e){const n=e.size,r=Gv(n),s=$v(n),i=e.getBufferLayout();return Qv(e)?new ya(t,{vs:Ok,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*n}]}],modules:[W2],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new ya(t,{vs:Pk,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:i.attributes[0].format}],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class Nk extends qv{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=kk(e),this.framebuffer=Lk(e,this.texture),this.transform=Uk(e,n)}start(e,n){const r=this.currentLength,s=this.currentStartIndices;super.start(e,n);const{buffers:i,attribute:o}=this;for(let c=0;c<2;c++)i[c]=Jv({device:this.device,buffer:i[c],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});i[2]=Yv({device:this.device,source:i[0],target:i[2]}),this.setBuffer(i[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:s}=this,i=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]}),n.model.setUniforms({stiffness:i.stiffness,damping:i.damping}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Kv(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const Fk=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Dk=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function Uk(t,e){const n=Gv(e.size),r=$v(e.size);return new ya(t,{vs:Fk,fs:Dk,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function kk(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Lk(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const Vk={interpolation:Bk,spring:Nk};class Hk{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const s in e){const i=e[s],o=i.getTransitionSetting(n);o&&this._updateAttribute(s,i,o)}for(const s in this.transitions){const i=e[s];(!i||!i.getTransitionSetting(n))&&this._removeTransition(s)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const s=this.transitions[e];let i=!s||s.type!==r.type;if(i){s&&this._removeTransition(e);const o=Vk[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(ie.error(`unsupported transition type '${r.type}'`)(),i=!1)}(i||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const sT="attributeManager.invalidate",zk="attributeManager.updateStart",jk="attributeManager.updateEnd",Wk="attribute.updateStart",Xk="attribute.allocate",Gk="attribute.updateEnd";class $k{constructor(e,{id:n="attribute-manager",stats:r,timeline:s}={}){this.mergeBoundsMemoized=Na(MN),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new Hk(e,{id:`${n}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);Je(sT,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Je(sT,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:s,props:i={},buffers:o={},context:a={}}){let c=!1;Je(zk,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const l in this.attributes){const u=this.attributes[l],h=u.settings.accessor;u.startIndices=r,u.numInstances=n,i[l]&&ie.removed(`props.${l}`,`data.attributes.${l}`)(),u.setExternalBuffer(o[l])||u.setBinaryValue(typeof h=="string"?o[h]:void 0,e.startIndices)||typeof h=="string"&&!o[h]&&u.setConstantValue(i[h])||u.needsUpdate()&&(c=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:i,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}c&&Je(jk,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var s;return(s=this.attributes[r])==null?void 0:s.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,s={...r.getAttributes()};for(const i in n){const o=n[i];o.needsRedraw(e)&&!r.hasAttribute(i)&&(s[i]=o)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const s=e[r],i={...s,id:r,size:s.isIndexed&&1||s.size||1,...n};this.attributes[r]=new Xv(this.device,i)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:s}=this,i=s[e];return i&&i.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),i}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(Je(Wk,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&Je(Xk,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,Je(Gk,n,r))}}class Kk extends Lu{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:s,easing:i}}=this,o=i(e/s);this._value=jl(n,r,o)}}const iT=1e-5;function oT(t,e,n,r,s){const i=e-t,a=(n-e)*s,c=-i*r;return a+c+i+e}function Yk(t,e,n,r,s){if(Array.isArray(n)){const i=[];for(let o=0;o<n.length;o++)i[o]=oT(t[o],e[o],n[o],r,s);return i}return oT(t,e,n,r,s)}function aT(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const s=t[r]-e[r];n+=s*s}return Math.sqrt(n)}return Math.abs(t-e)}class Jk extends Lu{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:s}=this.settings,{_prevValue:i=e,_currValue:o=e}=this;let a=Yk(i,o,n,r,s);const c=aT(a,n),l=aT(a,o);c<iT&&l<iT&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const qk={interpolation:Kk,spring:Jk};class Qk{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,s){const{transitions:i}=this;if(i.has(e)){const c=i.get(e),{value:l=c.settings.fromValue}=c;n=l,this.remove(e)}if(s=Wv(s),!s)return;const o=qk[s.type];if(!o){ie.error(`unsupported transition type '${s.type}'`)();return}const a=new o(this.timeline);a.start({...s,fromValue:n,toValue:r}),i.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Zk(t){const e=t[Or];for(const n in e){const r=e[n],{validate:s}=r;if(s&&!s(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function eL(t,e){const n=Zv({newProps:t,oldProps:e,propTypes:t[Or],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=nL(t,e);let s=!1;return r||(s=rL(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:s,extensionsChanged:sL(t,e),transitionsChanged:tL(t,e)}}function tL(t,e){if(!t.transitions)return!1;const n={},r=t[Or];let s=!1;for(const i in t.transitions){const o=r[i],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&hp(t[i],e[i],o)&&(n[i]=!0,s=!0)}return s?n:!1}function Zv({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:s="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const i of Object.keys(t))if(!(i in n)){if(!(i in e))return`${s}.${i} added`;const o=hp(t[i],e[i],r[i]);if(o)return`${s}.${i} ${o}`}for(const i of Object.keys(e))if(!(i in n)){if(!(i in t))return`${s}.${i} dropped`;if(!Object.hasOwnProperty.call(t,i)){const o=hp(t[i],e[i],r[i]);if(o)return`${s}.${i} ${o}`}}return!1}function hp(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function nL(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:s}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&s&&(n=s(t.data,e.data)||n),n}function rL(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&cT(t,e,"all"))return{all:!0};const n={};let r=!1;for(const s in t.updateTriggers)s!=="all"&&cT(t,e,s)&&(n[s]=!0,r=!0);return r?n:!1}function sL(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let s=0;s<r.length;s++)if(!r[s].equals(n[s]))return!0;return!1}function cT(t,e,n){let r=t.updateTriggers[n];r=r??{};let s=e.updateTriggers[n];return s=s??{},Zv({oldProps:s,newProps:r,triggerName:n})}const iL="count(): argument not an object",oL="count(): argument not a container";function aL(t){if(!lL(t))throw new Error(iL);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(cL(t))return Object.keys(t).length;throw new Error(oL)}function cL(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function lL(t){return t!==null&&typeof t=="object"}function lT(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(s=>s.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const s in e.inject)r[s]=(r[s]||"")+e.inject[s];n.inject=r}return n}const uL={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},fp={};function hL(t,e,n,r){if(n instanceof vt)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let s=null;n.compressed&&(s={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const i=e.createTexture({...n,sampler:{...uL,...s,...r}});return fp[i.id]=t,i}function fL(t,e){!e||!(e instanceof vt)||fp[e.id]===t&&(e.delete(),delete fp[e.id])}const dL={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||dp(t)&&(t.length===3||t.length===4)},equal(t,e,n){return tn(t,e,1)}},accessor:{validate(t,e){const n=ql(t);return n==="function"||n===ql(e.value)},equal(t,e,n){return typeof e=="function"?!0:tn(t,e,1)}},array:{validate(t,e){return e.optional&&!t||dp(t)},equal(t,e,n){const{compare:r}=n,s=Number.isInteger(r)?r:r?1:0;return r?tn(t,e,s):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,s=Number.isInteger(r)?r:r?1:0;return r?tn(t,e,s):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:hL(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{fL(n.id,t)}}};function pL(t){const e={},n={},r={};for(const[s,i]of Object.entries(t)){const o=i==null?void 0:i.deprecatedFor;if(o)r[s]=Array.isArray(o)?o:[o];else{const a=gL(s,i);e[s]=a,n[s]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function gL(t,e){switch(ql(e)){case"object":return go(t,e);case"array":return go(t,{type:"array",value:e,compare:!1});case"boolean":return go(t,{type:"boolean",value:e});case"number":return go(t,{type:"number",value:e});case"function":return go(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function go(t,e){return"type"in e?{name:t,...dL[e.type],...e}:"value"in e?{name:t,type:ql(e.value),...e}:{name:t,type:"object",value:e}}function dp(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function ql(t){return dp(t)?"array":t===null?"null":typeof t}function _L(t,e){let n;for(let i=e.length-1;i>=0;i--){const o=e[i];"extensions"in o&&(n=o.extensions)}const r=pp(t.constructor,n),s=Object.create(r);s[Yl]=t,s[Ss]={},s[Sr]={};for(let i=0;i<e.length;++i){const o=e[i];for(const a in o)s[a]=o[a]}return Object.freeze(s),s}const mL="_mergedDefaultProps";function pp(t,e){let n=mL;if(e)for(const s of e){const i=s.constructor;i&&(n+=`:${i.extensionName||i.name}`)}const r=e1(t,n);return r||(t[n]=AL(t,e||[]))}function AL(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),s=pp(r),i=e1(t,"defaultProps")||{},o=pL(i),a=Object.assign(Object.create(null),s,o.defaultProps),c=Object.assign(Object.create(null),s==null?void 0:s[Or],o.propTypes),l=Object.assign(Object.create(null),s==null?void 0:s[Qh],o.deprecatedProps);for(const u of e){const h=pp(u.constructor);h&&(Object.assign(a,h),Object.assign(c,h[Or]),Object.assign(l,h[Qh]))}return yL(a,t),EL(a,c),TL(a,l),a[Or]=c,a[Qh]=l,e.length===0&&!i_(t,"_propTypes")&&(t._propTypes=c),a}function yL(t,e){const n=CL(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function TL(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const s=`${this.id}: ${n}`;for(const i of e[n])i_(this,i)||(this[i]=r);ie.deprecated(s,e[n].join("/"))()}})}function EL(t,e){const n={},r={};for(const s in e){const i=e[s],{name:o,value:a}=i;i.async&&(n[o]=a,r[o]=SL(o))}t[Ci]=n,t[Ss]={},Object.defineProperties(t,r)}function SL(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||jv(e)?this[Ss][t]=e:this[Sr][t]=e},get(){if(this[Sr]){if(t in this[Sr])return this[Sr][t]||this[Ci][t];if(t in this[Ss]){const e=this[Yl]&&this[Yl].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Ci][t]}}return this[Ci][t]}}}function i_(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function e1(t,e){return i_(t,e)&&t[e]}function CL(t){const e=t.componentName;return e||ie.warn(`${t.name}.componentName not specified`)(),e||t.name}let vL=0;class o_{constructor(...e){this.props=_L(this,e),this.id=this.props.id,this.count=vL++}clone(e){const{props:n}=this,r={};for(const s in n[Ci])s in n[Sr]?r[s]=n[Sr][s]:s in n[Ss]&&(r[s]=n[Ss][s]);return new this.constructor({...n,...r,...e})}}o_.componentName="Component";o_.defaultProps={};const wL=o_,RL=Object.freeze({});class bL{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||RL}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Yl]||this.component;const n=e[Sr]||{},r=e[Ss]||e,s=e[Ci]||{};for(const i in n){const o=n[i];this._createAsyncPropData(i,s[i]),this._updateAsyncProp(i,o),n[i]=this.getAsyncProp(i)}for(const i in r){const o=r[i];this._createAsyncPropData(i,s[i]),this._updateAsyncProp(i,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(jv(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const s=this.asyncProps[e];s&&r>=s.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=n,s.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const s=r.pendingLoadCount;n.then(i=>{this.component&&(i=this._postProcessValue(r,i),this._setAsyncPropValue(e,i,s),this._onResolve(e,i))}).catch(i=>{this._onError(e,i)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const s=r.pendingLoadCount;let i=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:c}=this.component.props;c?i=c(a,i):i=i.concat(a),Object.defineProperty(i,"__diff",{enumerable:!1,value:[{startRow:o,endRow:i.length}]}),o=i.length,this._setAsyncPropValue(e,i,s)}this._onResolve(e,i)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const s=this.component&&this.component.props[Or];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class IL extends bL{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,s=r==null?void 0:r.props.fetch;return s?s(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const s=r.props.onDataLoad;e==="data"&&s&&s(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const ML="layer.changeFlag",BL="layer.initialize",PL="layer.update",OL="layer.finalize",xL="layer.matched",uT=2**24-1,NL=Object.freeze([]),FL=Na(({oldViewport:t,viewport:e})=>t.equals(e));let Tn=new Uint8ClampedArray(0);const DL={data:{type:"data",value:NL,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:s,signal:i})=>{const{resourceManager:o}=n.context;s=s||n.getLoadOptions(),r=r||n.props.loaders,i&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:i}});let a=o.contains(t);return!a&&!s&&(o.add({resourceId:t,data:Dr(t,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:c=>{var l;return(l=n.internalState)==null?void 0:l.reloadAsyncProp(e,c)},consumerId:n.id,requestId:e}):Dr(t,r,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Z.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class a_ extends wL{constructor(){super(...arguments),this.internalState=null,this.lifecycle=js.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Ze(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=mv(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,i,o]=fv(r,n.pixelProjectionMatrix);return e.length===2?[s,i]:[s,i,o]}unproject(e){return Ze(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Ze(this.internalState);const r=this.internalState.viewport||this.context.viewport;return FN(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Z.DEFAULT||e===Z.LNGLAT||e===Z.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Ze(e instanceof Uint8Array);const[n,r,s]=e;return n+r*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:aL(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=lT(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=lT(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const s of r)n.invalidateAll(s);else n.invalidateAll();if(n){const{props:s}=e,i=this.internalState.hasPickingBuffer,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(i!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:c}=n.attributes,l=a||c;l&&(o&&l.constant&&(l.constant=!1,n.invalidate(l.id)),!l.value&&!o&&(l.constant=!0,l.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,n){var r,s,i,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(s=(r=this.props).onError)!=null&&s.call(r,e)||(o=(i=this.context)==null?void 0:i.onError)==null||o.call(i,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!FL({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),s=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:s,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const i=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(i)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const s in n)Object.defineProperty(r,s,{value:n[s]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(Tn.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>uT&&ie.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Tn=ma.allocate(Tn,n,{size:4,copy:!0,maxCount:Math.max(n,uT)});const s=Math.floor(Tn.length/4),i=[];for(let o=r;o<s;o++)this.encodePickingColor(o,i),Tn[o*4+0]=i[0],Tn[o*4+1]=i[1],Tn[o*4+2]=i[2]}e.value=Tn.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var a;if(!Object.keys(n).length)return;if(r){const c=this.getAttributeManager();e.setBufferLayout(c.getBufferLayouts(e)),n=c.getAttributes()}const s=((a=e.userData)==null?void 0:a.excludeAttributes)||{},i={},o={};for(const c in n){if(s[c])continue;const l=n[c].getValue();for(const u in l){const h=l[u];h instanceof Se?n[c].settings.isIndexed?e.setIndexBuffer(h):i[u]=h:h&&(o[u]=h)}}e.setAttributes(i),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:s}=this.getAttributeManager().attributes,i=r||s,o=i&&n.attributes&&n.attributes[i.id];if(o&&o.value){const a=o.value,c=this.encodePickingColor(e);for(let l=0;l<n.length;l++){const u=i.getVertexOffset(l);a[u]===c[0]&&a[u+1]===c[1]&&a[u+2]===c[2]&&this._disablePickingIndex(l)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,s=n||r;if(!s)return;const i=s.getVertexOffset(e),o=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(o-i),i)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Tn.buffer&&(r.value=Tn.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Ze(!this.internalState),Ze(Number.isFinite(this.props.coordinateSystem)),Je(BL,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new IL({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ie.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Qk(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Je(xL,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Je(PL,this,e),!e)return;const n=this.props,r=this.context,s=this.internalState,i=r.viewport,o=this._updateUniformTransition();s.propsInTransition=o,r.viewport=s.viewport||i,this.props=o;try{const a=this._getUpdateParams(),c=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const l=this.getModels()[0]!==c[0];this._postUpdate(a,l)}finally{r.viewport=i,this.props=n,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Je(OL,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:n=null,uniforms:r={},parameters:s={}}){this._updateAttributeTransition();const i=this.props,o=this.context;this.props=this.internalState.propsInTransition||i;const a=this.props.opacity;r.opacity=Math.pow(a,1/2.2);try{if(n){const{isActive:u,isAttribute:h}=n.picking;this.setModuleParameters(n),this.setShaderModuleProps({picking:{isActive:u,isAttribute:h}})}const{getPolygonOffset:c}=this.props,l=c&&c(r)||[0,0];o.device.setParametersWebGL({polygonOffset:l});for(const u of this.getModels())u.setParameters(s);o.device.withParametersWebGL(s,()=>{const u={renderPass:e,moduleParameters:n,uniforms:r,parameters:s,context:o};for(const h of this.props.extensions)h.draw.call(this,u,h);this.draw(u)})}finally{this.props=i}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const s in e)if(e[s]){let i=!1;switch(s){case"dataChanged":const o=e[s],a=n[s];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,i=!0);default:n[s]||(n[s]=e[s],i=!0)}i&&Je(ML,this,s,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var s;const r=eL(e,n);if(r.updateTriggersChanged)for(const i in r.updateTriggersChanged)r.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(r.transitionsChanged)for(const i in r.transitionsChanged)this.internalState.uniformTransitions.add(i,n[i],e[i],(s=e.transitions)==null?void 0:s[i]);return this.setChangeFlags(r)}validateProps(){Zk(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new $k(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:s}=e;this.setNeedsRedraw(),this._updateAttributes();const i=this.state.model;i!=null&&i.isInstanced&&i.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:c}=r;if(n||s.autoHighlight!==o||s.highlightedObjectIndex!==a||s.highlightColor!==c){const l={};Array.isArray(c)&&(l.highlightColor=c),(n||s.autoHighlight!==o||a!==s.highlightedObjectIndex)&&(l.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:l})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),s=r?r.getNeedsRedraw(e):!1;if(n=n||s,n)for(const i of this.props.extensions)i.onNeedsRedraw.call(this,i);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}a_.defaultProps=DL;a_.layerName="Layer";const Da=a_,UL="compositeLayer.renderLayers";class t1 extends Da{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,s)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,s)}return e}getSubLayerProps(e={}){var x;const{opacity:n,pickable:r,visible:s,parameters:i,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:p,modelMatrix:m,extensions:y,fetch:w,operation:_,_subLayerProps:g}=this.props,T={id:"",updateTriggers:{},opacity:n,pickable:r,visible:s,parameters:i,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:p,modelMatrix:m,extensions:y,fetch:w,operation:_},C=g&&e.id&&g[e.id],I=C&&C.updateTriggers,P=e.id||"sublayer";if(C){const N=this.props[Or],D=e.type?e.type._propTypes:{};for(const F in C){const X=D[F]||N[F];X&&X.type==="accessor"&&(C[F]=this.getSubLayerAccessor(C[F]))}}Object.assign(T,e,C),T.id=`${this.props.id}-${P}`,T.updateTriggers={all:(x=this.props.updateTriggers)==null?void 0:x.all,...e.updateTriggers,...I};for(const N of y){const D=N.getSubLayerProps.call(this,N);D&&Object.assign(T,D,{updateTriggers:Object.assign(T.updateTriggers,D.updateTriggers)})}return T}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const s=!r||this.needsUpdate();if(s){const i=this.renderLayers();r=Qg(i,Boolean),this.internalState.subLayers=r}Je(UL,this,s,r);for(const i of r)i.parent=this}}t1.layerName="CompositeLayer";const kL=t1,LL=typeof window<"u"?H.useLayoutEffect:H.useEffect,VL=LL;function Ql(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const HL={position:"absolute",zIndex:-1};function n1(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>n1(n,e));if(ju(t)){if(zL(t))return e.style=HL,H.cloneElement(t,e);if(jL(t))return H.cloneElement(t,e)}return t}function ju(t){return t&&typeof t=="object"&&"type"in t||!1}function zL(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function jL(t){const e=t.type;return e&&e.deckGLViewProps}function gp(t){if(typeof t=="function")return H.createElement(Ui,{},t);if(Array.isArray(t))return t.map(gp);if(ju(t)){if(t.type===H.Fragment)return gp(t.props.children);if(Ql(t.type,Ui))return t}return t}function WL({children:t,layers:e=[],views:n=null}){const r=[],s=[],i={};return H.Children.forEach(gp(t),o=>{if(ju(o)){const a=o.type;if(Ql(a,Da)){const c=XL(a,o.props);s.push(c)}else r.push(o);if(Ql(a,Ui)&&a!==Ui&&o.props.id){const c=new a(o.props);i[c.id]=c}}else o&&r.push(o)}),Object.keys(i).length>0&&(Array.isArray(n)?n.forEach(o=>{i[o.id]=o}):n&&(i[n.id]=n),n=Object.values(i)),e=s.length>0?[...s,...e]:e,{layers:e,children:r,views:n}}function XL(t,e){const n={},r=t.defaultProps||{};for(const s in e)r[s]!==e[s]&&(n[s]=e[s]);return new t(n)}function $L({children:t,deck:e,ContextProvider:n}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const s={},i=r.views[0].id;for(const o of t){let a=i,c=o;ju(o)&&Ql(o.type,Ui)&&(a=o.props.id||i,c=o.props.children);const l=r.getViewport(a),u=r.getViewState(a);if(l){u.padding=l.padding;const{x:h,y:f,width:p,height:m}=l;c=n1(c,{x:h,y:f,width:p,height:m,viewport:l,viewState:u}),s[a]||(s[a]={viewport:l,children:[]}),s[a].children.push(c)}}return Object.keys(s).map(o=>{const{viewport:a,children:c}=s[o],{x:l,y:u,width:h,height:f}=a,p={position:"absolute",left:l,top:u,width:h,height:f},m=`view-${o}`,y=H.createElement("div",{key:m,id:m,style:p},...c);if(n){const w={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:_=>{_.viewId=o,e._onViewStateChange(_)}};return H.createElement(n,{key:m,value:w},y)}return y})}const KL={mixBlendMode:null};function YL({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},s={left:0,top:0};if(n)for(const i in n)i in KL?s[i]=n[i]:r[i]=n[i];return{containerStyle:r,canvasStyle:s}}function JL(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function r1(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function qL(t,e,n){const r=new e({...n,_customRender:s=>{t.redrawReason=s;const i=r.getViewports();t.lastRenderedViewports!==i?t.forceUpdate():r1(t)}});return r}function QL(t,e){const[n,r]=H.useState(0),i=H.useRef({control:null,version:n,forceUpdate:()=>r(I=>I+1)}).current,o=H.useRef(null),a=H.useRef(null),c=H.useMemo(()=>WL(t),[t.layers,t.views,t.children]);let l=!0;const u=I=>{var P;return l&&t.viewState?(i.viewStateUpdateRequested=I,null):(i.viewStateUpdateRequested=null,(P=t.onViewStateChange)==null?void 0:P.call(t,I))},h=I=>{var P;l?i.interactionStateUpdateRequested=I:(i.interactionStateUpdateRequested=null,(P=t.onInteractionStateChange)==null||P.call(t,I))},f=H.useMemo(()=>{const I={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:c.layers,views:c.views,onViewStateChange:u,onInteractionStateChange:h};return delete I._customRender,i.deck&&i.deck.setProps(I),I},[t]);H.useEffect(()=>{const I=t.Deck||mk;return i.deck=qL(i,I,{...f,parent:o.current,canvas:a.current}),()=>{var P;return(P=i.deck)==null?void 0:P.finalize()}},[]),VL(()=>{r1(i);const{viewStateUpdateRequested:I,interactionStateUpdateRequested:P}=i;I&&u(I),P&&h(P)}),H.useImperativeHandle(e,()=>JL(i),[]);const p=i.deck&&i.deck.isInitialized?i.deck.getViewports():void 0,{ContextProvider:m,width:y="100%",height:w="100%",id:_,style:g}=t,{containerStyle:T,canvasStyle:C}=H.useMemo(()=>YL({width:y,height:w,style:g}),[y,w,g]);if(!i.viewStateUpdateRequested&&i.lastRenderedViewports===p||i.version!==n){i.lastRenderedViewports=p,i.version=n;const I=$L({children:c.children,deck:i.deck,ContextProvider:m}),P=H.createElement("canvas",{key:"canvas",id:_||"deckgl-overlay",ref:a,style:C});i.control=H.createElement("div",{id:`${_||"deckgl"}-wrapper`,ref:o,style:T},[P,I])}return l=!1,i.control}const ZL=H.forwardRef(QL),e4=ZL,t4=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,n4=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,s1=[0,0,0,255],i1=[0,0,1],r4={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:i1},getColor:{type:"accessor",value:s1},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function s4(t){const{header:e,attributes:n}=t;if(!(!e||!n)&&(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0)){const{size:r,value:s}=n.COLOR_0;n.instanceColors={size:r,type:"unorm8",value:s}}}class c_ extends Da{getShaders(){return super.getShaders({vs:t4,fs:n4,modules:[$g,Ex,Jg]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:i1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:s1}})}updateState(e){var s;const{changeFlags:n,props:r}=e;super.updateState(e),n.extensionsChanged&&((s=this.state.model)==null||s.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),n.dataChanged&&s4(r.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:r}=this.props,s=this.state.model;s.setUniforms(e),s.setUniforms({sizeUnits:Yd[r],radiusPixels:n}),s.draw(this.context.renderPass)}_getModel(){const e=[];for(let n=0;n<3;n++){const r=n/3*Math.PI*2;e.push(Math.cos(r)*2,Math.sin(r)*2,0)}return new kr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ei({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}c_.layerName="PointCloudLayer";c_.defaultProps=r4;const i4=c_,St={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new M;new M;const _o=new M,hT=new M;class Ua{constructor(e=[0,0,0],n=0){this.radius=-0,this.center=new M,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=_o.from(n),this.center=new M().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Ua(this.center,this.radius)}union(e){const n=this.center,r=this.radius,s=e.center,i=e.radius,o=_o.copy(s).subtract(n),a=o.magnitude();if(r>=a+i)return this.clone();if(i>=a+r)return e.clone();const c=(r+a+i)*.5;return hT.copy(o).scale((-r+c)/a).add(n),this.center.copy(hT),this.radius=c,this}expand(e){const r=_o.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const n=PO(_o,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const r=_o.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const n=this.center,r=this.radius,i=e.normal.dot(n)+e.distance;return i<-r?St.OUTSIDE:i<r?St.INTERSECTING:St.INSIDE}}const o4=new M,a4=new M,Mc=new M,Bc=new M,Pc=new M,c4=new M,l4=new M,Un={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class ka{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){this.center=new M().from(e),this.halfAxes=new be(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new M(e).len(),new M(n).len(),new M(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),s=new M(e).normalize(),i=new M(n).normalize(),o=new M(r).normalize();return new _a().fromMatrix3(new be([...s,...i,...o]))}fromCenterHalfSizeQuaternion(e,n,r){const s=new _a(r),i=new be().fromQuaternion(s);return i[0]=i[0]*n[0],i[1]=i[1]*n[0],i[2]=i[2]*n[0],i[3]=i[3]*n[1],i[4]=i[4]*n[1],i[5]=i[5]*n[1],i[6]=i[6]*n[2],i[7]=i[7]*n[2],i[8]=i[8]*n[2],this.center=new M().from(e),this.halfAxes=i,this}clone(){return new ka(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Ua){const n=this.halfAxes,r=n.getColumn(0,Mc),s=n.getColumn(1,Bc),i=n.getColumn(2,Pc),o=o4.copy(r).add(s).add(i);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const n=this.center,r=e.normal,s=this.halfAxes,i=r.x,o=r.y,a=r.z,c=Math.abs(i*s[Un.COLUMN0ROW0]+o*s[Un.COLUMN0ROW1]+a*s[Un.COLUMN0ROW2])+Math.abs(i*s[Un.COLUMN1ROW0]+o*s[Un.COLUMN1ROW1]+a*s[Un.COLUMN1ROW2])+Math.abs(i*s[Un.COLUMN2ROW0]+o*s[Un.COLUMN2ROW1]+a*s[Un.COLUMN2ROW2]),l=r.dot(n)+e.distance;return l<=-c?St.OUTSIDE:l>=c?St.INSIDE:St.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=a4.from(e).subtract(this.center),r=this.halfAxes,s=r.getColumn(0,Mc),i=r.getColumn(1,Bc),o=r.getColumn(2,Pc),a=s.magnitude(),c=i.magnitude(),l=o.magnitude();s.normalize(),i.normalize(),o.normalize();let u=0,h;return h=Math.abs(n.dot(s))-a,h>0&&(u+=h*h),h=Math.abs(n.dot(i))-c,h>0&&(u+=h*h),h=Math.abs(n.dot(o))-l,h>0&&(u+=h*h),u}computePlaneDistances(e,n,r=[-0,-0]){let s=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,c=a.getColumn(0,Mc),l=a.getColumn(1,Bc),u=a.getColumn(2,Pc),h=c4.copy(c).add(l).add(u).add(o),f=l4.copy(h).subtract(e);let p=n.dot(f);return s=Math.min(p,s),i=Math.max(p,i),h.copy(o).add(c).add(l).subtract(u),f.copy(h).subtract(e),p=n.dot(f),s=Math.min(p,s),i=Math.max(p,i),h.copy(o).add(c).subtract(l).add(u),f.copy(h).subtract(e),p=n.dot(f),s=Math.min(p,s),i=Math.max(p,i),h.copy(o).add(c).subtract(l).subtract(u),f.copy(h).subtract(e),p=n.dot(f),s=Math.min(p,s),i=Math.max(p,i),o.copy(h).subtract(c).add(l).add(u),f.copy(h).subtract(e),p=n.dot(f),s=Math.min(p,s),i=Math.max(p,i),o.copy(h).subtract(c).add(l).subtract(u),f.copy(h).subtract(e),p=n.dot(f),s=Math.min(p,s),i=Math.max(p,i),o.copy(h).subtract(c).subtract(l).add(u),f.copy(h).subtract(e),p=n.dot(f),s=Math.min(p,s),i=Math.max(p,i),o.copy(h).subtract(c).subtract(l).subtract(u),f.copy(h).subtract(e),p=n.dot(f),s=Math.min(p,s),i=Math.max(p,i),r[0]=s,r[1]=i,r}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,Mc);n.transformAsPoint(e);const r=this.halfAxes.getColumn(1,Bc);r.transformAsPoint(e);const s=this.halfAxes.getColumn(2,Pc);return s.transformAsPoint(e),this.halfAxes=new be([...n,...r,...s]),this}getTransform(){throw new Error("not implemented")}}const fT=new M,dT=new M;class Cn{constructor(e=[0,0,1],n=0){this.normal=new M,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return Qt(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=fT.from(e),this.normal.from(n).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,n,r,s){return this.normal.set(e,n,r),Qt(on(this.normal.len(),1)),this.distance=s,this}clone(){return new Cn(this.normal,this.distance)}equals(e){return on(this.distance,e.distance)&&on(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=dT.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,n)}projectPointOntoPlane(e,n=[0,0,0]){const r=fT.from(e),s=this.getPointDistance(r),i=dT.copy(this.normal).scale(s);return r.subtract(i).to(n)}}const pT=[new M([1,0,0]),new M([0,1,0]),new M([0,0,1])],gT=new M,u4=new M;class Ut{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*pT.length;const n=e.center,r=e.radius;let s=0;for(const i of pT){let o=this.planes[s],a=this.planes[s+1];o||(o=this.planes[s]=new Cn),a||(a=this.planes[s+1]=new Cn);const c=gT.copy(i).scale(-r).add(n);o.fromPointNormal(c,i);const l=gT.copy(i).scale(r).add(n),u=u4.copy(i).negate();a.fromPointNormal(l,u),s+=2}return this}computeVisibility(e){let n=St.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case St.OUTSIDE:return St.OUTSIDE;case St.INTERSECTING:n=St.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(Qt(Number.isFinite(n),"parentPlaneMask is required."),n===Ut.MASK_OUTSIDE||n===Ut.MASK_INSIDE)return n;let r=Ut.MASK_INSIDE;const s=this.planes;for(let i=0;i<this.planes.length;++i){const o=i<31?1<<i:0;if(i<31&&!(n&o))continue;const a=s[i],c=e.intersectPlane(a);if(c===St.OUTSIDE)return Ut.MASK_OUTSIDE;c===St.INTERSECTING&&(r|=o)}return r}}Ut.MASK_OUTSIDE=4294967295;Ut.MASK_INSIDE=0;Ut.MASK_INDETERMINATE=2147483647;new M;new M;new M;new M;new M;new M;new M;new M;new M;new M;new M;new M;new M;new M;new M;new M;new M;const En=new be,h4=new be,f4=new be,Oc=new be,_T=new be;function d4(t,e={}){const n=_x,r=10;let s=0,i=0;const o=h4,a=f4;o.identity(),a.copy(t);const c=n*p4(a);for(;i<r&&g4(a)>c;)_4(a,Oc),_T.copy(Oc).transpose(),a.multiplyRight(Oc),a.multiplyLeft(_T),o.multiplyRight(Oc),++s>2&&(++i,s=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function p4(t){let e=0;for(let n=0;n<9;++n){const r=t[n];e+=r*r}return Math.sqrt(e)}const _p=[1,0,0],mp=[2,2,1];function g4(t){let e=0;for(let n=0;n<3;++n){const r=t[En.getElementIndex(mp[n],_p[n])];e+=2*r*r}return Math.sqrt(e)}function _4(t,e){const n=tv;let r=0,s=1;for(let l=0;l<3;++l){const u=Math.abs(t[En.getElementIndex(mp[l],_p[l])]);u>r&&(s=l,r=u)}const i=_p[s],o=mp[s];let a=1,c=0;if(Math.abs(t[En.getElementIndex(o,i)])>n){const l=t[En.getElementIndex(o,o)],u=t[En.getElementIndex(i,i)],h=t[En.getElementIndex(o,i)],f=(l-u)/2/h;let p;f<0?p=-1/(-f+Math.sqrt(1+f*f)):p=1/(f+Math.sqrt(1+f*f)),a=1/Math.sqrt(1+p*p),c=p*a}return be.IDENTITY.to(e),e[En.getElementIndex(i,i)]=e[En.getElementIndex(o,o)]=a,e[En.getElementIndex(o,i)]=c,e[En.getElementIndex(i,o)]=-c,e}const fr=new M,m4=new M,A4=new M,y4=new M,T4=new M,E4=new be,S4={diagonal:new be,unitary:new be};function C4(t,e=new ka){if(!t||t.length===0)return e.halfAxes=new be([0,0,0,0,0,0,0,0,0]),e.center=new M,e;const n=t.length,r=new M(0,0,0);for(const D of t)r.add(D);const s=1/n;r.multiplyByScalar(s);let i=0,o=0,a=0,c=0,l=0,u=0;for(const D of t){const F=fr.copy(D).subtract(r);i+=F.x*F.x,o+=F.x*F.y,a+=F.x*F.z,c+=F.y*F.y,l+=F.y*F.z,u+=F.z*F.z}i*=s,o*=s,a*=s,c*=s,l*=s,u*=s;const h=E4;h[0]=i,h[1]=o,h[2]=a,h[3]=o,h[4]=c,h[5]=l,h[6]=a,h[7]=l,h[8]=u;const{unitary:f}=d4(h,S4),p=e.halfAxes.copy(f);let m=p.getColumn(0,A4),y=p.getColumn(1,y4),w=p.getColumn(2,T4),_=-Number.MAX_VALUE,g=-Number.MAX_VALUE,T=-Number.MAX_VALUE,C=Number.MAX_VALUE,I=Number.MAX_VALUE,P=Number.MAX_VALUE;for(const D of t)fr.copy(D),_=Math.max(fr.dot(m),_),g=Math.max(fr.dot(y),g),T=Math.max(fr.dot(w),T),C=Math.min(fr.dot(m),C),I=Math.min(fr.dot(y),I),P=Math.min(fr.dot(w),P);m=m.multiplyByScalar(.5*(C+_)),y=y.multiplyByScalar(.5*(I+g)),w=w.multiplyByScalar(.5*(P+T)),e.center.copy(m).add(y).add(w);const x=m4.set(_-C,g-I,T-P).multiplyByScalar(.5),N=new be([x[0],0,0,0,x[1],0,0,0,x[2]]);return e.halfAxes.multiplyRight(N),e}const hf=Math.PI/180,xc=new Float32Array(16),mT=new Float32Array(12);function AT(t,e,n){const r=e[0]*hf,s=e[1]*hf,i=e[2]*hf,o=Math.sin(i),a=Math.sin(r),c=Math.sin(s),l=Math.cos(i),u=Math.cos(r),h=Math.cos(s),f=n[0],p=n[1],m=n[2];t[0]=f*h*u,t[1]=f*c*u,t[2]=f*-a,t[3]=p*(-c*l+h*a*o),t[4]=p*(h*l+c*a*o),t[5]=p*u*o,t[6]=m*(c*o+h*a*l),t[7]=m*(-h*o+c*a*l),t[8]=m*u*l}function yT(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const o1={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:r,getOrientation:s,getScale:i,getTranslation:o,getTransformMatrix:a}=this.props,c=Array.isArray(a),l=c&&a.length===16,u=Array.isArray(i),h=Array.isArray(s),f=Array.isArray(o),p=l||!c&&!!a(r[0]);p?t.constant=l:t.constant=h&&u&&f;const m=t.value;if(t.constant){let y;p?(xc.set(a),y=yT(xc)):(y=mT,AT(y,s,i),y.set(o,9)),t.value=new Float32Array(y)}else{let y=e*t.size;const{iterable:w,objectInfo:_}=zv(r,e,n);for(const g of w){_.index++;let T;if(p)xc.set(l?a:a(g,_)),T=yT(xc);else{T=mT;const C=h?s:s(g,_),I=u?i:i(g,_);AT(T,C,I),T.set(f?o:o(g,_),9)}m[y++]=T[0],m[y++]=T[1],m[y++]=T[2],m[y++]=T[3],m[y++]=T[4],m[y++]=T[5],m[y++]=T[6],m[y++]=T[7],m[y++]=T[8],m[y++]=T[9],m[y++]=T[10],m[y++]=T[11]}}}};function a1(t,e){return e===Z.CARTESIAN||e===Z.METER_OFFSETS||e===Z.DEFAULT&&!t.isGeospatial}const v4=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;
if (composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,w4=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
}
`;function ff(t){const e=t.positions||t.POSITION;ie.assert(e,'no "postions" or "POSITION" attribute in mesh');const n=e.value.length/e.size;let r=t.COLOR_0||t.colors;r||(r={size:3,value:new Float32Array(n*3).fill(1)});let s=t.NORMAL||t.normals;s||(s={size:3,value:new Float32Array(n*3).fill(0)});let i=t.TEXCOORD_0||t.texCoords;return i||(i={size:2,value:new Float32Array(n*2).fill(0)}),{positions:e,colors:r,normals:s,texCoords:i}}function TT(t){return t instanceof Ei?(t.attributes=ff(t.attributes),t):t.attributes?new Ei({...t,topology:"triangle-list",attributes:ff(t.attributes)}):new Ei({topology:"triangle-list",attributes:ff(t)})}const R4=[0,0,0,255],b4={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:R4},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class l_ extends Da{getShaders(){return super.getShaders({vs:v4,fs:w4,modules:[$g,Sx,Jg]})}getBounds(){var r;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:n}=this.props;if(!n)return null;if(e=(r=n.header)==null?void 0:r.boundingBox,!e){const{attributes:s}=TT(n);s.POSITION=s.POSITION||s.positions,e=lC(s)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:o1}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var i;super.updateState(e);const{props:n,oldProps:r,changeFlags:s}=e;if(n.mesh!==r.mesh||s.extensionsChanged){if(this.state.positionBounds=null,(i=this.state.model)==null||i.destroy(),n.mesh){this.state.model=this.getModel(n.mesh);const o=n.mesh.attributes||n.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==r.texture&&n.texture instanceof vt&&this.setTexture(n.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:n}=this.state;if(!n)return;const{viewport:r,renderPass:s}=this.context,{sizeScale:i,coordinateSystem:o,_instanced:a}=this.props;n.setUniforms(e),n.setUniforms({sizeScale:i,composeModelMatrix:!a||a1(r,o),flatShading:!this.state.hasNormals}),n.draw(s)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const n=new kr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:TT(e),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:s}=this.state;return n.setBindings({sampler:r||s}),n.setUniforms({hasTexture:!!r}),n}setTexture(e){const{emptyTexture:n,model:r}=this.state;r&&(r.setBindings({sampler:e||n}),r.setUniforms({hasTexture:!!e}))}}l_.defaultProps=b4;l_.layerName="SimpleMeshLayer";const I4=l_;var Zt;(function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.LINEAR=9729]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(Zt||(Zt={}));function c1(t,e,n,r){const s={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};s.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:i}=r;return i&&(s.bindings.u_DiffuseEnvSampler=i.diffuseEnvSampler,s.bindings.u_SpecularEnvSampler=i.specularEnvSampler,s.bindings.u_brdfLUT=i.brdfLutTexture,s.uniforms.u_ScaleIBLAmbient=[1,1]),r!=null&&r.pbrDebug&&(s.defines.PBR_DEBUG=1,s.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],s.uniforms.u_ScaleFGDSpec=[0,0,0,0]),n.NORMAL&&(s.defines.HAS_NORMALS=1),n.TANGENT&&(r!=null&&r.useTangents)&&(s.defines.HAS_TANGENTS=1),n.TEXCOORD_0&&(s.defines.HAS_UV=1),r!=null&&r.imageBasedLightingEnvironment&&(s.defines.USE_IBL=1),r!=null&&r.lights&&(s.defines.USE_LIGHTS=1),e&&M4(t,e,s),s}function M4(t,e,n){if(n.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&B4(t,e.pbrMetallicRoughness,n),e.normalTexture){Go(t,e.normalTexture,"u_NormalSampler","HAS_NORMALMAP",n);const{scale:r=1}=e.normalTexture;n.uniforms.u_NormalScale=r}if(e.occlusionTexture){Go(t,e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP",n);const{strength:r=1}=e.occlusionTexture;n.uniforms.u_OcclusionStrength=r}switch(e.emissiveTexture&&(Go(t,e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP",n),n.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:r=.5}=e;n.defines.ALPHA_CUTOFF=1,n.uniforms.u_AlphaCutoff=r;break;case"BLEND":k.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),n.parameters.blendColorOperation="add",n.parameters.blendColorSrcFactor="src-alpha",n.parameters.blendColorDstFactor="one-minus-src-alpha",n.parameters.blendAlphaOperation="add",n.parameters.blendAlphaSrcFactor="one",n.parameters.blendAlphaDstFactor="one-minus-src-alpha",n.glParameters.blend=!0,n.glParameters.blendEquation=Zt.FUNC_ADD,n.glParameters.blendFunc=[Zt.SRC_ALPHA,Zt.ONE_MINUS_SRC_ALPHA,Zt.ONE,Zt.ONE_MINUS_SRC_ALPHA];break}}function B4(t,e,n){e.baseColorTexture&&Go(t,e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP",n),n.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&Go(t,e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP",n);const{metallicFactor:r=1,roughnessFactor:s=1}=e;n.uniforms.u_MetallicRoughnessValues=[r,s]}function Go(t,e,n,r=null,s){var u,h;const i=((h=(u=e==null?void 0:e.texture)==null?void 0:u.sampler)==null?void 0:h.parameters)||{},o=e.texture.source.image;let a,c={};o.compressed?(a=o,c={[Zt.TEXTURE_MIN_FILTER]:o.data.length>1?Zt.LINEAR_MIPMAP_NEAREST:Zt.LINEAR}):a={data:o};const l=t.createTexture({id:e.uniformName||e.id,parameters:{...i,...c},pixelStore:{[Zt.UNPACK_FLIP_Y_WEBGL]:!1},...a});s.bindings[n]=l,r&&(s.defines[r]=1),s.generatedTextures.push(l)}const P4="4.2.4",Zl={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let ET;async function ST(t){VI(t.modules);const e=HI("basis");return e||(ET||(ET=O4(t)),await ET)}async function O4(t){let e=null,n=null;return[e,n]=await Promise.all([await ps(Zl.TRANSCODER,"textures",t),await ps(Zl.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await x4(e,n)}function x4(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(s=>{const{BasisFile:i,initializeBasis:o}=s;o(),r({BasisFile:i})})})}let df;async function CT(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(df=df||N4(t),await df)}async function N4(t){let e=null,n=null;return[e,n]=await Promise.all([await ps(Zl.ENCODER,"textures",t),await ps(Zl.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await F4(e,n)}function F4(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(s=>{const{BasisFile:i,KTX2File:o,initializeBasis:a,BasisEncoder:c}=s;a(),r({BasisFile:i,KTX2File:o,BasisEncoder:c})})})}const Vs={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},D4=["","WEBKIT_","MOZ_"],vT={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Nc=null;function U4(t){if(!Nc){t=t||k4()||void 0,Nc=new Set;for(const e of D4)for(const n in vT)if(t&&t.getExtension(`${e}${n}`)){const r=vT[n];Nc.add(r)}}return Nc}function k4(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var wT,RT,bT,IT,MT,BT,PT,OT;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(wT||(wT={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(RT||(RT={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(bT||(bT={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(IT||(IT={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(MT||(MT={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(BT||(BT={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(PT||(PT={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(OT||(OT={}));const yt=[171,75,84,88,32,50,48,187,13,10,26,10];function L4(t){const e=new Uint8Array(t);return!(e.byteLength<yt.length||e[0]!==yt[0]||e[1]!==yt[1]||e[2]!==yt[2]||e[3]!==yt[3]||e[4]!==yt[4]||e[5]!==yt[5]||e[6]!==yt[6]||e[7]!==yt[7]||e[8]!==yt[8]||e[9]!==yt[9]||e[10]!==yt[10]||e[11]!==yt[11])}const V4={etc1:{basisFormat:0,compressed:!0,format:Vs.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Vs.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Vs.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Vs.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Vs.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Vs.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function H4(t,e){if(e.basis.containerFormat==="auto"){if(L4(t)){const r=await CT(e);return xT(r.KTX2File,t,e)}const{BasisFile:n}=await ST(e);return pf(n,t,e)}switch(e.basis.module){case"encoder":const n=await CT(e);switch(e.basis.containerFormat){case"ktx2":return xT(n.KTX2File,t,e);case"basis":default:return pf(n.BasisFile,t,e)}case"transcoder":default:const{BasisFile:r}=await ST(e);return pf(r,t,e)}}function pf(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const s=r.getNumImages(),i=[];for(let o=0;o<s;o++){const a=r.getNumLevels(o),c=[];for(let l=0;l<a;l++)c.push(z4(r,o,l,n));i.push(c)}return i}finally{r.close(),r.delete()}}function z4(t,e,n,r){const s=t.getImageWidth(e,n),i=t.getImageHeight(e,n),o=t.getHasAlpha(),{compressed:a,format:c,basisFormat:l}=l1(r,o),u=t.getImageTranscodedSizeInBytes(e,n,l),h=new Uint8Array(u);if(!t.transcodeImage(h,e,n,l,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:i,data:h,compressed:a,format:c,hasAlpha:o}}function xT(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=r.getLevels(),i=[];for(let o=0;o<s;o++){i.push(j4(r,o,n));break}return[i]}finally{r.close(),r.delete()}}function j4(t,e,n){const{alphaFlag:r,height:s,width:i}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:c}=l1(n,r),l=t.getImageTranscodedSizeInBytes(e,0,0,c),u=new Uint8Array(l);if(!t.transcodeImage(u,e,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:i,height:s,data:u,compressed:o,levelSize:l,hasAlpha:r,format:a}}function l1(t,e){let n=t&&t.basis&&t.basis.format;return n==="auto"&&(n=u1()),typeof n=="object"&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),V4[n]}function u1(){const t=U4();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const W4={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:P4,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},X4={...W4,parse:H4},G4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$4={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class K4{constructor(e){d(this,"name");d(this,"startTime",0);d(this,"playing",!0);d(this,"speed",1);d(this,"channels",[]);Object.assign(this,e)}animate(e){if(!this.playing)return;const r=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:s,target:i,path:o})=>{t6(r,s,i,o),q4(i,i._node)})}}class Y4{constructor(e){d(this,"animations");this.animations=e.animations.map((n,r)=>{const s=n.name||`Animation-${r}`,i=n.samplers.map(({input:a,interpolation:c="LINEAR",output:l})=>({input:NT(e.accessors[a]),interpolation:c,output:NT(e.accessors[l])})),o=n.channels.map(({sampler:a,target:c})=>({sampler:i[a],target:e.nodes[c.node],path:c.path}));return new K4({name:s,channels:o})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(n=>n.animate(e))}getAnimations(){return this.animations}}function NT(t){if(!t._animation){const e=$4[t.componentType],n=G4[t.type],r=n*t.count,{buffer:s,byteOffset:i}=t.bufferView.data,o=new e(s,i+(t.byteOffset||0),r);if(n===1)t._animation=Array.from(o);else{const a=[];for(let c=0;c<o.length;c+=n)a.push(Array.from(o.slice(c,c+n)));t._animation=a}}return t._animation}const J4=new Q;function q4(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const n=J4.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}const gf=new _a;function Q4(t,e,n,r,s){if(e==="rotation"){gf.slerp({start:n,target:r,ratio:s});for(let i=0;i<gf.length;i++)t[e][i]=gf[i]}else for(let i=0;i<n.length;i++)t[e][i]=s*r[i]+(1-s)*n[i]}function Z4(t,e,{p0:n,outTangent0:r,inTangent1:s,p1:i,tDiff:o,ratio:a}){for(let c=0;c<t[e].length;c++){const l=r[c]*o,u=s[c]*o;t[e][c]=(2*Math.pow(a,3)-3*Math.pow(a,2)+1)*n[c]+(Math.pow(a,3)-2*Math.pow(a,2)+a)*l+(-2*Math.pow(a,3)+3*Math.pow(a,2))*i[c]+(Math.pow(a,3)-Math.pow(a,2))*u}}function e6(t,e,n){for(let r=0;r<n.length;r++)t[e][r]=n[r]}function t6(t,{input:e,interpolation:n,output:r},s,i){const o=e[e.length-1],a=t%o,c=e.findIndex(f=>f>=a),l=Math.max(0,c-1);if(!Array.isArray(s[i]))switch(i){case"translation":s[i]=[0,0,0];break;case"rotation":s[i]=[0,0,0,1];break;case"scale":s[i]=[1,1,1];break;default:k.warn(`Bad animation path ${i}`)()}oe(s[i].length===r[l].length);const u=e[l],h=e[c];switch(n){case"STEP":e6(s,i,r[l]);break;case"LINEAR":if(h>u){const f=(a-u)/(h-u);Q4(s,i,r[l],r[c],f)}break;case"CUBICSPLINE":if(h>u){const f=(a-u)/(h-u),p=h-u,m=r[3*l+1],y=r[3*l+2],w=r[3*c+0],_=r[3*c+1];Z4(s,i,{p0:m,outTangent0:y,inTangent1:w,p1:_,tDiff:p,ratio:f})}break;default:k.warn(`Interpolation ${n} not supported`)();break}}const n6=`
#pragma vscode_glsllint_stage: vert
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  // _attr vec4 POSITION;
  _attr vec4 positions;

  #ifdef HAS_NORMALS
    // _attr vec4 NORMAL;
    _attr vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // _attr vec2 TEXCOORD_0;
    _attr vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }
`,r6=`
#pragma vscode_glsllint_stage: frag
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function s6(t,e){const{id:n,geometry:r,material:s,vertexCount:i,materialOptions:o,modelOptions:a}=e,c=c1(t,s,r.attributes,o);k.info(4,"createGLTFModel defines: ",c.defines)();const l=[],u={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},h={id:n,geometry:r,topology:r.topology,vertexCount:i,modules:[Xg],vs:FT(t,n6),fs:FT(t,r6),...a,bindings:{...c.bindings,...a.bindings},defines:{...c.defines,...a.defines},parameters:{...u,...c.parameters,...a.parameters},uniforms:{...c.uniforms,...a.uniforms}},f=new kr(t,h);return new np({managedResources:l,model:f})}function FT(t,e){return`#version 300 es
${e}`}const i6={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class o6{constructor(e,n={}){d(this,"device");d(this,"options");d(this,"gltf");this.device=e,this.options={...i6,...n}}instantiate(e){return this.gltf=e,(e.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new Y4(this.gltf):null}createScene(e){const r=(e.nodes||[]).map(i=>this.createNode(i));return new Si({id:e.name||e.id,children:r})}createNode(e){if(!e._node){const r=(e.children||[]).map(i=>this.createNode(i));e.mesh&&r.push(this.createMesh(e.mesh));const s=new Si({id:e.name||e.id,children:r});if(e.matrix)s.setMatrix(e.matrix);else{if(s.matrix.identity(),e.translation&&s.matrix.translate(e.translation),e.rotation){const i=new Q().fromQuaternion(e.rotation);s.matrix.multiplyRight(i)}e.scale&&s.matrix.scale(e.scale)}e._node=s}return e._node}createMesh(e){if(!e._mesh){const r=(e.primitives||[]).map((i,o)=>this.createPrimitive(i,o,e)),s=new Si({id:e.name||e.id,children:r});e._mesh=s}return e._mesh}createPrimitive(e,n,r){const s=e.name||`${r.name||r.id}-primitive-${n}`,i=a6(e.mode||4),o=e.indices?e.indices.count:this.getVertexCount(e.attributes),a=s6(this.device,{id:s,geometry:this.createGeometry(s,e,i),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:o});return a.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],a}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,n,r){const s={};for(const[i,o]of Object.entries(n.attributes)){const{components:a,size:c,value:l}=o;s[i]={size:c??a,value:l}}return new Ei({id:e,topology:r,indices:n.indices.value,attributes:s})}createBuffer(e,n){e.bufferView||(e.bufferView={});const{bufferView:r}=e;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[n]||(r.lumaBuffers[n]=this.device.createBuffer({id:`from-${r.id}`,data:r.data||e.value})),r.lumaBuffers[n]}createSampler(e){return e}needsPOT(){return!1}}var Ln;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Ln||(Ln={}));function a6(t){switch(t){case Ln.POINTS:return"point-list";case Ln.LINES:return"line-list";case Ln.LINE_STRIP:return"line-strip";case Ln.LINE_LOOP:return"line-loop-webgl";case Ln.TRIANGLES:return"triangle-list";case Ln.TRIANGLE_STRIP:return"triangle-strip";case Ln.TRIANGLE_FAN:return"triangle-fan-webgl";default:throw new Error(t)}}function c6(t,e,n){const r=new o6(t,n),s=r.instantiate(e),i=r.createAnimator();return{scenes:s,animator:i}}function wt(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const h1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},f1={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},l6=1.33,DT=["SCALAR","VEC2","VEC3","VEC4"],u6=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],h6=new Map(u6),f6={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},d6={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},p6={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function d1(t){return DT[t-1]||DT[0]}function u_(t){const e=h6.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function h_(t,e){const n=p6[t.componentType],r=f6[t.type],s=d6[t.componentType],i=t.count*r,o=t.count*r*s;wt(o>=0&&o<=e.byteLength);const a=f1[t.componentType],c=h1[t.type];return{ArrayType:n,length:i,byteLength:o,componentByteSize:a,numberOfComponentsInElement:c}}function p1(t){let{images:e,bufferViews:n}=t;e=e||[],n=n||[];const r=e.map(o=>o.bufferView);n=n.filter(o=>!r.includes(o));const s=n.reduce((o,a)=>o+a.byteLength,0),i=e.reduce((o,a)=>{const{width:c,height:l}=a.image;return o+c*l},0);return s+Math.ceil(4*i*l6)}function g6(t,e,n){const r=t.bufferViews[n];wt(r);const s=r.buffer,i=e[s];wt(i);const o=(r.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,o,r.byteLength)}function _6(t,e,n){var y,w;const r=typeof n=="number"?(y=t.accessors)==null?void 0:y[n]:n;if(!r)throw new Error(`No gltf accessor ${JSON.stringify(n)}`);const s=(w=t.bufferViews)==null?void 0:w[r.bufferView||0];if(!s)throw new Error(`No gltf buffer view for accessor ${s}`);const{arrayBuffer:i,byteOffset:o}=e[s.buffer],a=(o||0)+(r.byteOffset||0)+(s.byteOffset||0),{ArrayType:c,length:l,componentByteSize:u,numberOfComponentsInElement:h}=h_(r,s),f=u*h,p=s.byteStride||f;if(typeof s.byteStride>"u"||s.byteStride===f)return new c(i,a,l);const m=new c(l);for(let _=0;_<r.count;_++){const g=new c(i,a+_*p,h);m.set(g,_*h)}return m}function m6(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class tt{constructor(e){d(this,"gltf");d(this,"sourceBuffers");d(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||m6(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const n=this.getUsedExtensions().find(s=>s===e),r=this.getRequiredExtensions().find(s=>s===e);return typeof n=="string"||typeof r=="string"}getExtension(e){const n=this.getUsedExtensions().find(s=>s===e),r=this.json.extensions||{};return n?r[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,n){return(e.extensions||{})[n]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,n){if(typeof n=="object")return n;const r=this.json[e]&&this.json[e][n];if(!r)throw new Error(`glTF file error: Could not find ${e}[${n}]`);return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);const n=e.buffer,r=this.gltf.buffers[n];wt(r);const s=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,s,e.byteLength)}getTypedArrayForAccessor(e){const n=this.getAccessor(e);return _6(this.gltf.json,this.gltf.buffers,n)}getTypedArrayForImageData(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),s=this.getBuffer(n.buffer).data,i=n.byteOffset||0;return new Uint8Array(s,i,n.byteLength)}addApplicationData(e,n){return this.json[e]=n,this}addExtraData(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}addObjectExtension(e,n,r){return e.extensions=e.extensions||{},e.extensions[n]=r,this.registerUsedExtension(n),this}setObjectExtension(e,n,r){const s=e.extensions||{};s[n]=r}removeObjectExtension(e,n){const r=(e==null?void 0:e.extensions)||{};if(r[n]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(n)||s.push(n)}delete r[n]}addExtension(e,n={}){return wt(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}addRequiredExtension(e,n={}){return wt(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var n;if((n=this.json.extensions)!=null&&n[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:n}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(e){const{meshIndex:n,matrix:r}=e;this.json.nodes=this.json.nodes||[];const s={mesh:n};return r&&(s.matrix=r),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(e){const{attributes:n,indices:r,material:s,mode:i=4}=e,a={primitives:[{attributes:this._addAttributes(n),mode:i}]};if(r){const c=this._addIndices(r);a.primitives[0].indices=c}return Number.isFinite(s)&&(a.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,n){const r=Pg(e),s=n||(r==null?void 0:r.mimeType),o={bufferView:this.addBufferView(e),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e,n=0,r=this.byteLength){const s=e.byteLength;wt(Number.isFinite(s)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const i={buffer:n,byteOffset:r,byteLength:s};return this.byteLength+=Ba(s,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(e,n){const r={bufferView:e,type:d1(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e,n={size:3}){const r=this.addBufferView(e);let s={min:n.min,max:n.max};(!s.min||!s.max)&&(s=this._getAccessorMinMax(e,n.size));const i={size:n.size,componentType:u_(e),count:Math.round(e.length/n.size),min:s.min,max:s.max};return this.addAccessor(r,Object.assign(i,n))}addTexture(e){const{imageIndex:n}=e,r={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var i,o;this.gltf.buffers=[];const e=this.byteLength,n=new ArrayBuffer(e),r=new Uint8Array(n);let s=0;for(const a of this.sourceBuffers||[])s=f3(a,r,s);(o=(i=this.json)==null?void 0:i.buffers)!=null&&o[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(e,n){let r=!0;for(;r;){const s=e.indexOf(n);s>-1?e.splice(s,1):r=!1}}_addAttributes(e={}){const n={};for(const r in e){const s=e[r],i=this._getGltfAttributeName(r),o=this.addBinaryBuffer(s.value,s);n[i]=o}return n}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,n){const r={min:null,max:null};if(e.length<n)return r;r.min=[],r.max=[];const s=e.subarray(0,n);for(const i of s)r.min.push(i),r.max.push(i);for(let i=n;i<e.length;i+=n)for(let o=0;o<n;o++)r.min[0+o]=Math.min(r.min[0+o],e[i+o]),r.max[0+o]=Math.max(r.max[0+o],e[i+o]);return r}}function UT(t){return(t%1+1)%1}const g1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},A6={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},_1={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function f_(t,e){return _1[e]*g1[t]}function Wu(t,e,n,r){if(n!=="UINT8"&&n!=="UINT16"&&n!=="UINT32"&&n!=="UINT64")return null;const s=t.getTypedArrayForBufferView(e),i=Xu(s,"SCALAR",n,r+1);return i instanceof BigInt64Array||i instanceof BigUint64Array?null:i}function Xu(t,e,n,r=1){const s=g1[e],i=A6[n],o=_1[n],a=r*s,c=a*o;let l=t.buffer,u=t.byteOffset;return u%o!==0&&(l=new Uint8Array(l).slice(u,u+c).buffer,u=0),new i(l,u,a)}function d_(t,e,n){var l,u,h,f,p;const r=`TEXCOORD_${e.texCoord||0}`,s=n.attributes[r],i=t.getTypedArrayForAccessor(s),o=t.gltf.json,a=e.index,c=(u=(l=o.textures)==null?void 0:l[a])==null?void 0:u.source;if(typeof c<"u"){const m=(f=(h=o.images)==null?void 0:h[c])==null?void 0:f.mimeType,y=(p=t.gltf.images)==null?void 0:p[c];if(y&&typeof y.width<"u"){const w=[];for(let _=0;_<i.length;_+=2){const g=y6(y,m,i,_,e.channels);w.push(g)}return w}}return[]}function m1(t,e,n,r,s){if(!(n!=null&&n.length))return;const i=[];for(const u of n){let h=r.findIndex(f=>f===u);h===-1&&(h=r.push(u)-1),i.push(h)}const o=new Uint32Array(i),a=t.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,c=t.addBufferView(o,a,0),l=t.addAccessor(c,{size:1,componentType:u_(o),count:o.length});s.attributes[e]=l}function y6(t,e,n,r,s=[0]){const i={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=n[r],a=n[r+1];let c=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(c=4);const l=T6(o,a,t,c);let u=0;for(const h of s){const f=typeof h=="number"?Object.values(i)[h]:i[h],p=l+f.offset,m=uC(t);if(m.data.length<=p)throw new Error(`${m.data.length} <= ${p}`);const y=m.data[p];u|=y<<f.shift}return u}function T6(t,e,n,r=1){const s=n.width,i=UT(t)*(s-1),o=Math.round(i),a=n.height,c=UT(e)*(a-1),l=Math.round(c),u=n.components?n.components:r;return(l*s+o)*u}function A1(t,e,n,r,s){const i=[];for(let o=0;o<e;o++){const a=n[o],c=n[o+1]-n[o];if(c+a>r)break;const l=a/s,u=c/s;i.push(t.slice(l,l+u))}return i}function y1(t,e,n){const r=[];for(let s=0;s<e;s++){const i=s*n;r.push(t.slice(i,i+n))}return r}function T1(t,e,n,r){if(n)throw new Error("Not implemented - arrayOffsets for strings is specified");if(r){const s=[],i=new TextDecoder("utf8");let o=0;for(let a=0;a<t;a++){const c=r[a+1]-r[a];if(c+o<=e.length){const l=e.subarray(o,c+o),u=i.decode(l);s.push(u),o+=c}}return s}return[]}const E1="EXT_mesh_features",E6=E1;async function S6(t,e){const n=new tt(t);C6(n,e)}function C6(t,e){const n=t.gltf.json;if(n.meshes)for(const r of n.meshes)for(const s of r.primitives)v6(t,s,e)}function v6(t,e,n){var i,o,a;if(!((i=n==null?void 0:n.gltf)!=null&&i.loadBuffers))return;const r=(o=e.extensions)==null?void 0:o[E1],s=r==null?void 0:r.featureIds;if(s)for(const c of s){let l;if(typeof c.attribute<"u"){const u=`_FEATURE_ID_${c.attribute}`,h=e.attributes[u];l=t.getTypedArrayForAccessor(h)}else typeof c.texture<"u"&&((a=n==null?void 0:n.gltf)!=null&&a.loadImages)?l=d_(t,c.texture,e):l=[];c.data=l}}const w6=Object.freeze(Object.defineProperty({__proto__:null,decode:S6,name:E6},Symbol.toStringTag,{value:"Module"})),p_="EXT_structural_metadata",R6=p_;async function b6(t,e){const n=new tt(t);I6(n,e)}function I6(t,e){var r,s;if(!((r=e.gltf)!=null&&r.loadBuffers))return;const n=t.getExtension(p_);n&&((s=e.gltf)!=null&&s.loadImages&&M6(t,n),B6(t,n))}function M6(t,e){const n=e.propertyTextures,r=t.gltf.json;if(n&&r.meshes)for(const s of r.meshes)for(const i of s.primitives)O6(t,n,i,e)}function B6(t,e){const n=e.schema;if(!n)return;const r=n.classes,s=e.propertyTables;if(r&&s)for(const i in r){const o=P6(s,i);o&&N6(t,n,o)}}function P6(t,e){for(const n of t)if(n.class===e)return n;return null}function O6(t,e,n,r){var o;if(!e)return;const s=(o=n.extensions)==null?void 0:o[p_],i=s==null?void 0:s.propertyTextures;if(i)for(const a of i){const c=e[a];x6(t,c,n,r)}}function x6(t,e,n,r){var i;if(!e.properties)return;r.dataAttributeNames||(r.dataAttributeNames=[]);const s=e.class;for(const o in e.properties){const a=`${s}_${o}`,c=(i=e.properties)==null?void 0:i[o];if(!c)continue;c.data||(c.data=[]);const l=c.data,u=d_(t,c,n);u!==null&&(m1(t,a,u,l,n),c.data=l,r.dataAttributeNames.push(a))}}function N6(t,e,n){var i,o;const r=(i=e.classes)==null?void 0:i[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const s=n.count;for(const a in r.properties){const c=r.properties[a],l=(o=n.properties)==null?void 0:o[a];if(l){const u=F6(t,e,c,s,l);l.data=u}}}function F6(t,e,n,r,s){let i=[];const o=s.values,a=t.getTypedArrayForBufferView(o),c=D6(t,n,s,r),l=U6(t,s,r);switch(n.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{i=k6(n,r,a,c);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${n.type}`);case"STRING":{i=T1(r,a,c,l);break}case"ENUM":{i=L6(e,n,r,a,c);break}default:throw new Error(`Unknown classProperty type ${n.type}`)}return i}function D6(t,e,n,r){return e.array&&typeof e.count>"u"&&typeof n.arrayOffsets<"u"?Wu(t,n.arrayOffsets,n.arrayOffsetType||"UINT32",r):null}function U6(t,e,n){return typeof e.stringOffsets<"u"?Wu(t,e.stringOffsets,e.stringOffsetType||"UINT32",n):null}function k6(t,e,n,r){const s=t.array,i=t.count,o=f_(t.type,t.componentType),a=n.byteLength/o;let c;return t.componentType?c=Xu(n,t.type,t.componentType,a):c=n,s?r?A1(c,e,r,n.length,o):i?y1(c,e,i):[]:c}function L6(t,e,n,r,s){var h;const i=e.enumType;if(!i)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const o=(h=t.enums)==null?void 0:h[i];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${i}`);const a=o.valueType||"UINT16",c=f_(e.type,a),l=r.byteLength/c;let u=Xu(r,e.type,a,l);if(u||(u=r),e.array){if(s)return V6({valuesData:u,numberOfElements:n,arrayOffsets:s,valuesDataBytesLength:r.length,elementSize:c,enumEntry:o});const f=e.count;return f?H6(u,n,f,o):[]}return g_(u,0,n,o)}function V6(t){const{valuesData:e,numberOfElements:n,arrayOffsets:r,valuesDataBytesLength:s,elementSize:i,enumEntry:o}=t,a=[];for(let c=0;c<n;c++){const l=r[c],u=r[c+1]-r[c];if(u+l>s)break;const h=l/i,f=u/i,p=g_(e,h,f,o);a.push(p)}return a}function H6(t,e,n,r){const s=[];for(let i=0;i<e;i++){const o=n*i,a=g_(t,o,n,r);s.push(a)}return s}function g_(t,e,n,r){const s=[];for(let i=0;i<n;i++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)s.push("");else{const o=t[e+i],a=z6(r,o);a?s.push(a.name):s.push("")}return s}function z6(t,e){for(const n of t.values)if(n.value===e)return n;return null}const j6=Object.freeze(Object.defineProperty({__proto__:null,decode:b6,name:R6},Symbol.toStringTag,{value:"Module"})),S1="EXT_feature_metadata",W6=S1;async function X6(t,e){const n=new tt(t);G6(n,e)}function G6(t,e){var r,s;if(!((r=e.gltf)!=null&&r.loadBuffers))return;const n=t.getExtension(S1);n&&((s=e.gltf)!=null&&s.loadImages&&$6(t,n),K6(t,n))}function $6(t,e){const n=e.schema;if(!n)return;const r=n.classes,{featureTextures:s}=e;if(r&&s)for(const i in r){const o=r[i],a=J6(s,i);a&&Q6(t,a,o)}}function K6(t,e){const n=e.schema;if(!n)return;const r=n.classes,s=e.featureTables;if(r&&s)for(const i in r){const o=Y6(s,i);o&&q6(t,n,o)}}function Y6(t,e){for(const n in t){const r=t[n];if(r.class===e)return r}return null}function J6(t,e){for(const n in t){const r=t[n];if(r.class===e)return r}return null}function q6(t,e,n){var i,o;if(!n.class)return;const r=(i=e.classes)==null?void 0:i[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const s=n.count;for(const a in r.properties){const c=r.properties[a],l=(o=n.properties)==null?void 0:o[a];if(l){const u=Z6(t,e,c,s,l);l.data=u}}}function Q6(t,e,n){var s;const r=e.class;for(const i in n.properties){const o=(s=e==null?void 0:e.properties)==null?void 0:s[i];if(o){const a=s8(t,o,r);o.data=a}}}function Z6(t,e,n,r,s){let i=[];const o=s.bufferView,a=t.getTypedArrayForBufferView(o),c=e8(t,n,s,r),l=t8(t,n,s,r);return n.type==="STRING"||n.componentType==="STRING"?i=T1(r,a,c,l):n8(n)&&(i=r8(n,r,a,c)),i}function e8(t,e,n,r){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof n.arrayOffsetBufferView<"u"?Wu(t,n.arrayOffsetBufferView,n.offsetType||"UINT32",r):null}function t8(t,e,n,r){return typeof n.stringOffsetBufferView<"u"?Wu(t,n.stringOffsetBufferView,n.offsetType||"UINT32",r):null}function n8(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function r8(t,e,n,r){const s=t.type==="ARRAY",i=t.componentCount,o="SCALAR",a=t.componentType||t.type,c=f_(o,a),l=n.byteLength/c,u=Xu(n,o,a,l);return s?r?A1(u,e,r,n.length,c):i?y1(u,e,i):[]:u}function s8(t,e,n){const r=t.gltf.json;if(!r.meshes)return[];const s=[];for(const i of r.meshes)for(const o of i.primitives)i8(t,n,e,s,o);return s}function i8(t,e,n,r,s){const i={channels:n.channels,...n.texture},o=d_(t,i,s);o&&m1(t,e,o,r,s)}const o8=Object.freeze(Object.defineProperty({__proto__:null,decode:X6,name:W6},Symbol.toStringTag,{value:"Module"})),a8="4.2.4",ki=!0,kT=1735152710,__=12,eu=8,c8=1313821514,l8=5130562,u8=0,h8=0,f8=1;function d8(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function p8(t,e=0,n={}){const r=new DataView(t),{magic:s=kT}=n,i=r.getUint32(e,!1);return i===s||i===kT}function g8(t,e,n=0,r={}){const s=new DataView(e),i=d8(s,n+0),o=s.getUint32(n+4,ki),a=s.getUint32(n+8,ki);switch(Object.assign(t,{header:{byteOffset:n,byteLength:a,hasBinChunk:!1},type:i,version:o,json:{},binChunks:[]}),n+=__,t.version){case 1:return _8(t,s,n);case 2:return m8(t,s,n,r={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function _8(t,e,n){ae(t.header.byteLength>__+eu);const r=e.getUint32(n+0,ki),s=e.getUint32(n+4,ki);return n+=eu,ae(s===u8),Ap(t,e,n,r),n+=r,n+=yp(t,e,n,t.header.byteLength),n}function m8(t,e,n,r){return ae(t.header.byteLength>__+eu),A8(t,e,n,r),n+t.header.byteLength}function A8(t,e,n,r){for(;n+8<=t.header.byteLength;){const s=e.getUint32(n+0,ki),i=e.getUint32(n+4,ki);switch(n+=eu,i){case c8:Ap(t,e,n,s);break;case l8:yp(t,e,n,s);break;case h8:r.strict||Ap(t,e,n,s);break;case f8:r.strict||yp(t,e,n,s);break}n+=Ba(s,4)}return n}function Ap(t,e,n,r){const s=new Uint8Array(e.buffer,n,r),o=new TextDecoder("utf8").decode(s);return t.json=JSON.parse(o),Ba(r,4)}function yp(t,e,n,r){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:r,arrayBuffer:e.buffer}),Ba(r,4)}function C1(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return r.substr(0,r.lastIndexOf("/")+1)+t}const y8="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",T8="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",E8=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),S8=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),C8={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},v8={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function w8(t,e,n,r,s,i="NONE"){const o=await R8();M8(o,o.exports[v8[s]],t,e,n,r,o.exports[C8[i||"NONE"]])}let _f;async function R8(){return _f||(_f=b8()),_f}async function b8(){let t=y8;WebAssembly.validate(E8)&&(t=T8,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(I8(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function I8(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;++r){const s=t.charCodeAt(r);e[r]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}let n=0;for(let r=0;r<t.length;++r)e[n++]=e[r]<60?S8[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,n)}function M8(t,e,n,r,s,i,o){const a=t.exports.sbrk,c=r+3&-4,l=a(c*s),u=a(i.length),h=new Uint8Array(t.exports.memory.buffer);h.set(i,u);const f=e(l,r,s,u,i.length);if(f===0&&o&&o(l,c,s),n.set(h.subarray(l,l+r*s)),a(l-a(0)),f!==0)throw new Error(`Malformed buffer data: ${f}`)}const tu="EXT_meshopt_compression",B8=tu;async function P8(t,e){var s,i;const n=new tt(t);if(!((s=e==null?void 0:e.gltf)!=null&&s.decompressMeshes)||!((i=e.gltf)!=null&&i.loadBuffers))return;const r=[];for(const o of t.json.bufferViews||[])r.push(O8(n,o));await Promise.all(r),n.removeExtension(tu)}async function O8(t,e){const n=t.getObjectExtension(e,tu);if(n){const{byteOffset:r=0,byteLength:s=0,byteStride:i,count:o,mode:a,filter:c="NONE",buffer:l}=n,u=t.gltf.buffers[l],h=new Uint8Array(u.arrayBuffer,u.byteOffset+r,s),f=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await w8(f,o,i,h,a,c),t.removeObjectExtension(e,tu)}}const x8=Object.freeze(Object.defineProperty({__proto__:null,decode:P8,name:B8},Symbol.toStringTag,{value:"Module"})),Ws="EXT_texture_webp",N8=Ws;function F8(t,e){const n=new tt(t);if(!cB("image/webp")){if(n.getRequiredExtensions().includes(Ws))throw new Error(`gltf: Required extension ${Ws} not supported by browser`);return}const{json:r}=n;for(const s of r.textures||[]){const i=n.getObjectExtension(s,Ws);i&&(s.source=i.source),n.removeObjectExtension(s,Ws)}n.removeExtension(Ws)}const D8=Object.freeze(Object.defineProperty({__proto__:null,name:N8,preprocess:F8},Symbol.toStringTag,{value:"Module"})),rl="KHR_texture_basisu",U8=rl;function k8(t,e){const n=new tt(t),{json:r}=n;for(const s of r.textures||[]){const i=n.getObjectExtension(s,rl);i&&(s.source=i.source,n.removeObjectExtension(s,rl))}n.removeExtension(rl)}const L8=Object.freeze(Object.defineProperty({__proto__:null,name:U8,preprocess:k8},Symbol.toStringTag,{value:"Module"})),V8="4.2.4",H8={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:V8,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function z8(t,e,n){const r=v1(e.metadata),s=[],i=j8(e.attributes);for(const o in t){const a=t[o],c=LT(o,a,i[o]);s.push(c)}if(n){const o=LT("indices",n);s.push(o)}return{fields:s,metadata:r}}function j8(t){const e={};for(const n in t){const r=t[n];e[r.name||"undefined"]=r}return e}function LT(t,e,n){const r=n?v1(n.metadata):void 0;return IM(t,e,r)}function v1(t){Object.entries(t);const e={};for(const n in t)e[`${n}.string`]=JSON.stringify(t[n]);return e}const VT={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},W8={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},X8=4;class G8{constructor(e){d(this,"draco");d(this,"decoder");d(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,n={}){const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);const s=this.decoder.GetEncodedGeometryType(r),i=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(s){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(r,i);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(r,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!i.ptr){const f=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(f)}const a=this._getDracoLoaderData(i,s,n),c=this._getMeshData(i,a,n),l=lC(c.attributes),u=z8(c.attributes,a,c.indices);return{loader:"draco",loaderData:a,header:{vertexCount:i.num_points(),boundingBox:l},...c,schema:u}}finally{this.draco.destroy(r),i&&this.draco.destroy(i)}}_getDracoLoaderData(e,n,r){const s=this._getTopLevelMetadata(e),i=this._getDracoAttributes(e,r);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:s,attributes:i}}_getDracoAttributes(e,n){const r={};for(let s=0;s<e.num_attributes();s++){const i=this.decoder.GetAttribute(e,s),o=this._getAttributeMetadata(e,s);r[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:s,metadata:o};const a=this._getQuantizationTransform(i,n);a&&(r[i.unique_id()].quantization_transform=a);const c=this._getOctahedronTransform(i,n);c&&(r[i.unique_id()].octahedron_transform=c)}return r}_getMeshData(e,n,r){const s=this._getMeshAttributes(n,e,r);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(e,n,r){const s={};for(const i of Object.values(e.attributes)){const o=this._deduceAttributeName(i,r);i.name=o;const a=this._getAttributeValues(n,i);if(a){const{value:c,size:l}=a;s[o]={value:c,size:l,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}}return s}_getTriangleListIndices(e){const r=e.num_faces()*3,s=r*X8,i=this.draco._malloc(s);try{return this.decoder.GetTrianglesUInt32Array(e,s,i),new Uint32Array(this.draco.HEAPF32.buffer,i,r).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(e){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),Y8(n)}finally{this.draco.destroy(n)}}_getAttributeValues(e,n){const r=W8[n.data_type];if(!r)return console.warn(`DRACO: Unsupported attribute type ${n.data_type}`),null;const s=n.num_components,o=e.num_points()*s,a=o*r.BYTES_PER_ELEMENT,c=$8(this.draco,r);let l;const u=this.draco._malloc(a);try{const h=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,h,c,a,u),l=new r(this.draco.HEAPF32.buffer,u,o).slice()}finally{this.draco._free(u)}return{value:l,size:s}}_deduceAttributeName(e,n){const r=e.unique_id;for(const[o,a]of Object.entries(n.extraAttributes||{}))if(a===r)return o;const s=e.attribute_type;for(const o in VT)if(this.draco[o]===s)return VT[o];const i=n.attributeNameEntry||"name";return e.metadata[i]?e.metadata[i].string:`CUSTOM_ATTRIBUTE_${r}`}_getTopLevelMetadata(e){const n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}_getAttributeMetadata(e,n){const r=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const n={},r=this.metadataQuerier.NumEntries(e);for(let s=0;s<r;s++){const i=this.metadataQuerier.GetEntryName(e,s);n[i]=this._getDracoMetadataField(e,i)}return n}_getDracoMetadataField(e,n){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,r);const s=K8(r);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:s}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:n=[],octahedronAttributes:r=[]}=e,s=[...n,...r];for(const i of s)this.decoder.SkipAttributeTransform(this.draco[i])}_getQuantizationTransform(e,n){const{quantizedAttributes:r=[]}=n,s=e.attribute_type();if(r.map(o=>this.decoder[o]).includes(s)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,n){const{octahedronAttributes:r=[]}=n,s=e.attribute_type();if(r.map(o=>this.decoder[o]).includes(s)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function $8(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function K8(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}function Y8(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}const J8="1.5.6",q8="1.4.1",mf=`https://www.gstatic.com/draco/versioned/decoders/${J8}`,ht={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Af={[ht.DECODER]:`${mf}/${ht.DECODER}`,[ht.DECODER_WASM]:`${mf}/${ht.DECODER_WASM}`,[ht.FALLBACK_DECODER]:`${mf}/${ht.FALLBACK_DECODER}`,[ht.ENCODER]:`https://raw.githubusercontent.com/google/draco/${q8}/javascript/${ht.ENCODER}`};let yf;async function Q8(t){const e=t.modules||{};return e.draco3d?yf||(yf=e.draco3d.createDecoderModule({}).then(n=>({draco:n}))):yf||(yf=Z8(t)),await yf}async function Z8(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await ps(Af[ht.FALLBACK_DECODER],"draco",t,ht.FALLBACK_DECODER);break;case"wasm":default:[e,n]=await Promise.all([await ps(Af[ht.DECODER],"draco",t,ht.DECODER),await ps(Af[ht.DECODER_WASM],"draco",t,ht.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await e9(e,n)}function e9(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t({...n,onModuleLoaded:s=>r({draco:s})})})}const w1={...H8,parse:t9};async function t9(t,e){const{draco:n}=await Q8(e),r=new G8(n);try{return r.parseSync(t,e==null?void 0:e.draco)}finally{r.destroy()}}function n9(t){const e={};for(const n in t){const r=t[n];if(n!=="indices"){const s=R1(r);e[n]=s}}return e}function R1(t){const{buffer:e,size:n,count:r}=r9(t);return{value:e,size:n,byteOffset:0,count:r,type:d1(n),componentType:u_(e)}}function r9(t){let e=t,n=1,r=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=s9(e,Float32Array)),r=e.length/n),{buffer:e,size:n,count:r}}function s9(t,e,n=!1){return t?Array.isArray(t)?new e(t):n&&!(t instanceof e)?new e(t):t:null}const Vr="KHR_draco_mesh_compression",i9=Vr;function o9(t,e,n){const r=new tt(t);for(const s of b1(r))r.getObjectExtension(s,Vr)}async function a9(t,e,n){var i;if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes))return;const r=new tt(t),s=[];for(const o of b1(r))r.getObjectExtension(o,Vr)&&s.push(l9(r,o,e,n));await Promise.all(s),r.removeExtension(Vr)}function c9(t,e={}){const n=new tt(t);for(const r of n.json.meshes||[])u9(r),n.addRequiredExtension(Vr)}async function l9(t,e,n,r){const s=t.getObjectExtension(e,Vr);if(!s)return;const i=t.getTypedArrayForBufferView(s.bufferView),o=vg(i.buffer,i.byteOffset),a={...n};delete a["3d-tiles"];const c=await Ma(o,w1,a,r),l=n9(c.attributes);for(const[u,h]of Object.entries(l))if(u in e.attributes){const f=e.attributes[u],p=t.getAccessor(f);p!=null&&p.min&&(p!=null&&p.max)&&(h.min=p.min,h.max=p.max)}e.attributes=l,c.indices&&(e.indices=R1(c.indices)),t.removeObjectExtension(e,Vr),h9(e)}function u9(t,e,n=4,r,s){var u;if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const i=r.DracoWriter.encodeSync({attributes:t}),o=(u=s==null?void 0:s.parseSync)==null?void 0:u.call(s,{attributes:t}),a=r._addFauxAttributes(o.attributes),c=r.addBufferView(i);return{primitives:[{attributes:a,mode:n,extensions:{[Vr]:{bufferView:c,attributes:a}}}]}}function h9(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*b1(t){for(const e of t.json.meshes||[])for(const n of e.primitives)yield n}const f9=Object.freeze(Object.defineProperty({__proto__:null,decode:a9,encode:c9,name:i9,preprocess:o9},Symbol.toStringTag,{value:"Module"})),Gu="KHR_texture_transform",d9=Gu,Fc=new M,p9=new be,g9=new be;async function _9(t,e){var i;if(!new tt(t).hasExtension(Gu)||!((i=e.gltf)!=null&&i.loadBuffers))return;const s=t.json.materials||[];for(let o=0;o<s.length;o++)m9(o,t)}function m9(t,e){var i,o,a,c;const n=(i=e.json.materials)==null?void 0:i[t],r=[(o=n==null?void 0:n.pbrMetallicRoughness)==null?void 0:o.baseColorTexture,n==null?void 0:n.emissiveTexture,n==null?void 0:n.normalTexture,n==null?void 0:n.occlusionTexture,(a=n==null?void 0:n.pbrMetallicRoughness)==null?void 0:a.metallicRoughnessTexture],s=[];for(const l of r)l&&((c=l==null?void 0:l.extensions)!=null&&c[Gu])&&A9(e,t,l,s)}function A9(t,e,n,r){const s=y9(n,r);if(!s)return;const i=t.json.meshes||[];for(const o of i)for(const a of o.primitives){const c=a.material;Number.isFinite(c)&&e===c&&T9(t,a,s)}}function y9(t,e){var o;const n=(o=t.extensions)==null?void 0:o[Gu],{texCoord:r=0}=t,{texCoord:s=r}=n;if(!(e.findIndex(([a,c])=>a===r&&c===s)!==-1)){const a=C9(n);return r!==s&&(t.texCoord=s),e.push([r,s]),{originalTexCoord:r,texCoord:s,matrix:a}}return null}function T9(t,e,n){var a,c;const{originalTexCoord:r,texCoord:s,matrix:i}=n,o=e.attributes[`TEXCOORD_${r}`];if(Number.isFinite(o)){const l=(a=t.json.accessors)==null?void 0:a[o];if(l&&l.bufferView){const u=(c=t.json.bufferViews)==null?void 0:c[l.bufferView];if(u){const{arrayBuffer:h,byteOffset:f}=t.buffers[u.buffer],p=(f||0)+(l.byteOffset||0)+(u.byteOffset||0),{ArrayType:m,length:y}=h_(l,u),w=f1[l.componentType],_=h1[l.type],g=u.byteStride||w*_,T=new Float32Array(y);for(let C=0;C<l.count;C++){const I=new m(h,p+C*g,2);Fc.set(I[0],I[1],1),Fc.transformByMatrix3(i),T.set([Fc[0],Fc[1]],C*_)}r===s?E9(l,u,t.buffers,T):S9(s,l,e,t,T)}}}}function E9(t,e,n,r){t.componentType=5126,n.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=n.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function S9(t,e,n,r,s){r.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});const i=r.json.bufferViews;if(!i)return;i.push({buffer:r.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});const o=r.json.accessors;o&&(o.push({bufferView:(i==null?void 0:i.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),n.attributes[`TEXCOORD_${t}`]=o.length-1)}function C9(t){const{offset:e=[0,0],rotation:n=0,scale:r=[1,1]}=t,s=new be().set(1,0,0,0,1,0,e[0],e[1],1),i=p9.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),o=g9.set(r[0],0,0,0,r[1],0,0,0,1);return s.multiplyRight(i).multiplyRight(o)}const v9=Object.freeze(Object.defineProperty({__proto__:null,decode:_9,name:d9},Symbol.toStringTag,{value:"Module"})),hs="KHR_lights_punctual",w9=hs;async function R9(t){const e=new tt(t),{json:n}=e,r=e.getExtension(hs);r&&(e.json.lights=r.lights,e.removeExtension(hs));for(const s of n.nodes||[]){const i=e.getObjectExtension(s,hs);i&&(s.light=i.light),e.removeObjectExtension(s,hs)}}async function b9(t){const e=new tt(t),{json:n}=e;if(n.lights){const r=e.addExtension(hs);wt(!r.lights),r.lights=n.lights,delete n.lights}if(e.json.lights){for(const r of e.json.lights){const s=r.node;e.addObjectExtension(s,hs,r)}delete e.json.lights}}const I9=Object.freeze(Object.defineProperty({__proto__:null,decode:R9,encode:b9,name:w9},Symbol.toStringTag,{value:"Module"})),Ea="KHR_materials_unlit",M9=Ea;async function B9(t){const e=new tt(t),{json:n}=e;for(const r of n.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,Ea);e.removeExtension(Ea)}function P9(t){const e=new tt(t),{json:n}=e;if(e.materials)for(const r of n.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,Ea,{}),e.addExtension(Ea))}const O9=Object.freeze(Object.defineProperty({__proto__:null,decode:B9,encode:P9,name:M9},Symbol.toStringTag,{value:"Module"})),Mo="KHR_techniques_webgl",x9=Mo;async function N9(t){const e=new tt(t),{json:n}=e,r=e.getExtension(Mo);if(r){const s=D9(r,e);for(const i of n.materials||[]){const o=e.getObjectExtension(i,Mo);o&&(i.technique=Object.assign({},o,s[o.technique]),i.technique.values=U9(i.technique,e)),e.removeObjectExtension(i,Mo)}e.removeExtension(Mo)}}async function F9(t,e){}function D9(t,e){const{programs:n=[],shaders:r=[],techniques:s=[]}=t,i=new TextDecoder;return r.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=i.decode(e.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(o=>{o.fragmentShader=r[o.fragmentShader],o.vertexShader=r[o.vertexShader]}),s.forEach(o=>{o.program=n[o.program]}),s}function U9(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(r=>{t.uniforms[r].value&&!(r in n)&&(n[r]=t.uniforms[r].value)}),Object.keys(n).forEach(r=>{typeof n[r]=="object"&&n[r].index!==void 0&&(n[r].texture=e.getTexture(n[r].index))}),n}const k9=Object.freeze(Object.defineProperty({__proto__:null,decode:N9,encode:F9,name:x9},Symbol.toStringTag,{value:"Module"})),I1=[j6,w6,x8,D8,L8,f9,I9,O9,k9,v9,o8];function L9(t,e={},n){var s;const r=I1.filter(i=>M1(i.name,e));for(const i of r)(s=i.preprocess)==null||s.call(i,t,e,n)}async function V9(t,e={},n){var s;const r=I1.filter(i=>M1(i.name,e));for(const i of r)await((s=i.decode)==null?void 0:s.call(i,t,e,n))}function M1(t,e){var s;const n=((s=e==null?void 0:e.gltf)==null?void 0:s.excludeExtensions)||{};return!(t in n&&!n[t])}const Tf="KHR_binary_glTF";function H9(t){const e=new tt(t),{json:n}=e;for(const r of n.images||[]){const s=e.getObjectExtension(r,Tf);s&&Object.assign(r,s),e.removeObjectExtension(r,Tf)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(Tf)}const HT={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},z9={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class j9{constructor(){d(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});d(this,"json")}normalize(e,n){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${r.asset.version}`);return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),H9(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const n in HT)this._convertTopLevelObjectToArray(e,n)}_convertTopLevelObjectToArray(e,n){const r=e[n];if(!(!r||Array.isArray(r))){e[n]=[];for(const s in r){const i=r[s];i.id=i.id||s;const o=e[n].length;e[n].push(i),this.idToIndexMap[n][s]=o}}}_convertObjectIdsToArrayIndices(e){for(const n in HT)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const n of e.textures)this._convertTextureIds(n);for(const n of e.meshes)this._convertMeshIds(n);for(const n of e.nodes)this._convertNodeIds(n);for(const n of e.scenes)this._convertSceneIds(n)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const n of e.primitives){const{attributes:r,indices:s,material:i}=n;for(const o in r)r[o]=this._convertIdToIndex(r[o],"accessor");s&&(n.indices=this._convertIdToIndex(s,"accessor")),i&&(n.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(n=>this._convertIdToIndex(n,"node"))),e.meshes&&(e.meshes=e.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(e,n){e[n]||(console.warn(`gltf v1: json doesn't contain attribute ${n}`),e[n]=[]);for(const r of e[n])for(const s in r){const i=r[s],o=this._convertIdToIndex(i,s);r[s]=o}}_convertIdToIndex(e,n){const r=z9[n];if(r in this.idToIndexMap){const s=this.idToIndexMap[r][e];if(!Number.isFinite(s))throw new Error(`gltf v1: failed to resolve ${n} with id ${e}`);return s}return e}_updateObjects(e){for(const n of this.json.buffers)delete n.type}_updateMaterial(e){var n,r,s;for(const i of e.materials){i.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((n=i.values)==null?void 0:n.tex)||((r=i.values)==null?void 0:r.texture2d_0)||((s=i.values)==null?void 0:s.diffuseTex),a=e.textures.findIndex(c=>c.id===o);a!==-1&&(i.pbrMetallicRoughness.baseColorTexture={index:a})}}}function W9(t,e={}){return new j9().normalize(t,e)}async function X9(t,e,n=0,r,s){var i,o,a;return G9(t,e,n,r),W9(t,{normalize:(i=r==null?void 0:r.gltf)==null?void 0:i.normalize}),L9(t,r,s),(o=r==null?void 0:r.gltf)!=null&&o.loadBuffers&&t.json.buffers&&await $9(t,r,s),(a=r==null?void 0:r.gltf)!=null&&a.loadImages&&await K9(t,r,s),await V9(t,r,s),t}function G9(t,e,n,r){if(r.uri&&(t.baseUri=r.uri),e instanceof ArrayBuffer&&!p8(e,n,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=c3(e);else if(e instanceof ArrayBuffer){const o={};n=g8(o,e,n,r.glb),wt(o.type==="glTF",`Invalid GLB magic string ${o.type}`),t._glb=o,t.json=o.json}else wt(!1,"GLTF: must be ArrayBuffer or string");const s=t.json.buffers||[];if(t.buffers=new Array(s.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:o}=t._glb;t.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const i=t.json.images||[];t.images=new Array(i.length).fill({})}async function $9(t,e,n){var s,i;const r=t.json.buffers||[];for(let o=0;o<r.length;++o){const a=r[o];if(a.uri){const{fetch:c}=n;wt(c);const l=C1(a.uri,e),u=await((s=n==null?void 0:n.fetch)==null?void 0:s.call(n,l)),h=await((i=u==null?void 0:u.arrayBuffer)==null?void 0:i.call(u));t.buffers[o]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete a.uri}else t.buffers[o]===null&&(t.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function K9(t,e,n){const r=Y9(t),s=t.json.images||[],i=[];for(const o of r)i.push(J9(t,s[o],o,e,n));return await Promise.all(i)}function Y9(t){const e=new Set,n=t.json.textures||[];for(const r of n)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function J9(t,e,n,r,s){let i;if(e.uri&&!e.hasOwnProperty("bufferView")){const a=C1(e.uri,r),{fetch:c}=s;i=await(await c(a)).arrayBuffer(),e.bufferView={data:i}}if(Number.isFinite(e.bufferView)){const a=g6(t.json,t.buffers,e.bufferView);i=vg(a.buffer,a.byteOffset,a.byteLength)}wt(i,"glTF image has no data");let o=await Ma(i,[dC,X4],{...r,mimeType:e.mimeType,basis:r.basis||{format:u1()}},s);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),t.images=t.images||[],t.images[n]=o}const Sa={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:a8,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:q9,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function q9(t,e={},n){e={...Sa.options,...e},e.gltf={...Sa.options.gltf,...e.gltf};const{byteOffset:r=0}=e;return await X9({},t,r,e,n)}const Q9={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Z9={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},xt={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},eV={magFilter:xt.TEXTURE_MAG_FILTER,minFilter:xt.TEXTURE_MIN_FILTER,wrapS:xt.TEXTURE_WRAP_S,wrapT:xt.TEXTURE_WRAP_T},tV={[xt.TEXTURE_MAG_FILTER]:xt.LINEAR,[xt.TEXTURE_MIN_FILTER]:xt.NEAREST_MIPMAP_LINEAR,[xt.TEXTURE_WRAP_S]:xt.REPEAT,[xt.TEXTURE_WRAP_T]:xt.REPEAT};function nV(){return{id:"default-sampler",parameters:tV}}function rV(t){return Z9[t]}function sV(t){return Q9[t]}class iV{constructor(){d(this,"baseUri","");d(this,"jsonUnprocessed");d(this,"json");d(this,"buffers",[]);d(this,"images",[])}postProcess(e,n={}){const{json:r,buffers:s=[],images:i=[]}=e,{baseUri:o=""}=e;return wt(r),this.baseUri=o,this.buffers=s,this.images=i,this.jsonUnprocessed=r,this.json=this._resolveTree(e.json,n),this.json}_resolveTree(e,n={}){const r={...e};return this.json=r,e.bufferViews&&(r.bufferViews=e.bufferViews.map((s,i)=>this._resolveBufferView(s,i))),e.images&&(r.images=e.images.map((s,i)=>this._resolveImage(s,i))),e.samplers&&(r.samplers=e.samplers.map((s,i)=>this._resolveSampler(s,i))),e.textures&&(r.textures=e.textures.map((s,i)=>this._resolveTexture(s,i))),e.accessors&&(r.accessors=e.accessors.map((s,i)=>this._resolveAccessor(s,i))),e.materials&&(r.materials=e.materials.map((s,i)=>this._resolveMaterial(s,i))),e.meshes&&(r.meshes=e.meshes.map((s,i)=>this._resolveMesh(s,i))),e.nodes&&(r.nodes=e.nodes.map((s,i)=>this._resolveNode(s,i)),r.nodes=r.nodes.map((s,i)=>this._resolveNodeChildren(s))),e.skins&&(r.skins=e.skins.map((s,i)=>this._resolveSkin(s,i))),e.scenes&&(r.scenes=e.scenes.map((s,i)=>this._resolveScene(s,i))),typeof this.json.scene=="number"&&r.scenes&&(r.scene=r.scenes[this.json.scene]),r}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,n){if(typeof n=="object")return n;const r=e&&e[n];return r||console.warn(`glTF file error: Could not find ${e}[${n}]`),r}_resolveScene(e,n){return{...e,id:e.id||`scene-${n}`,nodes:(e.nodes||[]).map(r=>this.getNode(r))}}_resolveNode(e,n){const r={...e,id:(e==null?void 0:e.id)||`node-${n}`};return e.mesh!==void 0&&(r.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(r.camera=this.getCamera(e.camera)),e.skin!==void 0&&(r.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(r.mesh=e.meshes.reduce((s,i)=>{const o=this.getMesh(i);return s.id=o.id,s.primitives=s.primitives.concat(o.primitives),s},{primitives:[]})),r}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(n=>this.getNode(n))),e}_resolveSkin(e,n){const r=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${n}`,inverseBindMatrices:r}}_resolveMesh(e,n){const r={...e,id:e.id||`mesh-${n}`,primitives:[]};return e.primitives&&(r.primitives=e.primitives.map(s=>{const i={...s,attributes:{},indices:void 0,material:void 0},o=s.attributes;for(const a in o)i.attributes[a]=this.getAccessor(o[a]);return s.indices!==void 0&&(i.indices=this.getAccessor(s.indices)),s.material!==void 0&&(i.material=this.getMaterial(s.material)),i})),r}_resolveMaterial(e,n){const r={...e,id:e.id||`material-${n}`};if(r.normalTexture&&(r.normalTexture={...r.normalTexture},r.normalTexture.texture=this.getTexture(r.normalTexture.index)),r.occlusionTexture&&(r.occlusionTexture={...r.occlusionTexture},r.occlusionTexture.texture=this.getTexture(r.occlusionTexture.index)),r.emissiveTexture&&(r.emissiveTexture={...r.emissiveTexture},r.emissiveTexture.texture=this.getTexture(r.emissiveTexture.index)),r.emissiveFactor||(r.emissiveFactor=r.emissiveTexture?[1,1,1]:[0,0,0]),r.pbrMetallicRoughness){r.pbrMetallicRoughness={...r.pbrMetallicRoughness};const s=r.pbrMetallicRoughness;s.baseColorTexture&&(s.baseColorTexture={...s.baseColorTexture},s.baseColorTexture.texture=this.getTexture(s.baseColorTexture.index)),s.metallicRoughnessTexture&&(s.metallicRoughnessTexture={...s.metallicRoughnessTexture},s.metallicRoughnessTexture.texture=this.getTexture(s.metallicRoughnessTexture.index))}return r}_resolveAccessor(e,n){const r=rV(e.componentType),s=sV(e.type),i=r*s,o={...e,id:e.id||`accessor-${n}`,bytesPerComponent:r,components:s,bytesPerElement:i,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(o.bufferView=this.getBufferView(e.bufferView)),o.bufferView){const a=o.bufferView.buffer,{ArrayType:c,byteLength:l}=h_(o,o.bufferView),u=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+a.byteOffset;let h=a.arrayBuffer.slice(u,u+l);o.bufferView.byteStride&&(h=this._getValueFromInterleavedBuffer(a,u,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new c(h)}return o}_getValueFromInterleavedBuffer(e,n,r,s,i){const o=new Uint8Array(i*s);for(let a=0;a<i;a++){const c=n+a*r;o.set(new Uint8Array(e.arrayBuffer.slice(c,c+s)),a*s)}return o.buffer}_resolveTexture(e,n){return{...e,id:e.id||`texture-${n}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):nV(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,n){const r={id:e.id||`sampler-${n}`,...e,parameters:{}};for(const s in r){const i=this._enumSamplerParameter(s);i!==void 0&&(r.parameters[i]=r[s])}return r}_enumSamplerParameter(e){return eV[e]}_resolveImage(e,n){const r={...e,id:e.id||`image-${n}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},s=this.images[n];return s&&(r.image=s),r}_resolveBufferView(e,n){const r=e.buffer,s=this.buffers[r].arrayBuffer;let i=this.buffers[r].byteOffset||0;return e.byteOffset&&(i+=e.byteOffset),{id:`bufferView-${n}`,...e,buffer:this.buffers[r],data:new Uint8Array(s,i,e.byteLength)}}_resolveCamera(e,n){const r={...e,id:e.id||`camera-${n}`};return r.perspective,r.orthographic,r}}function m_(t,e){return new iV().postProcess(t,e)}async function oV(t){const e=[];return t.scenes.forEach(n=>{n.traverse(r=>{Object.values(r.model.uniforms).forEach(s=>{s.loaded===!1&&e.push(s)})})}),await aV(()=>e.some(n=>!n.loaded))}async function aV(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const cV=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(MODULE_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(sizeScale);
float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (sceneModelMatrix * vec4(positions, 1.0)).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,lV=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
uniform float opacity;
in vec4 vColor;
out vec4 fragColor;
#ifndef MODULE_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D u_BaseColorSampler;
#endif
#endif
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(u_BaseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,B1=[255,255,255,255],uV={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:B1},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Sa]};class A_ extends Da{getShaders(){const e=[$g,Jg];return this.props._lighting==="pbr"&&e.push(Xg),super.getShaders({vs:cV,fs:lV,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:B1,transition:!0},instanceModelMatrix:o1})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;n.scenegraph!==r.scenegraph?this._updateScenegraph():n._animations!==r._animations&&this._applyAnimationsProp(this.state.animator,n._animations)}finalizeState(e){var n;super.finalizeState(e),(n=this.state.scenegraph)==null||n.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var a;const e=this.props,{device:n}=this.context;let r=null;if(e.scenegraph instanceof Kl)r={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const c=e.scenegraph,l=c.json?m_(c):c,u=c6(n,l,this._getModelOptions());r={gltf:l,...u},oV(u).then(()=>{this.setNeedsRedraw()}).catch(h=>{this.raiseError(h,"loading glTF")})}const s={layer:this,device:this.context.device},i=e.getScene(r,s),o=e.getAnimator(r,s);if(i instanceof Si){(a=this.state.scenegraph)==null||a.destroy(),this._applyAnimationsProp(o,e._animations);const c=[];i.traverse(l=>{l instanceof np&&c.push(l.model)}),this.setState({scenegraph:i,animator:o,models:c}),this.getAttributeManager().invalidateAll()}else i!==null&&ie.warn("invalid scenegraph:",i)()}_applyAnimationsProp(e,n){if(!e||!n)return;const r=e.getAnimations();Object.keys(n).sort().forEach(s=>{const i=n[s];if(s==="*")r.forEach(o=>{Object.assign(o,i)});else if(Number.isFinite(Number(s))){const o=Number(s);o>=0&&o<r.length?Object.assign(r[o],i):ie.warn(`animation ${s} not found`)()}else{const o=r.find(({name:a})=>a===s);o?Object.assign(o,i):ie.warn(`animation ${s} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let n;return e&&(typeof e=="function"?n=e({gl:this.context.gl,layer:this}):n=e),{imageBasedLightingEnvironment:n,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:n,renderPass:r}=this.context,{sizeScale:s,sizeMinPixels:i,sizeMaxPixels:o,opacity:a,coordinateSystem:c}=this.props,l=this.getNumInstances();this.state.scenegraph.traverse((u,{worldMatrix:h})=>{if(u instanceof np){const{model:f}=u;f.setInstanceCount(l),f.setUniforms({sizeScale:s,opacity:a,sizeMinPixels:i,sizeMaxPixels:o,composeModelMatrix:a1(n,c),sceneModelMatrix:h,u_Camera:f.uniforms.project_uCameraPosition}),f.draw(r)}})}}A_.defaultProps=uV;A_.layerName="ScenegraphLayer";const hV=A_,fV=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,dV=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function pV(t){const e=t.positions||t.POSITION,n=e.value.length/e.size;t.COLOR_0||t.colors||(t.colors={size:4,value:new Uint8Array(n*4).fill(255),normalized:!0})}const gV={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class y_ extends I4{getShaders(){const e=super.getShaders();return e.modules.push(Xg),{...e,vs:fV,fs:dV}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const n=this.getAttributeManager();e&&n.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;n.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(n.pbrMaterial)}draw(e){const{featureIds:n}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.uniforms.project_uCameraPosition,pickFeatureIds:!!n}),super.draw(e))}getModel(e){const{id:n,pbrMaterial:r}=this.props,s=this.parseMaterial(r,e);this.setState({parsedPBRMaterial:s});const i=this.getShaders();return pV(e.attributes),new kr(this.context.device,{...this.getShaders(),id:n,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...i.defines,...s==null?void 0:s.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:s==null?void 0:s.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:n}=this.state;if(n){const{mesh:r}=this.props,s=this.parseMaterial(e,r);this.setState({parsedPBRMaterial:s}),n.setBindings(s.bindings),n.setUniforms(s.uniforms)}}parseMaterial(e,n){const r=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return c1(this.context.device,{unlit:r,...e},{NORMAL:n.attributes.normals,TEXCOORD_0:n.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const n=this.props.featureIds,r=new Uint8ClampedArray(n.length*e.size),s=[];for(let i=0;i<n.length;i++)this.encodePickingColor(n[i],s),r[i*3]=s[0],r[i*3+1]=s[1],r[i*3+2]=s[2];e.value=r}finalizeState(e){var n;super.finalizeState(e),(n=this.state.parsedPBRMaterial)==null||n.generatedTextures.forEach(r=>r.destroy()),this.setState({parsedPBRMaterial:null})}}y_.layerName="MeshLayer";y_.defaultProps=gV;const _V=y_,mV=6378137,AV=6378137,yV=6356752314245179e-9;function $u(t){return t}new M;function TV(t,e=[],n=$u){return"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):"x"in t?(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function EV(t,e=[]){return TV(t,e,De._cartographicRadians?$u:Y2)}function SV(t,e,n=$u){return"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):"x"in e?(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function CV(t,e){return SV(t,e,De._cartographicRadians?$u:J2)}const zT=1e-14,vV=new M,jT={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Ef={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},mo={east:new M,north:new M,up:new M,west:new M,south:new M,down:new M},wV=new M,RV=new M,bV=new M;function WT(t,e,n,r,s,i){const o=jT[e]&&jT[e][n];Qt(o&&(!r||r===o));let a,c,l;const u=vV.copy(s);if(on(u.x,0,zT)&&on(u.y,0,zT)){const f=Math.sign(u.z);a=wV.fromArray(Ef[e]),e!=="east"&&e!=="west"&&a.scale(f),c=RV.fromArray(Ef[n]),n!=="east"&&n!=="west"&&c.scale(f),l=bV.fromArray(Ef[r]),r!=="east"&&r!=="west"&&l.scale(f)}else{const{up:f,east:p,north:m}=mo;p.set(-u.y,u.x,0).normalize(),t.geodeticSurfaceNormal(u,f),m.copy(f).cross(p);const{down:y,west:w,south:_}=mo;y.copy(f).scale(-1),w.copy(p).scale(-1),_.copy(m).scale(-1),a=mo[e],c=mo[n],l=mo[r]}return i[0]=a.x,i[1]=a.y,i[2]=a.z,i[3]=0,i[4]=c.x,i[5]=c.y,i[6]=c.z,i[7]=0,i[8]=l.x,i[9]=l.y,i[10]=l.z,i[11]=0,i[12]=u.x,i[13]=u.y,i[14]=u.z,i[15]=1,i}const Hs=new M,IV=new M,MV=new M;function BV(t,e,n=[]){const{oneOverRadii:r,oneOverRadiiSquared:s,centerToleranceSquared:i}=e;Hs.from(t);const o=Hs.x,a=Hs.y,c=Hs.z,l=r.x,u=r.y,h=r.z,f=o*o*l*l,p=a*a*u*u,m=c*c*h*h,y=f+p+m,w=Math.sqrt(1/y);if(!Number.isFinite(w))return;const _=IV;if(_.copy(t).scale(w),y<i)return _.to(n);const g=s.x,T=s.y,C=s.z,I=MV;I.set(_.x*g*2,_.y*T*2,_.z*C*2);let P=(1-w)*Hs.len()/(.5*I.len()),x=0,N,D,F,X;do{P-=x,N=1/(1+P*g),D=1/(1+P*T),F=1/(1+P*C);const q=N*N,ee=D*D,K=F*F,He=q*N,sr=ee*D,On=K*F;X=f*q+p*ee+m*K-1;const G=-2*(f*He*g+p*sr*T+m*On*C);x=X/G}while(Math.abs(X)>gx);return Hs.scale([N,D,F]).to(n)}const Dc=new M,XT=new M,PV=new M,$t=new M,OV=new M,Uc=new M;class ge{constructor(e=0,n=0,r=0){this.centerToleranceSquared=px,Qt(e>=0),Qt(n>=0),Qt(r>=0),this.radii=new M(e,n,r),this.radiiSquared=new M(e*e,n*n,r*r),this.radiiToTheFourth=new M(e*e*e*e,n*n*n*n,r*r*r*r),this.oneOverRadii=new M(e===0?0:1/e,n===0?0:1/n,r===0?0:1/r),this.oneOverRadiiSquared=new M(e===0?0:1/(e*e),n===0?0:1/(n*n),r===0?0:1/(r*r)),this.minimumRadius=Math.min(e,n,r),this.maximumRadius=Math.max(e,n,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,n=[0,0,0]){const r=XT,s=PV,[,,i]=e;this.geodeticSurfaceNormalCartographic(e,r),s.copy(this.radiiSquared).scale(r);const o=Math.sqrt(r.dot(s));return s.scale(1/o),r.scale(i),s.add(r),s.to(n)}cartesianToCartographic(e,n=[0,0,0]){Uc.from(e);const r=this.scaleToGeodeticSurface(Uc,$t);if(!r)return;const s=this.geodeticSurfaceNormal(r,XT),i=OV;i.copy(Uc).subtract(r);const o=Math.atan2(s.y,s.x),a=Math.asin(s.z),c=Math.sign(Vg(i,Uc))*XC(i);return CV([o,a,c],n)}eastNorthUpToFixedFrame(e,n=new Q){return WT(this,"east","north","up",e,n)}localFrameToFixedFrame(e,n,r,s,i=new Q){return WT(this,e,n,r,s,i)}geocentricSurfaceNormal(e,n=[0,0,0]){return Dc.from(e).normalize().to(n)}geodeticSurfaceNormalCartographic(e,n=[0,0,0]){const r=EV(e),s=r[0],i=r[1],o=Math.cos(i);return Dc.set(o*Math.cos(s),o*Math.sin(s),Math.sin(i)).normalize(),Dc.to(n)}geodeticSurfaceNormal(e,n=[0,0,0]){return Dc.from(e).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(e,n){return BV(e,this,n)}scaleToGeocentricSurface(e,n=[0,0,0]){$t.from(e);const r=$t.x,s=$t.y,i=$t.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(r*r*o.x+s*s*o.y+i*i*o.z);return $t.multiplyScalar(a).to(n)}transformPositionToScaledSpace(e,n=[0,0,0]){return $t.from(e).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(e,n=[0,0,0]){return $t.from(e).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(e,n=0,r=[0,0,0]){Qt(on(this.radii.x,this.radii.y,tv)),Qt(this.radii.z>0),$t.from(e);const s=$t.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(s)>=this.radii.z-n))return $t.set(0,0,s).to(r)}}ge.WGS84=new ge(mV,AV,yV);class xV{constructor(e,n,r){d(this,"item");d(this,"previous");d(this,"next");this.item=e,this.previous=n,this.next=r}}class NV{constructor(){d(this,"head",null);d(this,"tail",null);d(this,"_length",0)}get length(){return this._length}add(e){const n=new xV(e,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,n){e!==n&&(this.remove(n),this._insert(e,n))}_insert(e,n){const r=e.next;e.next=n,this.tail===e?this.tail=n:r.previous=n,n.next=r,n.previous=e,++this._length}}class FV{constructor(){d(this,"_list");d(this,"_sentinel");d(this,"_trimTiles");this._list=new NV,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const n=e._cacheNode;n&&this._list.splice(this._sentinel,n)}add(e,n,r){n._cacheNode||(n._cacheNode=this._list.add(n),r&&r(e,n))}unloadTile(e,n,r){const s=n._cacheNode;s&&(this._list.remove(s),n._cacheNode=null,r&&r(e,n))}unloadTiles(e,n){const r=this._trimTiles;this._trimTiles=!1;const s=this._list,i=e.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=s.head;for(;a!==o&&(e.gpuMemoryUsageInBytes>i||r);){const c=a.item;a=a.next,this.unloadTile(e,c,n)}}trim(){this._trimTiles=!0}}function DV(t,e){ae(t),ae(e);const{rtcCenter:n,gltfUpAxis:r}=e,{computedTransform:s,boundingVolume:{center:i}}=t;let o=new Q(s);switch(n&&o.translate(n),r){case"Z":break;case"Y":const h=new Q().rotateX(Math.PI/2);o=o.multiplyRight(h);break;case"X":const f=new Q().rotateY(-Math.PI/2);o=o.multiplyRight(f);break}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new M(i);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const c=ge.WGS84.cartesianToCartographic(a,new M),u=ge.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=u.multiplyRight(o),e.cartographicOrigin=c,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const GT=new M,Sf=new M,Tp=new Ut([new Cn,new Cn,new Cn,new Cn,new Cn,new Cn]);function UV(t,e){const{cameraDirection:n,cameraUp:r,height:s}=t,{metersPerUnit:i}=t.distanceScales,o=sl(t,t.center),a=ge.WGS84.eastNorthUpToFixedFrame(o),c=t.unprojectPosition(t.cameraPosition),l=ge.WGS84.cartographicToCartesian(c,new M),u=new M(a.transformAsVector(new M(n).scale(i))).normalize(),h=new M(a.transformAsVector(new M(r).scale(i))).normalize();LV(t);const f=t.constructor,{longitude:p,latitude:m,width:y,bearing:w,zoom:_}=t,g=new f({longitude:p,latitude:m,height:s,width:y,bearing:w,zoom:_,pitch:0});return{camera:{position:l,direction:u,up:h},viewport:t,topDownViewport:g,height:s,cullingVolume:Tp,frameNumber:e,sseDenominator:1.15}}function kV(t,e,n){if(n===0||t.length<=n)return[t,[]];const r=[],{longitude:s,latitude:i}=e.viewport;for(const[l,u]of t.entries()){const[h,f]=u.header.mbs,p=Math.abs(s-h),m=Math.abs(i-f),y=Math.sqrt(m*m+p*p);r.push([l,y])}const o=r.sort((l,u)=>l[1]-u[1]),a=[];for(let l=0;l<n;l++)a.push(t[o[l][0]]);const c=[];for(let l=n;l<o.length;l++)c.push(t[o[l][0]]);return[a,c]}function LV(t){const e=t.getFrustumPlanes(),n=$T(e.near,t.cameraPosition),r=sl(t,n),s=sl(t,t.cameraPosition,Sf);let i=0;Tp.planes[i++].fromPointNormal(r,GT.copy(r).subtract(s));for(const o in e){if(o==="near")continue;const a=e[o],c=$T(a,n,Sf),l=sl(t,c,Sf);Tp.planes[i++].fromPointNormal(l,GT.copy(r).subtract(l))}}function $T(t,e,n=new M){const r=t.normal.dot(e);return n.copy(t.normal).scale(t.distance-r).add(e),n}function sl(t,e,n=new M){const r=t.unprojectPosition(e);return ge.WGS84.cartographicToCartesian(r,n)}const VV=6378137,HV=6378137,Ep=6356752314245179e-9,li=new M;function zV(t,e){if(t instanceof ka){const{halfAxes:n}=t,r=WV(n);return Math.log2(Ep/(r+e[2]))}else if(t instanceof Ua){const{radius:n}=t;return Math.log2(Ep/(n+e[2]))}else if(t.width&&t.height){const{width:n,height:r}=t,s=Math.log2(VV/n),i=Math.log2(HV/r);return(s+i)/2}return 1}function P1(t,e,n){ge.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],li);const r=Math.sqrt(Math.pow(li[0]-n[0],2)+Math.pow(li[1]-n[1],2)+Math.pow(li[2]-n[2],2));return Math.log2(Ep/(r+e[2]))}function jV(t,e,n){const[r,s,i,o]=t;return P1({xmin:r,xmax:i,ymin:s,ymax:o,zmin:0,zmax:0},e,n)}function WV(t){t.getColumn(0,li);const e=t.getColumn(1),n=t.getColumn(2);return li.add(e).add(n).len()}const Tt={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var an;(function(t){t[t.ADD=1]="ADD",t[t.REPLACE=2]="REPLACE"})(an||(an={}));var $n;(function(t){t.EMPTY="empty",t.SCENEGRAPH="scenegraph",t.POINTCLOUD="pointcloud",t.MESH="mesh"})($n||($n={}));var ut;(function(t){t.I3S="I3S",t.TILES3D="TILES3D"})(ut||(ut={}));var Li;(function(t){t.GEOMETRIC_ERROR="geometricError",t.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Li||(Li={}));const XV={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function O1(t){return t!=null}const qe=new M,il=new M,GV=new M,$V=new M,qr=new M,KT=new M,YT=new M,JT=new M;function Cf(t,e,n){if(ae(t,"3D Tile: boundingVolume must be defined"),t.box)return x1(t.box,e,n);if(t.region)return JV(t.region);if(t.sphere)return YV(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function KV(t,e){if(t.box)return qV(e);if(t.region){const[n,r,s,i,o,a]=t.region;return[[qt(n),qt(r),o],[qt(s),qt(i),a]]}if(t.sphere)return QV(e);throw new Error("Unkown boundingVolume type")}function x1(t,e,n){const r=new M(t[0],t[1],t[2]);e.transform(r,r);let s=[];if(t.length===10){const l=t.slice(3,6),u=new _a;u.fromArray(t,6);const h=new M([1,0,0]),f=new M([0,1,0]),p=new M([0,0,1]);h.transformByQuaternion(u),h.scale(l[0]),f.transformByQuaternion(u),f.scale(l[1]),p.transformByQuaternion(u),p.scale(l[2]),s=[...h.toArray(),...f.toArray(),...p.toArray()]}else s=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const i=e.transformAsVector(s.slice(0,3)),o=e.transformAsVector(s.slice(3,6)),a=e.transformAsVector(s.slice(6,9)),c=new be([i[0],i[1],i[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return O1(n)?(n.center=r,n.halfAxes=c,n):new ka(r,c)}function YV(t,e,n){const r=new M(t[0],t[1],t[2]);e.transform(r,r);const s=e.getScale(il),i=Math.max(Math.max(s[0],s[1]),s[2]),o=t[3]*i;return O1(n)?(n.center=r,n.radius=o,n):new Ua(r,o)}function JV(t){const[e,n,r,s,i,o]=t,a=ge.WGS84.cartographicToCartesian([qt(e),qt(s),i],GV),c=ge.WGS84.cartographicToCartesian([qt(r),qt(n),o],$V),l=new M().addVectors(a,c).multiplyByScalar(.5);return ge.WGS84.cartesianToCartographic(l,qr),ge.WGS84.cartographicToCartesian([qt(r),qr[1],qr[2]],KT),ge.WGS84.cartographicToCartesian([qr[0],qt(s),qr[2]],YT),ge.WGS84.cartographicToCartesian([qr[0],qr[1],o],JT),x1([...l,...KT.subtract(l),...YT.subtract(l),...JT.subtract(l)],new Q)}function qV(t){const e=N1(),{halfAxes:n}=t,r=new M(n.getColumn(0)),s=new M(n.getColumn(1)),i=new M(n.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let c=0;c<2;c++)qe.copy(t.center),qe.add(r),qe.add(s),qe.add(i),F1(e,qe),i.negate();s.negate()}r.negate()}return e}function QV(t){const e=N1(),{center:n,radius:r}=t,s=ge.WGS84.scaleToGeodeticSurface(n,qe);let i;s?i=ge.WGS84.geodeticSurfaceNormal(s):i=new M(0,0,1);let o=new M(i[2],-i[1],0);o.len()>0?o.normalize():o=new M(0,1,0);const a=o.clone().cross(i);for(const c of[o,a,i]){il.copy(c).scale(r);for(let l=0;l<2;l++)qe.copy(n),qe.add(il),F1(e,qe),il.negate()}return e}function N1(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function F1(t,e){ge.WGS84.cartesianToCartographic(e,qe),t[0][0]=Math.min(t[0][0],qe[0]),t[0][1]=Math.min(t[0][1],qe[1]),t[0][2]=Math.min(t[0][2],qe[2]),t[1][0]=Math.max(t[1][0],qe[0]),t[1][1]=Math.max(t[1][1],qe[1]),t[1][2]=Math.max(t[1][2],qe[2])}new M;new M;new Q;new M;new M;new M;function ZV(t,e){const n=t*e;return 1-Math.exp(-(n*n))}function eH(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const n=t.dynamicScreenSpaceErrorComputedDensity,r=t.dynamicScreenSpaceErrorFactor;return ZV(e,n)*r}return 0}function tH(t,e,n){const r=t.tileset,s=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,i=n?s:t.lodMetricValue;if(i===0)return 0;const o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:c}=e,{viewDistanceScale:l}=r.options;let u=i*a*(l||1)/(o*c);return u-=eH(r,o),u}const vf=new M,qT=new M,dr=new M,QT=new M,nH=new M,wf=new Q,ZT=new Q;function rH(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const n=2*D1(t,e);return n<2?"OUT":!t.header.children||n<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function D1(t,e){const{topDownViewport:n}=e,r=t.header.mbs[1],s=t.header.mbs[0],i=t.header.mbs[2],o=t.header.mbs[3],a=[...t.boundingVolume.center],c=n.unprojectPosition(n.cameraPosition);ge.WGS84.cartographicToCartesian(c,vf),qT.copy(vf).subtract(a).normalize(),ge.WGS84.eastNorthUpToFixedFrame(a,wf),ZT.copy(wf).invert(),dr.copy(vf).transform(ZT);const l=Math.sqrt(dr[0]*dr[0]+dr[1]*dr[1]),u=l*l/dr[2];QT.copy([dr[0],dr[1],u]);const f=QT.transform(wf).subtract(a).normalize(),m=qT.cross(f).normalize().scale(o).add(a),y=ge.WGS84.cartesianToCartographic(m),w=n.project([s,r,i]),_=n.project(y);return nH.copy(w).subtract(_).magnitude()}function sH(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class e0{constructor(e=0){d(this,"_map",new Map);d(this,"_array");d(this,"_length");this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return ae(e<this._array.length),this._array[e]}set(e,n){ae(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=n,this._map.set(n,e)}delete(e){const n=this._map.get(e);n>=0&&(this._array.splice(n,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const n=this.length++;this._array[n]=e,this._map.set(e,n)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){ae(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){ae(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const iH={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Ku{constructor(e){d(this,"options");d(this,"root",null);d(this,"selectedTiles",{});d(this,"requestedTiles",{});d(this,"emptyTiles",{});d(this,"lastUpdate",new Date().getTime());d(this,"updateDebounceTime",1e3);d(this,"_traversalStack",new e0);d(this,"_emptyTraversalStack",new e0);d(this,"_frameNumber",null);this.options={...iH,...e}}traversalFinished(e){return!0}traverse(e,n,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,n),this._frameNumber=n.frameNumber,this.executeTraversal(e,n)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,n){const r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){const i=r.pop();let o=!1;this.canTraverse(i,n)&&(this.updateChildTiles(i,n),o=this.updateAndPushChildren(i,n,r,i.hasRenderContent?i._selectionDepth+1:i._selectionDepth));const a=i.parent,c=!!(!a||a._shouldRefine),l=!o;i.hasRenderContent?i.refine===an.ADD?(this.loadTile(i,n),this.selectTile(i,n)):i.refine===an.REPLACE&&(this.loadTile(i,n),l&&this.selectTile(i,n)):(this.emptyTiles[i.id]=i,this.loadTile(i,n),l&&this.selectTile(i,n)),this.touchTile(i,n),i._shouldRefine=o&&c}const s=new Date().getTime();(this.traversalFinished(n)||s-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=s,this.options.onTraversalEnd(n))}updateChildTiles(e,n){const r=e.children;for(const s of r)this.updateTile(s,n)}updateAndPushChildren(e,n,r,s){const{loadSiblings:i,skipLevelOfDetail:o}=this.options,a=e.children;a.sort(this.compareDistanceToCamera.bind(this));const c=e.refine===an.REPLACE&&e.hasRenderContent&&!o;let l=!1,u=!0;for(const h of a)if(h._selectionDepth=s,h.isVisibleAndInRequestVolume?(r.find(h)&&r.delete(h),r.push(h),l=!0):(c||i)&&(this.loadTile(h,n),this.touchTile(h,n)),c){let f;if(h._inRequestVolume?h.hasRenderContent?f=h.contentAvailable:f=this.executeEmptyTraversal(h,n):f=!1,u=u&&f,!u)return!1}return l||(u=!1),u}updateTile(e,n){this.updateTileVisibility(e,n)}selectTile(e,n){this.shouldSelectTile(e)&&(e._selectedFrame=n.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,n){this.shouldLoadTile(e)&&(e._requestedFrame=n.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,n){e.tileset._cache.touch(e),e._touchedFrame=n.frameNumber}canTraverse(e,n,r=!1,s=!1){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!s&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,n,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,n,r=!1){let s=e._screenSpaceError;return r&&(s=e.getScreenSpaceError(n,!0)),s>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,n){const r=[];if(this.options.viewportTraversersMap)for(const s in this.options.viewportTraversersMap)this.options.viewportTraversersMap[s]===n.viewport.id&&r.push(s);else r.push(n.viewport.id);e.updateVisibility(n,r)}compareDistanceToCamera(e,n){return e._distanceToCamera-n._distanceToCamera}anyChildrenVisible(e,n){let r=!1;for(const s of e.children)s.updateVisibility(n),r=r||s.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,n){let r=!0;const s=this._emptyTraversalStack;for(s.push(e);s.length>0;){const i=s.pop(),o=!i.hasRenderContent&&this.canTraverse(i,n,!1,!1),a=!i.hasRenderContent&&i.children.length===0;if(!o&&!i.contentAvailable&&!a&&(r=!1),this.updateTile(i,n),i.isVisibleAndInRequestVolume||(this.loadTile(i,n),this.touchTile(i,n)),o){const c=i.children;for(const l of c)s.push(l)}}return r}}const t0=new M;function oH(t){return t!=null}class Sp{constructor(e,n,r,s=""){d(this,"tileset");d(this,"header");d(this,"id");d(this,"url");d(this,"parent");d(this,"refine");d(this,"type");d(this,"contentUrl");d(this,"lodMetricType","geometricError");d(this,"lodMetricValue",0);d(this,"boundingVolume",null);d(this,"content",null);d(this,"contentState",Tt.UNLOADED);d(this,"gpuMemoryUsageInBytes",0);d(this,"children",[]);d(this,"depth",0);d(this,"viewportIds",[]);d(this,"transform",new Q);d(this,"extensions",null);d(this,"implicitTiling",null);d(this,"userData",{});d(this,"computedTransform");d(this,"hasEmptyContent",!1);d(this,"hasTilesetContent",!1);d(this,"traverser",new Ku({}));d(this,"_cacheNode",null);d(this,"_frameNumber",null);d(this,"_expireDate",null);d(this,"_expiredContent",null);d(this,"_boundingBox");d(this,"_distanceToCamera",0);d(this,"_screenSpaceError",0);d(this,"_visibilityPlaneMask");d(this,"_visible");d(this,"_contentBoundingVolume");d(this,"_viewerRequestVolume");d(this,"_initialTransform",new Q);d(this,"_priority",0);d(this,"_selectedFrame",0);d(this,"_requestedFrame",0);d(this,"_selectionDepth",0);d(this,"_touchedFrame",0);d(this,"_centerZDepth",0);d(this,"_shouldRefine",!1);d(this,"_stackLength",0);d(this,"_visitedFrame",0);d(this,"_inRequestVolume",!1);d(this,"_lodJudge",null);this.header=n,this.tileset=e,this.id=s||n.id,this.url=n.url,this.parent=r,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Tt.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Tt.UNLOADED}get contentExpired(){return this.contentState===Tt.EXPIRED}get contentFailed(){return this.contentState===Tt.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=KV(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,n){switch(this.tileset.type){case ut.I3S:return D1(this,e);case ut.TILES3D:return tH(this,e,n);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:n}=e.options,r=this.refine===an.ADD||n;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Tt.UNLOADED)return-1;const s=this.parent,o=s&&(!r||this._screenSpaceError===0||s.hasTilesetContent)?s._screenSpaceError:this._screenSpaceError,a=e.root?e.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Tt.LOADING;const n=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!n)return this.contentState=Tt.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),s=this.tileset.loader,i={...this.tileset.loadOptions,[s.id]:{...this.tileset.loadOptions[s.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(s.id)}};return this.content=await Dr(r,s,i),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Tt.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=Tt.FAILED,r}finally{n.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Tt.UNLOADED,!0}updateVisibility(e,n){if(this._frameNumber===e.frameNumber)return;const r=this.parent,s=r?r._visibilityPlaneMask:Ut.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const i=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(i)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,s),this._visible=this._visibilityPlaneMask!==Ut.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=n}visibility(e,n){const{cullingVolume:r}=e,{boundingVolume:s}=this;return r.computeVisibilityWithPlaneMask(s,n)}contentVisibility(){return!0}distanceToTile(e){const n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const n=this.boundingVolume;return t0.subVectors(n.center,e.position),e.direction.dot(t0)}insideViewerRequestVolume(e){const n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(oH(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Tt.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Q(e.transform):new Q;const n=this.parent,r=this.tileset,s=n&&n.computedTransform?n.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new Q(s).multiplyRight(this.transform);const i=n&&n._initialTransform?n._initialTransform.clone():new Q;this._initialTransform=new Q(i).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Tt.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Ut.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||an.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=Cf(e.boundingVolume,this.computedTransform,this.boundingVolume);const n=e.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=Cf(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=Cf(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new Q){const n=e.clone().multiplyRight(this.transform);n.equals(this.computedTransform)||(this.computedTransform=n,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return sH(this.tileset.tileset)}}}class aH extends Ku{compareDistanceToCamera(e,n){return n._distanceToCamera===0&&e._distanceToCamera===0?n._centerZDepth-e._centerZDepth:n._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,n){if(super.updateTileVisibility(e,n),!e.isVisibleAndInRequestVolume)return;const r=e.children.length>0;if(e.hasTilesetContent&&r){const o=e.children[0];this.updateTileVisibility(o,n),e._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(e,n)){e._visible=!1;return}const s=e.refine===an.REPLACE,i=e._optimChildrenWithinParent===XV.USE_OPTIMIZATION;if(s&&i&&r&&!this.anyChildrenVisible(e,n)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,n){const{parent:r}=e;return!r||r.hasTilesetContent||r.refine!==an.ADD?!1:!this.shouldRefine(e,n,!0)}}class cH{constructor(){d(this,"frameNumberMap",new Map)}register(e,n){const r=this.frameNumberMap.get(e)||new Map,s=r.get(n)||0;r.set(n,s+1),this.frameNumberMap.set(e,r)}deregister(e,n){const r=this.frameNumberMap.get(e);if(!r)return;const s=r.get(n)||1;r.set(n,s-1)}isZero(e,n){var s;return(((s=this.frameNumberMap.get(e))==null?void 0:s.get(n))||0)===0}}const Rf={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class lH{constructor(){d(this,"_statusMap");d(this,"pendingTilesRegister",new cH);this._statusMap={}}add(e,n,r,s){if(!this._statusMap[n]){const{frameNumber:i,viewport:{id:o}}=s;this._statusMap[n]={request:e,callback:r,key:n,frameState:s,status:Rf.REQUESTED},this.pendingTilesRegister.register(o,i),e().then(a=>{this._statusMap[n].status=Rf.COMPLETED;const{frameNumber:c,viewport:{id:l}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(l,c),this._statusMap[n].callback(a,s)}).catch(a=>{this._statusMap[n].status=Rf.ERROR;const{frameNumber:c,viewport:{id:l}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(l,c),r(a)})}}update(e,n){if(this._statusMap[e]){const{frameNumber:r,viewport:{id:s}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(s,r);const{frameNumber:i,viewport:{id:o}}=n;this.pendingTilesRegister.register(o,i),this._statusMap[e].frameState=n}}find(e){return this._statusMap[e]}hasPendingTiles(e,n){return!this.pendingTilesRegister.isZero(e,n)}}class uH extends Ku{constructor(n){super(n);d(this,"_tileManager");this._tileManager=new lH}traversalFinished(n){return!this._tileManager.hasPendingTiles(n.viewport.id,this._frameNumber||0)}shouldRefine(n,r){return n._lodJudge=rH(n,r),n._lodJudge==="DIG"}updateChildTiles(n,r){const s=n.header.children||[],i=n.children,o=n.tileset;for(const a of s){const c=`${a.id}-${r.viewport.id}`,l=i&&i.find(u=>u.id===c);if(l)l&&this.updateTile(l,r);else{let u=()=>this._loadTile(a.id,o);this._tileManager.find(c)?this._tileManager.update(c,r):(o.tileset.nodePages&&(u=()=>o.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(u,c,f=>this._onTileLoad(f,n,c),r))}}return!1}async _loadTile(n,r){const{loader:s}=r,i=r.getTileUrl(`${r.url}/nodes/${n}`),o={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await Dr(i,s,o)}_onTileLoad(n,r,s){const i=new Sp(r.tileset,n,r,s);r.children.push(i);const o=this._tileManager.find(i.id).frameState;this.updateTile(i,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,o)}}const hH={description:"",ellipsoid:ge.WGS84,modelMatrix:new Q,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},kc="Tiles In Tileset(s)",bf="Tiles In Memory",n0="Tiles In View",r0="Tiles To Render",s0="Tiles Loaded",If="Tiles Loading",i0="Tiles Unloaded",o0="Failed Tile Loads",a0="Points/Vertices",Mf="Tile Memory Use",c0="Maximum Screen Space Error";class fH{constructor(e,n){d(this,"options");d(this,"loadOptions");d(this,"type");d(this,"tileset");d(this,"loader");d(this,"url");d(this,"basePath");d(this,"modelMatrix");d(this,"ellipsoid");d(this,"lodMetricType");d(this,"lodMetricValue");d(this,"refine");d(this,"root",null);d(this,"roots",{});d(this,"asset",{});d(this,"description","");d(this,"properties");d(this,"extras",null);d(this,"attributions",{});d(this,"credits",{});d(this,"stats");d(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});d(this,"cartographicCenter",null);d(this,"cartesianCenter",null);d(this,"zoom",1);d(this,"boundingVolume",null);d(this,"dynamicScreenSpaceErrorComputedDensity",0);d(this,"maximumMemoryUsage",32);d(this,"gpuMemoryUsageInBytes",0);d(this,"memoryAdjustedScreenSpaceError",0);d(this,"_cacheBytes",0);d(this,"_cacheOverflowBytes",0);d(this,"_frameNumber",0);d(this,"_queryParams",{});d(this,"_extensionsUsed",[]);d(this,"_tiles",{});d(this,"_pendingCount",0);d(this,"selectedTiles",[]);d(this,"traverseCounter",0);d(this,"geometricError",0);d(this,"lastUpdatedVieports",null);d(this,"_requestedTiles",[]);d(this,"_emptyTiles",[]);d(this,"frameStateData",{});d(this,"_traverser");d(this,"_cache",new FV);d(this,"_requestScheduler");d(this,"updatePromise",null);d(this,"tilesetInitializationPromise");this.options={...hH,...n},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||wg(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new T3({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Xi({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let r=e;return this.queryParams.length&&(r=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),r}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(n=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),n(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const n=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;const r=[];for(const s of n){const i=s.id;this._needTraverse(i)?r.push(i):this.traverseCounter--}for(const s of n){const i=s.id;if(this.roots[i]||(this.roots[i]=this._initializeTileHeaders(this.tileset,null)),!r.includes(i))continue;const o=UV(s,this._frameNumber);this._traverser.traverse(this.roots[i],o,this.options)}}_needTraverse(e){let n=e;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[e]),n===e}_onTraversalEnd(e){const n=e.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[n],s=Object.values(this._traverser.selectedTiles),[i,o]=kV(s,e,this.options.maximumTilesSelected);r.selectedTiles=i;for(const a of o)a.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const n=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,n){if(e.length!==n.length)return!0;const r=new Set(e.map(o=>o.id)),s=new Set(n.map(o=>o.id));let i=e.filter(o=>!s.has(o.id)).length>0;return i=i||n.filter(o=>!r.has(o.id)).length>0,i}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,n)=>e._unloadTile(n))}_updateStats(){let e=0,n=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(e++,r.content.pointCount?n+=r.content.pointCount:n+=r.content.vertexCount);this.stats.get(n0).count=this.selectedTiles.length,this.stats.get(r0).count=e,this.stats.get(a0).count=n,this.stats.get(c0).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===ut.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===ut.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===ut.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var r;const e=this.tileset.fullExtent;if(e){const{xmin:s,xmax:i,ymin:o,ymax:a,zmin:c,zmax:l}=e;this.cartographicCenter=new M(s+(i-s)/2,o+(a-o)/2,c+(l-c)/2),this.cartesianCenter=new M,ge.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=P1(e,this.cartographicCenter,this.cartesianCenter);return}const n=(r=this.tileset.store)==null?void 0:r.extent;if(n){const[s,i,o,a]=n;this.cartographicCenter=new M(s+(o-s)/2,i+(a-i)/2,0),this.cartesianCenter=new M,ge.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=jV(n,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new M,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:n}=e.boundingVolume;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new M,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?(this.cartographicCenter=new M,ge.WGS84.cartesianToCartographic(n,this.cartographicCenter)):this.cartographicCenter=new M(0,0,-ge.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=zV(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(kc),this.stats.get(If),this.stats.get(bf),this.stats.get(n0),this.stats.get(r0),this.stats.get(s0),this.stats.get(i0),this.stats.get(o0),this.stats.get(a0),this.stats.get(Mf,"memory"),this.stats.get(c0)}_initializeTileHeaders(e,n){var s;const r=new Sp(this,e.root,n);if(n&&(n.children.push(r),r.depth=n.depth+1),this.type===ut.TILES3D){const i=[];for(i.push(r);i.length>0;){const o=i.pop();this.stats.get(kc).incrementCount();const a=o.header.children||[];for(const c of a){const l=new Sp(this,c,o);if((s=l.contentUrl)!=null&&s.includes("?session=")){const h=new URL(l.contentUrl).searchParams.get("session");h&&(this._queryParams.session=h)}o.children.push(l),l.depth=o.depth+1,i.push(l)}}}return r}_initializeTraverser(){let e;switch(this.type){case ut.TILES3D:e=aH;break;case ut.I3S:e=uH;break;default:e=Ku}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let n;try{this._onStartTileLoading(),n=await e.loadContent()}catch(r){this._onTileLoadError(e,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,n)}}_onTileLoadError(e,n){this.stats.get(o0).incrementCount();const r=n.message||n.toString(),s=e.url;console.error(`A 3D tile failed to load: ${e.url} ${r}`),this.options.onTileError(e,r,s)}_onTileLoad(e,n){var r,s;if(n){if(this.type===ut.I3S){const i=((s=(r=this.tileset)==null?void 0:r.nodePagesTile)==null?void 0:s.nodesInNodePages)||0;this.stats.get(kc).reset(),this.stats.get(kc).addCount(i)}e&&e.content&&DV(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var n;if(this.type===ut.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===ut.TILES3D){const{extensionsRemoved:r=[]}=((n=e.content)==null?void 0:n.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(If).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(If).decrementCount()}_addTileToCache(e){this._cache.add(this,e,n=>n._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(s0).incrementCount(),this.stats.get(bf).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(Mf).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(bf).decrementCount(),this.stats.get(i0).incrementCount(),this.stats.get(Mf).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const n=e.pop();for(const r of n.children)e.push(r);this._destroyTile(n)}this.root=null}_destroySubtree(e){const n=e,r=[];for(r.push(n);r.length>0;){e=r.pop();for(const s of e.children)r.push(s);e!==n&&this._destroyTile(e)}n.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const n=new URLSearchParams(e.queryString),r=Object.fromEntries(n.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const U1="4.2.4",Ao={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function k1(t,e,n){ae(t instanceof ArrayBuffer);const r=new TextDecoder("utf8"),s=new Uint8Array(t,e,n);return r.decode(s)}function dH(t,e=0){const n=new DataView(t);return`${String.fromCharCode(n.getUint8(e+0))}${String.fromCharCode(n.getUint8(e+1))}${String.fromCharCode(n.getUint8(e+2))}${String.fromCharCode(n.getUint8(e+3))}`}const pH={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Oe={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},te={...pH,...Oe},Bf={[Oe.DOUBLE]:Float64Array,[Oe.FLOAT]:Float32Array,[Oe.UNSIGNED_SHORT]:Uint16Array,[Oe.UNSIGNED_INT]:Uint32Array,[Oe.UNSIGNED_BYTE]:Uint8Array,[Oe.BYTE]:Int8Array,[Oe.SHORT]:Int16Array,[Oe.INT]:Int32Array},gH={DOUBLE:Oe.DOUBLE,FLOAT:Oe.FLOAT,UNSIGNED_SHORT:Oe.UNSIGNED_SHORT,UNSIGNED_INT:Oe.UNSIGNED_INT,UNSIGNED_BYTE:Oe.UNSIGNED_BYTE,BYTE:Oe.BYTE,SHORT:Oe.SHORT,INT:Oe.INT},Pf="Failed to convert GL type";class Mn{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const n in Bf)if(Bf[n]===e)return n;throw new Error(Pf)}static fromName(e){const n=gH[e];if(!n)throw new Error(Pf);return n}static getArrayType(e){switch(e){case Oe.UNSIGNED_SHORT_5_6_5:case Oe.UNSIGNED_SHORT_4_4_4_4:case Oe.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const n=Bf[e];if(!n)throw new Error(Pf);return n}}static getByteSize(e){return Mn.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Mn.getArrayType(e)}static createTypedArray(e,n,r=0,s){s===void 0&&(s=(n.byteLength-r)/Mn.getByteSize(e));const i=Mn.getArrayType(e);return new i(n,r,s)}}function _H(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}function mH(t,e=[0,0,0]){const n=t>>11&31,r=t>>5&63,s=t&31;return e[0]=n<<3,e[1]=r<<2,e[2]=s<<3,e}new Lg;new M;new Lg;new Lg;function l0(t,e=255){return Gn(t,0,e)/e*2-1}function u0(t){return t<0?-1:1}function AH(t,e,n,r){if(_H(r),t<0||t>n||e<0||e>n)throw new Error(`x and y must be unsigned normalized integers between 0 and ${n}`);if(r.x=l0(t,n),r.y=l0(e,n),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const s=r.x;r.x=(1-Math.abs(r.y))*u0(s),r.y=(1-Math.abs(s))*u0(r.y)}return r.normalize()}function yH(t,e,n){return AH(t,e,255,n)}class T_{constructor(e,n){d(this,"json");d(this,"buffer");d(this,"featuresLength",0);d(this,"_cachedTypedArrays",{});this.json=e,this.buffer=n}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,n=te.UNSIGNED_INT,r=1){const s=this.json[e];return s&&Number.isFinite(s.byteOffset)?this._getTypedArrayFromBinary(e,n,r,1,s.byteOffset):s}getPropertyArray(e,n,r){const s=this.json[e];return s&&Number.isFinite(s.byteOffset)?("componentType"in s&&(n=Mn.fromName(s.componentType)),this._getTypedArrayFromBinary(e,n,r,this.featuresLength,s.byteOffset)):this._getTypedArrayFromArray(e,n,s)}getProperty(e,n,r,s,i){const o=this.json[e];if(!o)return o;const a=this.getPropertyArray(e,n,r);if(r===1)return a[s];for(let c=0;c<r;++c)i[c]=a[r*s+c];return i}_getTypedArrayFromBinary(e,n,r,s,i){const o=this._cachedTypedArrays;let a=o[e];return a||(a=Mn.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+i,s*r),o[e]=a),a}_getTypedArrayFromArray(e,n,r){const s=this._cachedTypedArrays;let i=s[e];return i||(i=Mn.createTypedArray(n,r),s[e]=i),i}}const TH={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},EH={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},SH={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}};function CH(t,e,n,r){const{componentType:s}=t;ae(t.componentType);const i=typeof s=="string"?Mn.fromName(s):s,o=TH[t.type],a=EH[t.type],c=SH[t.type];return n+=t.byteOffset,{values:Mn.createTypedArray(i,e,n,o*r),type:i,size:o,unpacker:a,packer:c}}const Rn=t=>t!==void 0;function vH(t,e,n){if(!e)return null;let r=t.getExtension("3DTILES_batch_table_hierarchy");const s=e.HIERARCHY;return s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=s,r=s),r?wH(r,n):null}function wH(t,e){let n,r,s;const i=t.instancesLength,o=t.classes;let a=t.classIds,c=t.parentCounts,l=t.parentIds,u=i;Rn(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,s=getBinaryAccessor(a),a=s.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,i));let h;if(Rn(c))for(Rn(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,s=getBinaryAccessor(c),c=s.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,i)),h=new Uint16Array(i),u=0,n=0;n<i;++n)h[n]=u,u+=c[n];Rn(l)&&Rn(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,s=getBinaryAccessor(l),l=s.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,u));const f=o.length;for(n=0;n<f;++n){const w=o[n].length,_=o[n].instances,g=getBinaryProperties(w,_,e);o[n].instances=combine(g,_)}const p=new Array(f).fill(0),m=new Uint16Array(i);for(n=0;n<i;++n)r=a[n],m[n]=p[r],++p[r];const y={classes:o,classIds:a,classIndexes:m,parentCounts:c,parentIndexes:h,parentIds:l};return IH(y),y}function yo(t,e,n){if(!t)return;const r=t.parentCounts;return t.parentIds?n(t,e):r>0?RH(t,e,n):bH(t,e,n)}function RH(t,e,n){const r=t.classIds,s=t.parentCounts,i=t.parentIds,o=t.parentIndexes,a=r.length,c=scratchVisited;c.length=Math.max(c.length,a);const l=++marker,u=scratchStack;for(u.length=0,u.push(e);u.length>0;){if(e=u.pop(),c[e]===l)continue;c[e]=l;const h=n(t,e);if(Rn(h))return h;const f=s[e],p=o[e];for(let m=0;m<f;++m){const y=i[p+m];y!==e&&u.push(y)}}return null}function bH(t,e,n){let r=!0;for(;r;){const s=n(t,e);if(Rn(s))return s;const i=t.parentIds[e];r=i!==e,e=i}throw new Error("traverseHierarchySingleParent")}function IH(t){const n=t.classIds.length;for(let r=0;r<n;++r)L1(t,r,stack)}function L1(t,e,n){const r=t.parentCounts,s=t.parentIds,i=t.parentIndexes,a=t.classIds.length;if(!Rn(s))return;assert(e<a,`Parent index ${e} exceeds the total number of instances: ${a}`),assert(n.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),n.push(e);const c=Rn(r)?r[e]:1,l=Rn(r)?i[e]:e;for(let u=0;u<c;++u){const h=s[l+u];h!==e&&L1(t,h,n)}n.pop(e)}function lt(t){return t!=null}const Lc=(t,e)=>t,MH={HIERARCHY:!0,extensions:!0,extras:!0};class V1{constructor(e,n,r,s={}){d(this,"json");d(this,"binary");d(this,"featureCount");d(this,"_extensions");d(this,"_properties");d(this,"_binaryProperties");d(this,"_hierarchy");var i;ae(r>=0),this.json=e||{},this.binary=n,this.featureCount=r,this._extensions=((i=this.json)==null?void 0:i.extensions)||{},this._properties={};for(const o in this.json)MH[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=vH(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,n){if(this._checkBatchId(e),ae(typeof n=="string",n),this._hierarchy){const r=yo(this._hierarchy,e,(s,i)=>{const o=s.classIds[i];return s.classes[o].name===n});return lt(r)}return!1}isExactClass(e,n){return ae(typeof n=="string",n),this.getExactClassName(e)===n}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const n=this._hierarchy.classIds[e];return this._hierarchy.classes[n].name}}hasProperty(e,n){return this._checkBatchId(e),ae(typeof n=="string",n),lt(this._properties[n])||this._hasPropertyInHierarchy(e,n)}getPropertyNames(e,n){this._checkBatchId(e),n=lt(n)?n:[],n.length=0;const r=Object.keys(this._properties);return n.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,n),n}getProperty(e,n){if(this._checkBatchId(e),ae(typeof n=="string",n),this._binaryProperties){const s=this._binaryProperties[n];if(lt(s))return this._getBinaryProperty(s,e)}const r=this._properties[n];if(lt(r))return Lc(r[e]);if(this._hierarchy){const s=this._getHierarchyProperty(e,n);if(lt(s))return s}}setProperty(e,n,r){const s=this.featureCount;if(this._checkBatchId(e),ae(typeof n=="string",n),this._binaryProperties){const o=this._binaryProperties[n];if(o){this._setBinaryProperty(o,e,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,n,r))return;let i=this._properties[n];lt(i)||(this._properties[n]=new Array(s),i=this._properties[n]),i[e]=Lc(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,n){return e.unpack(e.typedArray,n)}_setBinaryProperty(e,n,r){e.pack(r,e.typedArray,n)}_initializeBinaryProperties(){let e=null;for(const n in this._properties){const r=this._properties[n],s=this._initializeBinaryProperty(n,r);s&&(e=e||{},e[n]=s)}return e}_initializeBinaryProperty(e,n){if("byteOffset"in n){const r=n;ae(this.binary,`Property ${e} requires a batch table binary.`),ae(r.type,`Property ${e} requires a type.`);const s=CH(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:s.values,componentCount:s.size,unpack:s.unpacker,pack:s.packer}}return null}_hasPropertyInHierarchy(e,n){if(!this._hierarchy)return!1;const r=yo(this._hierarchy,e,(s,i)=>{const o=s.classIds[i],a=s.classes[o].instances;return lt(a[n])});return lt(r)}_getPropertyNamesInHierarchy(e,n){yo(this._hierarchy,e,(r,s)=>{const i=r.classIds[s],o=r.classes[i].instances;for(const a in o)o.hasOwnProperty(a)&&n.indexOf(a)===-1&&n.push(a)})}_getHierarchyProperty(e,n){return yo(this._hierarchy,e,(r,s)=>{const i=r.classIds[s],o=r.classes[i],a=r.classIndexes[s],c=o.instances[n];return lt(c)?lt(c.typedArray)?this._getBinaryProperty(c,a):Lc(c[a]):null})}_setHierarchyProperty(e,n,r,s){const i=yo(this._hierarchy,n,(o,a)=>{const c=o.classIds[a],l=o.classes[c],u=o.classIndexes[a],h=l.instances[r];return lt(h)?(ae(a===n,`Inherited property "${r}" is read-only.`),lt(h.typedArray)?this._setBinaryProperty(h,u,s):h[u]=Lc(s),!0):!1});return lt(i)}}const Of=4;function Yu(t,e,n=0){const r=new DataView(e);if(t.magic=r.getUint32(n,!0),n+=Of,t.version=r.getUint32(n,!0),n+=Of,t.byteLength=r.getUint32(n,!0),n+=Of,t.version!==1)throw new Error(`3D Tile Version ${t.version} not supported`);return n}const zs=4,h0="b3dm tile in legacy format.";function E_(t,e,n){const r=new DataView(e);let s;t.header=t.header||{};let i=r.getUint32(n,!0);n+=zs;let o=r.getUint32(n,!0);n+=zs;let a=r.getUint32(n,!0);n+=zs;let c=r.getUint32(n,!0);return n+=zs,a>=570425344?(n-=zs*2,s=i,a=o,c=0,i=0,o=0,console.warn(h0)):c>=570425344&&(n-=zs,s=a,a=i,c=o,i=0,o=0,console.warn(h0)),t.header.featureTableJsonByteLength=i,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=c,t.header.batchLength=s,n}function S_(t,e,n,r){return n=BH(t,e,n),n=PH(t,e,n),n}function BH(t,e,n,r){const{featureTableJsonByteLength:s,featureTableBinaryByteLength:i,batchLength:o}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:o||0},s&&s>0){const a=k1(e,n,s);t.featureTableJson=JSON.parse(a)}return n+=s||0,t.featureTableBinary=new Uint8Array(e,n,i),n+=i||0,n}function PH(t,e,n,r){const{batchTableJsonByteLength:s,batchTableBinaryByteLength:i}=t.header||{};if(s&&s>0){const o=k1(e,n,s);t.batchTableJson=JSON.parse(o),n+=s,i&&i>0&&(t.batchTableBinary=new Uint8Array(e,n,i),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=i)}return n}function H1(t,e,n){if(!e&&(!t||!t.batchIds||!n))return null;const{batchIds:r,isRGB565:s,pointCount:i=0}=t;if(r&&n){const o=new Uint8ClampedArray(i*3);for(let a=0;a<i;a++){const c=r[a],u=n.getProperty(c,"dimensions").map(h=>h*255);o[a*3]=u[0],o[a*3+1]=u[1],o[a*3+2]=u[2]}return{type:te.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(e&&s){const o=new Uint8ClampedArray(i*3);for(let a=0;a<i;a++){const c=mH(e[a]);o[a*3]=c[0],o[a*3+1]=c[1],o[a*3+2]=c[2]}return{type:te.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return e&&e.length===i*3?{type:te.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:te.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const f0=new M;function OH(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array((t.pointsLength||0)*3);for(let r=0;r<(t.pointsLength||0);r++)yH(e[r*2],e[r*2+1],f0),f0.toArray(n,r*3);return{type:te.FLOAT,size:2,value:n}}return{type:te.FLOAT,size:2,value:e}}function xH(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,NH(t,e)):{type:te.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function NH(t,e){const n=new M,r=new Float32Array(t.pointCount*3);for(let s=0;s<t.pointCount;s++)n.set(e[s*3],e[s*3+1],e[s*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(r,s*3);return r}async function FH(t,e,n,r,s){n=Yu(t,e,n),n=E_(t,e,n),n=S_(t,e,n),DH(t);const{featureTable:i,batchTable:o}=UH(t);return await zH(t,i,o,r,s),kH(t,i,r),LH(t,i,o),VH(t,i),n}function DH(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function UH(t){const e=new T_(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",te.FLOAT,3);const r=HH(t,e);return{featureTable:e,batchTable:r}}function kH(t,e,n){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",te.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const r=e.getPropertyArray("POSITION_QUANTIZED",te.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65536-1,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",te.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",te.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=xH(t,r,n)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function LH(t,e,n){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let r=null;e.hasProperty("RGBA")?(r=e.getPropertyArray("RGBA",te.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?r=e.getPropertyArray("RGB",te.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(r=e.getPropertyArray("RGB565",te.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=H1(t,r,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",te.UNSIGNED_BYTE,4))}function VH(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",te.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",te.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=OH(t,n)}}function HH(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",te.UNSIGNED_SHORT,1),t.batchIds)){const r=e.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:s,batchTableBinary:i}=t;n=new V1(s,i,r)}return n}async function zH(t,e,n,r,s){let i,o,a;const c=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);const l=e.getExtension("3DTILES_draco_point_compression");if(l){o=l.properties;const h=l.byteOffset,f=l.byteLength;if(!o||!Number.isFinite(h)||!f)throw new Error("Draco properties, byteOffset, and byteLength must be defined");i=(t.featureTableBinary||[]).slice(h,h+f),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!i)return!0;const u={buffer:i,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await jH(t,u,r,s)}async function jH(t,e,n,r){if(!r)return;const s={...n,draco:{...n==null?void 0:n.draco,extraAttributes:e.batchTableProperties||{}}};delete s["3d-tiles"];const i=await Ma(e.buffer,w1,s,r),o=i.attributes.POSITION&&i.attributes.POSITION.value,a=i.attributes.COLOR_0&&i.attributes.COLOR_0.value,c=i.attributes.NORMAL&&i.attributes.NORMAL.value,l=i.attributes.BATCH_ID&&i.attributes.BATCH_ID.value,u=o&&i.attributes.POSITION.value.quantization,h=c&&i.attributes.NORMAL.value.quantization;if(u){const p=i.POSITION.data.quantization,m=p.range;t.quantizedVolumeScale=new M(m,m,m),t.quantizedVolumeOffset=new M(p.minValues),t.quantizedRange=(1<<p.quantizationBits)-1,t.isQuantizedDraco=!0}h&&(t.octEncodedRange=(1<<i.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const f={};if(e.batchTableProperties)for(const p of Object.keys(e.batchTableProperties))i.attributes[p]&&i.attributes[p].value&&(f[p.toLowerCase()]=i.attributes[p].value);t.attributes={positions:o,colors:H1(t,a,void 0),normals:c,batchIds:l,...f}}const Cp={URI:0,EMBEDDED:1};function z1(t,e,n,r){t.rotateYtoZ=!0;const s=(t.byteOffset||0)+(t.byteLength||0)-n;if(s===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=r!=null&&r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=vg(e,n,s),t.gltfByteOffset=0,t.gltfByteLength=s,n%4===0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function j1(t,e,n,r){const s=(n==null?void 0:n["3d-tiles"])||{};if(WH(t,e),s.loadGLTF){if(!r)return;if(t.gltfUrl){const{fetch:i}=r,o=await i(t.gltfUrl,n);t.gltfArrayBuffer=await o.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){const i=await Ma(t.gltfArrayBuffer,Sa,n,r);t.gltf=m_(i),t.gpuMemoryUsageInBytes=p1(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}function WH(t,e,n){switch(e){case Cp.URI:if(t.gltfArrayBuffer){const r=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),i=new TextDecoder().decode(r);t.gltfUrl=i.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case Cp.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function XH(t,e,n,r,s){var o;n=GH(t,e,n,r),await j1(t,Cp.EMBEDDED,r,s);const i=(o=t==null?void 0:t.gltf)==null?void 0:o.extensions;return i&&i.CESIUM_RTC&&(t.rtcCenter=i.CESIUM_RTC.center),n}function GH(t,e,n,r,s){n=Yu(t,e,n),n=E_(t,e,n),n=S_(t,e,n),n=z1(t,e,n,r);const i=new T_(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=i.getGlobalProperty("RTC_CENTER",te.FLOAT,3),n}async function $H(t,e,n,r,s){return n=KH(t,e,n,r),await j1(t,t.gltfFormat||0,r,s),n}function KH(t,e,n,r,s){var l;if(n=Yu(t,e,n),t.version!==1)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);n=E_(t,e,n);const i=new DataView(e);if(t.gltfFormat=i.getUint32(n,!0),n+=4,n=S_(t,e,n),n=z1(t,e,n,r),!((l=t==null?void 0:t.header)!=null&&l.featureTableJsonByteLength)||t.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new T_(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",te.FLOAT,3);const c=new V1(t.batchTableJson,t.batchTableBinary,a);return YH(t,o,c,a),n}function YH(t,e,n,r){const s=new Array(r),i=new M;new M,new M,new M;const o=new be,a=new _a,c=new M,l={},u=new Q,h=[],f=[],p=[],m=[];for(let y=0;y<r;y++){let w;if(e.hasProperty("POSITION"))w=e.getProperty("POSITION",te.FLOAT,3,y,i);else if(e.hasProperty("POSITION_QUANTIZED")){w=e.getProperty("POSITION_QUANTIZED",te.UNSIGNED_SHORT,3,y,i);const P=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",te.FLOAT,3);if(!P)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const x=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",te.FLOAT,3);if(!x)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const N=65535;for(let D=0;D<3;D++)w[D]=w[D]/N*x[D]+P[D]}if(!w)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(i.copy(w),l.translation=i,t.normalUp=e.getProperty("NORMAL_UP",te.FLOAT,3,y,h),t.normalRight=e.getProperty("NORMAL_RIGHT",te.FLOAT,3,y,f),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",te.UNSIGNED_SHORT,2,y,h),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",te.UNSIGNED_SHORT,2,y,f),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(ge.WGS84.eastNorthUpToFixedFrame(i,u),u.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),l.rotation=a,c.set(1,1,1);const _=e.getProperty("SCALE",te.FLOAT,1,y,p);Number.isFinite(_)&&c.multiplyByScalar(_);const g=e.getProperty("SCALE_NON_UNIFORM",te.FLOAT,3,y,h);g&&c.scale(g),l.scale=c;let T=e.getProperty("BATCH_ID",te.UNSIGNED_SHORT,1,y,m);T===void 0&&(T=y);const C=new Q().fromQuaternion(l.rotation);u.identity(),u.translate(l.translation),u.multiplyRight(C),u.scale(l.scale);const I=u.clone();s[y]={modelMatrix:I,batchId:T}}t.instances=s}async function JH(t,e,n,r,s,i){n=Yu(t,e,n);const o=new DataView(e);for(t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-n>12;){const a={shape:"tile3d"};t.tiles.push(a),n=await i(e,n,r,s,a)}return n}async function qH(t,e,n,r){var s,i;if(t.rotateYtoZ=!0,t.gltfUpAxis=(s=n==null?void 0:n["3d-tiles"])!=null&&s.assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",(i=n==null?void 0:n["3d-tiles"])!=null&&i.loadGLTF){if(!r)return e.byteLength;const o=await Ma(e,Sa,n,r);t.gltf=m_(o),t.gpuMemoryUsageInBytes=p1(t.gltf)}else t.gltfArrayBuffer=e;return e.byteLength}async function W1(t,e=0,n,r,s={shape:"tile3d"}){switch(s.byteOffset=e,s.type=dH(t,e),s.type){case Ao.COMPOSITE:return await JH(s,t,e,n,r,W1);case Ao.BATCHED_3D_MODEL:return await XH(s,t,e,n,r);case Ao.GLTF:return await qH(s,t,n,r);case Ao.INSTANCED_3D_MODEL:return await $H(s,t,e,n,r);case Ao.POINT_CLOUD:return await FH(s,t,e,n,r);default:throw new Error(`3DTileLoader: unknown type ${s.type}`)}}const QH=1952609651,ZH=1;async function e5(t,e,n){if(new Uint32Array(t.slice(0,4))[0]!==QH)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==ZH)throw new Error("Wrong subtree file verson, must be 1");const i=d0(t.slice(8,16)),o=new Uint8Array(t,24,i),c=new TextDecoder("utf8").decode(o),l=JSON.parse(c),u=d0(t.slice(16,24));let h=new ArrayBuffer(0);if(u&&(h=t.slice(24+i)),await Vc(l,l.tileAvailability,h,n),Array.isArray(l.contentAvailability))for(const f of l.contentAvailability)await Vc(l,f,h,n);else await Vc(l,l.contentAvailability,h,n);return await Vc(l,l.childSubtreeAvailability,h,n),l}async function Vc(t,e,n,r){const s=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof s!="number")return;const i=t.bufferViews[s],o=t.buffers[i.buffer];if(!(r!=null&&r.baseUrl))throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(o.uri){const c=`${(r==null?void 0:r.baseUrl)||""}/${o.uri}`,u=await(await r.fetch(c)).arrayBuffer();e.explicitBitstream=new Uint8Array(u,i.byteOffset,i.byteLength);return}const a=t.buffers.slice(0,i.buffer).reduce((c,l)=>c+l.byteLength,0);e.explicitBitstream=new Uint8Array(n.slice(a,a+o.byteLength),i.byteOffset,i.byteLength)}function d0(t){const e=new DataView(t),n=e.getUint32(0,!0),r=e.getUint32(4,!0);return n+2**32*r}const X1={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:U1,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:e5,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var kt=null;try{kt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ue(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}ue.prototype.__isLong__;Object.defineProperty(ue.prototype,"__isLong__",{value:!0});function nt(t){return(t&&t.__isLong__)===!0}function p0(t){var e=Math.clz32(t&-t);return t?31-e:e}ue.isLong=nt;var g0={},_0={};function Bs(t,e){var n,r,s;return e?(t>>>=0,(s=0<=t&&t<256)&&(r=_0[t],r)?r:(n=re(t,0,!0),s&&(_0[t]=n),n)):(t|=0,(s=-128<=t&&t<128)&&(r=g0[t],r)?r:(n=re(t,t<0?-1:0,!1),s&&(g0[t]=n),n))}ue.fromInt=Bs;function Lt(t,e){if(isNaN(t))return e?Kn:nn;if(e){if(t<0)return Kn;if(t>=G1)return Y1}else{if(t<=-A0)return pt;if(t+1>=A0)return K1}return t<0?Lt(-t,e).neg():re(t%Vi|0,t/Vi|0,e)}ue.fromNumber=Lt;function re(t,e,n){return new ue(t,e,n)}ue.fromBits=re;var nu=Math.pow;function C_(t,e,n){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(n=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?Kn:nn;if(n=n||10,n<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return C_(t.substring(1),e,n).neg();for(var s=Lt(nu(n,8)),i=nn,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),c=parseInt(t.substring(o,o+a),n);if(a<8){var l=Lt(nu(n,a));i=i.mul(l).add(Lt(c))}else i=i.mul(s),i=i.add(Lt(c))}return i.unsigned=e,i}ue.fromString=C_;function hn(t,e){return typeof t=="number"?Lt(t,e):typeof t=="string"?C_(t,e):re(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}ue.fromValue=hn;var m0=65536,t5=1<<24,Vi=m0*m0,G1=Vi*Vi,A0=G1/2,y0=Bs(t5),nn=Bs(0);ue.ZERO=nn;var Kn=Bs(0,!0);ue.UZERO=Kn;var ui=Bs(1);ue.ONE=ui;var $1=Bs(1,!0);ue.UONE=$1;var vp=Bs(-1);ue.NEG_ONE=vp;var K1=re(-1,2147483647,!1);ue.MAX_VALUE=K1;var Y1=re(-1,-1,!0);ue.MAX_UNSIGNED_VALUE=Y1;var pt=re(0,-2147483648,!1);ue.MIN_VALUE=pt;var V=ue.prototype;V.toInt=function(){return this.unsigned?this.low>>>0:this.low};V.toNumber=function(){return this.unsigned?(this.high>>>0)*Vi+(this.low>>>0):this.high*Vi+(this.low>>>0)};V.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(pt)){var n=Lt(e),r=this.div(n),s=r.mul(n).sub(this);return r.toString(e)+s.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Lt(nu(e,6),this.unsigned),o=this,a="";;){var c=o.div(i),l=o.sub(c.mul(i)).toInt()>>>0,u=l.toString(e);if(o=c,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};V.getHighBits=function(){return this.high};V.getHighBitsUnsigned=function(){return this.high>>>0};V.getLowBits=function(){return this.low};V.getLowBitsUnsigned=function(){return this.low>>>0};V.getNumBitsAbs=function(){if(this.isNegative())return this.eq(pt)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};V.isZero=function(){return this.high===0&&this.low===0};V.eqz=V.isZero;V.isNegative=function(){return!this.unsigned&&this.high<0};V.isPositive=function(){return this.unsigned||this.high>=0};V.isOdd=function(){return(this.low&1)===1};V.isEven=function(){return(this.low&1)===0};V.equals=function(e){return nt(e)||(e=hn(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};V.eq=V.equals;V.notEquals=function(e){return!this.eq(e)};V.neq=V.notEquals;V.ne=V.notEquals;V.lessThan=function(e){return this.comp(e)<0};V.lt=V.lessThan;V.lessThanOrEqual=function(e){return this.comp(e)<=0};V.lte=V.lessThanOrEqual;V.le=V.lessThanOrEqual;V.greaterThan=function(e){return this.comp(e)>0};V.gt=V.greaterThan;V.greaterThanOrEqual=function(e){return this.comp(e)>=0};V.gte=V.greaterThanOrEqual;V.ge=V.greaterThanOrEqual;V.compare=function(e){if(nt(e)||(e=hn(e)),this.eq(e))return 0;var n=this.isNegative(),r=e.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};V.comp=V.compare;V.negate=function(){return!this.unsigned&&this.eq(pt)?pt:this.not().add(ui)};V.neg=V.negate;V.add=function(e){nt(e)||(e=hn(e));var n=this.high>>>16,r=this.high&65535,s=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,c=e.low>>>16,l=e.low&65535,u=0,h=0,f=0,p=0;return p+=i+l,f+=p>>>16,p&=65535,f+=s+c,h+=f>>>16,f&=65535,h+=r+a,u+=h>>>16,h&=65535,u+=n+o,u&=65535,re(f<<16|p,u<<16|h,this.unsigned)};V.subtract=function(e){return nt(e)||(e=hn(e)),this.add(e.neg())};V.sub=V.subtract;V.multiply=function(e){if(this.isZero())return this;if(nt(e)||(e=hn(e)),kt){var n=kt.mul(this.low,this.high,e.low,e.high);return re(n,kt.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Kn:nn;if(this.eq(pt))return e.isOdd()?pt:nn;if(e.eq(pt))return this.isOdd()?pt:nn;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(y0)&&e.lt(y0))return Lt(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,s=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,c=e.high&65535,l=e.low>>>16,u=e.low&65535,h=0,f=0,p=0,m=0;return m+=o*u,p+=m>>>16,m&=65535,p+=i*u,f+=p>>>16,p&=65535,p+=o*l,f+=p>>>16,p&=65535,f+=s*u,h+=f>>>16,f&=65535,f+=i*l,h+=f>>>16,f&=65535,f+=o*c,h+=f>>>16,f&=65535,h+=r*u+s*l+i*c+o*a,h&=65535,re(p<<16|m,h<<16|f,this.unsigned)};V.mul=V.multiply;V.divide=function(e){if(nt(e)||(e=hn(e)),e.isZero())throw Error("division by zero");if(kt){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?kt.div_u:kt.div_s)(this.low,this.high,e.low,e.high);return re(n,kt.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Kn:nn;var r,s,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Kn;if(e.gt(this.shru(1)))return $1;i=Kn}else{if(this.eq(pt)){if(e.eq(ui)||e.eq(vp))return pt;if(e.eq(pt))return ui;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(nn)?e.isNegative()?ui:vp:(s=this.sub(e.mul(r)),i=r.add(s.div(e)),i)}else if(e.eq(pt))return this.unsigned?Kn:nn;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=nn}for(s=this;s.gte(e);){r=Math.max(1,Math.floor(s.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),c=a<=48?1:nu(2,a-48),l=Lt(r),u=l.mul(e);u.isNegative()||u.gt(s);)r-=c,l=Lt(r,this.unsigned),u=l.mul(e);l.isZero()&&(l=ui),i=i.add(l),s=s.sub(u)}return i};V.div=V.divide;V.modulo=function(e){if(nt(e)||(e=hn(e)),kt){var n=(this.unsigned?kt.rem_u:kt.rem_s)(this.low,this.high,e.low,e.high);return re(n,kt.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};V.mod=V.modulo;V.rem=V.modulo;V.not=function(){return re(~this.low,~this.high,this.unsigned)};V.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};V.clz=V.countLeadingZeros;V.countTrailingZeros=function(){return this.low?p0(this.low):p0(this.high)+32};V.ctz=V.countTrailingZeros;V.and=function(e){return nt(e)||(e=hn(e)),re(this.low&e.low,this.high&e.high,this.unsigned)};V.or=function(e){return nt(e)||(e=hn(e)),re(this.low|e.low,this.high|e.high,this.unsigned)};V.xor=function(e){return nt(e)||(e=hn(e)),re(this.low^e.low,this.high^e.high,this.unsigned)};V.shiftLeft=function(e){return nt(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?re(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):re(0,this.low<<e-32,this.unsigned)};V.shl=V.shiftLeft;V.shiftRight=function(e){return nt(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?re(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):re(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};V.shr=V.shiftRight;V.shiftRightUnsigned=function(e){return nt(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?re(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?re(this.high,0,this.unsigned):re(this.high>>>e-32,0,this.unsigned)};V.shru=V.shiftRightUnsigned;V.shr_u=V.shiftRightUnsigned;V.rotateLeft=function(e){var n;return nt(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?re(this.high,this.low,this.unsigned):e<32?(n=32-e,re(this.low<<e|this.high>>>n,this.high<<e|this.low>>>n,this.unsigned)):(e-=32,n=32-e,re(this.high<<e|this.low>>>n,this.low<<e|this.high>>>n,this.unsigned))};V.rotl=V.rotateLeft;V.rotateRight=function(e){var n;return nt(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?re(this.high,this.low,this.unsigned):e<32?(n=32-e,re(this.high<<n|this.low>>>e,this.low<<n|this.high>>>e,this.unsigned)):(e-=32,n=32-e,re(this.low<<n|this.high>>>e,this.high<<n|this.low>>>e,this.unsigned))};V.rotr=V.rotateRight;V.toSigned=function(){return this.unsigned?re(this.low,this.high,!1):this};V.toUnsigned=function(){return this.unsigned?this:re(this.low,this.high,!0)};V.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};V.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};V.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};ue.fromBytes=function(e,n,r){return r?ue.fromBytesLE(e,n):ue.fromBytesBE(e,n)};ue.fromBytesLE=function(e,n){return new ue(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};ue.fromBytesBE=function(e,n){return new ue(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const n5=16;function J1(t){t==="X"&&(t="");const e=t.padEnd(n5,"0");return ue.fromString(e,!0,16)}function r5(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const n=e%4;e=(e-n)/4;const r=e;e*=4;const i=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-r-i.length).join("0")+i}function s5(t,e){const n=i5(t).shiftRightUnsigned(2);return t.add(ue.fromNumber(2*e+1-4).multiply(n))}function i5(t){return t.and(t.not().add(1))}const o5=3,a5=30,c5=2*a5+1,T0=180/Math.PI;function l5(t){if(t.length===0)throw new Error(`Invalid Hilbert quad key ${t}`);const e=t.split("/"),n=parseInt(e[0],10),r=e[1],s=r.length;let i=0;const o=[0,0];for(let a=s-1;a>=0;a--){i=s-a;const c=r[a];let l=0,u=0;c==="1"?u=1:c==="2"?(l=1,u=1):c==="3"&&(l=1);const h=Math.pow(2,i-1);h5(h,o,l,u),o[0]+=h*l,o[1]+=h*u}if(n%2===1){const a=o[0];o[0]=o[1],o[1]=a}return{face:n,ij:o,level:i}}function u5(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<o5+c5;)e="0"+e;const n=e.lastIndexOf("1"),r=e.substring(0,3),s=e.substring(3,n),i=s.length/2,o=ue.fromString(r,!0,2).toString(10);let a="";if(i!==0)for(a=ue.fromString(s,!0,2).toString(4);a.length<i;)a="0"+a;return`${o}/${a}`}function q1(t,e,n){const r=1<<e;return[(t[0]+n[0])/r,(t[1]+n[1])/r]}function E0(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function Q1(t){return[E0(t[0]),E0(t[1])]}function Z1(t,[e,n]){switch(t){case 0:return[1,e,n];case 1:return[-e,1,n];case 2:return[-e,-n,1];case 3:return[-1,-n,-e];case 4:return[n,-1,-e];case 5:return[n,e,-1];default:throw new Error("Invalid face")}}function ew([t,e,n]){const r=Math.atan2(n,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*T0,r*T0]}function h5(t,e,n,r){if(r===0){n===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}function f5(t){const e=q1(t.ij,t.level,[.5,.5]),n=Q1(e),r=Z1(t.face,n);return ew(r)}const d5=100;function S0(t){const{face:e,ij:n,level:r}=t,s=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(d5*Math.pow(2,-r))),o=new Float64Array(4*i*2+2);let a=0,c=0;for(let l=0;l<4;l++){const u=s[l].slice(0),h=s[l+1],f=(h[0]-u[0])/i,p=(h[1]-u[1])/i;for(let m=0;m<i;m++){u[0]+=f,u[1]+=p;const y=q1(n,r,u),w=Q1(y),_=Z1(e,w),g=ew(_);Math.abs(g[1])>89.999&&(g[0]=c);const T=g[0]-c;g[0]+=T>180?-360:T<-180?360:0,o[a++]=g[0],o[a++]=g[1],c=g[0]}}return o[a++]=o[0],o[a++]=o[1],o}function v_(t){const e=p5(t);return l5(e)}function p5(t){if(t.indexOf("/")>0)return t;const e=J1(t);return u5(e)}function g5(t){const e=v_(t);return f5(e)}function _5(t){let e;if(t.face===2||t.face===5){let n=null,r=0;for(let s=0;s<4;s++){const i=`${t.face}/${s}`,o=v_(i),a=S0(o);(typeof n>"u"||n===null)&&(n=new Float64Array(4*a.length)),n.set(a,r),r+=a.length}e=C0(n)}else{const n=S0(t);e=C0(n)}return e}function C0(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],n=[];for(let r=0;r<t.length;r+=2)e.push(t[r]),n.push(t[r+1]);return e.sort((r,s)=>r-s),n.sort((r,s)=>r-s),{west:e[0],east:e[e.length-1],north:n[n.length-1],south:n[0]}}function m5(t,e){const n=(e==null?void 0:e.minimumHeight)||0,r=(e==null?void 0:e.maximumHeight)||0,s=v_(t),i=_5(s),o=i.west,a=i.south,c=i.east,l=i.north,u=[];return u.push(new M(o,l,n)),u.push(new M(c,l,n)),u.push(new M(c,a,n)),u.push(new M(o,a,n)),u.push(new M(o,l,r)),u.push(new M(c,l,r)),u.push(new M(c,a,r)),u.push(new M(o,a,r)),u}function tw(t){const e=t.token,n={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},r=m5(e,n),s=g5(e),i=s[0],o=s[1],a=ge.WGS84.cartographicToCartesian([i,o,n.maximumHeight]),c=new M(a[0],a[1],a[2]);r.push(c);const l=C4(r);return[...l.center,...l.halfAxes]}const A5=4,y5=8,T5={QUADTREE:A5,OCTREE:y5};function E5(t,e,n){if(t!=null&&t.box){const r=J1(t.s2VolumeInfo.token),s=s5(r,e),i=r5(s),o={...t.s2VolumeInfo};switch(o.token=i,n){case"OCTREE":const l=t.s2VolumeInfo,u=l.maximumHeight-l.minimumHeight,h=u/2,f=l.minimumHeight+u/2;l.minimumHeight=f-h,l.maximumHeight=f+h;break}return{box:tw(o),s2VolumeInfo:o}}}async function nw(t){const{implicitOptions:e,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,s2VolumeBox:s,loaderOptions:i}=t;let{subtree:o,level:a=0,globalData:c={level:0,mortonIndex:0,x:0,y:0,z:0}}=t;const{subdivisionScheme:l,subtreeLevels:u,maximumLevel:h,contentUrlTemplate:f,subtreesUriTemplate:p,basePath:m}=e,y={children:[],lodMetricValue:0,contentUrl:""};if(!h)return WS.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${f} won't be loaded...`),y;const w=a+c.level;if(w>h)return y;const _=T5[l],g=Math.log2(_),T=r&1,C=r>>1&1,I=r>>2&1,P=(_**a-1)/(_-1);let x=Qr(n.mortonIndex,r,g),N=P+x,D=Qr(n.x,T,1),F=Qr(n.y,C,1),X=Qr(n.z,I,1),q=!1;a>=u&&(q=xf(o.childSubtreeAvailability,x));const ee=Qr(c.x,D,a),K=Qr(c.y,F,a),He=Qr(c.z,X,a);if(q){const $=`${m}/${p}`,pe=wp($,w,ee,K,He);o=await Dr(pe,X1,i),c={mortonIndex:x,x:D,y:F,z:X,level:a},x=0,N=0,D=0,F=0,X=0,a=0}if(!xf(o.tileAvailability,N))return y;xf(o.contentAvailability,N)&&(y.contentUrl=wp(f,w,ee,K,He));const z=a+1,G={mortonIndex:x,x:D,y:F,z:X};for(let $=0;$<_;$++){const pe=E5(s,$,l),ce=await nw({subtree:o,implicitOptions:e,loaderOptions:i,parentData:G,childIndex:$,level:z,globalData:{...c},s2VolumeBox:pe});if(ce.contentUrl||ce.children.length){const ir=w+1,Gr=S5(ce,ir,{childTileX:D,childTileY:F,childTileZ:X},e,s);y.children.push(Gr)}}return y}function xf(t,e){let n;return Array.isArray(t)?(n=t[0],t.length>1&&WS.once('Not supported extension "3DTILES_multiple_contents" has been detected')):n=t,"constant"in n?!!n.constant:n.explicitBitstream?w5(e,n.explicitBitstream):!1}function S5(t,e,n,r,s){const{basePath:i,refine:o,getRefine:a,lodMetricType:c,getTileType:l,rootLodMetricValue:u,rootBoundingVolume:h}=r,f=t.contentUrl&&t.contentUrl.replace(`${i}/`,""),p=u/2**e,m=s!=null&&s.box?{box:s.box}:h,y=C5(e,m,n);return{children:t.children,contentUrl:t.contentUrl,content:{uri:f},id:t.contentUrl,refine:a(o),type:l(t),lodMetricType:c,lodMetricValue:p,geometricError:p,transform:t.transform,boundingVolume:y}}function C5(t,e,n){if(e.region){const{childTileX:r,childTileY:s,childTileZ:i}=n,[o,a,c,l,u,h]=e.region,f=2**t,p=(c-o)/f,m=(l-a)/f,y=(h-u)/f,[w,_]=[o+p*r,o+p*(r+1)],[g,T]=[a+m*s,a+m*(s+1)],[C,I]=[u+y*i,u+y*(i+1)];return{region:[w,g,_,T,C,I]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}function Qr(t,e,n){return(t<<n)+e}function wp(t,e,n,r,s){const i=v5({level:e,x:n,y:r,z:s});return t.replace(/{level}|{x}|{y}|{z}/gi,o=>i[o])}function v5(t){const e={};for(const n in t)e[`{${n}}`]=t[n];return e}function w5(t,e){const n=Math.floor(t/8),r=t%8;return(e[n]>>r&1)===1}function w_(t,e=""){if(!e)return $n.EMPTY;const r=e.split("?")[0].split(".").pop();switch(r){case"pnts":return $n.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return $n.SCENEGRAPH;default:return r||$n.EMPTY}}function R_(t){switch(t){case"REPLACE":case"replace":return an.REPLACE;case"ADD":case"add":return an.ADD;default:return t}}function Rp(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const r=new URL(t,`${e}/`);return decodeURI(r.toString())}else if(t.startsWith("/"))return t;return w3(e,t)}function v0(t,e){var s;if(!t)return null;let n;if(t.content){const i=t.content.uri||((s=t.content)==null?void 0:s.url);typeof i<"u"&&(n=Rp(i,e))}return{...t,id:n,contentUrl:n,lodMetricType:Li.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:w_(t,n),refine:R_(t.refine)}}async function R5(t,e,n){let r=null;const s=R0(t.root);s&&t.root?r=await w0(t.root,t,e,s,n):r=v0(t.root,e);const i=[];for(i.push(r);i.length>0;){const o=i.pop()||{},a=o.children||[],c=[];for(const l of a){const u=R0(l);let h;u?h=await w0(l,t,e,u,n):h=v0(l,e),h&&(c.push(h),i.push(h))}o.children=c}return r}async function w0(t,e,n,r,s){var C,I,P;const{subdivisionScheme:i,maximumLevel:o,availableLevels:a,subtreeLevels:c,subtrees:{uri:l}}=r,u=wp(l,0,0,0,0),h=Rp(u,n),f=await Dr(h,X1,s),p=(C=t.content)==null?void 0:C.uri,m=p?Rp(p,n):"",y=(I=e==null?void 0:e.root)==null?void 0:I.refine,w=t.geometricError,_=(P=t.boundingVolume.extensions)==null?void 0:P["3DTILES_bounding_volume_S2"];if(_){const N={box:tw(_),s2VolumeInfo:_};t.boundingVolume=N}const g=t.boundingVolume,T={contentUrlTemplate:m,subtreesUriTemplate:l,subdivisionScheme:i,subtreeLevels:c,maximumLevel:Number.isFinite(a)?a-1:o,refine:y,basePath:n,lodMetricType:Li.GEOMETRIC_ERROR,rootLodMetricValue:w,rootBoundingVolume:g,getTileType:w_,getRefine:R_};return await b5(t,n,f,T,s)}async function b5(t,e,n,r,s){if(!t)return null;const{children:i,contentUrl:o}=await nw({subtree:n,implicitOptions:r,loaderOptions:s});let a,c=null;return o&&(a=o,c={uri:o.replace(`${e}/`,"")}),{...t,id:a,contentUrl:a,lodMetricType:Li.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:w_(t,a),refine:R_(t.refine),content:c||t.content,children:i}}function R0(t){var e;return((e=t==null?void 0:t.extensions)==null?void 0:e["3DTILES_implicit_tiling"])||(t==null?void 0:t.implicitTiling)}const $o={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:U1,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:I5,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function I5(t,e={},n){const r=e["3d-tiles"]||{};let s;return r.isTileset==="auto"?s=(n==null?void 0:n.url)&&n.url.indexOf(".json")!==-1:s=r.isTileset,s?M5(t,e,n):B5(t,e,n)}async function M5(t,e,n){var c;const r=JSON.parse(new TextDecoder().decode(t)),s=(n==null?void 0:n.url)||"",i=P5(s),o=await R5(r,i,e||{});return{...r,shape:"tileset3d",loader:$o,url:s,queryString:(n==null?void 0:n.queryString)||"",basePath:i,root:o||r.root,type:ut.TILES3D,lodMetricType:Li.GEOMETRIC_ERROR,lodMetricValue:((c=r.root)==null?void 0:c.geometricError)||0}}async function B5(t,e,n){const r={content:{shape:"tile3d",featureIds:null}};return await W1(t,0,e,n,r.content),r.content}function P5(t){return wg(t)}const rw="https://api.cesium.com/v1/assets";async function O5(t,e){if(!e){const i=await x5(t);for(const o of i.items)o.type==="3DTILES"&&(e=o.id)}const n=await N5(t,e),{type:r,url:s}=n;return ae(r==="3DTILES"&&s),n.headers={Authorization:`Bearer ${n.accessToken}`},n}async function x5(t){ae(t);const e=rw,n={Authorization:`Bearer ${t}`},r=await da(e,{headers:n});if(!r.ok)throw new Error(r.statusText);return await r.json()}async function N5(t,e){ae(t,e);const n={Authorization:`Bearer ${t}`},r=`${rw}/${e}`;let s=await da(`${r}`,{headers:n});if(!s.ok)throw new Error(s.statusText);let i=await s.json();if(s=await da(`${r}/endpoint`,{headers:n}),!s.ok)throw new Error(s.statusText);const o=await s.json();return i={...i,...o},i}async function F5(t,e={}){e=e["cesium-ion"]||{};const{accessToken:n}=e;let r=e.assetId;if(!Number.isFinite(r)){const s=t.match(/\/([0-9]+)\/tileset.json/);r=s&&s[1]}return O5(n,r)}const sw={...$o,id:"cesium-ion",name:"Cesium Ion",preload:F5,parse:async(t,e,n)=>(e={...e},e["3d-tiles"]=e["cesium-ion"],e.loader=sw,$o.parse(t,e,n)),options:{"cesium-ion":{...$o.options["3d-tiles"],accessToken:null}}},b0=[0],D5={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:$o,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,n)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class b_ extends kL{initializeState(){"onTileLoadFail"in this.props&&ie.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,n;return!!((n=(e=this.state)==null?void 0:e.tileset3d)!=null&&n.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:n,changeFlags:r}){if(e.data&&e.data!==n.data&&this._loadTileset(e.data),r.viewportChanged){const{activeViewports:s}=this.state;Object.keys(s).length&&(this._updateTileset(s),this.state.lastUpdatedViewports=s,this.state.activeViewports={})}if(r.propsChanged){const{layerMap:s}=this.state;for(const i in s)s[i].needsUpdate=!0}}activateViewport(e){const{activeViewports:n,lastUpdatedViewports:r}=this.state;this.internalState.viewport=e,n[e.id]=e;const s=r==null?void 0:r[e.id];(!s||!e.equals(s))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:n}){const r=n&&n.props.tile;return e.picked&&(e.object=r),e.sourceTile=r,e}filterSubLayer({layer:e,viewport:n}){const{tile:r}=e.props,{id:s}=n;return r.selected&&r.viewportIds.includes(s)}_updateAutoHighlight(e){const n=e.sourceTile,r=this.state.layerMap[n==null?void 0:n.id];r&&r.layer&&r.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:n={}}=this.props,r=this.props.loader||this.props.loaders,s=Array.isArray(r)?r[0]:r,i={loadOptions:{...n}};let o=e;if(s.preload){const l=await s.preload(e,n);l.url&&(o=l.url),l.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:l.headers}),Object.assign(i,l)}const a=await Dr(o,s,i.loadOptions),c=new fH(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:c,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(c)}_onTileLoad(e){const{lastUpdatedViewports:n}=this.state;this.props.onTileLoad(e),this._updateTileset(n),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:n}=this.state,{timeline:r}=this.context,s=Object.keys(e).length;!r||!s||!n||n.selectTiles(Object.values(e)).then(i=>{this.state.frameNumber!==i&&this.setState({frameNumber:i})})}_getSubLayer(e,n){if(!e.content)return null;switch(e.type){case $n.POINTCLOUD:return this._makePointCloudLayer(e,n);case $n.SCENEGRAPH:return this._make3DModelLayer(e);case $n.MESH:return this._makeSimpleMeshLayer(e,n);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,n){const{attributes:r,pointCount:s,constantRGBA:i,cartographicOrigin:o,modelMatrix:a}=e.content,{positions:c,normals:l,colors:u}=r;if(!c)return null;const h=n&&n.props.data||{header:{vertexCount:s},attributes:{POSITION:c,NORMAL:l,COLOR_0:u}},{pointSize:f,getPointColor:p}=this.props,m=this.getSubLayerClass("pointcloud",i4);return new m({pointSize:f},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:h,coordinateSystem:Z.METER_OFFSETS,coordinateOrigin:o,modelMatrix:a,getColor:i||p,_offset:0})}_make3DModelLayer(e){const{gltf:n,instances:r,cartographicOrigin:s,modelMatrix:i}=e.content,o=this.getSubLayerClass("scenegraph",hV);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:r||b0,scenegraph:n,coordinateSystem:Z.METER_OFFSETS,coordinateOrigin:s,modelMatrix:i,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,n){const r=e.content,{attributes:s,indices:i,modelMatrix:o,cartographicOrigin:a,coordinateSystem:c=Z.METER_OFFSETS,material:l,featureIds:u}=r,{_getMeshColor:h}=this.props,f=n&&n.props.mesh||new Ei({topology:"triangle-list",attributes:k5(s),indices:i}),p=this.getSubLayerClass("mesh",_V);return new p(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:f,data:b0,getColor:h(e),pbrMaterial:l,modelMatrix:o,coordinateOrigin:a,coordinateSystem:c,featureIds:u,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:n}=this.state;return e?e.tiles.map(r=>{const s=n[r.id]=n[r.id]||{tile:r};let{layer:i}=s;return r.selected&&(i?s.needsUpdate&&(i=this._getSubLayer(r,i),s.needsUpdate=!1):i=this._getSubLayer(r)),s.layer=i,i}).filter(Boolean):null}}b_.defaultProps=D5;b_.layerName="Tile3DLayer";const U5=b_;function k5(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}const L5=96188,V5="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3NjEwMjA4Ni00YmVkLTQyMjgtYjRmZS1lY2M3ZWFiMmFmNTYiLCJpZCI6MjYxMzMsImlhdCI6MTY3NTM2ODY4NX0.chGkGL6DkDNv5wYJQDMzWIvi9iDoVa27dgng_5ARDmo",H5=`https://assets.ion.cesium.com/${L5}/tileset.json`,z5={latitude:40,longitude:-75,pitch:45,maxPitch:60,bearing:0,minZoom:2,maxZoom:30,zoom:17};function j5({mapStyle:t="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json",updateAttributions:e}){const[n,r]=H.useState(z5),s=o=>{console.log(o);const{zoom:a,cartographicCenter:c}=o,[l,u]=c;console.log(l),console.log(u),console.log(a)},i=new U5({id:"tile-3d-layer",data:H5,loader:sw,loadOptions:{"cesium-ion":{accessToken:V5}},onTilesetLoad:s});return Ff.createElement(e4,{layers:[i],initialViewState:n,controller:!0},Ff.createElement(RI,{reuseMaps:!0,mapStyle:t}))}function W5(t){VS(t).render(Ff.createElement(j5,null))}W5(document.getElementById("app"));export{G5 as c,M0 as g};
